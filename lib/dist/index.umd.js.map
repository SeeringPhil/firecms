{"version":3,"file":"index.umd.js","sources":["../src/core/contexts/BreacrumbsContext.tsx","../src/core/contexts/ModeController.tsx","../src/core/util/navigation_utils.ts","../src/core/util/navigation_from_path.ts","../src/core/internal/common.tsx","../src/core/contexts/DataSourceContext.tsx","../src/hooks/data/useDataSource.tsx","../src/core/contexts/NavigationContext.tsx","../src/hooks/useNavigationContext.tsx","../src/core/contexts/AuthControllerContext.tsx","../src/hooks/useAuthController.tsx","../src/core/contexts/SideDialogsControllerContext.tsx","../src/hooks/useSideDialogsController.tsx","../src/core/contexts/SideEntityControllerContext.tsx","../src/hooks/useSideEntityController.tsx","../src/core/contexts/StorageSourceContext.tsx","../src/hooks/useStorageSource.tsx","../src/hooks/useSnackbarController.tsx","../src/core/contexts/UserConfigurationPersistenceContext.tsx","../src/hooks/useUserConfigurationPersistence.tsx","../src/hooks/useFireCMSContext.tsx","../src/hooks/data/useCollectionFetch.tsx","../src/hooks/data/useEntityFetch.tsx","../src/hooks/data/save.ts","../src/hooks/data/delete.ts","../src/form/useClearRestoreValue.tsx","../src/hooks/useResolvedNavigationFrom.tsx","../src/hooks/useModeController.tsx","../src/hooks/useClipboard.tsx","../src/hooks/useBreadcrumbsContext.tsx","../src/hooks/useReferenceDialog.tsx","../src/hooks/useBrowserTitleAndIcon.tsx","../src/core/components/ErrorTooltip.tsx","../src/core/components/ErrorView.tsx","../src/types/entities.ts","../src/preview/PropertyPreview.tsx","../src/core/util/hash.ts","../src/core/util/chip_utils.ts","../src/core/util/enums.ts","../src/preview/components/ColorChip.tsx","../src/preview/property_previews/StringPropertyPreview.tsx","../src/preview/property_previews/ArrayOfStringsPreview.tsx","../src/preview/components/ArrayEnumPreview.tsx","../src/preview/property_previews/ArrayPropertyEnumPreview.tsx","../src/preview/property_previews/ArrayOfMapsPreview.tsx","../src/preview/property_previews/NumberPropertyPreview.tsx","../src/preview/property_previews/ArrayOfStorageComponentsPreview.tsx","../src/preview/property_previews/ArrayOfReferencesPreview.tsx","../src/preview/property_previews/MapPropertyPreview.tsx","../src/preview/property_previews/ArrayPropertyPreview.tsx","../src/core/util/common.tsx","../src/preview/property_previews/ArrayOneOfPreview.tsx","../src/preview/util.ts","../src/preview/property_previews/SkeletonPropertyComponent.tsx","../src/preview/components/AsyncPreviewComponent.tsx","../src/core/util/dates.ts","../src/preview/components/DatePreview.tsx","../src/preview/components/ImagePreview.tsx","../src/preview/components/UrlComponentPreview.tsx","../src/preview/components/StorageThumbnail.tsx","../src/preview/components/BooleanPreview.tsx","../src/preview/components/Markdown.tsx","../src/preview/components/EmptyValue.tsx","../src/preview/components/ReferencePreview.tsx","../src/core/util/objects.ts","../src/core/util/entities.ts","../src/core/util/collections.ts","../src/core/util/strings.ts","../src/core/util/paths.ts","../src/core/util/regexp.ts","../src/core/util/useDebounce.ts","../src/core/util/useDebounceValue.ts","../src/form/components/ArrayContainer.tsx","../src/form/components/FieldDescription.tsx","../src/form/components/LabelWithIcon.tsx","../src/form/components/DebouncedTextField.tsx","../src/form/components/SwitchControl.tsx","../src/form/field_bindings/SelectFieldBinding.tsx","../src/form/field_bindings/ArrayEnumSelectBinding.tsx","../src/form/field_bindings/ArrayOfReferencesFieldBinding.tsx","../src/core/util/storage.ts","../src/core/util/useStorageUploadController.tsx","../src/form/components/StorageUploadProgress.tsx","../src/form/components/StorageItemPreview.tsx","../src/form/field_bindings/utils.tsx","../src/form/field_bindings/StorageUploadFieldBinding.tsx","../src/core/components/fields/TextareaAutosize.tsx","../src/core/components/fields/DisabledTextField.tsx","../src/core/components/fields/TextInput.tsx","../src/form/field_bindings/TextFieldBinding.tsx","../src/form/field_bindings/SwitchFieldBinding.tsx","../src/form/field_bindings/DateTimeFieldBinding.tsx","../src/form/components/ReferenceWidget.tsx","../src/form/field_bindings/ReferenceFieldBinding.tsx","../src/core/components/ErrorBoundary.tsx","../src/form/field_bindings/ReadOnlyFieldBinding.tsx","../src/form/PropertyFieldBinding.tsx","../src/form/field_bindings/MapFieldBinding.tsx","../src/core/components/ExpandablePanel.tsx","../src/form/field_bindings/RepeatFieldBinding.tsx","../src/form/field_bindings/BlockFieldBinding.tsx","../src/form/field_bindings/MarkdownFieldBinding.tsx","../src/form/validation.ts","../src/form/components/ErrorFocus.tsx","../src/core/util/resolutions.ts","../src/form/components/CustomIdField.tsx","../src/form/EntityForm.tsx","../src/form/field_bindings/ArrayCustomShapedFieldBinding.tsx","../src/core/form_field_configs.tsx","../src/core/util/property_utils.tsx","../src/core/util/permissions.ts","../src/core/util/icons.tsx","../src/core/util/plurals.ts","../src/core/util/references.ts","../src/core/components/EntityPreview.tsx","../src/core/components/EntityCollectionTable/internal/common.tsx","../src/core/components/Table/fields/TableInput.tsx","../src/core/components/Table/fields/TableSelect.tsx","../src/core/components/Table/fields/TableNumberInput.tsx","../src/core/components/Table/fields/TableSwitch.tsx","../src/core/components/Table/fields/TableDateField.tsx","../src/core/components/EntityCollectionTable/fields/TableReferenceField.tsx","../src/core/components/EntityCollectionTable/fields/TableStorageUpload.tsx","../src/core/components/Table/common.tsx","../src/core/components/EntityCollectionTable/internal/TableCell.tsx","../src/core/components/EntityCollectionTable/internal/PropertyTableCell.tsx","../src/core/components/EntityCollectionTable/internal/popup_field/useDraggable.tsx","../src/core/components/EntityCollectionTable/internal/popup_field/useWindowSize.tsx","../src/core/components/EntityCollectionTable/internal/popup_field/ElementResizeListener.tsx","../src/core/components/CustomDialogActions.tsx","../src/core/components/EntityCollectionTable/internal/popup_field/PopupFormField.tsx","../src/core/components/CircularProgressCenter.tsx","../src/core/components/Table/VirtualTableHeader.tsx","../src/core/components/Table/VirtualTableHeaderRow.tsx","../src/core/components/Table/VirtualTableRow.tsx","../src/core/components/Table/VirtualTableCell.tsx","../src/core/components/Table/VirtualTable.tsx","../src/core/components/EntityCollectionTable/internal/EntityCollectionRowActions.tsx","../src/core/components/EntityCollectionTable/internal/SearchBar.tsx","../src/core/components/fields/FilledSelect.tsx","../src/core/components/EntityCollectionTable/internal/CollectionTableToolbar.tsx","../src/core/components/EntityCollectionTable/filters/ReferenceFilterField.tsx","../src/core/components/EntityCollectionTable/filters/StringNumberFilterField.tsx","../src/core/components/EntityCollectionTable/filters/BooleanFilterField.tsx","../src/core/components/EntityCollectionTable/filters/DateTimeFilterfield.tsx","../src/core/components/EntityCollectionTable/EntityCollectionTable.tsx","../src/core/internal/SideDialogDrawer.tsx","../src/core/internal/useUnsavedChangesDialog.tsx","../src/core/SideDialogs.tsx","../src/core/components/EntityCollectionTable/internal/DeleteEntityDialog.tsx","../src/core/util/csv.ts","../src/core/components/EntityCollectionTable/internal/ExportButton.tsx","../src/core/components/EntityCollectionView/EntityCollectionViewActions.tsx","../src/hooks/data/useDataOrder.ts","../src/core/components/EntityCollectionTable/useDebouncedData.ts","../src/core/components/EntityCollectionTable/useTableController.tsx","../src/core/components/EntityCollectionView/isFilterCombinationValidForFirestore.tsx","../src/core/components/EntityCollectionView/EntityCollectionView.tsx","../src/core/components/ReferenceSelectionInner.tsx","../src/core/util/arrays.ts","../src/core/components/HomePage/NavigationGroup.tsx","../src/core/components/HomePage/NavigationCollectionCard.tsx","../src/core/components/HomePage/FavouritesView.tsx","../src/core/internal/useRestoreScroll.tsx","../src/core/components/HomePage/FireCMSHomePage.tsx","../src/core/components/BreadcrumbUpdater.tsx","../src/core/components/NotFoundPage.tsx","../src/core/components/DeleteConfirmationDialog.tsx","../src/core/components/FireCMSLogo.tsx","../src/core/components/CenteredView.tsx","../src/core/components/InfoLabel.tsx","../src/core/Drawer.tsx","../src/core/Scaffold.tsx","../src/core/components/FireCMSAppBar.tsx","../src/core/internal/useLargeSideLayout.tsx","../src/core/internal/EntityView.tsx","../src/core/EntitySidePanel.tsx","../src/core/internal/useBuildSideEntityController.tsx","../src/core/internal/useBuildNavigationContext.tsx","../src/core/internal/useBuildSideDialogsController.tsx","../src/core/FireCMS.tsx","../src/core/theme.ts","../src/core/NavigationRoutes.tsx","../src/core/builders.ts","../src/core/useBuildModeController.tsx","../src/core/useBuildLocalConfigurationPersistence.tsx","../src/core/contexts/SnackbarContext.tsx","../src/firebase_app/hooks/useFirebaseAuthController.ts","../src/firebase_app/util/dates.ts","../src/firebase_app/hooks/useFirestoreDataSource.ts","../src/firebase_app/hooks/useFirebaseStorageSource.ts","../src/firebase_app/hooks/useValidateAuthenticator.tsx","../src/firebase_app/hooks/useInitialiseFirebase.ts","../src/firebase_app/hooks/useInitializeAppCheck.ts","../src/firebase_app/components/social_icons.tsx","../src/firebase_app/hooks/useRecaptcha.tsx","../src/firebase_app/components/FirebaseLoginView.tsx","../src/firebase_app/FirebaseCMSApp.tsx","../src/firebase_app/types/text_search.ts"],"sourcesContent":["import React, { useState } from \"react\";\nimport {\n    BreadcrumbEntry,\n    BreadcrumbsController\n} from \"../../hooks/useBreadcrumbsContext\";\n\nconst DEFAULT_BREADCRUMBS_CONTROLLER = {\n    breadcrumbs: [],\n    set: (props: {\n        breadcrumbs: BreadcrumbEntry[];\n    }) => {\n    }\n};\n\nexport const BreadcrumbContext = React.createContext<BreadcrumbsController>(DEFAULT_BREADCRUMBS_CONTROLLER);\n\ninterface BreadcrumbsProviderProps {\n    children: React.ReactNode;\n}\n\nexport const BreadcrumbsProvider: React.FC<BreadcrumbsProviderProps> = ({ children }) => {\n\n    const [breadcrumbs, setBreadcrumbs] = useState<BreadcrumbEntry[]>([]);\n\n    const set = (props: {\n        breadcrumbs: BreadcrumbEntry[];\n    }) => {\n        setBreadcrumbs(props.breadcrumbs);\n    };\n\n    return (\n        <BreadcrumbContext.Provider\n            value={{\n                breadcrumbs,\n                set\n            }}\n        >\n            {children}\n        </BreadcrumbContext.Provider>\n    );\n};\n","import React from \"react\";\nimport { ModeController } from \"../../hooks\";\n\nconst DEFAULT_MODE_STATE: ModeController = {\n    mode: \"light\",\n    setMode: (mode: \"light\" | \"dark\") => {\n    },\n    toggleMode: () => {\n    }\n};\nexport const ModeControllerContext = React.createContext<ModeController>(DEFAULT_MODE_STATE);\n\nexport const ModeControllerProvider = ModeControllerContext.Provider;\n","import { EntityCollection } from \"../../types\";\n\nexport function removeInitialAndTrailingSlashes(s: string): string {\n    return removeInitialSlash(removeTrailingSlash(s));\n}\n\nexport function removeInitialSlash(s: string) {\n    if (s.startsWith(\"/\"))\n        return s.slice(1);\n    else return s;\n}\n\nexport function removeTrailingSlash(s: string) {\n    if (s.endsWith(\"/\"))\n        return s.slice(0, -1);\n    else return s;\n}\n\nexport function addInitialSlash(s: string) {\n    if (s.startsWith(\"/\"))\n        return s;\n    else return `/${s}`;\n}\n\nexport function getLastSegment(path: string) {\n    const cleanPath = removeInitialAndTrailingSlashes(path);\n    if (cleanPath.includes(\"/\")) {\n        const segments = cleanPath.split(\"/\");\n        return segments[segments.length - 1];\n    }\n    return cleanPath;\n}\n\nexport function resolveCollectionPathAliases(path: string, allCollections: EntityCollection[]): string {\n\n    const cleanPath = removeInitialAndTrailingSlashes(path);\n    const subpaths = cleanPath.split(\"/\");\n    if (subpaths.length % 2 === 0) {\n        throw Error(`Collection paths must have an odd number of segments: ${path}`);\n    }\n\n    const aliasedCollection = allCollections.find((col) => col.alias === subpaths[0]);\n    let resolvedAliased;\n    if (aliasedCollection) {\n        resolvedAliased = aliasedCollection.path;\n    }\n\n    if (subpaths.length > 1) {\n        const segmentCollection = getCollectionByPathOrAlias(resolvedAliased ?? subpaths[0], allCollections);\n        if (!segmentCollection?.subcollections) {\n            return cleanPath;\n        }\n        const restOfThePath = cleanPath.split(\"/\").slice(2).join(\"/\");\n        return (resolvedAliased ?? subpaths[0]) + \"/\" + subpaths[1] + \"/\" + resolveCollectionPathAliases(restOfThePath, segmentCollection.subcollections);\n    } else {\n        return resolvedAliased ?? cleanPath;\n    }\n}\n\n/**\n * Find the corresponding view at any depth for a given path.\n * Note that path or segments of the paths can be collection aliases.\n * @param pathOrAlias\n * @param collections\n */\nexport function getCollectionByPathOrAlias<M extends Record<string, any>>(pathOrAlias: string, collections: EntityCollection[]): EntityCollection | undefined {\n\n    const subpaths = removeInitialAndTrailingSlashes(pathOrAlias).split(\"/\");\n    if (subpaths.length % 2 === 0) {\n        throw Error(`Collection paths must have an odd number of segments: ${pathOrAlias}`);\n    }\n\n    const subpathCombinations = getCollectionPathsCombinations(subpaths);\n    let result: EntityCollection | undefined;\n    for (let i = 0; i < subpathCombinations.length; i++) {\n        const subpathCombination = subpathCombinations[i];\n        const navigationEntry = collections && collections\n            .sort((a, b) => (a.alias ?? \"\").localeCompare(b.alias ?? \"\"))\n            .find((entry) => entry.alias === subpathCombination || entry.path === subpathCombination);\n\n        if (navigationEntry) {\n\n            if (subpathCombination === pathOrAlias) {\n                result = navigationEntry;\n            } else if (navigationEntry.subcollections) {\n                const newPath = pathOrAlias.replace(subpathCombination, \"\").split(\"/\").slice(2).join(\"/\");\n                if (newPath.length > 0)\n                    result = getCollectionByPathOrAlias(newPath, navigationEntry.subcollections);\n            }\n        }\n        if (result) break;\n    }\n    return result;\n}\n\n/**\n * Get the subcollection combinations from a path:\n * \"sites/es/locales\" => [\"sites/es/locales\", \"sites\"]\n * @param subpaths\n */\nexport function getCollectionPathsCombinations(subpaths: string[]): string[] {\n    const entries = subpaths.length > 0 && subpaths.length % 2 === 0 ? subpaths.splice(0, subpaths.length - 1) : subpaths;\n\n    const length = entries.length;\n    const result: string[] = [];\n    for (let i = length; i > 0; i = i - 2) {\n        result.push(entries.slice(0, i).join(\"/\"));\n    }\n    return result;\n\n}\n","import { EntityCollection, EntityCustomView } from \"../../types\";\nimport {\n    getCollectionPathsCombinations,\n    removeInitialAndTrailingSlashes\n} from \"./navigation_utils\";\n\nexport type NavigationViewInternal<M extends Record<string, any> = any> =\n    | NavigationViewEntityInternal<M>\n    | NavigationViewCollectionInternal<M>\n    | NavigationViewEntityCustomInternal<M>;\n\ninterface NavigationViewEntityInternal<M extends Record<string, any>> {\n    type: \"entity\";\n    entityId: string;\n    path: string;\n    parentCollection: EntityCollection<M>;\n}\n\ninterface NavigationViewCollectionInternal<M extends Record<string, any>> {\n    type: \"collection\";\n    path: string;\n    collection: EntityCollection<M>;\n}\n\ninterface NavigationViewEntityCustomInternal<M extends Record<string, any>> {\n    type: \"custom_view\";\n    path: string;\n    view: EntityCustomView<M>;\n}\n\nexport function getNavigationEntriesFromPathInternal(props: {\n    path: string,\n    collections: EntityCollection[] | undefined,\n    customViews?: EntityCustomView<any>[],\n    currentFullPath?: string,\n}): NavigationViewInternal [] {\n\n    const {\n        path,\n        collections = [],\n        currentFullPath\n    } = props;\n\n    const subpaths = removeInitialAndTrailingSlashes(path).split(\"/\");\n    const subpathCombinations = getCollectionPathsCombinations(subpaths);\n\n    const result: NavigationViewInternal[] = [];\n    for (let i = 0; i < subpathCombinations.length; i++) {\n        const subpathCombination = subpathCombinations[i];\n\n        const collection: EntityCollection<any> | undefined = collections && collections.find((entry) => entry.alias === subpathCombination || entry.path === subpathCombination);\n\n        if (collection) {\n            const pathOrAlias = collection.alias ?? collection.path;\n            const collectionPath = currentFullPath && currentFullPath.length > 0\n                ? (currentFullPath + \"/\" + pathOrAlias)\n                : pathOrAlias;\n\n            result.push({\n                type: \"collection\",\n                path: collectionPath,\n                collection\n            });\n            const restOfThePath = removeInitialAndTrailingSlashes(removeInitialAndTrailingSlashes(path).replace(subpathCombination, \"\"));\n            const nextSegments = restOfThePath.length > 0 ? restOfThePath.split(\"/\") : [];\n            if (nextSegments.length > 0) {\n                const entityId = nextSegments[0];\n                const fullPath = collectionPath + \"/\" + entityId;\n                result.push({\n                    type: \"entity\",\n                    entityId,\n                    path: collectionPath,\n                    parentCollection: collection\n                });\n                if (nextSegments.length > 1) {\n                    const newPath = nextSegments.slice(1).join(\"/\");\n                    if (!collection) {\n                        throw Error(\"collection not found resolving path: \" + collection);\n                    }\n                    const customViews = collection.views;\n                    const customView = customViews && customViews.find((entry) => entry.path === newPath);\n                    if (customView) {\n                        const path = currentFullPath && currentFullPath.length > 0\n                            ? (currentFullPath + \"/\" + customView.path)\n                            : customView.path;\n                        result.push({\n                            type: \"custom_view\",\n                            path,\n                            view: customView\n                        });\n                    } else if (collection.subcollections) {\n                        result.push(...getNavigationEntriesFromPathInternal({\n                            path: newPath,\n                            customViews,\n                            collections: collection.subcollections,\n                            currentFullPath: fullPath\n                        }));\n                    }\n                }\n            }\n            break;\n        }\n\n    }\n    return result;\n}\n","export const CONTAINER_FULL_WIDTH = \"100vw\";\n\nexport const ADDITIONAL_TAB_WIDTH = \"55vw\";\n\nexport const FORM_CONTAINER_WIDTH = \"700px\";\n","import React from \"react\";\nimport { DataSource } from \"../../types\";\n\nexport const DataSourceContext = React.createContext<DataSource>({} as DataSource);\n","import { useContext } from \"react\";\nimport { DataSource } from \"../../types\";\nimport { DataSourceContext } from \"../../core/contexts/DataSourceContext\";\n\n/**\n * Use this hook to get the datasource being used\n * @category Hooks and utilities\n */\nexport const useDataSource = (): DataSource => useContext(DataSourceContext);\n","import React from \"react\";\nimport { NavigationContext } from \"../../types\";\n\nexport const NavigationContextInstance = React.createContext<NavigationContext>({} as NavigationContext);\n","import { NavigationContext } from \"../types\";\nimport { useContext } from \"react\";\nimport { NavigationContextInstance } from \"../core/contexts/NavigationContext\";\n\n/**\n * Use this hook to get the navigation of the app.\n * This controller provides the resolved collections for the CMS as well\n * as utility methods.\n *\n * @category Hooks and utilities\n */\nexport const useNavigationContext = (): NavigationContext => useContext(NavigationContextInstance);\n","import React from \"react\";\nimport { AuthController } from \"../../types\";\n\nexport const AuthControllerContext = React.createContext<AuthController>({} as AuthController);\n","import { AuthController, User } from \"../types\";\nimport { useContext } from \"react\";\nimport { AuthControllerContext } from \"../core/contexts/AuthControllerContext\";\n\n/**\n * Hook to retrieve the AuthContext.\n *\n * Consider that in order to use this hook you need to have a parent\n * `FireCMS`\n *\n * @see AuthController\n * @category Hooks and utilities\n */\nexport const useAuthController = <UserType extends User = User, AuthControllerType extends AuthController<UserType> = AuthController<UserType>>(): AuthControllerType => useContext(AuthControllerContext) as AuthControllerType;\n","import React from \"react\";\nimport { SideDialogsController } from \"../../types\";\n\nexport const SideDialogsControllerContext = React.createContext<SideDialogsController>({} as SideDialogsController);\n","import { SideDialogsController } from \"../types\";\nimport {\n    SideDialogsControllerContext\n} from \"../core/contexts/SideDialogsControllerContext\";\nimport { useContext } from \"react\";\n\n/**\n * Hook to retrieve the side dialogs' controller.\n *\n * This hook allows you to open and close side dialogs. This is the mechanism\n * used when open a side entity dialog, or when selecting a reference.\n *\n * If you want to open a side entity dialog, you can use the {@link useSideEntityController}\n * hook.\n *\n * If you want to select a reference, you can use the {@link useReferenceDialog}\n *\n * Consider that in order to use this hook you need to have a parent\n * `FireCMS`\n *\n * @category Hooks and utilities\n */\nexport const useSideDialogsController = (): SideDialogsController => useContext(SideDialogsControllerContext);\n","import React from \"react\";\nimport { SideEntityController } from \"../../types\";\n\nexport const SideEntityControllerContext = React.createContext<SideEntityController>({} as SideEntityController);\n","import { SideEntityController } from \"../types\";\nimport { useContext } from \"react\";\nimport {\n    SideEntityControllerContext\n} from \"../core/contexts/SideEntityControllerContext\";\n\n/**\n * Use this hook to retrieve an entity controller that allows you to open\n * a side dialog to edit an entity.\n *\n * Consider that in order to use this hook you need to have a parent\n * `FireCMS`\n *\n * @see SideEntityController\n * @category Hooks and utilities\n */\nexport const useSideEntityController = (): SideEntityController => useContext(SideEntityControllerContext);\n","import React from \"react\";\nimport { StorageSource } from \"../../types\";\n\nexport const StorageSourceContext = React.createContext<StorageSource>({} as StorageSource);\n","import { StorageSource } from \"../types\";\nimport { StorageSourceContext } from \"../core/contexts/StorageSourceContext\";\nimport { useContext } from \"react\";\n\n/**\n * Use this hook to get the storage source being used\n * @category Hooks and utilities\n */\nexport const useStorageSource = (): StorageSource => useContext(StorageSourceContext);\n","import { useSnackbar } from \"notistack\";\nimport { useCallback } from \"react\";\n\n/**\n * Possible snackbar types\n * @category Hooks and utilities\n */\nexport type SnackbarMessageType = \"success\" | \"info\" | \"warning\" | \"error\";\n\n/**\n * Controller to display snackbars\n * @category Hooks and utilities\n */\nexport interface SnackbarController {\n\n    /**\n     * Close the currently open snackbar\n     */\n    close: () => void;\n\n    /**\n     * Display a new snackbar. You need to specify the type and message.\n     * You can optionally specify a title\n     */\n    open: (props: {\n        type: SnackbarMessageType;\n        message: React.ReactNode;\n    }) => void;\n}\n\n/**\n * Hook to retrieve the SnackbarContext.\n *\n * Consider that in order to use this hook you need to have a parent\n * `FireCMS`\n *\n * @see SnackbarController\n * @category Hooks and utilities\n */\nexport const useSnackbarController = () => {\n\n    const {\n        enqueueSnackbar,\n        closeSnackbar\n    } = useSnackbar();\n\n    const open = useCallback((props: {\n        type: SnackbarMessageType;\n        // title?: string;\n        message: React.ReactNode;\n    }) => {\n        const {\n            type,\n            message\n        } = props;\n        enqueueSnackbar({\n            message,\n            variant: type\n        })\n    }, []);\n\n    return {\n        open,\n        close: closeSnackbar\n    }\n\n};\n","import React from \"react\";\nimport { UserConfigurationPersistence } from \"../../types\";\n\nexport const UserConfigurationPersistenceContext = React.createContext<UserConfigurationPersistence | undefined>(undefined);\n","import { UserConfigurationPersistence } from \"../types\";\nimport React, { useContext } from \"react\";\nimport {\n    UserConfigurationPersistenceContext\n} from \"../core/contexts/UserConfigurationPersistenceContext\";\n\n/**\n * Use this controller to access the configuration that is stored externally,\n * and not defined in code\n *\n * @category Hooks and utilities\n */\nexport const useUserConfigurationPersistence = (): UserConfigurationPersistence | undefined => useContext(UserConfigurationPersistenceContext);\n","import { createContext, useContext } from \"react\";\nimport { AuthController, FireCMSContext, User } from \"../types\";\nimport { useAuthController } from \"./useAuthController\";\nimport { useSideDialogsController } from \"./useSideDialogsController\";\nimport { useNavigationContext } from \"./useNavigationContext\";\nimport { useSideEntityController } from \"./useSideEntityController\";\nimport { useDataSource } from \"./data/useDataSource\";\nimport { useStorageSource } from \"./useStorageSource\";\nimport { useSnackbarController } from \"./useSnackbarController\";\nimport {\n    useUserConfigurationPersistence\n} from \"./useUserConfigurationPersistence\";\n\nexport const FireCMSContextInstance = createContext<Partial<FireCMSContext>>({\n    sideDialogsController: {} as any,\n    sideEntityController: {} as any,\n    navigation: {} as any,\n    dataSource: {} as any,\n    storageSource: {} as any,\n    authController: {} as any,\n    snackbarController: {} as any,\n    fields: {}\n});\n\n/**\n * Hook to retrieve the {@link FireCMSContext}.\n *\n * Consider that in order to use this hook you need to have a parent\n * `FireCMS` component.\n *\n * @see FireCMSContext\n * @category Hooks and utilities\n */\nexport const useFireCMSContext = <UserType extends User = User, AuthControllerType extends AuthController<UserType> = AuthController<UserType>>(): FireCMSContext<UserType, AuthControllerType> => {\n\n    const partialContext = useContext(FireCMSContextInstance) as FireCMSContext<UserType, AuthControllerType>;\n    const authController = useAuthController<UserType, AuthControllerType>();\n    const sideDialogsController = useSideDialogsController();\n    const sideEntityController = useSideEntityController();\n    const navigation = useNavigationContext();\n    const dataSource = useDataSource();\n    const storageSource = useStorageSource();\n    const snackbarController = useSnackbarController();\n    const userConfigPersistence = useUserConfigurationPersistence();\n\n    return {\n        ...partialContext,\n        authController,\n        sideDialogsController,\n        sideEntityController,\n        navigation,\n        dataSource,\n        storageSource,\n        snackbarController,\n        userConfigPersistence\n    }\n\n};\n","import { useEffect, useState } from \"react\";\nimport {\n    Entity,\n    EntityCollection,\n    FilterValues,\n    FireCMSContext,\n    User\n} from \"../../types\";\nimport { useDataSource } from \"./useDataSource\";\nimport { useNavigationContext } from \"../useNavigationContext\";\nimport { useFireCMSContext } from \"../useFireCMSContext\";\n\n/**\n * @category Hooks and utilities\n */\nexport interface CollectionFetchProps<M extends Record<string, any>> {\n\n    /**\n     * Absolute collection path\n     */\n    path: string;\n\n    /**\n     * collection of the entity displayed by this collection\n     */\n    collection: EntityCollection<M>\n\n    /**\n     * Number of entities to fetch\n     */\n    itemCount?: number;\n\n    /**\n     * Filter the fetched data by the property\n     */\n    filterValues?: FilterValues<Extract<keyof M, string>>;\n\n    /**\n     * Sort the results by\n     */\n    sortBy?: [Extract<keyof M, string>, \"asc\" | \"desc\"];\n\n    /**\n     * Search string\n     */\n    searchString?: string;\n}\n\n/**\n * @category Hooks and utilities\n */\nexport interface CollectionFetchResult<M extends Record<string, any>> {\n    data: Entity<M>[];\n    dataLoading: boolean;\n    noMoreToLoad: boolean;\n    dataLoadingError?: Error;\n}\n\n/**\n * This hook is used to fetch collections using a given collection\n * @param path\n * @param collection\n * @param filterValues\n * @param sortBy\n * @param itemCount\n * @param searchString\n * @category Hooks and utilities\n */\nexport function useCollectionFetch<M extends Record<string, any>, UserType extends User>(\n    {\n        path: inputPath,\n        collection,\n        filterValues,\n        sortBy,\n        itemCount,\n        searchString\n    }: CollectionFetchProps<M>): CollectionFetchResult<M> {\n\n    const dataSource = useDataSource();\n    const navigationContext = useNavigationContext();\n\n    const path = navigationContext.resolveAliasesFrom(inputPath);\n\n    const sortByProperty = sortBy ? sortBy[0] : undefined;\n    const currentSort = sortBy ? sortBy[1] : undefined;\n\n    const context: FireCMSContext<UserType> = useFireCMSContext();\n\n    const [data, setData] = useState<Entity<M>[]>([]);\n\n    const [dataLoading, setDataLoading] = useState<boolean>(false);\n    const [dataLoadingError, setDataLoadingError] = useState<Error | undefined>();\n    const [noMoreToLoad, setNoMoreToLoad] = useState<boolean>(false);\n\n    useEffect(() => {\n\n        setDataLoading(true);\n\n        const onEntitiesUpdate = async (entities: Entity<M>[]) => {\n            if (collection.callbacks?.onFetch) {\n                try {\n                    entities = await Promise.all(\n                        entities.map((entity) =>\n                            collection.callbacks!.onFetch!({\n                                collection,\n                                path,\n                                entity,\n                                context\n                            })));\n                } catch (e: any) {\n                    console.error(e);\n                }\n            }\n            setDataLoading(false);\n            setDataLoadingError(undefined);\n            setData(entities);\n            setNoMoreToLoad(!itemCount || entities.length < itemCount);\n        };\n\n        const onError = (error: Error) => {\n            console.error(\"ERROR\", error);\n            setDataLoading(false);\n            setData([]);\n            setDataLoadingError(error);\n        };\n\n        if (dataSource.listenCollection) {\n            return dataSource.listenCollection<M>({\n                path,\n                collection,\n                onUpdate: onEntitiesUpdate,\n                onError,\n                searchString,\n                filter: filterValues,\n                limit: itemCount,\n                startAfter: undefined,\n                orderBy: sortByProperty,\n                order: currentSort\n            });\n        } else {\n            dataSource.fetchCollection<M>({\n                path,\n                collection,\n                searchString,\n                filter: filterValues,\n                limit: itemCount,\n                startAfter: undefined,\n                orderBy: sortByProperty,\n                order: currentSort\n            })\n                .then(onEntitiesUpdate)\n                .catch(onError);\n            return () => {\n            };\n        }\n    }, [path, itemCount, currentSort, sortByProperty, filterValues, searchString]);\n\n    return {\n        data,\n        dataLoading,\n        dataLoadingError,\n        noMoreToLoad\n    };\n\n}\n","import { useEffect, useState } from \"react\";\nimport { Entity, EntityCollection, FireCMSContext, User } from \"../../types\";\nimport { useDataSource } from \"./useDataSource\";\nimport { useNavigationContext } from \"../useNavigationContext\";\nimport { useFireCMSContext } from \"../useFireCMSContext\";\n\n/**\n * @category Hooks and utilities\n */\nexport interface EntityFetchProps<M extends Record<string, any>> {\n    path: string;\n    entityId?: string;\n    collection: EntityCollection<M>;\n    useCache?: boolean;\n}\n\n/**\n * @category Hooks and utilities\n */\nexport interface EntityFetchResult<M extends Record<string, any>> {\n    entity?: Entity<M>,\n    dataLoading: boolean,\n    dataLoadingError?: Error\n}\n\nconst CACHE:Record<string, Entity<any>| undefined> = {};\n\n/**\n * This hook is used to fetch an entity.\n * It gives real time updates if the datasource supports it.\n * @param path\n * @param collection\n * @param entityId\n * @param useCache\n * @category Hooks and utilities\n */\n\nexport function useEntityFetch<M extends Record<string, any>, UserType extends User>(\n    {\n        path: inputPath,\n        entityId,\n        collection,\n        useCache = false\n    }: EntityFetchProps<M>): EntityFetchResult<M> {\n\n    const dataSource = useDataSource();\n    const navigationContext = useNavigationContext();\n\n    const path = navigationContext.resolveAliasesFrom(inputPath);\n\n    const context: FireCMSContext<UserType> = useFireCMSContext();\n\n    const [entity, setEntity] = useState<Entity<M> | undefined>();\n    const [dataLoading, setDataLoading] = useState<boolean>(true);\n    const [dataLoadingError, setDataLoadingError] = useState<Error | undefined>();\n\n    useEffect(() => {\n\n        setDataLoading(true);\n\n        const onEntityUpdate = async (updatedEntity: Entity<M> | undefined) => {\n            if (collection.callbacks?.onFetch && updatedEntity) {\n                try {\n                    updatedEntity = await collection.callbacks.onFetch({\n                        collection,\n                        path,\n                        entity: updatedEntity,\n                        context\n                    });\n                } catch (e: any) {\n                    console.error(e);\n                }\n            }\n            CACHE[`${path}/${entityId}`] = updatedEntity;\n            setEntity(updatedEntity);\n            setDataLoading(false);\n            setDataLoadingError(undefined);\n        };\n\n        const onError = (error: Error) => {\n            console.error(\"ERROR fetching entity\", error);\n            setDataLoading(false);\n            setEntity(undefined);\n            setDataLoadingError(error);\n        };\n\n        if (entityId && useCache && CACHE[`${path}/${entityId}`]) {\n            setEntity(CACHE[`${path}/${entityId}`]);\n            setDataLoading(false);\n            setDataLoadingError(undefined);\n            // eslint-disable-next-line @typescript-eslint/no-empty-function\n            return () => {\n            };\n        } else if (entityId && path && collection) {\n            if (dataSource.listenEntity) {\n                return dataSource.listenEntity<M>({\n                    path,\n                    entityId,\n                    collection,\n                    onUpdate: onEntityUpdate,\n                    onError\n                });\n            } else {\n                dataSource.fetchEntity<M>({\n                    path,\n                    entityId,\n                    collection\n                })\n                    .then(onEntityUpdate)\n                    .catch(onError);\n                return () => {\n                };\n            }\n        }\n        // if no entityId is provided we do nothing\n        else {\n            onEntityUpdate(undefined);\n            return () => {\n            };\n        }\n    }, [entityId, path]);\n\n    return {\n        entity,\n        dataLoading,\n        dataLoadingError\n    };\n\n}\n","import {\n    DataSource,\n    Entity,\n    EntityCallbacks,\n    EntityValues,\n    FireCMSContext,\n    SaveEntityProps,\n    User\n} from \"../../types\";\nimport { useDataSource } from \"./useDataSource\";\nimport { resolveCollection } from \"../../core\";\n\n/**\n * @category Hooks and utilities\n */\nexport type SaveEntityWithCallbacksProps<M extends Record<string, any>> =\n    SaveEntityProps<M> &\n    {\n        callbacks?: EntityCallbacks<M>;\n        onSaveSuccess?: (updatedEntity: Entity<M>) => void,\n        onSaveFailure?: (e: Error) => void,\n        onPreSaveHookError?: (e: Error) => void,\n        onSaveSuccessHookError?: (e: Error) => void\n    }\n\n/**\n * This function is in charge of saving an entity to the datasource.\n * It will run all the save callbacks specified in the collection.\n * It is also possible to attach callbacks on save success or error, and callback\n * errors.\n *\n * If you just want to save the data without running the `onSaveSuccess`,\n * `onSaveFailure` and `onPreSave` callbacks, you can use the `saveEntity` method\n * in the datasource ({@link useDataSource}).\n *\n * @param collection\n * @param path\n * @param entityId\n * @param callbacks\n * @param values\n * @param previousValues\n * @param status\n * @param dataSource\n * @param context\n * @param onSaveSuccess\n * @param onSaveFailure\n * @param onPreSaveHookError\n * @param onSaveSuccessHookError\n * @see useDataSource\n * @category Hooks and utilities\n */\nexport async function saveEntityWithCallbacks<M extends Record<string, any>, UserType extends User>({\n                                                               collection,\n                                                               path,\n                                                               entityId,\n                                                               values,\n                                                               previousValues,\n                                                               status,\n                                                               dataSource,\n                                                               context,\n                                                               onSaveSuccess,\n                                                               onSaveFailure,\n                                                               onPreSaveHookError,\n                                                               onSaveSuccessHookError\n                                                           }: SaveEntityWithCallbacksProps<M> & {\n                                                               dataSource: DataSource,\n                                                               context: FireCMSContext<UserType>,\n                                                           }\n): Promise<void> {\n\n    let updatedValues: Partial<EntityValues<M>>;\n\n    const resolvedPath = context.navigation.resolveAliasesFrom(path);\n\n    const callbacks = collection.callbacks;\n    if (callbacks?.onPreSave) {\n        try {\n            const resolvedCollection = resolveCollection<M>({\n                collection,\n                path,\n                values: previousValues as EntityValues<M>,\n                entityId,\n                fields: context.fields\n            });\n            updatedValues = await callbacks.onPreSave({\n                collection: resolvedCollection,\n                path,\n                resolvedPath,\n                entityId,\n                values,\n                previousValues,\n                status,\n                context\n            });\n        } catch (e: any) {\n            console.error(e);\n            if (onPreSaveHookError)\n                onPreSaveHookError(e);\n            return;\n        }\n    } else {\n        updatedValues = values;\n    }\n\n    return dataSource.saveEntity({\n        collection,\n        path: resolvedPath,\n        entityId,\n        values: updatedValues,\n        previousValues,\n        status\n    }).then((entity) => {\n        try {\n            if (callbacks?.onSaveSuccess) {\n                const resolvedCollection = resolveCollection<M>({\n                    collection,\n                    path,\n                    values: updatedValues as EntityValues<M>,\n                    entityId,\n                    fields: context.fields\n                });\n                callbacks.onSaveSuccess({\n                    collection: resolvedCollection,\n                    path,\n                    resolvedPath,\n                    entityId: entity.id,\n                    values: updatedValues,\n                    previousValues,\n                    status,\n                    context\n                });\n            }\n        } catch (e: any) {\n            if (onSaveSuccessHookError)\n                onSaveSuccessHookError(e);\n        }\n        if (onSaveSuccess)\n            onSaveSuccess(entity);\n    })\n        .catch((e) => {\n            if (callbacks?.onSaveFailure) {\n\n                const resolvedCollection = resolveCollection<M>({\n                    collection,\n                    path,\n                    values: updatedValues as EntityValues<M>,\n                    entityId,\n                    fields: context.fields\n                });\n                callbacks.onSaveFailure({\n                    collection: resolvedCollection,\n                    path,\n                    resolvedPath,\n                    entityId,\n                    values: updatedValues,\n                    previousValues,\n                    status,\n                    context\n                });\n            }\n            if (onSaveFailure) onSaveFailure(e);\n        });\n}\n","import {\n    DataSource,\n    DeleteEntityProps,\n    Entity,\n    EntityCallbacks,\n    EntityOnDeleteProps,\n    FireCMSContext,\n    ResolvedEntityCollection,\n    User\n} from \"../../types\";\n\n/**\n * @category Hooks and utilities\n */\nexport type DeleteEntityWithCallbacksProps<M extends Record<string, any>> =\n    DeleteEntityProps<M>\n    & {\n    callbacks?: EntityCallbacks<M>;\n    onDeleteSuccess?: (entity: Entity<M>) => void;\n    onDeleteFailure?: (entity: Entity<M>, e: Error) => void;\n    onPreDeleteHookError?: (entity: Entity<M>, e: Error) => void;\n    onDeleteSuccessHookError?: (entity: Entity<M>, e: Error) => void;\n}\n\n/**\n * This function is in charge of deleting an entity in the datasource.\n * It will run all the delete callbacks specified in the collection.\n * It is also possible to attach callbacks on save success or error, and callback\n * errors.\n *\n * If you just want to delete any data without running the `onPreDelete`,\n * and `onDelete` callbacks, you can use the `deleteEntity` method\n * in the datasource ({@link useDataSource}).\n *\n * @param dataSource\n * @param entity\n * @param collection\n * @param callbacks\n * @param onDeleteSuccess\n * @param onDeleteFailure\n * @param onPreDeleteHookError\n * @param onDeleteSuccessHookError\n * @param context\n * @category Hooks and utilities\n */\nexport async function deleteEntityWithCallbacks<M extends Record<string, any>, UserType extends User>({\n                                                                 dataSource,\n                                                                 entity,\n                                                                 collection,\n                                                                 callbacks,\n                                                                 onDeleteSuccess,\n                                                                 onDeleteFailure,\n                                                                 onPreDeleteHookError,\n                                                                 onDeleteSuccessHookError,\n                                                                 context\n                                                             }: DeleteEntityWithCallbacksProps<M> & {\n                                                                 collection: ResolvedEntityCollection<M>,\n                                                                 dataSource: DataSource,\n                                                                 context: FireCMSContext<UserType>\n                                                             }\n): Promise<boolean> {\n\n    console.debug(\"Deleting entity\", entity.path, entity.id);\n\n    const entityDeleteProps: EntityOnDeleteProps<M, UserType> = {\n        entity,\n        collection,\n        entityId: entity.id,\n        path: entity.path,\n        context\n    };\n\n    if (callbacks?.onPreDelete) {\n        try {\n            await callbacks.onPreDelete(entityDeleteProps);\n        } catch (e: any) {\n            console.error(e);\n            if (onPreDeleteHookError)\n                onPreDeleteHookError(entity, e);\n            return false;\n        }\n    }\n    return dataSource.deleteEntity({\n        entity\n    }).then(() => {\n        onDeleteSuccess && onDeleteSuccess(entity);\n        try {\n            if (callbacks?.onDelete) {\n                callbacks.onDelete(entityDeleteProps);\n            }\n            return true;\n        } catch (e: any) {\n            if (onDeleteSuccessHookError)\n                onDeleteSuccessHookError(entity, e);\n            return false;\n        }\n    }).catch((e) => {\n        if (onDeleteFailure) onDeleteFailure(entity, e);\n        return false;\n    });\n}\n","import { useEffect, useRef } from \"react\";\nimport { CMSType, ResolvedProperty } from \"../types\";\n\n/**\n * Hook we use to restore a value after it has been cleared\n * @param property\n * @param value\n * @param setValue\n * @ignore\n */\nexport function useClearRestoreValue<T extends CMSType>({\n                                                            property,\n                                                            value,\n                                                            setValue\n                                                        }:\n                                                            {\n                                                                property: ResolvedProperty<T>,\n                                                                value: T,\n                                                                setValue: (value: T | null, shouldValidate?: boolean) => void\n                                                            }) {\n\n    const clearedValueRef = useRef<T | null>(null);\n    useEffect(() => {\n        const shouldClearValueIfDisabled = typeof property.disabled === \"object\" && Boolean(property.disabled.clearOnDisabled);\n        if (shouldClearValueIfDisabled) {\n            if (value != null) {\n                clearedValueRef.current = value;\n                setValue(null);\n            }\n        } else if (clearedValueRef.current) {\n            setValue(clearedValueRef.current);\n            clearedValueRef.current = null;\n        }\n    }, [property]);\n}\n","import {\n    Entity,\n    EntityCollection,\n    EntityCustomView,\n    FireCMSContext,\n    User\n} from \"../types\";\nimport { useEffect, useState } from \"react\";\nimport {\n    getNavigationEntriesFromPathInternal\n} from \"../core/util/navigation_from_path\";\nimport { useFireCMSContext } from \"./useFireCMSContext\";\n\n/**\n * @see resolveNavigationFrom\n * @category Hooks and utilities\n */\nexport type ResolvedNavigationEntry<M extends Record<string, any>> =\n    | ResolvedNavigationEntity<M>\n    | ResolvedNavigationCollection<M>\n    | ResolvedNavigationEntityCustom<M>;\n\n/**\n * @see resolveNavigationFrom\n * @category Hooks and utilities\n */\nexport interface ResolvedNavigationEntity<M extends Record<string, any>> {\n    type: \"entity\";\n    entity: Entity<M>;\n    entityId: string;\n    path: string;\n    parentCollection: EntityCollection<M>;\n}\n\n/**\n * @see resolveNavigationFrom\n * @category Hooks and utilities\n */\nexport interface ResolvedNavigationCollection<M extends Record<string, any>> {\n    type: \"collection\";\n    path: string;\n    collection: EntityCollection<M>;\n}\n\n/**\n * @see resolveNavigationFrom\n * @category Hooks and utilities\n */\ninterface ResolvedNavigationEntityCustom<M extends Record<string, any>> {\n    type: \"custom_view\";\n    path: string;\n    view: EntityCustomView<M>;\n}\n\n/**\n * Use this function to retrieve an array of navigation entries (resolved\n * collection, entity or entity custom_view) for the given path. You need to pass the app context\n * that you receive in different callbacks, such as the save hooks.\n *\n * It will take into account the `navigation` provided at the `FireCMS` level.\n *\n * @param path\n * @param context\n * @category Hooks and utilities\n */\nexport function resolveNavigationFrom<M extends Record<string, any>, UserType extends User>({\n                                             path,\n                                             context\n                                         }: { path: string, context: FireCMSContext<UserType> }): Promise<ResolvedNavigationEntry<M>[]> {\n\n    const dataSource = context.dataSource;\n    const navigation = context.navigation;\n\n    if (!navigation) {\n        throw Error(\"Calling getNavigationFrom, but main navigation has not yet been initialised\");\n    }\n\n    const navigationEntries = getNavigationEntriesFromPathInternal({\n        path,\n        collections: navigation.collections ?? []\n    });\n\n    const resultPromises: Promise<ResolvedNavigationEntry<any>>[] = navigationEntries\n        .map((entry) => {\n            if (entry.type === \"collection\") {\n                return Promise.resolve(entry);\n            } else if (entry.type === \"entity\") {\n                const collection = navigation.getCollection(entry.path, entry.entityId);\n                if (!collection) {\n                    throw Error(`No collection defined in the navigation for the entity with path ${entry.path}`);\n                }\n                return dataSource.fetchEntity({\n                    path: entry.path,\n                    entityId: entry.entityId,\n                    collection\n                })\n                    .then((entity) => {\n                        if (!entity) return undefined;\n                        return { ...entry, entity };\n                    });\n            } else if (entry.type === \"custom_view\") {\n                return Promise.resolve(entry);\n            } else {\n                throw Error(\"Unmapped element in useEntitiesFromPath\");\n            }\n        })\n        .filter(v => Boolean(v)) as Promise<ResolvedNavigationEntry<any>>[];\n\n    return Promise.all(resultPromises);\n}\n\n/**\n * @category Hooks and utilities\n */\nexport interface NavigationFromProps {\n    path: string;\n}\n\n/**\n * @category Hooks and utilities\n */\nexport interface NavigationFrom<M extends Record<string, any>> {\n    data?: ResolvedNavigationEntry<M>[]\n    dataLoading: boolean,\n    dataLoadingError?: Error\n}\n\n/**\n * Use this hook to retrieve an array of navigation entries (resolved\n * collection or entity) for the given path. You can use this hook\n * in any React component that lives under `FireCMS`\n * @category Hooks and utilities\n */\nexport function useResolvedNavigationFrom<M extends Record<string, any>, UserType extends User>(\n    {\n        path\n    }: NavigationFromProps): NavigationFrom<M> {\n\n    const context: FireCMSContext<UserType> = useFireCMSContext();\n\n    const [data, setData] = useState<ResolvedNavigationEntry<M>[] | undefined>();\n    const [dataLoading, setDataLoading] = useState<boolean>(false);\n    const [dataLoadingError, setDataLoadingError] = useState<Error | undefined>();\n\n    useEffect(() => {\n        const navigation = context.navigation;\n        if (navigation) {\n            setDataLoading(true);\n            setDataLoadingError(undefined);\n            resolveNavigationFrom<M, UserType>({ path, context })\n                .then((res) => {\n                    setData(res);\n                })\n                .catch((e) => setDataLoadingError(e))\n                .finally(() => setDataLoading(false));\n        }\n\n    }, [path, context]);\n\n    if (!context.navigation) {\n        return { dataLoading: true };\n    }\n\n    return { data, dataLoading, dataLoadingError };\n}\n","import { ModeControllerContext } from \"../core/contexts/ModeController\";\nimport { useContext } from \"react\";\n\n/**\n * Use this controller to change color mode\n * @category Hooks and utilities\n */\nexport interface ModeController {\n    mode: \"light\" | \"dark\";\n    setMode: (mode: \"light\" | \"dark\") => void;\n    toggleMode: () => void;\n}\n\n/**\n * Hook to retrieve the current mode (\"light\" | \"dark\"), and `setMode`\n * or `toggle` functions to change it.\n *\n * Consider that in order to use this hook you need to have a parent\n * `FireCMS`\n *\n * @see ModeController\n * @category Hooks and utilities\n */\nexport const useModeController = () => useContext(ModeControllerContext);\n","// FORKED FROM https://github.com/fayeed/use-clipboard\n\nimport {\n    MutableRefObject,\n    useCallback,\n    useEffect,\n    useRef,\n    useState\n} from \"react\";\n\nexport interface UseClipboardProps {\n    /**\n     * It's callback function that is called after the `copy` command\n     * is executed.\n     *\n     * @param text: The selected clipboard text.\n     */\n    onSuccess?: (text: string) => void;\n\n    /**\n     * Triggers when the hook encounters an error.\n     * If passed hook won't throw an error.\n     *\n     * @param error: cause of the error\n     */\n    onError?: (error: string) => void;\n\n    /**\n     * Disables the new clipboard API `navigator.clipboard` even if\n     * it is supported.\n     */\n    disableClipboardAPI?: boolean;\n\n    /**\n     * revert back the isCopied flag to false again if a value is set.\n     */\n    copiedDuration?: number;\n}\n\nexport interface useClipboardReturnType {\n    /**\n     * Use ref to pull the text content from.\n     */\n    ref: MutableRefObject<any>;\n\n    /**\n     * Use it to perform the copy operation\n     */\n    copy: (text?: string) => void;\n\n    /**\n     * Use it to perform the cut operation\n     */\n    cut: () => void;\n\n    /**\n     * Indicates wheater the content was successfully copied or not.\n     */\n    isCoppied: boolean;\n\n    /**\n     * Current selected clipboard content.\n     */\n    clipboard: string;\n\n    /**\n     * Clears the user clipboard.\n     */\n    clearClipboard: () => void;\n\n    /**\n     * Check to see if the browser supports the new `navigator.clipboard` API.\n     */\n    isSupported: () => boolean;\n}\n\nexport const useClipboard = (\n    options?: UseClipboardProps\n): useClipboardReturnType => {\n    const { onSuccess, onError, disableClipboardAPI = false, copiedDuration } =\n    options || {};\n    const ref = useRef<any>(null);\n    const [isCoppied, setIsCoppied] = useState(false);\n    const [clipboard, setClipbaord] = useState(\"\");\n\n    useEffect(() => {\n        if (copiedDuration) setTimeout(() => setIsCoppied(false), copiedDuration);\n    }, [isCoppied]);\n\n    const isSupported = () => navigator.clipboard !== undefined;\n\n    const handleError = useCallback((error: string) => {\n        if (onError) onError(error);\n        else throw new Error(error);\n    }, [onError]);\n\n    const handleSuccess = useCallback((text: string) => {\n        if (onSuccess) onSuccess(text);\n        setIsCoppied(true);\n        setClipbaord(text);\n    }, [onSuccess]);\n\n    const copyToClipboard = useCallback((text: string) => {\n        navigator.clipboard\n            .writeText(text)\n            .then(() => handleSuccess(text))\n            .catch((err) => {\n                handleError(err);\n                setIsCoppied(false);\n            });\n    }, [handleError, handleSuccess]);\n\n    const clearClipboard = () => {\n        if (isSupported()) {\n            navigator.clipboard.writeText(\"\");\n        }\n    };\n\n    const copy = (text?: string) =>\n        action(\"copy\", typeof text === \"object\" ? undefined : text);\n\n    const cut = () => action(\"cut\");\n\n    const action = useCallback(\n        (operation = \"copy\", text?: string) => {\n            const element = ref.current as HTMLElement;\n\n            const isInput =\n                element &&\n                (element.tagName === \"INPUT\" || element.tagName === \"TEXTAREA\");\n\n            const input = ref.current as HTMLInputElement;\n\n            if (isSupported() && !disableClipboardAPI) {\n                if (text) {\n                    copyToClipboard(text);\n                } else if (element) {\n                    if (isInput) {\n                        copyToClipboard(input.value);\n\n                        if (operation === \"cut\") {\n                            input.value = \"\";\n                        }\n                    } else {\n                        copyToClipboard(element.innerText);\n                    }\n                } else {\n                    handleError(\"Both the ref & text were undefined\");\n                }\n            }\n        },\n        [disableClipboardAPI, copyToClipboard, handleError]\n    );\n\n    return {\n        ref,\n        isCoppied,\n        clipboard,\n        clearClipboard,\n        isSupported,\n        copy,\n        cut\n    };\n};\n","import { useContext } from \"react\";\nimport { BreadcrumbContext } from \"../core/contexts/BreacrumbsContext\";\n\n/**\n * @category Hooks and utilities\n */\nexport interface BreadcrumbsController {\n    breadcrumbs: BreadcrumbEntry[];\n    set: (props: {\n        breadcrumbs: BreadcrumbEntry[];\n    }) => void;\n}\n\n/**\n * @category Hooks and utilities\n */\nexport interface BreadcrumbEntry {\n    title: string;\n    url: string;\n}\n\n/**\n * Hook to retrieve the BreadcrumbContext.\n *\n * Consider that in order to use this hook you need to have a parent\n * `FireCMS`\n *\n * @see BreadcrumbsController\n * @category Hooks and utilities\n */\nexport const useBreadcrumbsContext = (): BreadcrumbsController => useContext(BreadcrumbContext);\n","import { useSideDialogsController } from \"./useSideDialogsController\";\nimport { ReferenceSelectionInner, ReferenceSelectionInnerProps } from \"../core\";\nimport { useCallback } from \"react\";\nimport { useNavigationContext } from \"./useNavigationContext\";\n\n/**\n * This hook is used to open a side dialog that allows the selection\n * of entities under a given path.\n * You can use it in custom views for selecting entities.\n * You need to specify the path of the target collection at least.\n * If your collection is not defined in your  top collection configuration\n * (in your `FireCMS` component), you need to specify explicitly.\n * This is the same hook used internally when a reference property is defined.\n * @category Hooks and utilities\n */\nexport function useReferenceDialog<M extends Record<string, any>>(referenceDialogProps: Omit<ReferenceSelectionInnerProps<M>, \"path\"> & {\n    path?: string | false;\n    onClose?: () => void;\n}): { open: () => void; close: () => void } {\n\n    const navigation = useNavigationContext();\n    const sideDialogsController = useSideDialogsController();\n\n    const open = useCallback(() => {\n        if (referenceDialogProps.path) {\n            let usedCollection = referenceDialogProps.collection;\n            if (!usedCollection)\n                usedCollection = navigation.getCollection(referenceDialogProps.path);\n            if (!usedCollection)\n                throw Error(\"Not able to resolve the collection in useReferenceDialog\");\n\n            sideDialogsController.open({\n                key: `reference_${referenceDialogProps.path}`,\n                component:\n                    <ReferenceSelectionInner\n                        {...referenceDialogProps as ReferenceSelectionInnerProps<M>}\n                        collection={usedCollection}/>,\n                width: \"90vw\",\n                onClose: () => {\n                    referenceDialogProps.onClose?.();\n                }\n            });\n        } else {\n            throw Error(\"useReferenceDialog: You are trying to open a reference dialog, but have not declared the `path`\")\n        }\n    }, [navigation, referenceDialogProps, sideDialogsController]);\n\n    const close = useCallback(() => {\n        sideDialogsController.close();\n    }, [sideDialogsController]);\n\n    return {\n        open,\n        close\n    }\n\n}\n","import { useEffect } from \"react\";\n\nconst fireCMSLogo = \"data:image/png;base64,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\\n\";\n\n/**\n * Internal hook to handle the browser title and icon\n * @param name\n * @param logo\n */\nexport function useBrowserTitleAndIcon(name: string, logo?: string) {\n    useEffect(() => {\n        if (document) {\n            document.title = `${name} - FireCMS`;\n            let link = document.querySelector(\"link[rel~='icon']\");\n            if (!link) {\n                link = document.createElement(\"link\");\n                // @ts-ignore\n                link.rel = \"icon\";\n                document.getElementsByTagName(\"head\")[0].appendChild(link);\n            }\n            // @ts-ignore\n            link.href = logo ?? fireCMSLogo;\n        }\n    }, [name, logo]);\n}\n","import React from \"react\";\nimport { styled } from \"@mui/material/styles\";\nimport { Tooltip } from \"@mui/material\";\nimport { tooltipClasses, TooltipProps } from \"@mui/material/Tooltip\";\nimport { StyledComponent } from \"@emotion/styled\";\n\nexport const ErrorTooltip: StyledComponent<any> = styled(({\n                                                              className,\n                                                              ...props\n                                                          }: TooltipProps) => (\n    <Tooltip {...props} classes={{ popper: className }}/>\n))(({ theme }) => ({\n    [`& .${tooltipClasses.tooltip}`]: {\n        margin: \"0 8px\",\n        backgroundColor: theme.palette.error.light\n    },\n    [`& .${tooltipClasses.arrow}`]: {\n        color: theme.palette.error.light\n    }\n}));\n","import React from \"react\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport { Box, Typography } from \"@mui/material\";\nimport { ErrorTooltip } from \"./ErrorTooltip\";\n\n/**\n * @category Components\n */\nexport interface ErrorViewProps {\n    title?: string;\n    error: Error | React.ReactElement | string,\n    tooltip?: string\n}\n\n/**\n * Generic error view. Displayed for example when an unexpected value comes\n * from the datasource in a collection view.\n * @param title\n * @param error\n * @param tooltip\n * @constructor\n * @category Components\n */\nexport function ErrorView({\n                              title,\n                              error,\n                              tooltip\n                          }: ErrorViewProps): React.ReactElement {\n    const component = error instanceof Error ? error.message : error;\n\n    const body = (\n        <Box\n            sx={{\n                display: \"flex\",\n                alignItems: \"center\",\n                margin: 1\n            }}>\n            <ErrorIcon fontSize={\"small\"} color={\"error\"}/>\n            <Box sx={{\n                paddingLeft: 2\n            }}>\n                {title && <Typography\n                    variant={\"body2\"}\n                    sx={{\n                        fontWeight: \"500\"\n                    }}>{title}</Typography>}\n                <Typography variant={\"body2\"}>{component}</Typography>\n            </Box>\n        </Box>\n    );\n\n    if (tooltip) {\n        return (\n            <ErrorTooltip title={tooltip}>\n                {body}\n            </ErrorTooltip>\n        );\n    }\n    return body;\n}\n","/**\n * New or existing status\n * @category Models\n */\nexport type EntityStatus = \"new\" | \"existing\" | \"copy\";\n\n/**\n * Representation of an entity fetched from the datasource\n * @category Models\n */\nexport interface Entity<M extends object> {\n\n    /**\n     * ID of the entity\n     */\n    id: string;\n\n    /**\n     * A string representing the path of the referenced document (relative\n     * to the root of the database).\n     */\n    path: string;\n\n    /**\n     * Current values\n     */\n    values: EntityValues<M>;\n}\n\n/**\n * This type represents a record of key value pairs as described in an\n * entity collection.\n * @category Models\n */\nexport type EntityValues<M extends object> = M;\n\n/**\n * Class used to create a reference to an entity in a different path\n */\nexport class EntityReference {\n    /**\n     * ID of the entity\n     */\n    readonly id: string;\n    /**\n     * A string representing the path of the referenced document (relative\n     * to the root of the database).\n     */\n    readonly path: string;\n\n    constructor(id: string, path: string) {\n        this.id = id;\n        this.path = path;\n    }\n\n    get pathWithId() {\n        return `${this.path}/${this.id}`;\n    }\n}\n\nexport class GeoPoint {\n\n    /**\n     * The latitude of this GeoPoint instance.\n     */\n    readonly latitude: number;\n    /**\n     * The longitude of this GeoPoint instance.\n     */\n    readonly longitude: number;\n\n    constructor(latitude: number, longitude: number) {\n        this.latitude = latitude;\n        this.longitude = longitude;\n    }\n}\n","import React, { createElement } from \"react\";\nimport {\n    CMSType,\n    EntityReference,\n    ResolvedArrayProperty,\n    ResolvedMapProperty,\n    ResolvedNumberProperty,\n    ResolvedStringProperty\n} from \"../types\";\n\nimport {\n    ArrayOfMapsPreview,\n    ArrayOfReferencesPreview,\n    ArrayOfStorageComponentsPreview,\n    ArrayOfStringsPreview,\n    ArrayOneOfPreview,\n    ArrayPropertyEnumPreview,\n    ArrayPropertyPreview,\n    BooleanPreview,\n    DatePreview,\n    EmptyValue,\n    MapPropertyPreview,\n    Markdown,\n    NumberPropertyPreview,\n    ReferencePreview,\n    StorageThumbnail,\n    StringPropertyPreview,\n    UrlComponentPreview\n} from \"./index\";\nimport { ErrorView, resolveProperty } from \"../core\";\n\nimport { PropertyPreviewProps } from \"./PropertyPreviewProps\";\nimport { useFireCMSContext } from \"../hooks\";\n\n/**\n * @category Preview components\n */\nexport function PropertyPreview<T extends CMSType>(props: PropertyPreviewProps<T>) {\n\n    const fireCMSContext = useFireCMSContext();\n    let content: React.ReactNode | any;\n    const {\n        property: inputProperty,\n        propertyKey,\n        value,\n        size,\n        height,\n        width,\n        entity\n    } = props;\n\n    const property = resolveProperty({\n        propertyKey,\n        propertyOrBuilder: inputProperty,\n        propertyValue: value,\n        fields: fireCMSContext.fields\n    });\n\n    if (value === undefined || property === null) {\n        content = <EmptyValue/>;\n    } else if (property.Preview) {\n        content = createElement(property.Preview as React.ComponentType<PropertyPreviewProps>,\n            {\n                propertyKey,\n                value,\n                property,\n                size,\n                height,\n                width,\n                entity,\n                customProps: property.customProps\n            });\n    } else if (value === null) {\n        content = <EmptyValue/>;\n    } else if (property.dataType === \"string\") {\n        const stringProperty = property as ResolvedStringProperty;\n        if (typeof value === \"string\") {\n            if (stringProperty.url) {\n                if (typeof stringProperty.url === \"boolean\")\n                    content =\n                        <UrlComponentPreview size={props.size}\n                                             url={value}/>;\n                else if (typeof stringProperty.url === \"string\")\n                    content =\n                        <UrlComponentPreview size={props.size}\n                                             url={value}\n                                             previewType={stringProperty.url}/>;\n            } else if (stringProperty.storage) {\n                content = <StorageThumbnail\n                    storeUrl={property.storage?.storeUrl ?? false}\n                    size={props.size}\n                    storagePathOrDownloadUrl={value}/>;\n            } else if (stringProperty.markdown) {\n                content = <Markdown source={value}/>;\n            } else {\n                content = <StringPropertyPreview {...props}\n                                                 property={stringProperty}\n                                                 value={value}/>;\n            }\n        } else {\n            content = buildWrongValueType(propertyKey, property.dataType, value);\n        }\n    } else if (property.dataType === \"array\") {\n        if (value instanceof Array) {\n            const arrayProperty = property as ResolvedArrayProperty;\n            if (!arrayProperty.of && !arrayProperty.oneOf) {\n                throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${propertyKey}`);\n            }\n\n            if (arrayProperty.of) {\n                if (Array.isArray(arrayProperty.of)) {\n                    content = <ArrayPropertyPreview {...props}\n                                                    value={value}\n                                                    property={property as ResolvedArrayProperty}/>;\n                } else if (arrayProperty.of.dataType === \"map\") {\n                    content =\n                        <ArrayOfMapsPreview propertyKey={propertyKey}\n                                            property={property as ResolvedArrayProperty}\n                                            value={value as Record<string, any>[]} // This might be wrong\n                                            entity={entity}\n                                            size={size}\n                        />;\n                } else if (arrayProperty.of.dataType === \"reference\") {\n                    if (typeof arrayProperty.of.path === \"string\") {\n                        content = <ArrayOfReferencesPreview {...props}\n                                                            value={value}\n                                                            property={property as ResolvedArrayProperty}/>;\n                    } else {\n                        content = <EmptyValue/>;\n                    }\n                } else if (arrayProperty.of.dataType === \"string\") {\n                    if (arrayProperty.of.enumValues) {\n                        content = <ArrayPropertyEnumPreview\n                            {...props}\n                            value={value as string[]}\n                            property={property as ResolvedArrayProperty}/>;\n                    } else if (arrayProperty.of.storage) {\n                        content = <ArrayOfStorageComponentsPreview\n                            {...props}\n                            value={value}\n                            property={property as ResolvedArrayProperty}/>;\n                    } else {\n                        content = <ArrayOfStringsPreview\n                            {...props}\n                            value={value as string[]}\n                            property={property as ResolvedArrayProperty}/>;\n                    }\n                } else if (arrayProperty.of.dataType === \"number\" && arrayProperty.of.enumValues) {\n                    content = <ArrayPropertyEnumPreview\n                        {...props}\n                        value={value as string[]}\n                        property={property as ResolvedArrayProperty}/>;\n                } else {\n                    content = <ArrayPropertyPreview {...props}\n                                                    value={value}\n                                                    property={property as ResolvedArrayProperty}/>;\n                }\n            } else if (arrayProperty.oneOf) {\n                content = <ArrayOneOfPreview {...props}\n                                             value={value}\n                                             property={property as ResolvedArrayProperty}/>;\n            }\n        } else {\n            content = buildWrongValueType(propertyKey, property.dataType, value);\n        }\n    } else if (property.dataType === \"map\") {\n        if (typeof value === \"object\") {\n            content =\n                <MapPropertyPreview {...props}\n                                    property={property as ResolvedMapProperty}/>;\n        } else {\n            content = buildWrongValueType(propertyKey, property.dataType, value);\n        }\n    } else if (property.dataType === \"date\") {\n        if (value instanceof Date) {\n            content = <DatePreview date={value}/>;\n        } else {\n            content = buildWrongValueType(propertyKey, property.dataType, value);\n        }\n    } else if (property.dataType === \"reference\") {\n        if (typeof property.path === \"string\") {\n            if (value instanceof EntityReference) {\n                content = <ReferencePreview\n                    disabled={!property.path}\n                    previewProperties={property.previewProperties}\n                    size={props.size}\n                    onClick={props.onClick}\n                    reference={value as EntityReference}\n                />;\n            } else {\n                content = buildWrongValueType(propertyKey, property.dataType, value);\n            }\n        } else {\n            content = <EmptyValue/>;\n        }\n\n    } else if (property.dataType === \"boolean\") {\n        if (typeof value === \"boolean\") {\n            content = <BooleanPreview value={value}/>;\n        } else {\n            content = buildWrongValueType(propertyKey, property.dataType, value);\n        }\n    } else if (property.dataType === \"number\") {\n        if (typeof value === \"number\") {\n            content = <NumberPropertyPreview {...props}\n                                             value={value}\n                                             property={property as ResolvedNumberProperty}/>;\n        } else {\n            content = buildWrongValueType(propertyKey, property.dataType, value);\n        }\n    } else {\n        content = JSON.stringify(value);\n    }\n\n    return content === undefined || content === null ? <EmptyValue/> : content;\n}\n\nfunction buildWrongValueType(name: string | undefined, dataType: string, value: any) {\n    console.error(`Unexpected value for property ${name}, of type ${dataType}`, value);\n    return (\n        <ErrorView title={\"Unexpected value\"}\n                   error={`${JSON.stringify(value)}`}/>\n    );\n}\n","export function hashString(str: string): number {\n    let hash = 0; let i; let chr;\n    for (i = 0; i < str.length; i++) {\n        chr = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + chr;\n        hash |= 0; // Convert to 32bit integer\n    }\n    return Math.abs(hash);\n}\n","import { hashString } from \"./hash\";\nimport { ChipColorKey, ChipColorScheme } from \"../../types\";\n\nexport const CHIP_COLORS: Record<string, ChipColorScheme> = {\n    blueLighter: { color: \"#cfdfff\", text: \"#102046\" },\n    cyanLighter: { color: \"#d0f0fd\", text: \"#04283f\" },\n    tealLighter: { color: \"#c2f5e9\", text: \"#012524\" },\n    greenLighter: { color: \"#d1f7c4\", text: \"#0b1d05\" },\n    yellowLighter: { color: \"#ffeab6\", text: \"#3b2501\" },\n    orangeLighter: { color: \"#fee2d5\", text: \"#6b2613\" },\n    redLighter: { color: \"#ffdce5\", text: \"#4c0c1c\" },\n    pinkLighter: { color: \"#ffdaf6\", text: \"#400832\" },\n    purpleLighter: { color: \"#ede2fe\", text: \"#280b42\" },\n    grayLighter: { color: \"#eee\", text: \"#040404\" },\n\n    blueLight: { color: \"#9cc7ff\", text: \"#102046\" },\n    cyanLight: { color: \"#77d1f3\", text: \"#04283f\" },\n    tealLight: { color: \"#72ddc3\", text: \"#012524\" },\n    greenLight: { color: \"#93e088\", text: \"#0b1d05\" },\n    yellowLight: { color: \"#ffd66e\", text: \"#3b2501\" },\n    orangeLight: { color: \"#ffa981\", text: \"#6b2613\" },\n    redLight: { color: \"#ff9eb7\", text: \"#4c0c1c\" },\n    pinkLight: { color: \"#f99de2\", text: \"#400832\" },\n    purpleLight: { color: \"#cdb0ff\", text: \"#280b42\" },\n    grayLight: { color: \"#ccc\", text: \"#040404\" },\n\n    blueDark: { color: \"#2d7ff9\", text: \"#fff\" },\n    cyanDark: { color: \"#18bfff\", text: \"#fff\" },\n    tealDark: { color: \"#20d9d2\", text: \"#fff\" },\n    greenDark: { color: \"#20c933\", text: \"#fff\" },\n    yellowDark: { color: \"#fcb400\", text: \"#fff\" },\n    orangeDark: { color: \"#ff6f2c\", text: \"#fff\" },\n    redDark: { color: \"#f82b60\", text: \"#fff\" },\n    pinkDark: { color: \"#ff08c2\", text: \"#fff\" },\n    purpleDark: { color: \"#8b46ff\", text: \"#fff\" },\n    grayDark: { color: \"#666\", text: \"#fff\" },\n\n    blueDarker: { color: \"#2750ae\", text: \"#cfdfff\" },\n    cyanDarker: { color: \"#0b76b7\", text: \"#d0f0fd\" },\n    tealDarker: { color: \"#06a09b\", text: \"#c2f5e9\" },\n    greenDarker: { color: \"#338a17\", text: \"#d1f7c4\" },\n    yellowDarker: { color: \"#b87503\", text: \"#ffeab6\" },\n    orangeDarker: { color: \"#d74d26\", text: \"#fee2d5\" },\n    redDarker: { color: \"#ba1e45\", text: \"#ffdce5\" },\n    pinkDarker: { color: \"#b2158b\", text: \"#ffdaf6\" },\n    purpleDarker: { color: \"#6b1cb0\", text: \"#ede2fe\" },\n    grayDarker: { color: \"#444\", text: \"#eee\" }\n};\n\nexport function getColorSchemeForSeed(seed: string): ChipColorScheme {\n    const hash: number = hashString(seed);\n    const colorKeys = Object.keys(CHIP_COLORS);\n    const index = hash % colorKeys.length;\n    return CHIP_COLORS[colorKeys[index]];\n}\n\nexport function getColorSchemeForKey(key: ChipColorKey): ChipColorScheme {\n    return CHIP_COLORS[key];\n}\n","import { ChipColorScheme, EnumValueConfig, EnumValues } from \"../../types\";\nimport { CHIP_COLORS, getColorSchemeForSeed } from \"./chip_utils\";\n\nexport function enumToObjectEntries(enumValues: EnumValues): EnumValueConfig[] {\n    if (Array.isArray(enumValues)) {\n        return enumValues;\n    } else {\n        return Object.entries(enumValues).map(([id, value]) => {\n            if (typeof value === \"string\") {\n                return {\n                    id,\n                    label: value\n                }\n            } else {\n                return {\n                    ...value,\n                    id\n                }\n            }\n        });\n    }\n}\n\nexport function getLabelOrConfigFrom(enumValues: EnumValueConfig[], key?: string | number): EnumValueConfig | undefined {\n    if (!key) return undefined;\n    return enumValues.find((entry) => entry.id === key);\n}\n\nexport function getColorScheme(enumValues: EnumValueConfig[], key: string | number): ChipColorScheme | undefined {\n    const labelOrConfig = getLabelOrConfigFrom(enumValues, key);\n    if (!labelOrConfig?.color)\n        return getColorSchemeForSeed(key.toString());\n    if (typeof labelOrConfig === \"object\" && \"color\" in labelOrConfig) {\n        if (typeof labelOrConfig.color === \"string\")\n            return CHIP_COLORS[labelOrConfig.color];\n        if (typeof labelOrConfig.color === \"object\")\n            return labelOrConfig.color;\n    }\n    return undefined;\n}\n\nexport function isEnumValueDisabled(labelOrConfig?: string | EnumValueConfig) {\n    return typeof labelOrConfig === \"object\" && (labelOrConfig as EnumValueConfig).disabled;\n}\n\nexport function buildEnumLabel(\n    labelOrConfig?: string | EnumValueConfig\n): string | undefined {\n    if (labelOrConfig === undefined)\n        return undefined;\n    if (typeof labelOrConfig === \"object\") {\n        return labelOrConfig.label;\n    } else {\n        return labelOrConfig;\n    }\n}\n","import { Chip, useTheme } from \"@mui/material\";\nimport React from \"react\";\nimport { ChipColorScheme, EnumValues } from \"../../types\";\nimport {\n    buildEnumLabel,\n    enumToObjectEntries,\n    getColorScheme,\n    getLabelOrConfigFrom\n} from \"../../core/util/enums\";\nimport { getColorSchemeForSeed } from \"../../core/util/chip_utils\";\n\nexport interface EnumValuesChipProps {\n    enumValues?: EnumValues;\n    enumKey: any;\n    small: boolean;\n}\n\n/**\n * @category Preview components\n */\nexport function EnumValuesChip({\n                                   enumValues,\n                                   enumKey,\n                                   small\n                               }: EnumValuesChipProps) {\n    if (!enumValues) return null;\n    const enumValuesConfig = enumToObjectEntries(enumValues);\n    const enumValue = enumKey !== undefined ? getLabelOrConfigFrom(enumValuesConfig, enumKey) : undefined;\n    const label = buildEnumLabel(enumValue);\n    const colorScheme = getColorScheme(enumValuesConfig, enumKey);\n    return <ColorChip\n        colorScheme={colorScheme}\n        label={label !== undefined ? label : enumKey}\n        error={!label}\n        outlined={false}\n        small={small}/>;\n}\n\nexport interface ColorChipProps {\n    label: string;\n    small?: boolean;\n    colorScheme?: ChipColorScheme;\n    error?: boolean;\n    outlined?: boolean;\n}\n\n/**\n * @category Preview components\n */\nexport function ColorChip({\n                              label,\n                              colorScheme,\n                              error,\n                              outlined,\n                              small\n                          }: ColorChipProps) {\n\n    const theme = useTheme();\n\n    const usedColorScheme = colorScheme ?? getColorSchemeForSeed(label);\n    return (\n        <Chip\n            sx={{\n                maxWidth: \"100%\",\n                backgroundColor: error || !usedColorScheme ? \"#eee\" : usedColorScheme.color,\n                color: error || !usedColorScheme ? \"red\" : usedColorScheme.text,\n                fontWeight: theme!.typography.fontWeightRegular\n            }}\n            size={small ? \"small\" : \"medium\"}\n            variant={outlined ? \"outlined\" : \"filled\"}\n            label={label}\n        />\n    );\n}\n","import React from \"react\";\n\nimport { ErrorBoundary, resolvePropertyEnum } from \"../../core\";\nimport { ColorChip, EnumValuesChip } from \"../components/ColorChip\";\nimport { PropertyPreviewProps } from \"../index\";\nimport { getColorSchemeForSeed } from \"../../core/util/chip_utils\";\n\n/**\n * @category Preview components\n */\nexport function StringPropertyPreview({\n                                          propertyKey,\n                                          value,\n                                          property,\n                                          size\n                                      }: PropertyPreviewProps<string>): React.ReactElement {\n\n    if (property.enumValues) {\n        const enumKey = value;\n        const resolvedProperty = resolvePropertyEnum(property);\n        return <EnumValuesChip\n            enumKey={enumKey}\n            enumValues={resolvedProperty.enumValues}\n            small={size !== \"regular\"}/>;\n    } else if (property.previewAsTag) {\n        const colorScheme = getColorSchemeForSeed(propertyKey ?? \"\");\n        return (\n            <ErrorBoundary>\n                <ColorChip\n                    colorScheme={colorScheme}\n                    label={value}\n                    small={size !== \"regular\"}\n                />\n            </ErrorBoundary>);\n    } else {\n        if (!value) return <></>;\n        const lines = value.split(\"\\n\");\n        return value && value.includes(\"\\n\")\n            ? <div>\n                {lines.map((str, index) =>\n                    <React.Fragment key={`string_preview_${index}`}>\n                        <span>{str}</span>\n                        {index !== lines.length - 1 && <br/>}\n                    </React.Fragment>)}\n            </div>\n            : <>{value}</>;\n    }\n}\n","import React from \"react\";\nimport { styled } from \"@mui/material/styles\";\nimport { ResolvedStringProperty } from \"../../types\";\nimport { PropertyPreviewProps } from \"../index\";\n\nimport { ErrorBoundary, resolveArrayProperty } from \"../../core\";\nimport { StringPropertyPreview } from \"./StringPropertyPreview\";\nimport { Theme } from \"@mui/material\";\nimport { useFireCMSContext } from \"../../hooks\";\n\nconst PREFIX = \"ArrayOfStringsPreview\";\n\nconst classes = {\n    array: `${PREFIX}-array`,\n    arrayWrap: `${PREFIX}-arrayWrap`,\n    arrayItem: `${PREFIX}-arrayItem`\n};\n\nconst Root = styled(\"div\")((\n   { theme } : {\n        theme: Theme\n    }\n) => ({\n    [`& .${classes.array}`]: {\n        display: \"flex\",\n        flexDirection: \"column\"\n    },\n\n    [`& .${classes.arrayWrap}`]: {\n        display: \"flex\",\n        flexWrap: \"wrap\"\n    },\n\n    [`& .${classes.arrayItem}`]: {\n        margin: theme.spacing(0.5)\n    }\n}));\n\n/**\n * @category Preview components\n */\nexport function ArrayOfStringsPreview({\n                                          propertyKey,\n                                          value,\n                                          property: inputProperty,\n                                          entity,\n                                          size\n                                      }: PropertyPreviewProps<string[]>) {\n\n    const fireCMSContext = useFireCMSContext();\n    const property = resolveArrayProperty({\n        propertyKey,\n        property: inputProperty,\n        propertyValue: value,\n        fields: fireCMSContext.fields\n    });\n\n    if (Array.isArray(property.of)) {\n        throw Error(\"Using array properties instead of single one in `of` in ArrayProperty\");\n    }\n    if (!property.of || property.dataType !== \"array\" || property.of.dataType !== \"string\")\n        throw Error(\"Picked wrong preview component ArrayOfStringsPreview\");\n\n    if (value && !Array.isArray(value)) {\n        return <Root>{`Unexpected value: ${value}`}</Root>;\n    }\n    const stringProperty = property.of as ResolvedStringProperty;\n\n    return (\n        <div className={classes.array}>\n            {value &&\n            value.map((v, index) =>\n                <div className={classes.arrayItem}\n                     key={`preview_array_strings_${propertyKey}_${index}`}>\n                    <ErrorBoundary>\n                        <StringPropertyPreview propertyKey={propertyKey}\n                                               property={stringProperty}\n                                               value={v}\n                                               entity={entity}\n                                               size={size}/>\n                    </ErrorBoundary>\n                </div>\n            )}\n        </div>\n    );\n}\n","import React from \"react\";\n\nimport { EnumValueConfig } from \"../../types\";\nimport { ErrorBoundary } from \"../../core\";\nimport { EnumValuesChip } from \"./ColorChip\";\nimport { Box } from \"@mui/material\";\nimport { PreviewSize } from \"../PropertyPreviewProps\";\n\n/**\n * @category Preview components\n */\nexport function ArrayEnumPreview({\n                                     name,\n                                     value,\n                                     enumValues,\n                                     size\n                                 }: {\n    value: string[] | number[],\n    name: string | undefined,\n    enumValues: EnumValueConfig[],\n    size: PreviewSize\n}) {\n\n    return (\n        <Box sx={theme => ({\n            display: \"flex\",\n            flexWrap: \"wrap\",\n            gap: theme.spacing(0.5)\n        })}>\n            {value && value.map((enumKey, index) => {\n                    return (\n                        <ErrorBoundary\n                            key={`preview_array_ref_${name}_${index}`}>\n                            <EnumValuesChip\n                                enumKey={enumKey}\n                                enumValues={enumValues}\n                                small={size !== \"regular\"}/>\n                        </ErrorBoundary>\n                    );\n                }\n                )}\n        </Box>\n    );\n}\n","import { PropertyPreviewProps } from \"../index\";\nimport { ResolvedNumberProperty, ResolvedStringProperty } from \"../../types\";\nimport { ArrayEnumPreview } from \"../components/ArrayEnumPreview\";\n\n/**\n * @category Preview components\n */\nexport function ArrayPropertyEnumPreview({\n                                             propertyKey,\n                                             value,\n                                             property,\n                                             size\n                                         }: PropertyPreviewProps<string[] | number[]>) {\n\n    if (property.dataType !== \"array\")\n        throw Error(\"Picked wrong preview component ArrayEnumPreview\");\n\n    const ofProperty = property.of as ResolvedStringProperty | ResolvedNumberProperty;\n    if (!ofProperty.enumValues)\n        throw Error(\"Picked wrong preview component ArrayEnumPreview\");\n\n    if (!value) return null;\n\n    return <ArrayEnumPreview name={propertyKey}\n                             value={value}\n                             enumValues={ofProperty.enumValues}\n                             size={size}/>;\n}\n","import React from \"react\";\nimport { ErrorBoundary, resolveArrayProperty } from \"../../core\";\n\nimport { Table, TableBody, TableCell, TableRow } from \"@mui/material\";\nimport { PropertyPreview, PropertyPreviewProps } from \"../index\";\nimport { useFireCMSContext } from \"../../hooks\";\n\n/**\n * @category Preview components\n */\nexport function ArrayOfMapsPreview({\n                                       propertyKey,\n                                       value,\n                                       property: inputProperty,\n                                       size,\n                                       entity\n                                   }: PropertyPreviewProps<Record<string, any>[]>) {\n    const fireCMSContext = useFireCMSContext();\n\n    const property = resolveArrayProperty({\n        propertyKey,\n        property: inputProperty,\n        propertyValue: value,\n        fields: fireCMSContext.fields\n    });\n\n    if (Array.isArray(property?.of)) {\n        throw Error(\"Using array properties instead of single one in `of` in ArrayProperty\");\n    }\n\n    if (property?.dataType !== \"array\" || !property.of || property.of.dataType !== \"map\")\n        throw Error(\"Picked wrong preview component ArrayOfMapsPreview\");\n\n    const mapProperty = property.of;\n    const properties = mapProperty.properties;\n    if (!properties) {\n        throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${propertyKey}`);\n    }\n    const values = value;\n    const previewProperties: string[] | undefined = mapProperty.previewProperties;\n\n    if (!values) return null;\n\n    let mapProperties = previewProperties;\n    if (!mapProperties || !mapProperties.length) {\n        mapProperties = Object.keys(properties);\n        if (size)\n            mapProperties = mapProperties.slice(0, 3);\n    }\n\n    return (\n        <Table size=\"small\">\n            <TableBody>\n                {values &&\n                values.map((v, index) => {\n                    return (\n                        <TableRow key={`table_${v}_${index}`}\n                                  sx={{\n                                      \"&:last-child th, &:last-child td\": {\n                                          borderBottom: 0\n                                      }\n                                  }}>\n                            {mapProperties && mapProperties.map(\n                                (key) => (\n                                    <TableCell\n                                        key={`table-cell-${key as string}`}\n                                        component=\"th\"\n                                    >\n                                        <ErrorBoundary>\n                                            <PropertyPreview\n                                                propertyKey={key as string}\n                                                value={(v)[key]}\n                                                property={properties[key as string]}\n                                                entity={entity}\n                                                size={\"small\"}/>\n                                        </ErrorBoundary>\n                                    </TableCell>\n                                )\n                            )}\n                        </TableRow>\n                    );\n                })}\n            </TableBody>\n        </Table>\n    );\n}\n","import React from \"react\";\n\nimport { EnumValuesChip } from \"../components/ColorChip\";\nimport { PropertyPreviewProps } from \"../index\";\nimport { resolveEnumValues } from \"../../core\";\n\n/**\n * @category Preview components\n */\nexport function NumberPropertyPreview({\n                                          value,\n                                          property,\n                                          size\n                                      }: PropertyPreviewProps<number>): React.ReactElement {\n\n    if (property.enumValues) {\n        const enumKey = value;\n        const enumValues = resolveEnumValues(property.enumValues);\n        if (!enumValues)\n            return <>{value}</>;\n        return <EnumValuesChip\n            enumKey={enumKey}\n            enumValues={enumValues}\n            small={size !== \"regular\"}/>;\n    } else {\n        return <>{value}</>;\n    }\n}\n","import React from \"react\";\n\nimport { styled } from \"@mui/material/styles\";\n\nimport { PreviewSize, PropertyPreview, PropertyPreviewProps } from \"../index\";\nimport { ErrorBoundary, resolveArrayProperty } from \"../../core\";\nimport { ResolvedProperty } from \"../../types\";\n\nimport { Theme } from \"@mui/material\";\nimport { useFireCMSContext } from \"../../hooks\";\n\nconst PREFIX = \"ArrayOfStorageComponentsPreview\";\n\nconst classes = {\n    arrayWrap: `${PREFIX}-arrayWrap`,\n    arrayItem: `${PREFIX}-arrayItem`\n};\n\nconst Root = styled(\"div\")((\n   { theme } : {\n        theme: Theme\n    }\n) => ({\n    [`&.${classes.arrayWrap}`]: {\n        display: \"flex\",\n        flexWrap: \"wrap\"\n    },\n\n    [`& .${classes.arrayItem}`]: {\n        margin: theme.spacing(0.5)\n    }\n}));\n\n/**\n * @category Preview components\n */\nexport function ArrayOfStorageComponentsPreview({\n                                                    propertyKey,\n                                                    entity,\n                                                    value,\n                                                    property: inputProperty,\n                                                    size\n                                                }: PropertyPreviewProps<any[]>) {\n\n    const fireCMSContext = useFireCMSContext();\n    const property = resolveArrayProperty({\n        propertyKey,\n        property: inputProperty,\n        propertyValue: value,\n        fields: fireCMSContext.fields\n    });\n\n    if (Array.isArray(property.of)) {\n        throw Error(\"Using array properties instead of single one in `of` in ArrayProperty\");\n    }\n\n    if (property.dataType !== \"array\" || !property.of || property.of.dataType !== \"string\")\n        throw Error(\"Picked wrong preview component ArrayOfStorageComponentsPreview\");\n\n    const childSize: PreviewSize = size === \"regular\" ? \"small\" : \"tiny\";\n\n    return (\n        <Root className={classes.arrayWrap}>\n            {value &&\n            value.map((v, index) =>\n                <div className={classes.arrayItem}\n                     key={`preview_array_storage_${propertyKey}_${index}`}>\n                    <ErrorBoundary>\n                        <PropertyPreview\n                            propertyKey={propertyKey}\n                            value={v}\n                            entity={entity}\n                            property={property.of as ResolvedProperty<string>}\n                            size={childSize}/>\n                    </ErrorBoundary>\n                </div>\n            )}\n        </Root>\n    );\n}\n","import { PreviewSize, PropertyPreviewProps, ReferencePreview } from \"../index\";\nimport { ResolvedReferenceProperty } from \"../../types\";\n\nimport { Box } from \"@mui/material\";\nimport { resolveArrayProperty } from \"../../core\";\nimport { useFireCMSContext } from \"../../hooks\";\n\n/**\n * @category Preview components\n */\nexport function ArrayOfReferencesPreview({\n                                             propertyKey,\n                                             value,\n                                             property: inputProperty,\n                                             size\n                                         }: PropertyPreviewProps<any[]>) {\n\n    const fireCMSContext = useFireCMSContext();\n    const property = resolveArrayProperty({\n        propertyKey,\n        property: inputProperty,\n        propertyValue: value,\n        fields: fireCMSContext.fields\n    });\n\n    if (Array.isArray(property?.of)) {\n        throw Error(\"Using array properties instead of single one in `of` in ArrayProperty\");\n    }\n\n    if (property?.dataType !== \"array\" || !property.of || property.of.dataType !== \"reference\")\n        throw Error(\"Picked wrong preview component ArrayOfReferencesPreview\");\n\n    const childSize: PreviewSize = size === \"regular\" ? \"small\" : \"tiny\";\n\n    return (\n        <Box sx={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            width: \"100%\"\n        }}>\n            {value &&\n                value.map((reference, index) => {\n                        const ofProperty = property.of as ResolvedReferenceProperty;\n                        return <Box sx={{\n                            marginTop: 0.25,\n                            marginBottom: 0.25,\n                            width: \"100%\"\n                        }}\n                                    key={`preview_array_ref_${propertyKey}_${index}`}>\n                            <ReferencePreview\n                                disabled={!ofProperty.path}\n                                previewProperties={ofProperty.previewProperties}\n                                size={childSize}\n                                reference={reference}\n                            />\n                        </Box>;\n                    }\n                )}\n        </Box>\n    );\n}\n","import React from \"react\";\nimport {\n    Box,\n    Table,\n    TableBody,\n    TableCell,\n    TableRow,\n    Typography\n} from \"@mui/material\";\n\nimport { PropertyPreview, PropertyPreviewProps } from \"../index\";\nimport { ResolvedMapProperty } from \"../../types\";\nimport { ErrorBoundary } from \"../../core\";\n\n/**\n * @category Preview components\n */\nexport function MapPropertyPreview<T extends Record<string, any> = Record<string, any>>({\n                                                         propertyKey,\n                                                         value,\n                                                         property,\n                                                         entity,\n                                                         size\n                                                     }: PropertyPreviewProps<T>) {\n\n    if (property.dataType !== \"map\") {\n        throw Error(\"Picked wrong preview component MapPropertyPreview\");\n    }\n\n    const mapProperty = property as ResolvedMapProperty;\n    if (!mapProperty.properties) {\n        throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${propertyKey}`);\n    }\n\n    if (!value) return null;\n\n    let mapPropertyKeys: string[];\n    if (size === \"regular\") {\n        mapPropertyKeys = Object.keys(mapProperty.properties);\n    } else {\n        mapPropertyKeys = (mapProperty.previewProperties || Object.keys(mapProperty.properties)) as string[];\n        if (size === \"small\")\n            mapPropertyKeys = mapPropertyKeys.slice(0, 3);\n        else if (size === \"tiny\")\n            mapPropertyKeys = mapPropertyKeys.slice(0, 1);\n    }\n\n    if (size !== \"regular\")\n        return (\n            <Box sx={theme => ({\n                width: \"100%\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                \"& > *\": {\n                    [theme.breakpoints.down(\"md\")]: {\n                        marginBottom: `${theme.spacing(0.5)} !important`\n                    },\n                    marginBottom: `${theme.spacing(1)} !important`\n                }\n            })}>\n                {mapPropertyKeys.map((key, index) => (\n                    <div key={`map_${key}`}>\n                        <ErrorBoundary\n                            key={\"map_preview_\" + mapProperty.name + key + index}>\n                            <PropertyPreview propertyKey={key}\n                                             value={(value)[key]}\n                                             property={mapProperty.properties![key]}\n                                             entity={entity}\n                                             size={size}/>\n                        </ErrorBoundary>\n                    </div>\n                ))}\n            </Box>\n        );\n\n    return (\n        <Table size=\"small\" key={`map_preview_${propertyKey}`}>\n            <TableBody>\n                {mapPropertyKeys &&\n                mapPropertyKeys.map((key, index) => {\n                    return (\n                        <TableRow\n                            key={`map_preview_table_${propertyKey}_${index}`}\n                            sx={{\n                                \"&:last-child th, &:last-child td\": {\n                                    borderBottom: 0\n                                }\n                            }}>\n                            <TableCell key={`table-cell-title-${propertyKey}-${key}`}\n                                       sx={{\n                                           verticalAlign: \"top\"\n                                       }}\n                                       width=\"30%\"\n                                       component=\"th\">\n                                <Typography variant={\"caption\"}\n                                            color={\"textSecondary\"}>\n                                    {mapProperty.properties![key].name}\n                                </Typography>\n                            </TableCell>\n                            <TableCell key={`table-cell-${propertyKey}-${key}`}\n                                       width=\"70%\"\n                                       component=\"th\">\n                                <ErrorBoundary>\n                                    <PropertyPreview\n                                        propertyKey={key}\n                                        value={(value)[key]}\n                                        property={mapProperty.properties![key]}\n                                        entity={entity}\n                                        size={\"small\"}/>\n                                </ErrorBoundary>\n                            </TableCell>\n                        </TableRow>\n                    );\n                })}\n            </TableBody>\n        </Table>\n    );\n\n}\n","import React from \"react\";\n\nimport { Box, Divider } from \"@mui/material\";\n\nimport { PreviewSize, PropertyPreview, PropertyPreviewProps } from \"../index\";\nimport { ErrorBoundary, resolveArrayProperty } from \"../../core\";\nimport { ResolvedProperty } from \"../../types\";\nimport { useFireCMSContext } from \"../../hooks\";\n\n/**\n * @category Preview components\n */\nexport function ArrayPropertyPreview({\n                                         propertyKey,\n                                         value,\n                                         property: inputProperty,\n                                         entity,\n                                         size\n                                     }: PropertyPreviewProps<any[]>) {\n\n    const fireCMSContext = useFireCMSContext();\n    const property = resolveArrayProperty({\n        propertyKey,\n        property: inputProperty,\n        propertyValue: value,\n        fields: fireCMSContext.fields\n    });\n\n    if (!property.of) {\n        throw Error(`You need to specify an 'of' prop (or specify a custom field) in your array property ${propertyKey}`);\n    }\n\n    if (property.dataType !== \"array\")\n        throw Error(\"Picked wrong preview component ArrayPreview\");\n\n    const values = value;\n\n    if (!values) return null;\n\n    const childSize: PreviewSize = size === \"regular\" ? \"small\" : \"tiny\";\n\n    return (\n        <Box sx={{\n            display: \"flex\",\n            flexDirection: \"column\"\n        }}>\n            {values &&\n                values.map((value, index) => {\n                    const of:ResolvedProperty = property.resolvedProperties[index] ??\n                        (property.resolvedProperties[index] ?? (Array.isArray(property.of) ? property.of[index] : property.of));\n                    return of\n                        ? <React.Fragment\n                            key={\"preview_array_\" + value + \"_\" + index}>\n                            <Box sx={{\n                                margin: 1\n                            }}>\n                                <ErrorBoundary>\n                                    <PropertyPreview\n                                        propertyKey={propertyKey}\n                                        entity={entity}\n                                        value={value}\n                                        property={of}\n                                        size={childSize}/>\n                                    </ErrorBoundary>\n                                </Box>\n                                {index < values.length - 1 && <Divider/>}\n                            </React.Fragment>\n                            : null;\n                    }\n                )}\n        </Box>\n    );\n}\n","export const DEFAULT_ONE_OF_TYPE = \"type\"\nexport const DEFAULT_ONE_OF_VALUE = \"value\"\n","import React from \"react\";\n\nimport { styled } from \"@mui/material/styles\";\n\nimport { Divider, Theme } from \"@mui/material\";\nimport { PreviewSize, PropertyPreview, PropertyPreviewProps } from \"../index\";\nimport { ErrorBoundary, resolveArrayProperty } from \"../../core\";\nimport { ResolvedProperty } from \"../../types\";\nimport {\n    DEFAULT_ONE_OF_TYPE,\n    DEFAULT_ONE_OF_VALUE\n} from \"../../core/util/common\";\nimport { useFireCMSContext } from \"../../hooks\";\n\nconst PREFIX = \"ArrayOneOfPreview\";\n\nconst classes = {\n    array: `${PREFIX}-array`,\n    arrayWrap: `${PREFIX}-arrayWrap`,\n    arrayItemBig: `${PREFIX}-arrayItemBig`\n};\n\nconst Root = styled(\"div\")((\n   { theme } : {\n        theme: Theme\n    }\n) => ({\n    [`&.${classes.array}`]: {\n        display: \"flex\",\n        flexDirection: \"column\"\n    },\n\n    [`& .${classes.arrayWrap}`]: {\n        display: \"flex\",\n        flexWrap: \"wrap\"\n    },\n\n    [`& .${classes.arrayItemBig}`]: {\n        margin: theme.spacing(1)\n    }\n}));\n\n/**\n * @category Preview components\n */\nexport function ArrayOneOfPreview({\n                                      propertyKey,\n                                      value,\n                                      property: inputProperty,\n                                      size,\n                                      entity\n                                  }: PropertyPreviewProps<any[]>) {\n\n    const fireCMSContext = useFireCMSContext();\n    const property = resolveArrayProperty({\n        propertyKey,\n        property: inputProperty,\n        propertyValue: value,\n        fields: fireCMSContext.fields\n    });\n\n    if (property?.dataType !== \"array\")\n        throw Error(\"Picked wrong preview component ArrayPreview\");\n\n    if (!property?.oneOf) {\n        throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${propertyKey}`);\n    }\n\n    const values = value;\n\n    if (!values) return null;\n\n    const childSize: PreviewSize = size === \"regular\" ? \"small\" : \"tiny\";\n\n    const typeField = property.oneOf.typeField ?? DEFAULT_ONE_OF_TYPE;\n    const valueField = property.oneOf.valueField ?? DEFAULT_ONE_OF_VALUE;\n    const properties = property.oneOf.properties;\n\n    return (\n        <Root className={classes.array}>\n            {values &&\n                values.map((value, index) =>\n                    <React.Fragment\n                        key={\"preview_array_\" + value + \"_\" + index}>\n                        <div className={classes.arrayItemBig}>\n                            <ErrorBoundary>\n                                {value && <PropertyPreview\n                                propertyKey={propertyKey}\n                                value={value[valueField]}\n                                entity={entity}\n                                property={(property.resolvedProperties[index] ?? properties[value[typeField]]) as ResolvedProperty<any>}\n                                size={childSize}/>}\n                        </ErrorBoundary>\n                    </div>\n                    {index < values.length - 1 && <Divider/>}\n                </React.Fragment>\n            )}\n        </Root>\n    );\n}\n","import { CollectionSize } from \"../types\";\nimport { PreviewSize } from \"./index\";\n\nexport const TINY_THUMBNAIL = 40;\nexport const SMALL_THUMBNAIL = 100;\nexport const REGULAR_THUMBNAIL = 200;\n\nexport function getThumbnailMeasure(size: PreviewSize): number {\n    if (size === \"tiny\")\n        return TINY_THUMBNAIL;\n    else if (size === \"small\")\n        return SMALL_THUMBNAIL;\n    else if (size === \"regular\")\n        return REGULAR_THUMBNAIL;\n    else throw Error(\"Thumbnail size not mapped\");\n}\n\nexport function getPreviewSizeFrom(size: CollectionSize): PreviewSize {\n    switch (size) {\n        case \"xs\":\n        case \"s\":\n            return \"tiny\";\n        case \"m\":\n            return \"small\";\n        case \"l\":\n        case \"xl\":\n            return \"regular\";\n        default:\n            throw Error(\"Missing mapping value in getPreviewSizeFrom\");\n    }\n}\n","import {\n    ResolvedArrayProperty,\n    ResolvedMapProperty,\n    ResolvedProperties,\n    ResolvedProperty,\n    ResolvedStringProperty\n} from \"../../types\";\nimport React from \"react\";\nimport {\n    Box,\n    Grid,\n    Skeleton,\n    Table,\n    TableBody,\n    TableCell,\n    TableRow,\n    Typography\n} from \"@mui/material\";\nimport { PreviewSize } from \"../index\";\nimport { getThumbnailMeasure } from \"../util\";\n\nexport interface SkeletonPropertyComponentProps {\n    property: ResolvedProperty,\n    size: PreviewSize\n}\n\n/**\n * @category Preview components\n */\nexport function SkeletonPropertyComponent({\n                                              property,\n                                              size\n                                          }: SkeletonPropertyComponentProps\n) {\n\n    if (!property) {\n        console.error(\"No property assigned for skeleton component\", property, size);\n    }\n\n    let content: React.ReactNode | any;\n    if (property.dataType === \"string\") {\n        const stringProperty = property as ResolvedStringProperty;\n        if (stringProperty.url) {\n            content = renderUrlComponent(stringProperty, size);\n        } else if (stringProperty.storage) {\n            content = renderSkeletonImageThumbnail(size);\n        } else {\n            content = renderSkeletonText();\n        }\n    } else if (property.dataType === \"array\") {\n        const arrayProperty = property as ResolvedArrayProperty;\n\n        if (arrayProperty.of) {\n            if (Array.isArray(arrayProperty.of)) {\n                content = <>{arrayProperty.of.map((p, i) => renderGenericArrayCell(p, i))} </>;\n            } else {\n                if (arrayProperty.of.dataType === \"map\" && arrayProperty.of.properties) {\n                    content = renderArrayOfMaps(arrayProperty.of.properties, size, arrayProperty.of.previewProperties);\n                } else if (arrayProperty.of.dataType === \"string\") {\n                    if (arrayProperty.of.enumValues) {\n                        content = renderArrayEnumTableCell();\n                    } else if (arrayProperty.of.storage) {\n                        content = renderGenericArrayCell(arrayProperty.of);\n                    } else {\n                        content = renderArrayOfStrings();\n                    }\n                } else {\n                    content = renderGenericArrayCell(arrayProperty.of);\n                }\n            }\n        }\n\n    } else if (property.dataType === \"map\") {\n        content = renderMap(property as ResolvedMapProperty, size);\n    } else if (property.dataType === \"date\") {\n        content = renderSkeletonText();\n    } else if (property.dataType === \"reference\") {\n        content = renderReference();\n    } else if (property.dataType === \"boolean\") {\n        content = renderSkeletonText();\n    } else {\n        content = renderSkeletonText();\n    }\n    return (content || null);\n}\n\nfunction renderMap<T extends Record<string, any>>(property: ResolvedMapProperty<T>, size: PreviewSize) {\n\n    if (!property.properties)\n        return <></>;\n\n    let mapPropertyKeys: string[];\n    if (size === \"regular\") {\n        mapPropertyKeys = Object.keys(property.properties);\n    } else {\n        mapPropertyKeys = (property.previewProperties || Object.keys(property.properties)) as string[];\n        if (size === \"small\")\n            mapPropertyKeys = mapPropertyKeys.slice(0, 3);\n        else if (size === \"tiny\")\n            mapPropertyKeys = mapPropertyKeys.slice(0, 1);\n    }\n\n    if (size !== \"regular\")\n        return (\n            <Box sx={theme => ({\n                width: \"100%\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                \"& > *\": {\n                    [theme.breakpoints.down(\"md\")]: {\n                        marginBottom: `${theme.spacing(0.5)} !important`\n                    },\n                    marginBottom: `${theme.spacing(1)} !important`\n                }\n            })}>\n                {mapPropertyKeys.map((key, index) => (\n                    <div key={`map_${key}`}>\n                        {property.properties && property.properties[key] && <SkeletonPropertyComponent\n                            property={property.properties[key]}\n                            size={\"small\"}/>}\n                    </div>\n                ))}\n            </Box>\n        );\n\n    return (\n        <Table size=\"small\">\n            <TableBody>\n                {mapPropertyKeys &&\n                    mapPropertyKeys.map((key, index) => {\n                        return (\n                            <TableRow\n                                key={`map_preview_table__${index}`}\n                                sx={{\n                                    \"&:last-child th, &:last-child td\": {\n                                        borderBottom: 0\n                                    }\n                                }}>\n                                <TableCell key={`table-cell-title--${key}`}\n                                           sx={{\n                                               verticalAlign: \"top\"\n                                           }}\n                                           width=\"30%\"\n                                           component=\"th\">\n                                    <Typography variant={\"caption\"}\n                                                color={\"textSecondary\"}>\n                                        {property.properties![key].name}\n                                    </Typography>\n                                </TableCell>\n                                <TableCell key={`table-cell-${key}`}\n                                           width=\"70%\"\n                                           component=\"th\">\n                                    {property.properties && property.properties[key] && <SkeletonPropertyComponent\n                                        property={property.properties[key]}\n                                        size={\"small\"}/>}\n                                </TableCell>\n                            </TableRow>\n                        );\n                    })}\n            </TableBody>\n        </Table>\n    );\n}\n\nfunction renderArrayOfMaps<M extends Record<string, any>>(properties: ResolvedProperties<M>, size: PreviewSize, previewProperties?: string[]) {\n    let tableProperties = previewProperties;\n    if (!tableProperties || !tableProperties.length) {\n        tableProperties = Object.keys(properties) as string[];\n        if (size)\n            tableProperties = tableProperties.slice(0, 3);\n    }\n\n    return (\n        <Table size={\"small\"}>\n            <TableBody>\n                {\n                    [0, 1, 2].map((value, index) => {\n                        return (\n                            <TableRow key={`table_${value}_${index}`}>\n                                {tableProperties && tableProperties.map(\n                                    (key) => (\n                                        <TableCell\n                                            key={`table-cell-${key}`}\n                                            component=\"th\"\n                                        >\n                                            <SkeletonPropertyComponent\n                                                property={(properties)[key]}\n                                                size={\"small\"}/>\n                                        </TableCell>\n                                    )\n                                )}\n                            </TableRow>\n                        );\n                    })}\n            </TableBody>\n        </Table>\n    );\n}\n\nfunction renderArrayOfStrings() {\n    return (\n        <Grid>\n            {\n                [0, 1].map((value, index) => (\n                    renderSkeletonText(index)\n                ))}\n        </Grid>\n    );\n}\n\nfunction renderArrayEnumTableCell() {\n    return (\n        <Grid>\n            {\n                [0, 1].map((value, index) =>\n                    <>\n                        {renderSkeletonText(index)}\n                    </>\n                )}\n        </Grid>\n    );\n}\n\nfunction renderGenericArrayCell(\n    property: ResolvedProperty,\n    index = 0\n) {\n    return (\n        <Grid key={\"array_index\"}>\n\n            {\n                [0, 1].map((value, index) =>\n                    <>\n                        <SkeletonPropertyComponent key={`i_${index}`}\n                                                   property={property}\n                                                   size={\"small\"}/>\n                    </>\n                )}\n        </Grid>\n    );\n}\n\nfunction renderUrlAudioComponent() {\n    return (\n        <Skeleton variant=\"rectangular\"\n                  width={300}\n                  height={100}/>\n    );\n}\n\nexport function renderSkeletonImageThumbnail(size: PreviewSize) {\n    const imageSize = size === \"tiny\" ? 40 : size === \"small\" ? 100 : 200;\n    return (\n        <Skeleton variant=\"rectangular\"\n                  sx={theme => ({\n                      borderRadius: `${theme.shape.borderRadius}px`\n                  })}\n                  width={imageSize}\n                  height={imageSize}/>\n    );\n}\n\nfunction renderUrlVideo(size: PreviewSize) {\n\n    return (\n        <Skeleton variant=\"rectangular\"\n                  width={size !== \"regular\" ? 300 : 500}\n                  height={size !== \"regular\" ? 200 : 250}/>\n    );\n}\n\nfunction renderReference() {\n    return <Skeleton variant=\"rectangular\" width={200} height={100}/>;\n}\n\nfunction renderUrlComponent(property: ResolvedStringProperty, size: PreviewSize = \"regular\") {\n\n    if (typeof property.url === \"boolean\") {\n        return <div style={{\n            display: \"flex\"\n        }}>\n            {renderSkeletonIcon()}\n            {renderSkeletonText()}\n        </div>;\n    }\n\n    return renderUrlFile(size);\n}\n\nfunction renderUrlFile(size: PreviewSize) {\n\n    return (\n        <Box\n            sx={{\n                width: getThumbnailMeasure(size),\n                height: getThumbnailMeasure(size)\n            }}>\n            {renderSkeletonIcon()}\n        </Box>\n    );\n}\n\nexport function renderSkeletonText(index?: number) {\n    return <Skeleton variant=\"text\" key={`skeleton_${index}`}/>;\n}\n\nexport function renderSkeletonCaptionText(index?: number) {\n    return <Skeleton\n        height={20}\n        variant=\"text\"/>;\n}\n\nexport function renderSkeletonIcon() {\n    return <Skeleton variant=\"rectangular\" width={24} height={24}/>;\n}\n","import { Skeleton } from \"@mui/material\";\nimport * as React from \"react\";\nimport { useEffect, useState } from \"react\";\n\nexport interface AsyncPreviewComponentProps {\n    builder: Promise<React.ReactNode>;\n}\n\n/**\n * Utility component used to render the result of an async execution.\n * It shows a loading indicator while at it.\n *\n * @category Preview components\n */\nexport const AsyncPreviewComponent = React.memo(function AsyncPreviewComponentInternal<M extends Record<string, any>>(\n        {\n            builder\n        }: AsyncPreviewComponentProps) {\n\n        const [loading, setLoading] = useState<boolean>(true);\n        const [result, setResult] = useState<React.ReactNode>(null);\n\n        useEffect(() => {\n            let unmounted = false;\n            builder\n                .then((res) => {\n                    if (!unmounted) {\n                        setLoading(false);\n                        setResult(res);\n                    }\n                })\n                .catch(error => {\n                    setLoading(false);\n                    console.error(error);\n                });\n            return () => {\n                unmounted = true;\n            };\n        }, [builder]);\n\n        if (loading)\n            return <Skeleton variant=\"text\"/>;\n\n        return <React.Fragment>{result}</React.Fragment>;\n\n    }\n);\n","export const defaultDateFormat = \"MMMM dd, yyyy, HH:mm:ss\";\n","import React from \"react\";\n\nimport format from \"date-fns/format\";\nimport * as locales from \"date-fns/locale\";\nimport { defaultDateFormat } from \"../../core/util/dates\";\nimport { FireCMSContext } from \"../../types\";\nimport { useFireCMSContext } from \"../../hooks\";\n\n/**\n * @category Preview components\n */\nexport function DatePreview({\n                                date\n                            }: { date: Date }): React.ReactElement {\n\n    const appConfig: FireCMSContext<any> | undefined = useFireCMSContext();\n    // @ts-ignore\n    const dateUtilsLocale = appConfig?.locale ? locales[appConfig?.locale] : undefined;\n    const dateFormat: string = appConfig?.dateTimeFormat ?? defaultDateFormat;\n    const formattedDate = date ? format(date, dateFormat, { locale: dateUtilsLocale }) : \"\";\n\n    return (\n        <>\n            {formattedDate}\n        </>\n    );\n}\n","import React, { CSSProperties, useMemo, useState } from \"react\";\nimport { Box, IconButton, Tooltip, useTheme } from \"@mui/material\";\nimport OpenInNewIcon from \"@mui/icons-material/OpenInNew\";\nimport ContentCopyIcon from \"@mui/icons-material/ContentCopy\";\n\nimport { PreviewSize } from \"../index\";\nimport { getThumbnailMeasure } from \"../util\";\n\n/**\n * @category Preview components\n */\nexport interface ImagePreviewProps {\n    size: PreviewSize,\n    url: string\n}\n\n/**\n * @category Preview components\n */\nexport function ImagePreview({\n                                 size,\n                                 url\n                             }: ImagePreviewProps) {\n\n    const [onHover, setOnHover] = useState(false);\n\n    const imageSize = useMemo(() => getThumbnailMeasure(size), [size]);\n\n    const theme = useTheme();\n\n    if (size === \"tiny\") {\n        return (\n            <img src={url}\n                 key={\"tiny_image_preview_\" + url}\n                 style={{\n                     position: \"relative\",\n                     objectFit: \"cover\",\n                     width: imageSize,\n                     height: imageSize,\n                     borderRadius: theme.shape.borderRadius,\n                     maxHeight: \"100%\"\n                 }}/>\n        );\n    }\n\n    const imageStyle: CSSProperties =\n        {\n            maxWidth: \"100%\",\n            maxHeight: \"100%\",\n            borderRadius: theme.shape.borderRadius\n        };\n\n    return (\n        <Box\n            sx={{\n                position: \"relative\",\n                maxWidth: \"100%\",\n                maxHeight: \"100%\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                width: imageSize,\n                height: imageSize\n            }}\n            key={\"image_preview_\" + url}\n            onMouseEnter={() => setOnHover(true)}\n            onMouseMove={() => setOnHover(true)}\n            onMouseLeave={() => setOnHover(false)}>\n\n            <img src={url}\n                 style={imageStyle}/>\n\n            {onHover && <>\n\n                {navigator && <Tooltip title=\"Copy url to clipboard\">\n                    <Box sx={{\n                        borderRadius: \"9999px\",\n                        position: \"absolute\",\n                        bottom: -4,\n                        right: 32,\n                        backgroundColor: theme.palette.background.default\n                    }}>\n                        <IconButton\n                            size={\"small\"}\n                            onClick={(e) => {\n                                e.stopPropagation();\n                                return navigator.clipboard.writeText(url);\n                            }}>\n                            <ContentCopyIcon htmlColor={\"#666\"}\n                                             fontSize={\"small\"}/>\n                        </IconButton>\n                    </Box>\n                </Tooltip>}\n\n                <Tooltip title=\"Open image in new tab\">\n                    <a\n                        style={{\n                            borderRadius: \"9999px\",\n                            position: \"absolute\",\n                            bottom: -4,\n                            right: -4,\n                            backgroundColor: theme.palette.background.default\n                        }}\n                        href={url}\n                        rel=\"noopener noreferrer\"\n                        target=\"_blank\">\n                        <IconButton\n                            size={\"small\"}\n                            onClick={(e) => e.stopPropagation()}>\n                            <OpenInNewIcon htmlColor={\"#666\"}\n                                           fontSize={\"small\"}/>\n                        </IconButton>\n                    </a>\n                </Tooltip>\n            </>\n            }\n        </Box>\n    );\n}\n","import React from \"react\";\nimport { Box, CardMedia, Link, Tooltip, Typography } from \"@mui/material\";\n\nimport DescriptionOutlinedIcon from \"@mui/icons-material/DescriptionOutlined\";\nimport OpenInNewIcon from \"@mui/icons-material/OpenInNew\";\n\nimport { PreviewSize } from \"../index\";\nimport { ImagePreview } from \"./ImagePreview\";\nimport { getThumbnailMeasure } from \"../util\";\nimport { PreviewType } from \"../../types\";\n\n/**\n * @category Preview components\n */\nexport function UrlComponentPreview({\n                                        url,\n                                        previewType,\n                                        size,\n                                        hint\n                                    }: { url: string, previewType?: PreviewType, size: PreviewSize, hint?: string }): React.ReactElement {\n\n    if (!previewType) {\n        return (\n            <Link sx={(theme) => ({\n                display: \"flex\",\n                wordBreak: \"break-word\",\n                fontWeight: theme.typography.fontWeightMedium\n            })}\n                  href={url}\n                  onMouseDown={(e: React.MouseEvent) => {\n                      e.preventDefault();\n                  }}\n                  target=\"_blank\">\n                <OpenInNewIcon style={{ marginRight: 8 }} fontSize={\"small\"}/>\n                {url}\n            </Link>\n        );\n    }\n\n    if (previewType === \"image\") {\n        return <ImagePreview key={`image_preview_${url}_${size}`}\n                             url={url}\n                             size={size}/>;\n    } else if (previewType === \"audio\") {\n        return <audio controls\n                      src={url}\n                      key={`audio_preview_${url}_${size}`}>\n            Your browser does not support the\n            <code>audio</code> element.\n        </audio>;\n    } else if (previewType === \"video\") {\n        return <CardMedia\n            key={`video_preview_${url}_${size}`}\n            sx={{ maxWidth: size === \"small\" ? 300 : 500 }}\n            component=\"video\"\n            controls\n            image={url}\n        />;\n    } else {\n        return (\n            <a\n                key={`link_preview_${url}_${size}`}\n                href={url}\n                rel=\"noopener noreferrer\"\n                target=\"_blank\"\n                onClick={(e) => e.stopPropagation()}>\n                <Box sx={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    width: getThumbnailMeasure(size),\n                    height: getThumbnailMeasure(size)\n                }}>\n                    <DescriptionOutlinedIcon sx={{ flexGrow: 1 }}/>\n                    {hint &&\n                        <Tooltip title={hint}>\n                            <Typography\n                                sx={{\n                                    maxWidth: \"100%\",\n                                    whiteSpace: \"nowrap\",\n                                    overflow: \"hidden\",\n                                    textOverflow: \"ellipsis\",\n                                    direction: \"rtl\",\n                                    textAlign: \"left\"\n                                }}\n                                variant={\"caption\"}>{hint}</Typography>\n                        </Tooltip>}\n                </Box>\n            </a>\n        );\n    }\n}\n","import React, { useEffect } from \"react\";\n\nimport {\n    renderSkeletonImageThumbnail\n} from \"../property_previews/SkeletonPropertyComponent\";\nimport { UrlComponentPreview } from \"./UrlComponentPreview\";\nimport { PreviewSize } from \"../index\";\nimport { useStorageSource } from \"../../hooks\";\nimport { DownloadConfig, FileType } from \"../../types\";\n\ntype StorageThumbnailProps = {\n    storagePathOrDownloadUrl: string;\n    storeUrl: boolean;\n    size: PreviewSize;\n};\n\n/**\n * @category Preview components\n */\nexport const StorageThumbnail = React.memo<StorageThumbnailProps>(StorageThumbnailInternal, areEqual) as React.FunctionComponent<StorageThumbnailProps>;\n\nfunction areEqual(prevProps: StorageThumbnailProps, nextProps: StorageThumbnailProps) {\n    return prevProps.size === nextProps.size &&\n        prevProps.storagePathOrDownloadUrl === nextProps.storagePathOrDownloadUrl &&\n        prevProps.storeUrl === nextProps.storeUrl;\n}\n\nconst URL_CACHE: Record<string, DownloadConfig> = {};\n\nexport function StorageThumbnailInternal({\n                                             storeUrl,\n                                             storagePathOrDownloadUrl,\n                                             size\n                                         }: StorageThumbnailProps) {\n    const storage = useStorageSource();\n\n    const [downloadConfig, setDownloadConfig] = React.useState<DownloadConfig>(URL_CACHE[storagePathOrDownloadUrl]);\n\n    useEffect(() => {\n        if (!storagePathOrDownloadUrl)\n            return;\n        let unmounted = false;\n        storage.getDownloadURL(storagePathOrDownloadUrl)\n            .then(function (downloadConfig) {\n                if (!unmounted) {\n                    setDownloadConfig(downloadConfig);\n                    URL_CACHE[storagePathOrDownloadUrl] = downloadConfig;\n                }\n            });\n        return () => {\n            unmounted = true;\n        };\n    }, [storagePathOrDownloadUrl]);\n\n    if (!storagePathOrDownloadUrl) return null;\n\n    const filetype = downloadConfig?.metadata ? getFiletype(downloadConfig?.metadata.contentType) : undefined;\n    const previewType = filetype?.startsWith(\"image\")\n        ? \"image\"\n        : (filetype?.startsWith(\"video\")\n            ? \"video\"\n            : (filetype?.startsWith(\"audio\") ? \"audio\" : \"file\"));\n\n    return downloadConfig\n        ? <UrlComponentPreview previewType={previewType}\n                               url={downloadConfig.url}\n                               size={size}\n                               hint={storagePathOrDownloadUrl}/>\n        : renderSkeletonImageThumbnail(size);\n}\n\nfunction getFiletype(input: string): FileType {\n    if (input.startsWith(\"image\")) return \"image/*\";\n    else if (input.startsWith(\"video\")) return \"video/*\";\n    else if (input.startsWith(\"audio\")) return \"audio/*\";\n    else if (input.startsWith(\"application\")) return \"application/*\";\n    else if (input.startsWith(\"text\")) return \"text/*\";\n    else if (input.startsWith(\"font\")) return \"font/*\";\n    else return input;\n}\n","import React from \"react\";\nimport { CheckBox, CheckBoxOutlineBlank } from \"@mui/icons-material\";\n\n/**\n * @category Preview components\n */\nexport function BooleanPreview({ value }: { value: boolean }): React.ReactElement {\n    return value\n        ? <CheckBox color=\"secondary\"/>\n        : <CheckBoxOutlineBlank color=\"disabled\"/>;\n}\n","import React, { useMemo } from \"react\";\n\n// @ts-ignore\nimport MarkdownIt from \"markdown-it\";\n\nexport interface MarkdownProps {\n    source: string\n}\n\nconst md = new MarkdownIt({ html: true, });\n/**\n * @category Preview components\n */\nexport const Markdown = React.memo<MarkdownProps>(function Markdown({\n                                                                        source\n                                                                    }: MarkdownProps) {\n        const html = useMemo(() => {\n            return md.render(typeof source === \"string\" ? source : \"\");\n        }, [source]);\n\n        return <div\n            dangerouslySetInnerHTML={{ __html: html }}\n        />;\n    }\n    , areEqual) as React.FunctionComponent<MarkdownProps>;\n\nfunction areEqual(prevProps: MarkdownProps, nextProps: MarkdownProps) {\n    return prevProps.source === nextProps.source;\n}\n","import React from \"react\";\nimport { Box } from \"@mui/material\";\n\n/**\n * @category Preview components\n */\nexport function EmptyValue() {\n\n    return <Box sx={{\n        borderRadius: \"9999px\",\n        backgroundColor: \"rgba(128,128,128,0.1)\",\n        width: \"18px\",\n        height: \"6px\",\n        display: \"inline-block\"\n    }}/>;\n}\n","import * as React from \"react\";\nimport { useMemo } from \"react\";\n\nimport {\n    Box,\n    darken,\n    IconButton,\n    lighten,\n    Skeleton,\n    Tooltip,\n    Typography\n} from \"@mui/material\";\nimport {\n    Entity,\n    EntityCollection,\n    EntityReference,\n    ResolvedProperty\n} from \"../../types\";\n\nimport KeyboardTabIcon from \"@mui/icons-material/KeyboardTab\";\nimport {\n    PreviewSize,\n    PropertyPreview,\n    SkeletonPropertyComponent\n} from \"../index\";\n\nimport {\n    ErrorView,\n    getReferencePreviewKeys,\n    getValueInPath,\n    resolveCollection\n} from \"../../core\";\nimport {\n    useEntityFetch,\n    useFireCMSContext,\n    useNavigationContext,\n    useSideEntityController\n} from \"../../hooks\";\n\nexport type ReferencePreviewProps = {\n    disabled: boolean;\n    reference: EntityReference,\n    size: PreviewSize;\n    previewProperties?: string[];\n    onClick?: () => void;\n    onHover?: boolean;\n    allowEntityNavigation?: boolean;\n};\n\n/**\n * @category Preview components\n */\nexport const ReferencePreview = React.memo<ReferencePreviewProps>(ReferencePreviewInternal, areEqual) as React.FunctionComponent<ReferencePreviewProps>;\n\nfunction areEqual(prevProps: ReferencePreviewProps, nextProps: ReferencePreviewProps) {\n    return prevProps.disabled === nextProps.disabled &&\n        prevProps.size === nextProps.size &&\n        prevProps.onHover === nextProps.onHover &&\n        prevProps.reference?.id === nextProps.reference?.id &&\n        prevProps.reference?.path === nextProps.reference?.path &&\n        prevProps.allowEntityNavigation === nextProps.allowEntityNavigation\n        ;\n}\n\nfunction ReferencePreviewInternal<M extends Record<string, any>>({\n                                                                     disabled,\n                                                                     reference,\n                                                                     previewProperties,\n                                                                     size,\n                                                                     onHover,\n                                                                     onClick,\n                                                                     allowEntityNavigation = true\n                                                                 }: ReferencePreviewProps) {\n\n    const context = useFireCMSContext();\n\n    const navigationContext = useNavigationContext();\n    const sideEntityController = useSideEntityController();\n\n    const collection = navigationContext.getCollection<EntityCollection<M>>(reference.path);\n    if (!collection) {\n        throw Error(`Couldn't find the corresponding collection view for the path: ${reference.path}`);\n    }\n\n    const {\n        entity,\n        dataLoading,\n        dataLoadingError\n    } = useEntityFetch({\n        path: reference.path,\n        entityId: reference.id,\n        collection,\n        useCache: true\n    });\n\n    if (entity) {\n        referencesCache.set(reference.pathWithId, entity);\n    }\n\n    const usedEntity = entity ?? referencesCache.get(reference.pathWithId);\n\n    const resolvedCollection = useMemo(() => resolveCollection({\n        collection,\n        path: reference.path,\n        values: usedEntity?.values,\n        fields: context.fields\n    }), [collection]);\n\n    const listProperties = useMemo(() => getReferencePreviewKeys(resolvedCollection, context.fields, previewProperties, size === \"small\" || size === \"regular\" ? 3 : 1),\n        [previewProperties, resolvedCollection, size]);\n\n    let body: React.ReactNode;\n\n    if (!resolvedCollection) {\n        return <ErrorView\n            error={\"Could not find collection with id \" + resolvedCollection}/>\n    }\n\n    if (!reference) {\n        body = <ErrorView error={\"Reference not set\"}/>;\n    } else if (!(reference instanceof EntityReference)) {\n        console.error(\"Reference preview received value of type\", typeof reference);\n        body = <ErrorView error={\"Unexpected value\"}\n                          tooltip={JSON.stringify(reference)}/>;\n    } else if (usedEntity && !usedEntity.values) {\n        body = <ErrorView error={\"Reference does not exist\"}\n                          tooltip={reference.path}/>;\n    } else {\n        body = (\n            <>\n                <Box sx={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    flexGrow: 1,\n                    maxWidth: \"calc(100% - 52px)\",\n                    margin: 1\n                }}>\n\n                    {size !== \"tiny\" && (\n                        reference\n                            ? <Box sx={{\n                                display: size !== \"regular\" ? \"block\" : undefined,\n                                whiteSpace: size !== \"regular\" ? \"nowrap\" : undefined,\n                                overflow: size !== \"regular\" ? \"hidden\" : undefined,\n                                textOverflow: size !== \"regular\" ? \"ellipsis\" : undefined\n                            }}>\n                                <Typography variant={\"caption\"}\n                                            className={\"mono\"}>\n                                    {reference.id}\n                                </Typography>\n                            </Box>\n                            : <Skeleton variant=\"text\"/>)}\n\n                    {listProperties && listProperties.map((key) => {\n                        const childProperty = resolvedCollection.properties[key as string];\n                        if (!childProperty) return null;\n\n                        return (\n                            <Box key={\"ref_prev_\" + (key as string)}\n                                 sx={{\n                                     my: listProperties.length > 1 ? 0.5 : 0\n                                 }}>\n                                {usedEntity\n                                    ? <PropertyPreview\n                                        propertyKey={key as string}\n                                        value={getValueInPath(usedEntity.values, key)}\n                                        property={childProperty as ResolvedProperty}\n                                        entity={usedEntity}\n                                        size={\"tiny\"}/>\n                                    : <SkeletonPropertyComponent\n                                        property={childProperty as ResolvedProperty}\n                                        size={\"tiny\"}/>\n                                }\n                            </Box>\n                        );\n                    })}\n\n                </Box>\n                <Box sx={{\n                    my: size === \"tiny\" ? 0.5 : 1\n                }}>\n                    {!disabled && usedEntity && allowEntityNavigation &&\n                        <Tooltip title={`See details for ${usedEntity.id}`}>\n                            <IconButton\n                                color={\"inherit\"}\n                                size={\"small\"}\n                                onClick={(e) => {\n                                    e.stopPropagation();\n                                    context.onAnalyticsEvent?.(\"entity_click_from_reference\", {\n                                        path: usedEntity.path,\n                                        entityId: usedEntity.id\n                                    });\n                                    sideEntityController.open({\n                                        entityId: usedEntity.id,\n                                        path: usedEntity.path,\n                                        collection: resolvedCollection,\n                                        updateUrl: true\n                                    });\n                                }}>\n                                <KeyboardTabIcon fontSize={\"small\"}/>\n                            </IconButton>\n                        </Tooltip>}\n                </Box>\n            </>\n        );\n    }\n\n    return (\n        <ReferencePreviewWrap onClick={disabled ? undefined : onClick}\n                              onHover={disabled ? undefined : onHover}\n                              size={size}>\n            {body}\n        </ReferencePreviewWrap>\n    );\n}\n\nfunction ReferencePreviewWrap({\n                                  children,\n                                  onHover,\n                                  size,\n                                  onClick\n                              }: {\n    children: React.ReactNode;\n    onHover?: boolean;\n    size: PreviewSize;\n    onClick?: () => void;\n}) {\n    return <Typography variant={\"label\"} sx={(theme) => {\n        const clickableStyles = onClick\n            ? {\n                tabindex: 0,\n                backgroundColor: onHover ? (theme.palette.mode === \"dark\" ? lighten(theme.palette.background.default, 0.1) : darken(theme.palette.background.default, 0.15)) : darken(theme.palette.background.default, 0.1),\n                transition: \"background-color 300ms ease, box-shadow 300ms ease\",\n                boxShadow: onHover ? \"0 0 0 2px rgba(128,128,128,0.05)\" : undefined,\n                cursor: onHover ? \"pointer\" : undefined\n            }\n            : {};\n        return ({\n            width: \"100%\",\n            display: \"flex\",\n            backgroundColor: darken(theme.palette.background.default, 0.1),\n            borderRadius: `${theme.shape.borderRadius}px`,\n            overflow: \"hidden\",\n            padding: size === \"regular\" ? 1 : 0,\n            itemsAlign: size === \"tiny\" ? \"center\" : undefined,\n            ...clickableStyles\n        });\n    }}\n                       onClick={(event) => {\n                           if (onClick) {\n                               event.preventDefault();\n                               onClick();\n                           }\n                       }}>\n\n        {children}\n\n    </Typography>\n}\n\nconst referencesCache = new Map<string, Entity<any>>();\n","import hash from \"object-hash\";\nimport { GeoPoint } from \"../../types\";\n\nexport const pick: <T>(obj: T, ...args: any[]) => T = (obj: any, ...args: any[]) => ({\n    ...args.reduce((res, key) => ({\n        ...res,\n        [key]: obj[key]\n    }), {})\n});\n\nexport function isObject(item: any) {\n    return item && typeof item === \"object\" && !Array.isArray(item);\n}\n\nexport function mergeDeep<T extends object>(target: T, source: any): T {\n    const targetIsObject = isObject(target);\n    const output: T = targetIsObject ? { ...target } : target;\n    if (targetIsObject && isObject(source)) {\n        Object.keys(source).forEach(key => {\n            if (isObject(source[key])) {\n                if (!(key in target))\n                    Object.assign(output, { [key]: source[key] });\n                else\n                    (output as any)[key] = mergeDeep((target as any)[key], source[key]);\n            } else {\n                Object.assign(output, { [key]: source[key] });\n            }\n        });\n    }\n    return output;\n}\n\nexport function getValueInPath(o: object | undefined, path: string): any {\n    if (!o) return undefined;\n    if (typeof o === \"object\") {\n        if (path in o) {\n            return (o as any)[path];\n        }\n        if (path.includes(\".\")) {\n            const pathSegments = path.split(\".\");\n            return getValueInPath((o as any)[pathSegments[0]], pathSegments.slice(1).join(\".\"))\n        }\n    }\n    return undefined;\n}\n\nexport function removeInPath(o: object, path: string): object | undefined {\n    let currentObject = { ...o };\n    const parts = path.split(\".\");\n    const last = parts.pop();\n    for (const part of parts) {\n        currentObject = (currentObject as any)[part]\n    }\n    if (last)\n        delete (currentObject as any)[last];\n    return currentObject;\n}\n\nexport function removeFunctions(o: object | undefined): any {\n    if (typeof o === \"object\") {\n        return Object.entries(o)\n            .filter(([_, value]) => typeof value !== \"function\")\n            .map(([key, value]) => {\n                if (Array.isArray(value)) {\n                    return { [key]: value.map(v => removeFunctions(v)) };\n                } else if (typeof value === \"object\") {\n                    return { [key]: removeFunctions(value) };\n                } else return { [key]: value };\n            })\n            .reduce((a, b) => ({ ...a, ...b }), {});\n    }\n    return o;\n}\n\nexport function getHashValue<T>(v: T) {\n    if (!v) return null;\n    if (typeof v === \"object\") {\n        if (\"id\" in v)\n            return (v as any).id;\n        else if (v instanceof Date)\n            return v.toLocaleString();\n        else if (v instanceof GeoPoint)\n            return hash(v as Record<string, unknown>);\n    }\n    return hash(v, { ignoreUnknown: true });\n}\n\nexport function removeUndefined(value: any): any {\n    if (typeof value === \"function\") {\n        return value;\n    }\n    if (Array.isArray(value)) {\n        return value.map((v: any) => removeUndefined(v));\n    }\n    if (typeof value === \"object\") {\n        const res: object = {};\n        Object.keys(value).forEach((key) => {\n            if (!isEmptyObject(value)) {\n                const childRes = removeUndefined(value[key]);\n                if (childRes !== undefined && !isEmptyObject(childRes))\n                    (res as any)[key] = childRes;\n            }\n        });\n        return res;\n    }\n    return value;\n}\n\nexport function isEmptyObject(obj: object) {\n    return obj &&\n        Object.getPrototypeOf(obj) === Object.prototype &&\n        Object.keys(obj).length === 0\n}\n","import {\n    CMSType,\n    Entity,\n    EntityReference,\n    EntityStatus,\n    EntityValues,\n    Properties,\n    PropertiesOrBuilders,\n    Property,\n    PropertyBuilder,\n    PropertyOrBuilder,\n    ResolvedProperties,\n    ResolvedProperty\n} from \"../../types\";\nimport { DEFAULT_ONE_OF_TYPE, DEFAULT_ONE_OF_VALUE } from \"./common\";\n\nexport function isReadOnly(property: Property | ResolvedProperty): boolean {\n    if (property.readOnly)\n        return true;\n    if (property.dataType === \"date\") {\n        if (property.autoValue)\n            return true;\n    }\n    if (property.dataType === \"reference\") {\n        return !property.path;\n    }\n    return false;\n}\n\nexport function isHidden(property: Property | ResolvedProperty): boolean {\n    return typeof property.disabled === \"object\" && Boolean(property.disabled.hidden);\n}\n\nexport function isPropertyBuilder<T extends CMSType, M extends Record<string, any>>(propertyOrBuilder?: PropertyOrBuilder<T, M> | Property<T> | ResolvedProperty<T>): propertyOrBuilder is PropertyBuilder<T, M> {\n    return typeof propertyOrBuilder === \"function\";\n}\n\nexport function getDefaultValuesFor<M extends Record<string, any>>(properties: PropertiesOrBuilders<M> | ResolvedProperties<M>): Partial<EntityValues<M>> {\n    if (!properties) return {};\n    return Object.entries(properties)\n        .map(([key, property]) => {\n            const value = getDefaultValueFor(property as PropertyOrBuilder);\n            return value === undefined ? {} : { [key]: value };\n        })\n        .reduce((a, b) => ({ ...a, ...b }), {}) as EntityValues<M>;\n}\n\nfunction getDefaultValueFor(property: PropertyOrBuilder) {\n    if (isPropertyBuilder(property)) return undefined;\n    if (property.dataType === \"map\" && property.properties) {\n        const defaultValuesFor = getDefaultValuesFor(property.properties as Properties);\n        if (Object.keys(defaultValuesFor).length === 0) return undefined;\n        return defaultValuesFor;\n    } else {\n        return property.defaultValue;\n    }\n}\n\n/**\n * Update the automatic values in an entity before save\n * @category Datasource\n */\nexport function updateDateAutoValues<M extends Record<string, any>>({\n                                                                        inputValues,\n                                                                        properties,\n                                                                        status,\n                                                                        timestampNowValue,\n                                                                        setDateToMidnight\n                                                                    }:\n                                                                        {\n                                                                            inputValues: Partial<EntityValues<M>>,\n                                                                            properties: ResolvedProperties<M>,\n                                                                            status: EntityStatus,\n                                                                            timestampNowValue: any,\n                                                                            setDateToMidnight: (input?: any) => any | undefined\n                                                                        }): EntityValues<M> {\n    return traverseValuesProperties(\n        inputValues,\n        properties,\n        (inputValue, property) => {\n            if (property.dataType === \"date\") {\n                let resultDate;\n                if (status === \"existing\" && property.autoValue === \"on_update\") {\n                    resultDate = timestampNowValue;\n                } else if ((status === \"new\" || status === \"copy\") &&\n                    (property.autoValue === \"on_update\" || property.autoValue === \"on_create\")) {\n                    resultDate = timestampNowValue;\n                } else {\n                    resultDate = inputValue;\n                }\n                if (property.mode === \"date\")\n                    resultDate = setDateToMidnight(resultDate);\n                return resultDate;\n            } else {\n                return inputValue;\n            }\n        }\n    ) ?? {} as M;\n}\n\n/**\n * Add missing required fields, expected in the collection, to the values of an entity\n * @param values\n * @param properties\n * @category Datasource\n */\nexport function sanitizeData<M extends Record<string, any>>\n(\n    values: EntityValues<M>,\n    properties: ResolvedProperties<M>\n) {\n    const result: any = values;\n    Object.entries(properties)\n        .forEach(([key, property]) => {\n            if (values && values[key] !== undefined) result[key] = values[key];\n            else if ((property as Property).validation?.required) result[key] = null;\n        });\n    return result;\n}\n\nexport function getReferenceFrom(entity: Entity<any>): EntityReference {\n    return new EntityReference(entity.id, entity.path);\n}\n\nexport function traverseValuesProperties<M extends Record<string, any>>(\n    inputValues: Partial<EntityValues<M>>,\n    properties: ResolvedProperties<M>,\n    operation: (value: any, property: Property) => any\n): EntityValues<M> | undefined {\n    const updatedValues = Object.entries(properties)\n        .map(([key, property]) => {\n            const inputValue = inputValues && (inputValues)[key];\n            const updatedValue = traverseValueProperty(inputValue, property as Property, operation);\n            if (updatedValue === undefined) return undefined;\n            return ({ [key]: updatedValue });\n        })\n        .reduce((a, b) => ({ ...a, ...b }), {}) as EntityValues<M>;\n    const result = { ...inputValues, ...updatedValues };\n    if (Object.keys(result).length === 0) return undefined;\n    return result;\n}\n\nexport function traverseValueProperty(inputValue: any,\n                                      property: Property,\n                                      operation: (value: any, property: Property) => any): any {\n\n    let value;\n    if (property.dataType === \"map\" && property.properties) {\n        value = traverseValuesProperties(inputValue, property.properties as ResolvedProperties, operation);\n    } else if (property.dataType === \"array\") {\n        if (property.of && Array.isArray(inputValue)) {\n            value = inputValue.map((e) => traverseValueProperty(e, property.of as Property, operation));\n        } else if (property.oneOf && Array.isArray(inputValue)) {\n            const typeField = property.oneOf?.typeField ?? DEFAULT_ONE_OF_TYPE;\n            const valueField = property.oneOf?.valueField ?? DEFAULT_ONE_OF_VALUE;\n            value = inputValue.map((e) => {\n                if (e === null) return null;\n                if (typeof e !== \"object\") return e;\n                const type = e[typeField];\n                const childProperty = property.oneOf?.properties[type];\n                if (!type || !childProperty) return e;\n                return {\n                    [typeField]: type,\n                    [valueField]: traverseValueProperty(e[valueField], childProperty, operation)\n                };\n            });\n        } else {\n            value = inputValue;\n        }\n    } else {\n        value = operation(inputValue, property);\n    }\n\n    return value;\n}\n","import {\n    EntityCollection,\n    PropertiesOrBuilders,\n    PropertyOrBuilder\n} from \"../../types\";\nimport { mergeDeep } from \"./objects\";\nimport { isPropertyBuilder } from \"./entities\";\n\n/**\n *\n * @param target\n * @param source\n */\nexport function mergeCollections(target: EntityCollection, source: EntityCollection): EntityCollection {\n    const subcollectionsMerged = target.subcollections?.map((targetSubcollection) => {\n        const modifiedCollection =\n            source.subcollections?.find((sourceSubcollection) => sourceSubcollection.path === targetSubcollection.path) ??\n            source.subcollections?.find((sourceSubcollection) => sourceSubcollection.alias === targetSubcollection.alias);\n\n        if (!modifiedCollection) {\n            return targetSubcollection;\n        } else {\n            return mergeCollections(targetSubcollection, modifiedCollection);\n        }\n    });\n\n    const mergedCollection = mergeDeep(target, source);\n    return {\n        ...mergedCollection,\n        subcollections: subcollectionsMerged,\n        properties: sortProperties(mergedCollection.properties, mergedCollection.propertiesOrder)\n    }\n}\n\n/**\n *\n * @param fetchedCollections\n * @param baseCollections\n */\nexport function joinCollectionLists(fetchedCollections: EntityCollection[], baseCollections: EntityCollection[] | undefined): EntityCollection[] {\n    const resolvedFetchedCollections: EntityCollection[] = fetchedCollections.map(c => ({\n        ...c,\n        editable: true,\n        deletable: true\n    }));\n    const updatedCollections = (baseCollections ?? [])\n        .map((navigationCollection) => {\n            const storedCollection = resolvedFetchedCollections?.find((collection) => collection.path === navigationCollection.path) ??\n                resolvedFetchedCollections?.find((collection) => collection.alias === navigationCollection.alias);\n            if (!storedCollection) {\n                return { ...navigationCollection, deletable: false };\n            } else {\n                const mergedCollection = mergeCollections(navigationCollection, storedCollection);\n                return { ...mergedCollection, deletable: false };\n            }\n        });\n    const storedCollections = resolvedFetchedCollections\n        .filter((col) => !updatedCollections.map(c => c.path).includes(col.path) || !updatedCollections.map(c => c.alias).includes(col.alias));\n\n    return [...updatedCollections, ...storedCollections];\n}\n\nexport function sortProperties<M extends Record<string, any>>(properties: PropertiesOrBuilders<M>, propertiesOrder?: (keyof M)[]): PropertiesOrBuilders<M> {\n    try {\n        const propertiesKeys = Object.keys(properties);\n        const allPropertiesOrder = propertiesOrder ?? propertiesKeys;\n        return allPropertiesOrder\n            .map((key) => {\n                if (properties[key as keyof M]) {\n                    const property = properties[key] as PropertyOrBuilder;\n                    if (!isPropertyBuilder(property) && property?.dataType === \"map\" && property.properties) {\n                        return ({\n                            [key]: {\n                                ...property,\n                                properties: sortProperties(property.properties, property.propertiesOrder)\n                            }\n                        });\n                    } else {\n                        return ({ [key]: property });\n                    }\n                } else {\n                    return undefined;\n                }\n            })\n            .filter((a) => a !== undefined)\n            .reduce((a: any, b: any) => ({ ...a, ...b }), {}) as PropertiesOrBuilders<M>;\n    } catch (e) {\n        console.error(\"Error sorting properties\", e);\n        return properties;\n    }\n}\n","const kebabCaseRegex = /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g;\n\nexport const toKebabCase = (str: string) => {\n    const regExpMatchArray = str.match(kebabCaseRegex);\n    if (!regExpMatchArray) return \"\";\n    return regExpMatchArray\n        .map(x => x.toLowerCase())\n        .join(\"-\");\n};\n\nconst snakeCaseRegex = /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g;\n\nexport const toSnakeCase = (str: string) => {\n    const regExpMatchArray = str.match(snakeCaseRegex);\n    if (!regExpMatchArray) return \"\";\n    return regExpMatchArray\n        .map(x => x.toLowerCase())\n        .join(\"_\");\n};\n\nexport function randomString(strLength = 5) {\n    return Math.random().toString(36).slice(2, 2 + strLength);\n}\n\nexport function randomColor() {\n    return Math.floor(Math.random() * 16777215).toString(16);\n}\n","export const COLLECTION_PATH_SEPARATOR = \"::\";\n\n/**\n * Remove the entity ids from a given path\n * `products/B44RG6APH/locales` => `products::locales`\n * @param path\n */\nexport function stripCollectionPath(path: string): string {\n    return segmentsToStrippedPath(fullPathToCollectionSegments(path));\n}\n\nexport function segmentsToStrippedPath(paths: string[]) {\n    if (paths.length === 1)\n        return paths[0];\n    return paths.reduce((a, b) => `${a}${COLLECTION_PATH_SEPARATOR}${b}`);\n}\n\n/**\n * Extract the collection path routes\n * `products/B44RG6APH/locales` => [`products`, `locales`]\n * @param path\n */\nexport function fullPathToCollectionSegments(path: string): string[] {\n    return path\n        .split(\"/\")\n        .filter((e, i) => i % 2 === 0);\n}\n","export function serializeRegExp(input: RegExp): string {\n    if (!input) return \"\";\n    // const fragments = input.toString().match(/\\/(.*?)\\/([a-z]*)?$/i);\n    // if (fragments) {\n    //     if (fragments[2])\n    //         return input.toString();\n    //     return fragments[1];\n    // }\n    return input.toString();\n}\n\n/**\n * Get a RegExp out of a serialized string\n * @param input\n */\nexport function hydrateRegExp(input?: string): RegExp | undefined {\n    if (!input) return undefined;\n    const fragments = input.match(/\\/(.*?)\\/([a-z]*)?$/i);\n    if (fragments) {\n        return new RegExp(fragments[1], fragments[2] || \"\");\n    } else {\n        return new RegExp(input, \"\");\n    }\n}\n\nexport function isValidRegExp(input: string): boolean {\n    const fullRegexp = input.match(/\\/((?![*+?])(?:[^\\r\\n[/\\\\]|\\\\.|\\[(?:[^\\r\\n\\]\\\\]|\\\\.)*])+)\\/((?:g(?:im?|mi?)?|i(?:gm?|mg?)?|m(?:gi?|ig?)?)?)/);\n    if (fullRegexp)\n        return true;\n    const simpleRegexp = input.match(/((?![*+?])(?:[^\\r\\n[/\\\\]|\\\\.|\\[(?:[^\\r\\n\\]\\\\]|\\\\.)*])+)/);\n    return !!simpleRegexp;\n}\n","import React from \"react\";\n\nexport function useDebounce<T>(value: T, callback: () => void, timeoutMs = 300) {\n\n    const pendingUpdate = React.useRef(false);\n    const performUpdate = React.useCallback(() => {\n        callback();\n        pendingUpdate.current = false;\n    }, [callback]);\n\n    React.useEffect(\n        () => {\n            pendingUpdate.current = true;\n            const handler = setTimeout(performUpdate, timeoutMs);\n            return () => {\n                clearTimeout(handler);\n                if (pendingUpdate.current)\n                    performUpdate();\n            };\n        },\n        [value]\n    );\n}\n","import { useEffect, useState } from \"react\";\n\nexport function useDebounceValue<T>(value:T, delay = 300):T {\n    // State and setters for debounced value\n    const [debouncedValue, setDebouncedValue] = useState(value);\n    useEffect(\n        () => {\n            const handler = setTimeout(() => {\n                setDebouncedValue(value);\n            }, delay);\n            return () => {\n                clearTimeout(handler);\n            };\n        },\n        [value, delay] // Only re-call effect if value or delay changes\n    );\n    return debouncedValue;\n}\n","import React, {\n    useCallback,\n    useEffect,\n    useMemo,\n    useRef,\n    useState\n} from \"react\";\nimport { FieldArray } from \"formik\";\n\nimport {\n    Box,\n    Button,\n    IconButton,\n    ListItemIcon,\n    ListItemText,\n    Menu,\n    MenuItem,\n    Tooltip\n} from \"@mui/material\";\n\nimport AddIcon from \"@mui/icons-material/Add\";\nimport RemoveIcon from \"@mui/icons-material/Remove\";\nimport CopyIcon from \"@mui/icons-material/ContentCopy\";\nimport DragHandleIcon from \"@mui/icons-material/DragHandle\";\n\nimport {\n    DragDropContext,\n    Draggable,\n    DraggableProvided,\n    Droppable\n} from \"@hello-pangea/dnd\";\n\nimport { getHashValue } from \"../../core\";\nimport useMeasure from \"react-use-measure\";\nimport { MoreVert } from \"@mui/icons-material\";\n\ninterface ArrayContainerProps<T> {\n    value: T[];\n    name: string;\n    addLabel: string;\n    buildEntry: (index: number, internalId: number) => React.ReactNode;\n    disabled: boolean;\n    small?: boolean;\n    onInternalIdAdded?: (id: number) => void;\n    includeAddButton?: boolean;\n    newDefaultEntry?: T | null;\n}\n\n/**\n * @category Form custom fields\n */\nexport function ArrayContainer<T>({\n                                      name,\n                                      addLabel,\n                                      value,\n                                      disabled,\n                                      buildEntry,\n                                      small,\n                                      onInternalIdAdded,\n                                      includeAddButton,\n                                      newDefaultEntry = null\n                                  }: ArrayContainerProps<T>) {\n\n    const hasValue = value && Array.isArray(value) && value.length > 0;\n    const internalIdsMap: Record<string, number> = useMemo(() =>\n            hasValue\n                ? value.map((v, index) => {\n                    if (!v) return {};\n                    return ({\n                        [getHashValue(v) + index]: getRandomId()\n                    });\n                }).reduce((a, b) => ({ ...a, ...b }), {})\n                : {},\n        [value, hasValue]);\n\n    // Used to track the ids that have displayed the initial show animation\n    const animatedIds = useRef<Set<number>>(new Set(Object.values(internalIdsMap)));\n    const internalIdsRef = useRef<Record<string, number>>(internalIdsMap);\n\n    const [internalIds, setInternalIds] = useState<number[]>(\n        hasValue\n            ? Object.values(internalIdsRef.current)\n            : []);\n\n    useEffect(() => {\n        if (hasValue && value && value.length !== internalIds.length) {\n            const newInternalIds = value.map((v, index) => {\n                const hashValue = getHashValue(v) + index;\n                if (hashValue in internalIdsRef.current) {\n                    return internalIdsRef.current[hashValue];\n                } else {\n                    const newInternalId = getRandomId();\n                    internalIdsRef.current[hashValue] = newInternalId;\n                    return newInternalId;\n                }\n            });\n            setInternalIds(newInternalIds);\n        }\n    }, [hasValue, internalIds.length, value]);\n\n    return <FieldArray\n        name={name}\n        validateOnChange={true}\n        render={arrayHelpers => {\n            return <ArrayContainerInternal\n                disabled={disabled}\n                internalIds={internalIds}\n                onInternalIdAdded={onInternalIdAdded}\n                setInternalIds={setInternalIds}\n                arrayHelpers={arrayHelpers}\n                newDefaultEntry={newDefaultEntry}\n                value={value}\n                name={name}\n                small={small}\n                buildEntry={buildEntry}\n                hasValue={hasValue}\n                includeAddButton={includeAddButton}\n                addLabel={addLabel}\n                animatedIds={animatedIds}\n            />;\n        }}\n    />;\n}\n\nfunction ArrayContainerInternal<T>({\n                                       disabled,\n                                       internalIds,\n                                       onInternalIdAdded,\n                                       setInternalIds,\n                                       arrayHelpers,\n                                       newDefaultEntry,\n                                       value,\n                                       name,\n                                       small,\n                                       buildEntry,\n                                       hasValue,\n                                       includeAddButton,\n                                       addLabel,\n                                       animatedIds\n                                   }: {\n    disabled: boolean,\n    internalIds: any,\n    onInternalIdAdded: ((id: number) => void) | undefined,\n    setInternalIds: any,\n    arrayHelpers: any,\n    newDefaultEntry: T | null | undefined,\n    value: T[],\n    name: string,\n    small: boolean | undefined,\n    buildEntry: (index: number, internalId: number) => React.ReactNode,\n    hasValue: boolean,\n    includeAddButton: boolean | undefined,\n    addLabel: string,\n    animatedIds: React.MutableRefObject<Set<number>>,\n}) {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const insertInEnd = useCallback(() => {\n        if (disabled) return;\n        const id = getRandomId();\n        const newIds: number[] = [...internalIds, id];\n        if (onInternalIdAdded)\n            onInternalIdAdded(id);\n        setInternalIds(newIds);\n        arrayHelpers.push(newDefaultEntry);\n    }, [arrayHelpers, disabled, internalIds, newDefaultEntry, onInternalIdAdded, setInternalIds]);\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const remove = useCallback((index: number) => {\n        const newIds = [...internalIds];\n        newIds.splice(index, 1);\n        setInternalIds(newIds);\n        animatedIds.current.delete(internalIds[index]);\n        arrayHelpers.remove(index);\n    }, [arrayHelpers, internalIds, setInternalIds]);\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const copy = useCallback((index: number) => {\n        const id = getRandomId();\n        const copyingItem = value[index];\n        const newIds: number[] = [\n            ...internalIds.splice(0, index + 1),\n            id,\n            ...internalIds.splice(index + 1, internalIds.length - index - 1)];\n        if (onInternalIdAdded)\n            onInternalIdAdded(id);\n        setInternalIds(newIds);\n        arrayHelpers.insert(index + 1, copyingItem);\n    }, [arrayHelpers, internalIds, onInternalIdAdded, setInternalIds, value]);\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const onDragEnd = useCallback((result: any) => {\n        // dropped outside the list\n        if (!result.destination) {\n            return;\n        }\n        const sourceIndex = result.source.index;\n        const destinationIndex = result.destination.index;\n\n        const newIds = [...internalIds];\n        const temp = newIds[sourceIndex];\n        newIds[sourceIndex] = newIds[destinationIndex];\n        newIds[destinationIndex] = temp;\n        setInternalIds(newIds);\n\n        arrayHelpers.move(sourceIndex, destinationIndex);\n    }, [arrayHelpers, internalIds, setInternalIds]);\n\n    return (\n        <DragDropContext onDragEnd={onDragEnd}>\n            <Droppable droppableId={`droppable_${name}`}\n                       renderClone={(provided, snapshot, rubric) => {\n                           const index = rubric.source.index;\n                           const internalId = internalIds[index];\n                           return (\n                               <ArrayContainerItem\n                                   provided={provided}\n                                   internalId={internalId}\n                                   index={index}\n                                   name={name}\n                                   small={small}\n                                   disabled={disabled}\n                                   buildEntry={buildEntry}\n                                   remove={remove}\n                                   copy={copy}\n                                   animatedIds={animatedIds}\n                               />\n                           );\n                       }}\n            >\n                {(droppableProvided, droppableSnapshot) => (\n                    <div\n                        {...droppableProvided.droppableProps}\n                        ref={droppableProvided.innerRef}>\n                        {hasValue && internalIds.map((internalId: number, index: number) => {\n                            return (\n                                <Draggable\n                                    key={`array_field_${name}_${internalId}`}\n                                    draggableId={`array_field_${name}_${internalId}`}\n                                    isDragDisabled={disabled}\n                                    index={index}>\n                                    {(provided, snapshot) => (\n                                        <ArrayContainerItem\n                                            provided={provided}\n                                            internalId={internalId}\n                                            index={index}\n                                            name={name}\n                                            small={small}\n                                            disabled={disabled}\n                                            buildEntry={buildEntry}\n                                            remove={remove}\n                                            copy={copy}\n                                            animatedIds={animatedIds}\n                                        />\n                                    )}\n                                </Draggable>\n                            );\n                        })}\n\n                        {droppableProvided.placeholder}\n\n                        {includeAddButton && <Box p={1}\n                                                  justifyContent=\"center\"\n                                                  textAlign={\"left\"}>\n                            <Button variant=\"outlined\"\n                                    size={\"large\"}\n                                    color=\"primary\"\n                                    disabled={disabled}\n                                    startIcon={<AddIcon/>}\n                                    onClick={insertInEnd}>\n                                {addLabel ?? \"Add\"}\n                            </Button>\n                        </Box>}\n                    </div>\n                )}\n            </Droppable>\n        </DragDropContext>\n    );\n}\n\ntype ArrayContainerItemProps = {\n    provided: DraggableProvided,\n    index: number,\n    name: string,\n    internalId: number,\n    small?: boolean,\n    disabled: boolean,\n    buildEntry: (index: number, internalId: number) => React.ReactNode,\n    remove: (index: number) => void,\n    copy: (index: number) => void,\n    animatedIds: React.MutableRefObject<Set<number>>,\n};\n\nfunction ArrayContainerItem({\n                                provided,\n                                index,\n                                name,\n                                internalId,\n                                small,\n                                disabled,\n                                buildEntry,\n                                remove,\n                                copy,\n                                animatedIds\n                            }: ArrayContainerItemProps) {\n\n    const [measureRef, bounds] = useMeasure();\n    const smallContent = bounds.height < 100;\n\n    // WIP of animation\n    // const initiallyDisplayed = animatedIds.current.has(internalId);\n    // const [displayed, setDisplayed] = useState(initiallyDisplayed);\n    // useEffect(() => {\n    //     setDisplayed(true);\n    //     animatedIds.current.add(internalId);\n    // }, []);\n    //\n    // console.log(animatedIds.current);\n\n    return <Box\n        ref={provided.innerRef}\n        {...provided.draggableProps}\n        style={\n            provided.draggableProps.style\n        }\n        sx={theme => ({\n            marginBottom: 1,\n            borderRadius: theme.shape.borderRadius,\n            opacity: 1\n        })}\n    >\n        {/*<Collapse*/}\n        {/*    in={displayed}*/}\n        {/*    appear={false}*/}\n        {/*    enter={initiallyDisplayed}*/}\n        {/*    timeout={500}>*/}\n        <Box\n            display=\"flex\">\n            <Box ref={measureRef}\n                 flexGrow={1}\n                 width={\"calc(100% - 48px)\"}\n                // key={`field_${name}_entryValue`}\n            >\n                {buildEntry(index, internalId)}\n            </Box>\n            <ArrayItemOptions direction={small ? \"row\" : \"column\"}\n                              disabled={disabled}\n                              remove={remove}\n                              index={index}\n                              provided={provided}\n                              smallContent={smallContent}\n                              copy={copy}/>\n        </Box>\n        {/*</Collapse>*/}\n    </Box>;\n}\n\nfunction ArrayItemOptions({\n                              direction,\n                              disabled,\n                              remove,\n                              index,\n                              provided,\n                              copy,\n                              smallContent\n                          }: {\n    direction?: \"row\" | \"column\",\n    smallContent: boolean,\n    disabled: boolean,\n    remove: (index: number) => void,\n    index: number,\n    provided: any,\n    copy: (index: number) => void\n}) {\n\n    const [anchorEl, setAnchorEl] = React.useState<any | null>(null);\n\n    const openMenu = useCallback((event: React.MouseEvent) => {\n        setAnchorEl(event.currentTarget);\n        event.stopPropagation();\n    }, [setAnchorEl]);\n\n    const closeMenu = useCallback(() => {\n        setAnchorEl(null);\n    }, [setAnchorEl]);\n\n    return <Box display=\"flex\"\n                flexDirection={direction ?? \"column\"}\n                sx={{\n                    pl: 1\n                }}\n                alignItems=\"center\">\n        <div\n            {...provided.dragHandleProps}>\n            <Tooltip\n                placement={direction === \"column\" ? \"left\" : undefined}\n                title=\"Move\">\n                <IconButton\n                    size=\"small\"\n                    disabled={disabled}\n                    sx={{ cursor: disabled ? \"inherit\" : \"move\" }}>\n                    <DragHandleIcon\n                        fontSize={\"small\"}\n                        color={disabled ? \"disabled\" : \"inherit\"}/>\n                </IconButton>\n            </Tooltip>\n        </div>\n\n        {!smallContent && <>\n            <Tooltip\n                title=\"Remove\"\n                placement={direction === \"column\" ? \"left\" : undefined}>\n                <IconButton\n                    size=\"small\"\n                    aria-label=\"remove\"\n                    disabled={disabled}\n                    onClick={() => remove(index)}>\n                    <RemoveIcon\n                        fontSize={\"small\"}/>\n                </IconButton>\n            </Tooltip>\n\n            <Tooltip\n                placement={direction === \"column\" ? \"left\" : undefined}\n                title=\"Copy in this position\">\n                <IconButton\n                    size=\"small\"\n                    aria-label=\"copy\"\n                    disabled={disabled}\n                    onClick={() => copy(index)}>\n                    <CopyIcon\n                        fontSize={\"small\"}/>\n                </IconButton>\n            </Tooltip>\n        </>}\n\n        {smallContent && <>\n            <IconButton onClick={openMenu}\n                        size={\"small\"}>\n                <MoreVert/>\n            </IconButton>\n            <Menu\n                anchorEl={anchorEl}\n                open={Boolean(anchorEl)}\n                onClose={closeMenu}\n                elevation={3}\n            >\n\n                <MenuItem dense onClick={() => remove(index)}>\n                    <ListItemIcon>\n                        <RemoveIcon/>\n                    </ListItemIcon>\n                    <ListItemText primary=\"Remove\"/>\n                </MenuItem>\n                <MenuItem dense onClick={() => copy(index)}>\n                    <ListItemIcon>\n                        <CopyIcon/>\n                    </ListItemIcon>\n                    <ListItemText primary={\"Copy\"}/>\n                </MenuItem>\n\n            </Menu></>}\n    </Box>;\n}\n\nfunction getRandomId() {\n    return Math.floor(Math.random() * Math.floor(Number.MAX_SAFE_INTEGER));\n}\n","import React from \"react\";\nimport { CMSType, ResolvedProperty } from \"../../types\";\n\nimport {\n    Box,\n    FormHelperText,\n    IconButton,\n    Tooltip,\n    Typography\n} from \"@mui/material\";\nimport InfoIcon from \"@mui/icons-material/InfoOutlined\";\n\ninterface FieldDescriptionPopoverProps<T extends CMSType> {\n    property: ResolvedProperty<T>,\n}\n\n/**\n * Render the field description for a property\n * @category Form custom fields\n */\nexport function FieldDescription<T extends CMSType>({ property }: FieldDescriptionPopoverProps<T>) {\n    const disabledTooltip: string | undefined = typeof property.disabled === \"object\" ? property.disabled.disabledMessage : undefined;\n    return (\n\n        // <FormHelperText>{disabledTooltip ? disabledTooltip : property.description}</FormHelperText>\n        <Box display=\"flex\">\n\n            <Box flexGrow={1}>\n                <FormHelperText>{disabledTooltip || property.description}</FormHelperText>\n            </Box>\n\n            {property.longDescription &&\n            <Tooltip title={\n                <Typography\n                    variant={\"caption\"}>{property.longDescription}</Typography>\n            }\n                     placement=\"bottom-start\"\n                     arrow>\n                <IconButton\n                    edge={\"start\"}\n                    size={\"small\"}\n                    sx={{\n                        alignSelf: \"flex-start\"\n                    }}>\n\n                    <InfoIcon color={\"disabled\"}\n                              fontSize={\"small\"}/>\n                </IconButton>\n            </Tooltip>}\n\n        </Box>\n    );\n}\n","import React from \"react\";\nimport { Box, SxProps, Theme, Typography } from \"@mui/material\";\n\ninterface LabelWithIconProps {\n\n    icon: React.ReactNode;\n    title?: string;\n    small?: boolean;\n    sx?: SxProps<Theme>;\n}\n\n/**\n * Render the label of a form field for a given property, with the corresponding\n * icon\n * @category Form custom fields\n */\nexport function LabelWithIcon({\n                                  icon,\n                                  title,\n                                  small,\n                                  sx\n                              }: LabelWithIconProps) {\n    return (\n        <Box sx={{\n            display: \"inline-flex\",\n            marginBottom: \"2px\",\n            alignItems: \"center\",\n            gap: small ? 1 : 1.5,\n            ...sx\n        }} component={\"span\"}>\n\n            {icon}\n            <Typography component={\"span\"}\n                        sx={{\n                            fontWeight: 500,\n                            fontSize: small ? \"1rem\" : \".85rem\",\n                            transformOrigin: \"left top\",\n                            transform: small ? \"translate(8px, 0px) scale(0.75)\" : undefined\n                        }}>{title}</Typography>\n\n        </Box>\n    );\n}\n","import React, {\n    ChangeEvent,\n    useCallback,\n    useDeferredValue,\n    useEffect\n} from \"react\";\nimport { TextField, TextFieldProps } from \"@mui/material\";\n\nexport function DebouncedTextField(props: TextFieldProps) {\n\n    const previousEventRef = React.useRef<ChangeEvent<any>>();\n    const [internalValue, setInternalValue] = React.useState(props.value);\n\n    const deferredValue = useDeferredValue(internalValue);\n\n    useEffect(() => {\n        setInternalValue(props.value);\n    }, [props.value]);\n\n    useEffect(() => {\n        const emptyInitialValue = !props.value;\n        if (emptyInitialValue && !deferredValue)\n            return;\n        if (deferredValue !== props.value && previousEventRef.current && props.onChange)\n            props.onChange(previousEventRef.current);\n    }, [deferredValue, props.value, props.onChange]);\n\n    const internalOnChange = useCallback((event: ChangeEvent<any>) => {\n        previousEventRef.current = event;\n        setInternalValue(event.target.value);\n    }, []);\n\n    return <TextField {...props}\n                      onChange={internalOnChange}\n                      value={internalValue}/>\n}\n","import React from \"react\";\n\nimport { FieldProps } from \"formik\";\nimport { FormControlLabel, Switch, Tooltip, Typography } from \"@mui/material\";\n\nexport function SwitchControl({\n                                 field,\n                                 form,\n                                 label,\n                                 tooltip,\n                                 disabled,\n                                 size = \"small\"\n                             }: FieldProps & { label: string, tooltip?: string, disabled?: boolean, size: \"small\" | \"medium\" }) {\n    const formControlLabel = <FormControlLabel\n        checked={field.value ?? false}\n        sx={{ ml: 0 }}\n        disabled={disabled}\n        control={\n            <Switch size={size}\n                    disabled={disabled}\n                    onChange={(e, checked) => form.setFieldValue(field.name, checked)}/>\n        }\n        label={<Typography variant={\"body2\"}>{label}</Typography>}\n    />;\n    if (tooltip)\n        return (\n            <Tooltip\n                title={tooltip}>\n                {formControlLabel}\n            </Tooltip>\n        );\n    return formControlLabel;\n}\n","import React, { useCallback } from \"react\";\nimport {\n    FormControl,\n    FormHelperText,\n    IconButton,\n    InputLabel,\n    MenuItem,\n    Select as MuiSelect\n} from \"@mui/material\";\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\n\nimport { EnumType, FieldProps } from \"../../types\";\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { isEnumValueDisabled } from \"../../core/util/enums\";\nimport { EnumValuesChip } from \"../../preview\";\nimport { getIconForProperty } from \"../../core\";\n\ntype SelectProps<T extends EnumType> = FieldProps<T>;\n\n/**\n * If `enumValues` are set in the string config, this field renders a select\n * where each option is a colored chip.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function SelectFieldBinding<T extends EnumType>({\n                                                           propertyKey,\n                                                           value,\n                                                           setValue,\n                                                           error,\n                                                           showError,\n                                                           disabled,\n                                                           autoFocus,\n                                                           touched,\n                                                           property,\n                                                           includeDescription\n                                                       }: SelectProps<T>) {\n\n    const enumValues = property.enumValues;\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const handleClearClick = useCallback(() => {\n        setValue(null);\n    }, [setValue]);\n\n    return (\n        <FormControl\n            fullWidth\n            required={property.validation?.required}\n            error={showError}\n            disabled={disabled}\n            sx={{\n                \"& .MuiInputLabel-root\": {\n                    mt: 1 / 2,\n                    ml: 1 / 2\n                },\n                \"& .MuiInputLabel-shrink\": {\n                    mt: 2\n                }\n            }}\n        >\n\n            <InputLabel id={`${propertyKey}-select-label`}>\n                <LabelWithIcon icon={getIconForProperty(property)}\n                                 title={property.name}/>\n            </InputLabel>\n\n            <MuiSelect\n                sx={(theme) => ({\n                    minHeight: \"64px\",\n                    borderRadius: `${theme.shape.borderRadius}px`\n                })}\n                variant={\"filled\"}\n                labelId={`${propertyKey}-select-label`}\n                autoFocus={autoFocus}\n                value={value ?? \"\"}\n                disabled={disabled}\n                disableUnderline={true}\n                endAdornment={\n                    property.clearable && <IconButton\n                        sx={{\n                            position: \"absolute\",\n                            top: \"12px\",\n                            right: \"32px\"\n                        }}\n                        onClick={handleClearClick}>\n                        <ClearIcon/>\n                    </IconButton>\n                }\n                onChange={(evt: any) => {\n                    const eventValue = evt.target.value;\n                    const newValue = eventValue\n                        ? (property.dataType === \"number\" ? parseFloat(eventValue) : eventValue)\n                        : null;\n\n                    return setValue(newValue);\n                }}\n                renderValue={(enumKey: any) => {\n                    return <EnumValuesChip\n                        enumKey={enumKey}\n                        enumValues={enumValues}\n                        small={false}/>;\n                }\n                }>\n\n                {enumValues && enumValues.map((enumConfig) => {\n                    return (\n                        <MenuItem key={`select_${propertyKey}_${enumConfig.id}`}\n                                  value={enumConfig.id}\n                                  disabled={isEnumValueDisabled(enumConfig)}>\n                            <EnumValuesChip\n                                enumKey={enumConfig.id}\n                                enumValues={enumValues}\n                                small={true}/>\n                        </MenuItem>\n                    );\n                })}\n            </MuiSelect>\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n            {showError && <FormHelperText error={true}>{error}</FormHelperText>}\n\n        </FormControl>\n    );\n}\n","import React, { useCallback } from \"react\";\nimport {\n    Checkbox,\n    FormControl,\n    FormHelperText,\n    IconButton,\n    InputLabel,\n    ListItemText,\n    MenuItem,\n    Select as MuiSelect\n} from \"@mui/material\";\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\n\nimport { EnumType, FieldProps, ResolvedProperty } from \"../../types\";\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport {\n    enumToObjectEntries,\n    isEnumValueDisabled\n} from \"../../core/util/enums\";\nimport { ArrayEnumPreview, EnumValuesChip } from \"../../preview\";\nimport { ErrorView, getIconForProperty } from \"../../core\";\n\n/**\n * This fields renders a dropdown with multiple selection.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function ArrayEnumSelectBinding({\n                                           propertyKey,\n                                           value,\n                                           setValue,\n                                           error,\n                                           showError,\n                                           disabled,\n                                           property,\n                                           includeDescription,\n                                           autoFocus\n                                       }: FieldProps<EnumType[], any, any>) {\n\n    const of = property.of;\n    if (!of) {\n        throw Error(\"Using wrong component ArrayEnumSelect\");\n    }\n\n    if (Array.isArray(of)) {\n        throw Error(\"Using array properties instead of single one in `of` in ArrayProperty\");\n    }\n\n    if (of.dataType !== \"string\" && of.dataType !== \"number\") {\n        throw Error(\"Field misconfiguration: array field of type string or number\");\n    }\n\n    const enumValues = of.enumValues;\n    if (!enumValues) {\n        console.error(property);\n        throw Error(\"Field misconfiguration: array field of type string or number needs to have enumValues\");\n    }\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const handleClearClick = useCallback(() => {\n        setValue(null);\n    }, [setValue]);\n\n    if (enumValues instanceof Error) {\n        return <ErrorView error={enumValues.message}/>;\n    }\n\n    const validValue = !!value && Array.isArray(value);\n    return (\n        <FormControl\n            fullWidth\n            required={property.validation?.required}\n            error={showError}\n            sx={{\n                \"& .MuiInputLabel-root\": {\n                    mt: 1 / 2,\n                    ml: 1 / 2\n                },\n                \"& .MuiInputLabel-shrink\": {\n                    mt: 2\n                }\n            }}\n        >\n\n            <InputLabel id={`${propertyKey}-multiselect-label`}>\n                <LabelWithIcon icon={getIconForProperty(property)}\n                               title={property.name}/>\n            </InputLabel>\n\n            <MuiSelect\n                multiple\n                sx={(theme) => ({\n                    minHeight: \"64px\",\n                    borderRadius: `${theme.shape.borderRadius}px`\n                })}\n                variant={\"filled\"}\n                labelId={`${propertyKey}-multiselect-label`}\n                value={validValue ? value.map(v => v.toString()) : []}\n                autoFocus={autoFocus}\n                disabled={disabled}\n                disableUnderline={true}\n                endAdornment={\n                    of.clearable && <IconButton\n                        sx={{\n                            position: \"absolute\",\n                            top: \"12px\",\n                            right: \"32px\"\n                        }}\n                        onClick={handleClearClick}>\n                        <ClearIcon/>\n                    </IconButton>\n                }\n                onChange={(evt: any) => {\n                    let newValue;\n                    if ((of as ResolvedProperty)?.dataType === \"number\")\n                        newValue = evt.target.value ? evt.target.value.map((e: any) => parseFloat(e)) : [];\n                    else\n                        newValue = evt.target.value;\n                    return setValue(\n                        newValue\n                    );\n                }}\n                renderValue={(selected: any) => (\n                    <ArrayEnumPreview value={selected}\n                                      name={propertyKey}\n                                      enumValues={enumValues}\n                                      size={\"regular\"}/>\n                )}>\n\n                {enumToObjectEntries(enumValues)\n                    .map((enumConfig) => {\n                        const enumKey = enumConfig.id;\n                        const checked = validValue && value.map(v => v.toString()).includes(enumKey.toString());\n                        return (\n                            <MenuItem\n                                key={`form-select-${propertyKey}-${enumKey}`}\n                                value={enumKey}\n                                disabled={isEnumValueDisabled(enumConfig)}\n                                dense={true}>\n                                <Checkbox checked={checked}/>\n                                <ListItemText primary={\n                                    <EnumValuesChip\n                                        enumKey={enumKey}\n                                        enumValues={enumValues}\n                                        small={true}/>\n                                }/>\n                            </MenuItem>\n                        );\n                    })}\n            </MuiSelect>\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n            {showError && <FormHelperText error={true}>{error}</FormHelperText>}\n\n        </FormControl>\n    );\n}\n","import React, { useCallback, useMemo } from \"react\";\nimport { Box, Button, FormControl, FormHelperText } from \"@mui/material\";\nimport {\n    Entity,\n    EntityCollection,\n    EntityReference,\n    FieldProps,\n    ResolvedProperty\n} from \"../../types\";\nimport { ReferencePreview } from \"../../preview\";\nimport { ArrayContainer, FieldDescription, LabelWithIcon } from \"../components\";\nimport {\n    ErrorView,\n    ExpandablePanel,\n    getIconForProperty,\n    getReferenceFrom\n} from \"../../core\";\n\nimport {\n    useClearRestoreValue,\n    useNavigationContext,\n    useReferenceDialog\n} from \"../../hooks\";\n\ntype ArrayOfReferencesFieldProps = FieldProps<EntityReference[]>;\n\n/**\n * This field allows selecting multiple references.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function ArrayOfReferencesFieldBinding({\n                                                  propertyKey,\n                                                  value,\n                                                  error,\n                                                  showError,\n                                                  isSubmitting,\n                                                  tableMode,\n                                                  property,\n                                                  includeDescription,\n                                                  setValue\n                                              }: ArrayOfReferencesFieldProps) {\n\n    const ofProperty = property.of as ResolvedProperty;\n    if (ofProperty.dataType !== \"reference\") {\n        throw Error(\"ArrayOfReferencesField expected a property containing references\");\n    }\n\n    const expanded = property.expanded === undefined ? true : property.expanded;\n    const [onHover, setOnHover] = React.useState(false);\n    const selectedEntityIds = value && Array.isArray(value) ? value.map((ref) => ref.id) : [];\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const navigationContext = useNavigationContext();\n    const collection: EntityCollection | undefined = useMemo(() => {\n        return ofProperty.path ? navigationContext.getCollection(ofProperty.path) : undefined;\n    }, [ofProperty.path]);\n\n    if (!collection) {\n        throw Error(`Couldn't find the corresponding collection for the path: ${ofProperty.path}`);\n    }\n\n    const onMultipleEntitiesSelected = useCallback((entities: Entity<any>[]) => {\n        setValue(entities.map(e => getReferenceFrom(e)));\n    }, [setValue]);\n\n    const referenceDialogController = useReferenceDialog({\n            multiselect: true,\n            path: ofProperty.path,\n            collection,\n            onMultipleEntitiesSelected,\n            selectedEntityIds,\n            forceFilter: ofProperty.forceFilter\n        }\n    );\n\n    const onEntryClick = useCallback(() => {\n        referenceDialogController.open();\n    }, [referenceDialogController]);\n\n    const buildEntry = useCallback((index: number, internalId: number) => {\n        const entryValue = value && value.length > index ? value[index] : undefined;\n        if (!entryValue)\n            return <div>Internal ERROR</div>;\n        return (\n            <div\n                onMouseEnter={() => setOnHover(true)}\n                onMouseMove={() => setOnHover(true)}\n                onMouseLeave={() => setOnHover(false)}>\n                <ReferencePreview\n                    disabled={!ofProperty.path}\n                    previewProperties={ofProperty.previewProperties}\n                    size={\"regular\"}\n                    onClick={onEntryClick}\n                    reference={entryValue}\n                    onHover={onHover}\n                />\n            </div>\n        );\n    }, [ofProperty.path, ofProperty.previewProperties, onHover, value]);\n\n    const title = (\n        <LabelWithIcon icon={getIconForProperty(property)}\n                       title={property.name}/>\n    );\n\n    const body = <>\n        {!collection && <ErrorView\n            error={\"The specified collection does not exist. Check console\"}/>}\n\n        {collection && <>\n\n            <ArrayContainer value={value}\n                            addLabel={property.name ? \"Add reference to \" + property.name : \"Add reference\"}\n                            name={propertyKey}\n                            buildEntry={buildEntry}\n                            disabled={isSubmitting}\n                            newDefaultEntry={property.of.defaultValue}/>\n\n            <Box p={1}\n                 justifyContent=\"center\"\n                 textAlign={\"left\"}>\n                <Button variant=\"outlined\"\n                        color=\"primary\"\n                        disabled={isSubmitting}\n                        onClick={onEntryClick}>\n                    Edit {property.name}\n                </Button>\n            </Box>\n        </>}\n    </>;\n\n    return (\n        <>\n            <FormControl fullWidth error={showError}>\n\n                {!tableMode &&\n                    <ExpandablePanel initiallyExpanded={expanded} title={title}>\n                        {body}\n                    </ExpandablePanel>}\n\n                {tableMode && body}\n\n                {includeDescription &&\n                    <FieldDescription property={property}/>}\n\n                {showError &&\n                    typeof error === \"string\" &&\n                    <FormHelperText error={true}>{error}</FormHelperText>}\n\n            </FormControl>\n        </>\n    );\n}\n","import {\n    EntityValues,\n    ResolvedArrayProperty,\n    ResolvedStringProperty,\n    StorageConfig,\n    UploadedFileContext\n} from \"../../types\";\nimport { randomString } from \"./strings\";\n\nexport async function resolveFilenameString<M extends object>(\n    input: string | ((context: UploadedFileContext) => Promise<string> | string),\n    storage: StorageConfig,\n    values: EntityValues<M>,\n    entityId: string,\n    path: string,\n    property: ResolvedStringProperty | ResolvedArrayProperty<string[]>,\n    file: File,\n    propertyKey: string): Promise<string> {\n    let result;\n    if (typeof input === \"function\") {\n        result = await input({\n            path,\n            entityId,\n            values,\n            property,\n            file,\n            storage,\n            propertyKey\n        });\n        if (!result)\n            console.warn(\"Storage callback returned empty result. Using default name value\")\n    } else {\n        result = replacePlaceholders(file, input, entityId, propertyKey, path);\n    }\n\n    if (!result)\n        result = randomString() + \"_\" + file.name;\n\n    return result;\n}\n\nexport function resolveStoragePathString<M extends object>(\n    input: string | ((context: UploadedFileContext) => string),\n    storage: StorageConfig,\n    values: EntityValues<M>,\n    entityId: string,\n    path: string,\n    property: ResolvedStringProperty | ResolvedArrayProperty<string[]>,\n    file: File,\n    propertyKey: string): string {\n    let result;\n    if (typeof input === \"function\") {\n        result = input({\n            path,\n            entityId,\n            values,\n            property,\n            file,\n            storage,\n            propertyKey\n        });\n        if (!result)\n            console.warn(\"Storage callback returned empty result. Using default name value\")\n    } else {\n        result = replacePlaceholders(file, input, entityId, propertyKey, path);\n    }\n\n    if (!result)\n        result = randomString() + \"_\" + file.name;\n\n    return result;\n}\n\nfunction replacePlaceholders(file: File, input: string, entityId: string, propertyKey: string, path: string) {\n    const ext = file.name.split(\".\").pop();\n    let result = input.replace(\"{entityId}\", entityId)\n        .replace(\"{propertyKey}\", propertyKey)\n        .replace(\"{rand}\", randomString())\n        .replace(\"{file}\", file.name)\n        .replace(\"{file.type}\", file.type)\n        .replace(\"{path}\", path);\n    if (ext) {\n        result = result.replace(\"{file.ext}\", ext);\n        const name = file.name.replace(`.${ext}`, \"\");\n        result = result.replace(\"{file.name}\", name)\n    }\n\n    if (!result)\n        result = randomString() + \"_\" + file.name;\n\n    return result;\n}\n","import Resizer from \"react-image-file-resizer\";\nimport equal from \"react-fast-compare\";\n\nimport {\n    EntityValues,\n    ImageCompression,\n    Property,\n    ResolvedArrayProperty,\n    ResolvedStringProperty,\n    StorageConfig,\n    StorageSource,\n    StringProperty\n} from \"../../types\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { PreviewSize } from \"../../preview\";\nimport { randomString } from \"./strings\";\nimport { resolveFilenameString, resolveStoragePathString } from \"./storage\";\n\n/**\n * Internal representation of an item in the storage\n * It can have two states, having a storagePathOrDownloadUrl set,\n * which means the file has been uploaded, and it is rendered as a preview\n * Or have a pending file being uploaded.\n */\nexport interface StorageFieldItem {\n    id: number; // generated on the fly for internal use only\n    storagePathOrDownloadUrl?: string;\n    file?: File;\n    fileName?: string;\n    metadata?: any,\n    size: PreviewSize\n}\n\nexport function useStorageUploadController<M extends object>({\n                                                                 entityId,\n                                                                 entityValues,\n                                                                 path,\n                                                                 value,\n                                                                 property,\n                                                                 propertyKey,\n                                                                 storageSource,\n                                                                 disabled,\n                                                                 onChange\n                                                             }:\n                                                                 {\n                                                                     entityId: string,\n                                                                     entityValues: EntityValues<M>,\n                                                                     value: string | string[] | null;\n                                                                     path: string,\n                                                                     propertyKey: string,\n                                                                     property: ResolvedStringProperty | ResolvedArrayProperty<string[]>,\n                                                                     storageSource: StorageSource,\n                                                                     disabled: boolean,\n                                                                     onChange: (value: string | string[] | null) => void\n                                                                 }) {\n\n    const storage: StorageConfig | undefined = property.dataType === \"string\"\n        ? property.storage\n        : property.dataType === \"array\" &&\n        (property.of as Property).dataType === \"string\"\n            ? (property.of as StringProperty).storage\n            : undefined;\n\n    const multipleFilesSupported = property.dataType === \"array\";\n\n    if (!storage)\n        throw Error(\"Storage meta must be specified\");\n\n    const metadata: Record<string, any> | undefined = storage?.metadata;\n    const size = multipleFilesSupported ? \"small\" : \"regular\";\n\n    const compression: ImageCompression | undefined = storage?.imageCompression;\n\n    const internalInitialValue: StorageFieldItem[] =\n        (multipleFilesSupported\n            ? (value ?? []) as string[]\n            : value ? [value as string] : []).map(entry => (\n            {\n                id: getRandomId(),\n                storagePathOrDownloadUrl: entry,\n                metadata,\n                size\n            }\n        ));\n\n    const [initialValue, setInitialValue] = useState<string | string[] | null>(value);\n    const [internalValue, setInternalValue] = useState<StorageFieldItem[]>(internalInitialValue);\n\n    useEffect(() => {\n        if (!equal(initialValue, value)) {\n            setInitialValue(value);\n            setInternalValue(internalInitialValue);\n        }\n    }, [internalInitialValue, value, initialValue]);\n\n    const fileNameBuilder = useCallback(async (file: File) => {\n        if (storage.fileName) {\n            const fileName = await resolveFilenameString(storage.fileName, storage, entityValues, entityId, path, property, file, propertyKey);\n            if (!fileName || fileName.length === 0) {\n                throw Error(\"You need to return a valid filename\");\n            }\n            return fileName;\n        }\n        return randomString() + \"_\" + file.name;\n    }, [entityId, entityValues, path, property, propertyKey, storage]);\n\n    const storagePathBuilder = useCallback((file: File) => {\n        return resolveStoragePathString(storage.storagePath, storage, entityValues, entityId, path, property, file, propertyKey) ?? \"/\";\n    }, [entityId, entityValues, path, property, propertyKey, storage]);\n\n    const onFileUploadComplete = useCallback(async (uploadedPath: string,\n                                                    entry: StorageFieldItem,\n                                                    metadata?: any) => {\n\n        console.debug(\"onFileUploadComplete\", uploadedPath, entry);\n\n        let uploadPathOrDownloadUrl = uploadedPath;\n        if (storage.storeUrl) {\n            uploadPathOrDownloadUrl = (await storageSource.getDownloadURL(uploadedPath)).url;\n        }\n        if (storage.postProcess) {\n            uploadPathOrDownloadUrl = await storage.postProcess(uploadPathOrDownloadUrl);\n        }\n\n        let newValue: StorageFieldItem[];\n\n        entry.storagePathOrDownloadUrl = uploadPathOrDownloadUrl;\n        entry.metadata = metadata;\n        newValue = [...internalValue];\n\n        newValue = removeDuplicates(newValue);\n        setInternalValue(newValue);\n\n        const fieldValue = newValue\n            .filter(e => !!e.storagePathOrDownloadUrl)\n            .map(e => e.storagePathOrDownloadUrl as string);\n\n        if (multipleFilesSupported) {\n            onChange(fieldValue);\n        } else {\n            onChange(fieldValue ? fieldValue[0] : null);\n        }\n    }, [internalValue, multipleFilesSupported, onChange, storage, storageSource]);\n\n    const onFilesAdded = useCallback(async (acceptedFiles: File[]) => {\n\n        if (!acceptedFiles.length || disabled)\n            return;\n\n        let newInternalValue: StorageFieldItem[];\n        if (multipleFilesSupported) {\n            newInternalValue = [...internalValue,\n                ...(await Promise.all(acceptedFiles.map(async file => {\n                    if (compression && compressionFormat(file)) {\n                        file = await resizeAndCompressImage(file, compression)\n                    }\n\n                    return {\n                        id: getRandomId(),\n                        file,\n                        fileName: await fileNameBuilder(file),\n                        metadata,\n                        size\n                    } as StorageFieldItem;\n                })))];\n        } else {\n            let file = acceptedFiles[0]\n            if (compression && compressionFormat(file)) {\n                file = await resizeAndCompressImage(file, compression)\n            }\n\n            newInternalValue = [{\n                id: getRandomId(),\n                file,\n                fileName: await fileNameBuilder(file),\n                metadata,\n                size\n            }];\n        }\n\n        // Remove either storage path or file duplicates\n        newInternalValue = removeDuplicates(newInternalValue);\n        setInternalValue(newInternalValue);\n    }, [disabled, fileNameBuilder, internalValue, metadata, multipleFilesSupported, size]);\n\n    return {\n        internalValue,\n        setInternalValue,\n        storage,\n        fileNameBuilder,\n        storagePathBuilder,\n        onFileUploadComplete,\n        onFilesAdded,\n        multipleFilesSupported\n    }\n}\n\nfunction removeDuplicates(items: StorageFieldItem[]) {\n    return items.filter(\n        (item, i) => {\n            return ((items.map((v) => v.storagePathOrDownloadUrl).indexOf(item.storagePathOrDownloadUrl) === i) || !item.storagePathOrDownloadUrl) &&\n                ((items.map((v) => v.file).indexOf(item.file) === i) || !item.file);\n        }\n    );\n}\n\nfunction getRandomId() {\n    return Math.floor(Math.random() * Math.floor(Number.MAX_SAFE_INTEGER));\n}\n\nconst supportedTypes: Record<string, string> = {\n    \"image/jpeg\": \"JPEG\",\n    \"image/png\": \"PNG\",\n    \"image/webp\": \"WEBP\"\n}\nconst compressionFormat = (file: File) => supportedTypes[file.type] ? supportedTypes[file.type] : null;\n\nconst defaultQuality = 100;\nconst resizeAndCompressImage = (file: File, compression: ImageCompression) => new Promise<File>((resolve) => {\n\n    const inputQuality = compression.quality === undefined ? defaultQuality : compression.quality;\n    const quality = inputQuality >= 0 ? inputQuality <= 100 ? inputQuality : 100 : 100;\n\n    const format = compressionFormat(file);\n    if (!format) {\n        throw Error(\"resizeAndCompressImage: Unsupported image format\");\n    }\n    Resizer.imageFileResizer(\n        file,\n        compression.maxWidth || Number.MAX_VALUE,\n        compression.maxHeight || Number.MAX_VALUE,\n        format,\n        quality,\n        0,\n        (file: string | Blob | File | ProgressEvent<FileReader>) => resolve(file as File),\n        \"file\"\n    )\n});\n","import React, { useCallback } from \"react\";\nimport { useSnackbarController, useStorageSource } from \"../../hooks\";\nimport { StorageFieldItem } from \"../../core/util/useStorageUploadController\";\nimport { Box, Paper, Skeleton } from \"@mui/material\";\nimport { ErrorView } from \"../../core\";\n\nexport interface StorageUploadItemProps {\n    storagePath: string;\n    metadata?: any,\n    entry: StorageFieldItem,\n    onFileUploadComplete: (value: string,\n                           entry: StorageFieldItem,\n                           metadata?: any) => Promise<void>;\n    imageSize: number;\n    simple: boolean;\n}\n\nexport function StorageUploadProgress({\n                                          storagePath,\n                                          entry,\n                                          metadata,\n                                          onFileUploadComplete,\n                                          imageSize,\n                                          simple\n                                      }: StorageUploadItemProps) {\n\n    const storage = useStorageSource();\n\n    const snackbarController = useSnackbarController();\n\n    const [error, setError] = React.useState<Error | undefined>();\n    const [loading, setLoading] = React.useState<boolean>(false);\n    const mounted = React.useRef(false);\n    const uploading = React.useRef(false);\n\n    const upload = useCallback((file: File, fileName?: string) => {\n\n        if (uploading.current) return;\n        uploading.current = true;\n        setError(undefined);\n        setLoading(true);\n\n        storage.uploadFile({\n            file,\n            fileName,\n            path: storagePath,\n            metadata\n        })\n            .then(async ({ path }) => {\n                console.debug(\"Upload successful\");\n                await onFileUploadComplete(path, entry, metadata);\n                if (mounted.current)\n                    setLoading(false);\n            })\n            .catch((e) => {\n                console.error(\"Upload error\", e);\n                if (mounted.current) {\n                    setError(e);\n                    setLoading(false);\n                    snackbarController.open({\n                        type: \"error\",\n                        message: \"Error uploading file: \" + e.message\n                    });\n                }\n            })\n            .finally(() => {\n                uploading.current = false;\n            });\n    }, [entry, metadata, onFileUploadComplete, storage, storagePath]);\n\n    React.useEffect(() => {\n        mounted.current = true;\n        if (entry.file)\n            upload(entry.file, entry.fileName);\n        return () => {\n            mounted.current = false;\n        };\n    }, [entry.file, entry.fileName, upload]);\n\n    if (simple) {\n        return <Box m={1} sx={{\n            width: imageSize,\n            height: imageSize\n        }}>\n\n            {loading && <Skeleton variant=\"rectangular\" sx={{\n                width: imageSize,\n                height: imageSize\n            }}/>}\n\n        </Box>\n    }\n    return (\n\n        <Box m={1}>\n            <Paper elevation={0}\n                   sx={{\n                       padding: 1,\n                       boxSizing: \"border-box\",\n                       minWidth: imageSize,\n                       minHeight: imageSize\n                   }}\n                   variant={\"outlined\"}>\n\n                {loading && <Skeleton variant=\"rectangular\" sx={{\n                    width: \"100%\",\n                    height: \"100%\"\n                }}/>}\n\n                {error && <ErrorView title={\"Error uploading file\"}\n                                     error={error}/>}\n\n            </Paper>\n        </Box>\n\n    );\n\n}\n","import React from \"react\";\n\nimport { Box, IconButton, Paper, Tooltip } from \"@mui/material\";\nimport { Entity, ResolvedStringProperty } from \"../../types\";\nimport RemoveIcon from \"@mui/icons-material/Remove\";\nimport { PreviewSize, PropertyPreview } from \"../../preview\";\n\nimport { ErrorBoundary } from \"../../core\";\n\ninterface StorageItemPreviewProps {\n    name: string;\n    property: ResolvedStringProperty;\n    value: string,\n    entity: Entity<any>,\n    onRemove: (value: string) => void;\n    size: PreviewSize;\n    disabled: boolean;\n}\n\nexport function StorageItemPreview({\n                                       name,\n                                       property,\n                                       value,\n                                       entity,\n                                       onRemove,\n                                       disabled,\n                                       size\n                                   }: StorageItemPreviewProps) {\n\n    return (\n        <Box m={1} position={\"relative\"}>\n\n            <Paper\n                elevation={0}\n                sx={{\n                    padding: 1,\n                    boxSizing: \"border-box\",\n                    minWidth: size === \"regular\" ? 220 : 118,\n                    minHeight: size === \"regular\" ? 220 : 118\n                }}\n                variant={\"outlined\"}>\n\n                {!disabled &&\n                    <Box\n                        sx={(theme) => ({\n                            position: \"absolute\",\n                            borderRadius: \"9999px\",\n                            top: -8,\n                            right: -8,\n                            zIndex: 1,\n                            backgroundColor: theme.palette.background.paper\n                        })}>\n\n                        <Tooltip\n                            title=\"Remove\">\n                            <IconButton\n                                size={\"small\"}\n                                onClick={(event) => {\n                                    event.stopPropagation();\n                                    onRemove(value);\n                                }}>\n                                <RemoveIcon fontSize={\"small\"}/>\n                            </IconButton>\n                        </Tooltip>\n                    </Box>\n                }\n\n                {value &&\n                    <ErrorBoundary>\n                        <PropertyPreview propertyKey={name}\n                                         value={value}\n                                         property={property}\n                                         entity={entity}\n                                         size={size}/>\n                    </ErrorBoundary>\n                }\n\n            </Paper>\n\n        </Box>\n    );\n\n}\n","import { Theme } from \"@mui/material\";\n\nexport const fieldBackground = (theme: Theme) =>\n    theme.palette.mode === \"light\" ? \"rgb(240 240 240)\" : \"rgb(39 39 41)\";\nexport const fieldBackgroundHover = (theme: Theme) =>\n    theme.palette.mode === \"light\" ? \"rgb(232 232 232)\" : \"rgb(49,49,50)\";\nexport const fieldBackgroundDisabled = (theme: Theme) =>\n    theme.palette.mode === \"light\" ? \"rgb(224 224 224)\" : \"rgb(47 47 49)\";\n","import React, { useCallback } from \"react\";\n\nimport { styled, Theme } from \"@mui/material/styles\";\n\nimport { Box, FormControl, FormHelperText, Typography } from \"@mui/material\";\nimport {\n    ArrayProperty,\n    Entity,\n    FieldProps,\n    ResolvedArrayProperty,\n    ResolvedStringProperty,\n    StorageConfig\n} from \"../../types\";\nimport { useDropzone } from \"react-dropzone\";\nimport { PreviewSize } from \"../../preview\";\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\n\nimport { getIconForProperty, isReadOnly } from \"../../core\";\nimport clsx from \"clsx\";\nimport {\n    useClearRestoreValue,\n    useSnackbarController,\n    useStorageSource\n} from \"../../hooks\";\nimport { DragDropContext, Draggable, Droppable } from \"@hello-pangea/dnd\";\nimport {\n    StorageFieldItem,\n    useStorageUploadController\n} from \"../../core/util/useStorageUploadController\";\nimport { StorageUploadProgress } from \"../components/StorageUploadProgress\";\nimport { StorageItemPreview } from \"../components/StorageItemPreview\";\nimport { fieldBackground, fieldBackgroundHover } from \"./utils\";\n\nconst PREFIX = \"StorageUploadField\";\n\nconst classes = {\n    dropZone: `${PREFIX}-dropZone`,\n    disabled: `${PREFIX}-disabled`,\n    nonActiveDrop: `${PREFIX}-nonActiveDrop`,\n    activeDrop: `${PREFIX}-activeDrop`,\n    acceptDrop: `${PREFIX}-acceptDrop`,\n    rejectDrop: `${PREFIX}-rejectDrop`\n};\n\nconst StyledBox = styled(Box)(({ theme }:\n                                   {\n                                       theme: Theme\n                                   }\n) => ({\n    [`&.${classes.dropZone}`]: {\n        position: \"relative\",\n        paddingTop: \"2px\",\n        border: \"2px solid transparent\",\n        minHeight: \"254px\",\n        outline: 0,\n        borderRadius: `${theme.shape.borderRadius}px`,\n        backgroundColor: fieldBackground(theme),\n        boxSizing: \"border-box\",\n        transition: \"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms\",\n        \"&:focus\": {\n            border: `2px solid ${theme.palette.primary.main}`\n        }\n    },\n\n    [`&.${classes.disabled}`]: {\n        backgroundColor: \"rgba(0, 0, 0, 0.12)\",\n        color: theme.palette.mode === \"light\" ? \"rgba(0, 0, 0, 0.38)\" : \"rgba(255, 255, 255, 0.38)\",\n        border: `1px dotted ${theme.palette.grey[400]}`\n    },\n\n    [`&.${classes.nonActiveDrop}`]: {\n        \"&:hover\": {\n            backgroundColor: fieldBackgroundHover(theme)\n        }\n    },\n\n    [`&.${classes.activeDrop}`]: {\n        paddingTop: \"0px\",\n        boxSizing: \"border-box\",\n        border: \"2px solid\"\n    },\n\n    [`&.${classes.acceptDrop}`]: {\n        transition: \"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms\",\n        background: \"repeating-linear-gradient( 45deg, rgba(0, 0, 0, 0.09), rgba(0, 0, 0, 0.09) 10px, rgba(0, 0, 0, 0.12) 10px, rgba(0, 0, 0, 0.12) 20px) !important\",\n        border: \"2px solid\",\n        borderColor: theme.palette.success.light\n    },\n\n    [`&.${classes.rejectDrop}`]: {\n        border: \"2px solid\",\n        borderColor: theme.palette.error.light\n    }\n\n}));\n\ntype StorageUploadFieldProps = FieldProps<string | string[]>;\n\n/**\n * Field that allows to upload files to Google Cloud Storage.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function StorageUploadFieldBinding({\n                                              propertyKey,\n                                              value,\n                                              setValue,\n                                              error,\n                                              showError,\n                                              autoFocus,\n                                              tableMode,\n                                              property,\n                                              includeDescription,\n                                              context,\n                                              isSubmitting\n                                          }: StorageUploadFieldProps) {\n\n    if (!context.entityId)\n        throw new Error(\"StorageUploadFieldBinding: Entity id is null\");\n\n    const storageSource = useStorageSource();\n    const disabled = isReadOnly(property) || !!property.disabled || isSubmitting;\n\n    const {\n        internalValue,\n        setInternalValue,\n        onFilesAdded,\n        storage,\n        onFileUploadComplete,\n        storagePathBuilder,\n        multipleFilesSupported\n    } = useStorageUploadController({\n        entityValues: context.values,\n        entityId: context.entityId,\n        path: context.path,\n        property,\n        propertyKey,\n        value,\n        storageSource,\n        disabled,\n        onChange: setValue\n    });\n\n    useClearRestoreValue<string | string[]>({\n        property,\n        value,\n        setValue\n    });\n\n    const entity: Entity<any> = {\n        id: context.entityId,\n        values: context.values,\n        path: context.path\n    };\n\n    return (\n\n        <FormControl fullWidth\n                     required={property.validation?.required}\n                     error={showError}>\n\n            {!tableMode &&\n                <FormHelperText filled>\n                    <LabelWithIcon icon={getIconForProperty(property)}\n                                   title={property.name}/>\n                </FormHelperText>}\n\n            <StorageUpload\n                value={internalValue}\n                name={propertyKey}\n                disabled={disabled}\n                autoFocus={autoFocus}\n                property={property}\n                onChange={setValue}\n                setInternalValue={setInternalValue}\n                onFilesAdded={onFilesAdded}\n                entity={entity}\n                onFileUploadComplete={onFileUploadComplete}\n                storagePathBuilder={storagePathBuilder}\n                storage={storage}\n                multipleFilesSupported={multipleFilesSupported}/>\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n            {showError && <FormHelperText error={true}>{error}</FormHelperText>}\n\n        </FormControl>\n    );\n}\n\nfunction FileDropComponent({\n                               storage,\n                               disabled,\n                               isDraggingOver,\n                               onFilesAdded,\n                               multipleFilesSupported,\n                               droppableProvided,\n                               autoFocus,\n                               internalValue,\n                               property,\n                               entity,\n                               onClear,\n                               metadata,\n                               storagePathBuilder,\n                               onFileUploadComplete,\n                               size,\n                               name,\n                               helpText\n                           }: {\n    storage: StorageConfig,\n    disabled: boolean,\n    isDraggingOver: boolean,\n    droppableProvided: any,\n    onFilesAdded: (acceptedFiles: File[]) => void,\n    multipleFilesSupported: boolean,\n    autoFocus: boolean,\n    internalValue: StorageFieldItem[],\n    property: ResolvedStringProperty,\n    onClear: (clearedStoragePathOrDownloadUrl: string) => void,\n    metadata: any,\n    entity: Entity<any>;\n    storagePathBuilder: (file: File) => string,\n    onFileUploadComplete: (uploadedPath: string, entry: StorageFieldItem, fileMetadata?: any) => Promise<void>,\n    size: PreviewSize,\n    name: string,\n    helpText: string\n}) {\n\n    const snackbarContext = useSnackbarController();\n\n    const {\n        getRootProps,\n        getInputProps,\n        isDragActive,\n        isDragAccept,\n        isDragReject\n    } = useDropzone({\n            accept: storage.acceptedFiles ? storage.acceptedFiles.map(e => ({ [e]: [] })).reduce((a, b) => ({ ...a, ...b }), {}) : undefined,\n            disabled: disabled || isDraggingOver,\n            noDragEventsBubbling: true,\n            maxSize: storage.maxSize,\n            onDrop: onFilesAdded,\n            onDropRejected: (fileRejections, event) => {\n                for (const fileRejection of fileRejections) {\n                    for (const error of fileRejection.errors) {\n                        snackbarContext.open({\n                            type: \"error\",\n                            message: `Error uploading file: File is larger than ${storage.maxSize} bytes`\n                        });\n                    }\n                }\n            }\n        }\n    );\n\n    return (\n        <StyledBox\n            {...getRootProps()}\n            className={clsx(classes.dropZone, {\n                [classes.nonActiveDrop]: !isDragActive,\n                [classes.activeDrop]: isDragActive,\n                [classes.rejectDrop]: isDragReject,\n                [classes.acceptDrop]: isDragAccept,\n                [classes.disabled]: disabled\n            })}\n            sx={{\n                display: multipleFilesSupported && internalValue.length ? undefined : \"flex\",\n                alignItems: \"center\"\n            }}\n        >\n            <Box\n                {...droppableProvided.droppableProps}\n                ref={droppableProvided.innerRef}\n                sx={{\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    overflow: multipleFilesSupported && internalValue.length ? \"auto\" : undefined,\n                    minHeight: multipleFilesSupported && internalValue.length ? 180 : 250,\n                    p: 1,\n                    \"&::-webkit-scrollbar\": {\n                        display: \"none\"\n                    }\n                }}\n            >\n\n                <input\n                    autoFocus={autoFocus}\n                    {...getInputProps()} />\n\n                {internalValue.map((entry, index) => {\n                    let child: any;\n                    if (entry.storagePathOrDownloadUrl) {\n                        child = (\n                            <StorageItemPreview\n                                name={`storage_preview_${entry.storagePathOrDownloadUrl}`}\n                                property={property}\n                                disabled={disabled}\n                                entity={entity}\n                                value={entry.storagePathOrDownloadUrl}\n                                onRemove={onClear}\n                                size={entry.size}/>\n                        );\n                    } else if (entry.file) {\n                        child = (\n                            <StorageUploadProgress\n                                entry={entry}\n                                metadata={metadata}\n                                storagePath={storagePathBuilder(entry.file)}\n                                onFileUploadComplete={onFileUploadComplete}\n                                imageSize={size === \"regular\" ? 220 : 118}\n                                simple={false}\n                            />\n                        );\n                    }\n\n                    return (\n                        <Draggable\n                            key={`array_field_${name}_${entry.id}`}\n                            draggableId={`array_field_${name}_${entry.id}`}\n                            index={index}>\n                            {(provided, snapshot) => (\n                                <Box\n                                    ref={provided.innerRef}\n                                    {...provided.draggableProps}\n                                    {...provided.dragHandleProps}\n                                    style={\n                                        provided.draggableProps.style\n                                    }\n                                    sx={theme => ({\n                                        borderRadius: `${theme.shape.borderRadius}px`\n                                    })}\n                                >\n                                    {child}\n                                </Box>\n                            )}\n                        </Draggable>\n                    );\n                })\n                }\n\n                {droppableProvided.placeholder}\n\n            </Box>\n\n            <Box\n                sx={{\n                    flexGrow: 1,\n                    minHeight: 38,\n                    boxSizing: \"border-box\",\n                    m: 2\n                }}>\n                <Typography align={\"center\"}\n                            variant={\"label\"}>\n                    {helpText}\n                </Typography>\n            </Box>\n\n        </StyledBox>\n    );\n}\n\nexport interface StorageUploadProps {\n    value: StorageFieldItem[];\n    setInternalValue: (v: StorageFieldItem[]) => void;\n    name: string;\n    property: ResolvedStringProperty | ResolvedArrayProperty<string[]>;\n    onChange: (value: string | string[] | null) => void;\n    multipleFilesSupported: boolean;\n    autoFocus: boolean;\n    disabled: boolean;\n    entity: Entity<any>;\n    storage: StorageConfig;\n    onFilesAdded: (acceptedFiles: File[]) => void;\n    storagePathBuilder: (file: File) => string;\n    onFileUploadComplete: (uploadedPath: string, entry: StorageFieldItem, fileMetadata?: any) => Promise<void>;\n}\n\nexport function StorageUpload({\n                                  property,\n                                  name,\n                                  value,\n                                  setInternalValue,\n                                  onChange,\n                                  multipleFilesSupported,\n                                  onFileUploadComplete,\n                                  disabled,\n                                  onFilesAdded,\n                                  autoFocus,\n                                  storage,\n                                  entity,\n                                  storagePathBuilder\n                              }: StorageUploadProps) {\n\n    if (multipleFilesSupported) {\n        const arrayProperty = property as ResolvedArrayProperty<string[]>;\n        if (arrayProperty.of) {\n            if (Array.isArray(arrayProperty.of)) {\n                throw Error(\"Storage field using array must be of data type string\");\n            }\n            if (arrayProperty.of.dataType !== \"string\") {\n                throw Error(\"Storage field using array must be of data type string\");\n            }\n        } else {\n            throw Error(\"Storage field using array must be of data type string\");\n        }\n    }\n\n    const metadata: Record<string, unknown> | undefined = storage?.metadata;\n    const size = multipleFilesSupported ? \"small\" : \"regular\";\n\n    const moveItem = useCallback((fromIndex: number, toIndex: number) => {\n        if (!multipleFilesSupported) return;\n        const newValue = [...value];\n        const item = newValue[fromIndex];\n        newValue.splice(fromIndex, 1);\n        newValue.splice(toIndex, 0, item);\n        setInternalValue(newValue);\n        const fieldValue = newValue\n            .filter(e => !!e.storagePathOrDownloadUrl)\n            .map(e => e.storagePathOrDownloadUrl as string);\n        onChange(fieldValue);\n    }, [multipleFilesSupported, onChange, setInternalValue, value]);\n\n    const onDragEnd = useCallback((result: any) => {\n        // dropped outside the list\n        if (!result.destination) {\n            return;\n        }\n\n        moveItem(result.source.index, result.destination.index);\n\n    }, [moveItem])\n\n    const onClear = useCallback((clearedStoragePathOrDownloadUrl: string) => {\n        if (multipleFilesSupported) {\n            const newValue: StorageFieldItem[] = value.filter(v => v.storagePathOrDownloadUrl !== clearedStoragePathOrDownloadUrl);\n            onChange(newValue.filter(v => !!v.storagePathOrDownloadUrl).map(v => v.storagePathOrDownloadUrl as string));\n            setInternalValue(newValue);\n        } else {\n            onChange(null);\n            setInternalValue([]);\n        }\n    }, [value, multipleFilesSupported, onChange]);\n\n    const helpText = multipleFilesSupported\n        ? \"Drag 'n' drop some files here, or click to select files\"\n        : \"Drag 'n' drop a file here, or click to select one\";\n\n    const renderProperty: ResolvedStringProperty = multipleFilesSupported\n        ? (property as ArrayProperty<string[]>).of as ResolvedStringProperty\n        : property as ResolvedStringProperty;\n\n    return (\n        <DragDropContext onDragEnd={onDragEnd}>\n            <Droppable\n                droppableId={`droppable_${name}`}\n                direction=\"horizontal\"\n                renderClone={(provided, snapshot, rubric) => {\n                    const entry = value[rubric.source.index];\n                    return (\n                        <Box\n                            ref={provided.innerRef}\n                            {...provided.draggableProps}\n                            {...provided.dragHandleProps}\n                            style={\n                                provided.draggableProps.style\n                            }\n                            sx={theme => ({\n                                borderRadius: theme.shape.borderRadius\n                            })}\n                        >\n                            <StorageItemPreview\n                                name={`storage_preview_${entry.storagePathOrDownloadUrl}`}\n                                property={renderProperty}\n                                disabled={true}\n                                entity={entity}\n                                value={entry.storagePathOrDownloadUrl as string}\n                                onRemove={onClear}\n                                size={entry.size}/>\n                        </Box>\n                    );\n                }}\n            >\n                {(provided, snapshot) => {\n                    return <FileDropComponent storage={storage}\n                                              disabled={disabled}\n                                              isDraggingOver={snapshot.isDraggingOver}\n                                              droppableProvided={provided}\n                                              onFilesAdded={onFilesAdded}\n                                              multipleFilesSupported={multipleFilesSupported}\n                                              autoFocus={autoFocus}\n                                              internalValue={value}\n                                              property={renderProperty}\n                                              entity={entity}\n                                              onClear={onClear}\n                                              metadata={metadata}\n                                              storagePathBuilder={storagePathBuilder}\n                                              onFileUploadComplete={onFileUploadComplete}\n                                              size={size}\n                                              name={name}\n                                              helpText={helpText}/>\n                }}\n            </Droppable>\n        </DragDropContext>\n    );\n\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport {\n    unstable_debounce as debounce,\n    unstable_ownerWindow as ownerWindow,\n    unstable_useEnhancedEffect as useEnhancedEffect,\n    unstable_useForkRef as useForkRef\n} from \"@mui/utils\";\n\ntype State = {\n    outerHeightStyle: number;\n    overflow?: boolean | undefined;\n};\n\nfunction getStyleValue(value: string) {\n    return parseInt(value, 10) || 0;\n}\n\nconst styles: {\n    shadow: React.CSSProperties;\n} = {\n    shadow: {\n        // Visibility needed to hide the extra text area on iPads\n        visibility: \"hidden\",\n        // Remove from the content flow\n        position: \"absolute\",\n        // Ignore the scrollbar width\n        overflow: \"hidden\",\n        height: 0,\n        top: 0,\n        left: 0,\n        // Create a new layer, increase the isolation of the computed values\n        transform: \"translateZ(0)\"\n    }\n};\n\nfunction isEmpty(obj: State) {\n    return (\n        obj === undefined ||\n        obj === null ||\n        Object.keys(obj).length === 0 ||\n        (obj.outerHeightStyle === 0 && !obj.overflow)\n    );\n}\n\nexport const TextareaAutosize = React.forwardRef(function TextareaAutosize(\n    props: TextareaAutosizeProps,\n    ref: React.ForwardedRef<Element>\n) {\n    const {\n        onChange,\n        onScroll,\n        onResize,\n        maxRows,\n        minRows = 1,\n        style,\n        value,\n        onFocus,\n        onBlur,\n        sizeRef,\n        ...other\n    } = props;\n\n    const { current: isControlled } = React.useRef(value != null);\n    const inputRef = React.useRef<HTMLInputElement>(null);\n    const handleRef = useForkRef(ref, inputRef);\n    const shadowRef = React.useRef<HTMLTextAreaElement>(null);\n    const renders = React.useRef(0);\n    const [state, setState] = React.useState<State>({\n        outerHeightStyle: 0\n    });\n\n    const getUpdatedState = React.useCallback(() => {\n\n        const input = inputRef.current!;\n\n        const containerWindow = ownerWindow(input);\n        const computedStyle = containerWindow.getComputedStyle(input);\n\n        // If input's width is shrunk and it's not visible, don't sync height.\n        if (computedStyle.width === \"0px\") {\n            return {\n                outerHeightStyle: 0\n            };\n        }\n\n        const sizeReferenceElement = sizeRef?.current ?? shadowRef.current!;\n        const inputShallow = shadowRef.current!;\n\n        sizeReferenceElement.style.width = computedStyle.width;\n        inputShallow.value = input.value || props.placeholder || \"x\";\n        if (inputShallow.value.slice(-1) === \"\\n\") {\n            // Certain fonts which overflow the line height will cause the textarea\n            // to report a different scrollHeight depending on whether the last line\n            // is empty. Make it non-empty to avoid this issue.\n            inputShallow.value += \" \";\n        }\n\n        const boxSizing = computedStyle.boxSizing;\n        const padding =\n            getStyleValue(computedStyle.paddingBottom) + getStyleValue(computedStyle.paddingTop);\n        const border =\n            getStyleValue(computedStyle.borderBottomWidth) + getStyleValue(computedStyle.borderTopWidth);\n\n        // The height of the inner content\n        const innerHeight = sizeReferenceElement.scrollHeight;\n\n        // Measure height of a textarea with a single row\n        inputShallow.value = \"x\";\n        const singleRowHeight = sizeReferenceElement.scrollHeight;\n\n        // The height of the outer content\n        let outerHeight = innerHeight;\n\n        if (minRows) {\n            outerHeight = Math.max(Number(minRows) * singleRowHeight, outerHeight);\n        }\n        if (maxRows) {\n            outerHeight = Math.min(Number(maxRows) * singleRowHeight, outerHeight);\n        }\n        outerHeight = Math.max(outerHeight, singleRowHeight);\n\n        // Take the box sizing into account for applying this value as a style.\n        const outerHeightStyle = outerHeight + (boxSizing === \"border-box\" ? padding + border : 0);\n        const overflow = Math.abs(outerHeight - innerHeight) <= 1;\n\n        return { outerHeightStyle, overflow };\n    }, [maxRows, minRows, props.placeholder]);\n\n    const updateState = (prevState: State, newState: State) => {\n        const { outerHeightStyle, overflow } = newState;\n        // Need a large enough difference to update the height.\n        // This prevents infinite rendering loop.\n        if (\n            renders.current < 20 &&\n            ((outerHeightStyle > 0 &&\n                    Math.abs((prevState.outerHeightStyle || 0) - outerHeightStyle) > 1) ||\n                prevState.overflow !== overflow)\n        ) {\n            renders.current += 1;\n            return {\n                overflow,\n                outerHeightStyle\n            };\n        }\n        if (process.env.NODE_ENV !== \"production\") {\n            if (renders.current === 20) {\n                console.error(\n                    [\n                        \"MUI: Too many re-renders. The layout is unstable.\",\n                        \"TextareaAutosize limits the number of renders to prevent an infinite loop.\"\n                    ].join(\"\\n\")\n                );\n            }\n        }\n        return prevState;\n    };\n\n    const syncHeight = React.useCallback(() => {\n        const newState = getUpdatedState();\n\n        if (isEmpty(newState)) {\n            return;\n        }\n        if (onResize) {\n            onResize(newState);\n        }\n\n        setState((prevState) => {\n            return updateState(prevState, newState);\n        });\n    }, [getUpdatedState, onResize]);\n\n    const syncHeightWithFlushSync = () => {\n        const newState = getUpdatedState();\n\n        if (isEmpty(newState)) {\n            return;\n        }\n\n        // In React 18, state updates in a ResizeObserver's callback are happening after the paint which causes flickering\n        // when doing some visual updates in it. Using flushSync ensures that the dom will be painted after the states updates happen\n        // Related issue - https://github.com/facebook/react/issues/24331\n        ReactDOM.flushSync(() => {\n            setState((prevState) => {\n                return updateState(prevState, newState);\n            });\n        });\n    };\n\n    React.useEffect(() => {\n        const handleResize = debounce(() => {\n            renders.current = 0;\n\n            // If the TextareaAutosize component is replaced by Suspense with a fallback, the last\n            // ResizeObserver's handler that runs because of the change in the layout is trying to\n            // access a dom node that is no longer there (as the fallback component is being shown instead).\n            // See https://github.com/mui/material-ui/issues/32640\n            if (inputRef.current) {\n                syncHeightWithFlushSync();\n            }\n        });\n        let resizeObserver: ResizeObserver;\n\n        const input = inputRef.current!;\n        const containerWindow = ownerWindow(input);\n\n        containerWindow.addEventListener(\"resize\", handleResize);\n\n        if (typeof ResizeObserver !== \"undefined\") {\n            resizeObserver = new ResizeObserver(handleResize);\n            resizeObserver.observe(input);\n        }\n\n        return () => {\n            handleResize.clear();\n            containerWindow.removeEventListener(\"resize\", handleResize);\n            if (resizeObserver) {\n                resizeObserver.disconnect();\n            }\n        };\n    });\n\n    useEnhancedEffect(() => {\n        syncHeight();\n    });\n\n    React.useEffect(() => {\n        renders.current = 0;\n    }, [value]);\n\n    const handleChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n        renders.current = 0;\n\n        if (!isControlled) {\n            syncHeight();\n        }\n\n        if (onChange) {\n            onChange(event);\n        }\n    };\n\n    return (\n        <React.Fragment>\n            <textarea\n                value={value}\n                onChange={handleChange}\n                ref={handleRef}\n                onFocus={onFocus}\n                onBlur={onBlur}\n                // Apply the rows prop to get a \"correct\" first SSR paint\n                rows={minRows as number}\n                style={{\n                    height: state.outerHeightStyle,\n                    // Need a large enough difference to allow scrolling.\n                    // This prevents infinite rendering loop.\n                    overflow: state.overflow ? \"hidden\" : undefined,\n                    ...style\n                }}\n                onScroll={onScroll}\n                {...other}\n            />\n            <textarea\n                aria-hidden\n                className={props.className}\n                readOnly\n                ref={shadowRef}\n                tabIndex={-1}\n                style={{\n                    ...styles.shadow,\n                    ...style,\n                    padding: 0\n                }}\n            />\n        </React.Fragment>\n    );\n});\n\nexport interface TextareaAutosizeProps {\n    /**\n     * @ignore\n     */\n    className?: string;\n\n    onFocus?: React.FocusEventHandler<HTMLTextAreaElement>;\n\n    onBlur?: React.FocusEventHandler<HTMLTextAreaElement>;\n\n    /**\n     * Maximum number of rows to display.\n     */\n    maxRows?: number | string;\n    /**\n     * Minimum number of rows to display.\n     * @default 1\n     */\n    minRows?: number | string;\n    /**\n     * @ignore\n     */\n    onChange?: (event: React.ChangeEvent<HTMLTextAreaElement>) => void;\n    /**\n     * @ignore\n     */\n    placeholder?: string;\n    /**\n     * @ignore\n     */\n    style?: object;\n    /**\n     * @ignore\n     */\n    value?: string[] | number | string;\n\n    sizeRef?: React.RefObject<HTMLDivElement>;\n\n    onScroll?: (event: React.UIEvent<HTMLTextAreaElement>) => void;\n\n    onResize?: (state: State) => void;\n\n    autoFocus?: boolean;\n}\n","import React from \"react\";\n\nimport { Box, InputLabel, Typography } from \"@mui/material\";\nimport { fieldBackgroundDisabled } from \"../../../form/field_bindings/utils\";\n\nexport function DisabledTextField<T extends string | number>({\n                                                                 label,\n                                                                 value\n                                                             }: {\n    label: React.ReactNode,\n    value: T\n}) {\n    return <Box sx={{\n        position: \"relative\",\n        background: fieldBackgroundDisabled,\n        borderRadius: \"4px\",\n        maxWidth: \"100%\",\n        minHeight: \"64px\",\n        color: theme => theme.palette.text.disabled\n    }}>\n        <InputLabel\n            shrink={Boolean(value)}\n            sx={{\n                position: \"absolute\",\n                left: 0,\n                top: \"4px\",\n                pointerEvents: \"none\"\n            }}\n            variant={\"filled\"}>{label}</InputLabel>\n        <Box sx={{\n            padding: \"32px 12px 8px 12px\"\n        }}>\n            <Typography variant={\"body1\"}>{value}</Typography>\n        </Box>\n    </Box>;\n}\n","import React, { useCallback, useRef } from \"react\";\nimport { styled } from \"@mui/system\";\n\nimport { Box, InputLabel } from \"@mui/material\";\nimport {\n    fieldBackground,\n    fieldBackgroundHover\n} from \"../../../form/field_bindings/utils\";\nimport { TextareaAutosize } from \"./TextareaAutosize\";\nimport { DisabledTextField } from \"./DisabledTextField\";\n\nexport type InputType = \"text\" | \"number\";\n\nexport function TextInput<T extends string | number>({\n                                                         value,\n                                                         setValue,\n                                                         label,\n                                                         inputType = \"text\",\n                                                         multiline = false,\n                                                         disabled,\n                                                         error,\n                                                         endAdornment,\n                                                         autoFocus,\n                                                         placeholder\n                                                     }: {\n    inputType?: InputType,\n    value: T,\n    setValue: (value: T | null) => void,\n    label?: React.ReactNode,\n    multiline?: boolean,\n    disabled?: boolean,\n    error?: boolean,\n    endAdornment?: React.ReactNode,\n    autoFocus?: boolean,\n    placeholder?: string\n}) {\n\n    const inputRef = useRef(null);\n    const [focused, setFocused] = React.useState(document.activeElement === inputRef.current);\n\n    const hasValue = value !== undefined && value !== null && value !== \"\";\n\n    const onChange = useCallback((event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        if (inputType === \"number\") {\n            const numberValue = event.target.value ? parseFloat(event.target.value) : undefined;\n            if (numberValue && isNaN(numberValue))\n                setValue(null);\n            else if (numberValue !== undefined && numberValue !== null)\n                setValue(numberValue as T);\n            else\n                setValue(null);\n        } else {\n            setValue(event.target.value as T);\n        }\n    }, [inputType, setValue]);\n\n    if (disabled) {\n        return <DisabledTextField label={label}\n                                  value={value}/>\n    }\n\n    const input = multiline\n        ? <StyledTextArea ref={inputRef}\n                          placeholder={placeholder}\n                          autoFocus={autoFocus}\n                          onFocus={() => setFocused(true)}\n                          onBlur={() => setFocused(false)}\n                          value={value ?? \"\"}\n                          onChange={onChange}/>\n        : <StyledInput ref={inputRef}\n                       sx={{\n                           padding: label ? \"32px 12px 8px 12px\" : \"8px 12px 8px 12px\",\n                       }}\n                       placeholder={placeholder}\n                       autoFocus={autoFocus}\n                       onFocus={() => setFocused(true)}\n                       onBlur={() => setFocused(false)}\n                       type={inputType}\n                       value={value ?? \"\"}\n                       onChange={onChange}/>;\n\n    const inner = endAdornment\n        ? <Box sx={{\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"space-between\"\n        }}>\n            {input}\n            <Box sx={{\n                mr: 2,\n                my: 1\n            }}>{endAdornment}</Box>\n        </Box>\n        : input;\n\n    return (\n        <Box\n            sx={theme => ({\n                position: \"relative\",\n                background: fieldBackground(theme),\n                borderRadius: `${theme.shape.borderRadius}px`,\n                maxWidth: \"100%\",\n                minHeight: \"64px\",\n                \"&:hover\": {\n                    backgroundColor: focused ? undefined : fieldBackgroundHover(theme)\n                }\n            })}>\n            <InputLabel\n                shrink={hasValue || focused}\n                sx={{\n                    position: \"absolute\",\n                    left: 0,\n                    top: \"4px\",\n                    pointerEvents: \"none\",\n                    color: theme => (!error ? (focused ? theme.palette.primary.main : undefined) : theme.palette.error.main)\n                }}\n                variant={\"filled\"}>{label}</InputLabel>\n\n            {inner}\n        </Box>\n    );\n}\n\nconst StyledInput = React.memo(styled(\"input\")(() => ({\n    width: \"100%\",\n    outlineWidth: 0,\n    minHeight: \"64px\",\n    fontSize: \"16px\",\n    padding: \"32px 12px 8px 12px\",\n    font: \"inherit\",\n    letterSpacing: \"inherit\",\n    color: \"currentcolor\",\n    border: \"0px\",\n    background: \"none\",\n    height: \"1.4375em\",\n    margin: \"0px\",\n    WebkitTapHighlightColor: \"transparent\",\n    display: \"block\",\n    minWidth: \"0px\",\n    animationName: \"mui-auto-fill-cancel\",\n    animationDuration: \"10ms\"\n})), (prevProps, nextProps) => prevProps.value === nextProps.value);\n\nconst StyledTextArea = styled(TextareaAutosize)({\n    width: \"100%\",\n    outlineWidth: 0,\n    resize: \"none\",\n    minHeight: \"64px\",\n    fontSize: \"16px\",\n    padding: \"32px 12px 8px 12px\",\n    font: \"inherit\",\n    letterSpacing: \"inherit\",\n    color: \"currentcolor\",\n    border: \"0px\",\n    background: \"none\",\n    height: \"1.4375em\",\n    margin: \"0px\",\n    WebkitTapHighlightColor: \"transparent\",\n    display: \"block\",\n    minWidth: \"0px\",\n    animationName: \"mui-auto-fill-cancel\",\n    animationDuration: \"10ms\"\n});\n","import React, { useCallback } from \"react\";\nimport {\n    Box,\n    FormControlLabel,\n    FormHelperText,\n    IconButton,\n    Switch,\n    Typography\n} from \"@mui/material\";\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\n\nimport { FieldProps } from \"../../types\";\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { getIconForProperty } from \"../../core\";\nimport { TextInput } from \"../../core/components/fields/TextInput\";\n\ninterface TextFieldProps<T extends string | number> extends FieldProps<T> {\n    allowInfinity?: boolean\n}\n\n/**\n * Generic text field.\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function TextFieldBinding<T extends string | number>({\n                                                                propertyKey,\n                                                                value,\n                                                                setValue,\n                                                                error,\n                                                                showError,\n                                                                disabled,\n                                                                autoFocus,\n                                                                property,\n                                                                includeDescription,\n                                                                allowInfinity\n                                                            }: TextFieldProps<T>) {\n\n    let multiline: boolean | undefined;\n    if (property.dataType === \"string\") {\n        multiline = property.multiline;\n    }\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const handleClearClick = useCallback(() => {\n        setValue(null);\n    }, [setValue]);\n\n    const isMultiline = Boolean(multiline);\n\n    const internalValue = value ?? (property.dataType === \"string\" ? \"\" : value === 0 ? 0 : \"\");\n\n    const valueIsInfinity = internalValue === Infinity;\n    const inputType = !valueIsInfinity && property.dataType === \"number\" ? \"number\" : undefined;\n\n    const updateValue = useCallback((newValue: typeof internalValue | undefined) => {\n\n        if (!newValue) {\n            setValue(\n                null\n            );\n        } else if (inputType === \"number\") {\n            const numValue = parseFloat(newValue as string);\n            setValue(\n                numValue as T\n            );\n        } else {\n            setValue(\n                newValue\n            );\n        }\n    }, [inputType, setValue]);\n\n    return (\n        <>\n            <TextInput\n                value={value}\n                setValue={setValue}\n                autoFocus={autoFocus}\n                label={<LabelWithIcon icon={getIconForProperty(property)}\n                                      title={property.name}/>}\n                inputType={inputType}\n                multiline={isMultiline}\n                disabled={disabled}\n                endAdornment={\n                    property.clearable && <IconButton\n                        onClick={handleClearClick}>\n                        <ClearIcon/>\n                    </IconButton>\n                }\n                error={showError ? error : undefined}/>\n\n            {(showError || includeDescription || allowInfinity) &&\n                <Box display={\"flex\"}\n                     sx={{ marginLeft: \"14px\" }}\n                >\n\n                    <Box flexGrow={1}>\n                        {showError && <FormHelperText error={true}>{error}</FormHelperText>}\n\n                        {includeDescription &&\n                            <FieldDescription property={property}/>}\n                    </Box>\n\n                    {allowInfinity &&\n                        <FormControlLabel\n                            checked={valueIsInfinity}\n                            style={{ marginRight: 0 }}\n                            labelPlacement={\"start\"}\n                            control={\n                                <Switch\n                                    size={\"small\"}\n                                    type={\"checkbox\"}\n                                    onChange={(evt) => {\n                                        updateValue(\n                                            evt.target.checked ? Infinity as T : undefined);\n                                    }}/>\n                            }\n                            disabled={disabled}\n                            label={\n                                <Typography variant={\"caption\"}>\n                                    Set value to Infinity\n                                </Typography>\n                            }\n                        />\n                    }\n                </Box>}\n\n            {/*</FormControl>*/}\n        </>\n    );\n\n}\n","import React, { useState } from \"react\";\nimport {\n    FormControl,\n    FormControlLabel,\n    FormHelperText,\n    Switch\n} from \"@mui/material\";\n\nimport { FieldProps } from \"../../types\";\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { fieldBackground, fieldBackgroundHover } from \"./utils\";\nimport { getIconForProperty } from \"../../core\";\n\ntype SwitchFieldProps = FieldProps<boolean>;\n\n/**\n * Simple boolean switch.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport const SwitchFieldBinding = React.forwardRef(function SwitchFieldBinding({\n                                                                                   propertyKey,\n                                                                                   value,\n                                                                                   setValue,\n                                                                                   error,\n                                                                                   showError,\n                                                                                   autoFocus,\n                                                                                   disabled,\n                                                                                   touched,\n                                                                                   property,\n                                                                                   includeDescription\n                                                                               }: SwitchFieldProps, ref) {\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const [focus, setFocus] = useState<boolean>(autoFocus);\n\n    return (\n        <>\n            <FormControl fullWidth>\n\n                <FormControlLabel\n                    sx={theme => ({\n                        color: focus ? theme.palette.primary.main : theme.palette.text.secondary,\n                        justifyContent: \"space-between\",\n                        margin: 0,\n                        width: \"100%\",\n                        minHeight: \"64px\",\n                        paddingLeft: \"16px\",\n                        paddingRight: \"24px\",\n                        boxSizing: \"border-box\",\n                        position: \"relative\",\n                        display: \"inline-flex\",\n                        alignItems: \"center\",\n                        backgroundColor: fieldBackground(theme),\n                        borderRadius: `${theme.shape.borderRadius}px`,\n                        transition: \"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms\",\n                        \"&:hover\": {\n                            backgroundColor: fieldBackgroundHover(theme)\n                        }\n                    })}\n                    onClick={(e) => setFocus(true)}\n                    labelPlacement={\"start\"}\n                    checked={Boolean(value)}\n                    inputRef={ref}\n                    control={\n                        <Switch\n                            type={\"checkbox\"}\n                            color={\"secondary\"}\n                            autoFocus={autoFocus}\n                            disabled={disabled}\n                            onFocus={(e) => setFocus(true)}\n                            onBlur={(e) => setFocus(false)}\n                            onChange={(evt) => {\n                                setFocus(true);\n                                setValue(\n                                    evt.target.checked\n                                );\n                            }}/>\n                    }\n                    disabled={disabled}\n                    label={\n                        <LabelWithIcon icon={getIconForProperty(property)}\n                                       title={property.name}/>\n                    }\n                />\n\n                {includeDescription &&\n                    <FieldDescription property={property}/>}\n\n                {showError && <FormHelperText error={true}>{error}</FormHelperText>}\n\n            </FormControl>\n\n        </>\n\n    );\n});\n","import React, { useCallback } from \"react\";\n\nimport { Box, IconButton, TextField as MuiTextField } from \"@mui/material\";\nimport { DatePicker } from \"@mui/x-date-pickers/DatePicker\";\nimport { DateTimePicker } from \"@mui/x-date-pickers/DateTimePicker\";\nimport ClearIcon from \"@mui/icons-material/Clear\";\n\nimport { FieldProps } from \"../../types\";\n\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { getIconForProperty } from \"../../core\";\n\ntype DateTimeFieldProps = FieldProps<Date>;\n\n/**\n * Field that allows selecting a date\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function DateTimeFieldBinding({\n                                         propertyKey,\n                                         value,\n                                         setValue,\n                                         autoFocus,\n                                         error,\n                                         showError,\n                                         disabled,\n                                         touched,\n                                         property,\n                                         includeDescription\n                                     }: DateTimeFieldProps) {\n\n    const internalValue = value || null;\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const handleClearClick = useCallback(() => {\n        setValue(null);\n    }, [setValue]);\n\n    const PickerComponent = property.mode === undefined || property.mode === \"date_time\"\n        ? DateTimePicker\n        : DatePicker;\n\n    return (\n        <>\n\n            <PickerComponent\n                autoFocus={autoFocus}\n                value={internalValue}\n                renderInput={(params) =>\n                    (\n                        <MuiTextField {...params}\n                                      fullWidth\n                                      sx={(theme) => ({\n                                          minHeight: \"64px\",\n                                          borderRadius: `${theme.shape.borderRadius}px`\n                                      })}\n                                      label={\n                                          <LabelWithIcon\n                                              icon={getIconForProperty(property)}\n                                              title={property.name}/>\n                                      }\n                                      InputProps={{\n                                          ...params.InputProps,\n                                          sx: (theme) => ({\n                                              minHeight: \"64px\",\n                                              borderRadius: `${theme.shape.borderRadius}px`\n                                          }),\n                                          disableUnderline: true,\n                                          endAdornment: <Box\n                                              sx={{\n                                                  pr: 2,\n                                                  gap: 2\n                                              }}>\n                                              {property.clearable && <IconButton\n                                                  sx={{\n                                                      position: \"absolute\",\n                                                      right: \"56px\",\n                                                      top: \"12px\"\n                                                  }}\n                                                  onClick={handleClearClick}>\n                                                  <ClearIcon/>\n                                              </IconButton>}\n                                              {params.InputProps?.endAdornment}\n                                          </Box>\n                                      }}\n                                      error={showError}\n                                      variant={\"filled\"}\n                                      helperText={showError ? error : null}/>\n                    )}\n                disabled={disabled}\n                onChange={(dateValue) => setValue(dateValue)}\n            />\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n        </>\n    );\n}\n","import React, { useCallback, useMemo } from \"react\";\n\nimport { Box, Button, IconButton, Tooltip, Typography } from \"@mui/material\";\n\nimport LinkIcon from \"@mui/icons-material/Link\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport KeyboardTabIcon from \"@mui/icons-material/KeyboardTab\";\n\nimport {\n    Entity,\n    EntityCollection,\n    EntityReference,\n    FilterValues,\n    ResolvedProperty\n} from \"../../types\";\nimport {\n    ErrorBoundary,\n    ErrorView,\n    getReferenceFrom,\n    getReferencePreviewKeys\n} from \"../../core\";\nimport { PropertyPreview, SkeletonPropertyComponent } from \"../../preview\";\nimport { LabelWithIcon } from \"../components\";\nimport {\n    useEntityFetch,\n    useFireCMSContext,\n    useNavigationContext,\n    useReferenceDialog,\n    useSideEntityController\n} from \"../../hooks\";\n\n/**\n * This field allows selecting reference/s.\n * @param name\n * @param path\n * @param disabled\n * @param value\n * @param setValue\n * @param previewProperties\n * @param forceFilter\n * @constructor\n */\nexport function ReferenceWidget<M extends Record<string, any>>({\n                                                                   name,\n                                                                   path,\n                                                                   disabled,\n                                                                   value,\n                                                                   setValue,\n                                                                   previewProperties,\n                                                                   forceFilter\n                                                               }: {\n    name?: string,\n    value?: EntityReference,\n    setValue: (value: EntityReference | null) => void,\n    path: string,\n    disabled?: boolean,\n    previewProperties?: string[];\n    /**\n     * Allow selection of entities that pass the given filter only.\n     */\n    forceFilter?: FilterValues<string>;\n}) {\n\n    const fireCMSContext = useFireCMSContext();\n    const navigationContext = useNavigationContext();\n    const sideEntityController = useSideEntityController();\n\n    const collection: EntityCollection | undefined = useMemo(() => {\n        return navigationContext.getCollection(path);\n    }, [path, navigationContext]);\n\n    if (!collection) {\n        throw Error(`Couldn't find the corresponding collection for the path: ${path}`);\n    }\n\n    const validValue = value && value instanceof EntityReference;\n\n    const {\n        entity,\n        dataLoading,\n        dataLoadingError\n    } = useEntityFetch({\n        path,\n        entityId: validValue ? value.id : undefined,\n        collection,\n        useCache: true\n    });\n\n    const onSingleEntitySelected = useCallback((entity: Entity<M>) => {\n        if (disabled)\n            return;\n        setValue(entity ? getReferenceFrom(entity) : null);\n    }, [disabled, setValue]);\n\n    const referenceDialogController = useReferenceDialog({\n            multiselect: false,\n            path,\n            collection,\n            onSingleEntitySelected,\n            forceFilter\n        }\n    );\n\n    const handleClickOpen = useCallback(() => {\n        referenceDialogController.open();\n    }, [referenceDialogController]);\n\n    const clearValue = useCallback((e: React.MouseEvent) => {\n        e.stopPropagation();\n        setValue(null);\n    }, [setValue]);\n\n    const seeEntityDetails = useCallback((e: React.MouseEvent) => {\n        e.stopPropagation();\n        if (entity) {\n            fireCMSContext.onAnalyticsEvent?.(\"entity_click_from_reference\", {\n                path: entity.path,\n                entityId: entity.id\n            });\n            sideEntityController.open({\n                entityId: entity.id,\n                path,\n                updateUrl: true\n            });\n        }\n    }, [entity, path, sideEntityController]);\n\n    const buildEntityView = (collection?: EntityCollection<any>) => {\n\n        const missingEntity = entity && !entity.values;\n\n        let body: React.ReactNode;\n        if (!collection) {\n            body = (\n                <ErrorView\n                    error={\"The specified collection does not exist. Check console\"}/>\n            );\n        } else if (missingEntity) {\n            body = (\n                <Tooltip title={value && value.path}>\n                    <Box\n                        display={\"flex\"}\n                        alignItems={\"center\"}\n                        p={1}\n                        flexGrow={1}>\n                        <ErrorIcon fontSize={\"small\"} color={\"error\"}/>\n                        <Box marginLeft={1}>Missing\n                            reference {entity && entity.id}</Box>\n                    </Box>\n                </Tooltip>\n            );\n        } else {\n            if (validValue) {\n\n                const listProperties = getReferencePreviewKeys(collection, fireCMSContext.fields, previewProperties, 3);\n\n                body = (\n                    <Box display={\"flex\"}\n                         flexDirection={\"column\"}\n                         flexGrow={1}\n                         ml={1}\n                         mr={1}>\n\n                        {listProperties && listProperties.map((key) => {\n                            const property = collection.properties[key as string];\n                            if (!property) return null;\n                            return (\n                                <Box\n                                    key={`reference_previews_${key as string}`}\n                                    mt={0.25}\n                                    mb={0.25}>\n                                    <ErrorBoundary>{\n                                        entity\n                                            ? <PropertyPreview\n                                                propertyKey={key as string}\n                                                value={(entity.values)[key]}\n                                                property={property as ResolvedProperty}\n                                                entity={entity}\n                                                size={\"tiny\"}/>\n                                            : <SkeletonPropertyComponent\n                                                property={property as ResolvedProperty}\n                                                size={\"tiny\"}/>}\n                                    </ErrorBoundary>\n                                </Box>\n                            );\n                        })}\n                    </Box>\n                );\n            } else {\n                body = <Box p={1}\n                            onClick={disabled ? undefined : handleClickOpen}\n                            justifyContent=\"center\"\n                            display=\"flex\">\n                    <Typography variant={\"label\"} sx={(theme) => ({\n                        flexGrow: 1,\n                        textAlign: \"center\"\n                    })}>No value set</Typography>\n                    {!disabled && <Button variant=\"outlined\"\n                                          color=\"primary\">\n                        Set\n                    </Button>}\n                </Box>;\n            }\n        }\n\n        return (\n            <Box\n                onClick={disabled ? undefined : handleClickOpen}\n                display=\"flex\">\n\n                <Box display={\"flex\"}\n                     flexDirection={\"column\"}\n                     flexGrow={1}>\n\n                    <Box display={\"flex\"}\n                         flexDirection={\"row\"}\n                         flexGrow={1}>\n                        <LabelWithIcon icon={<LinkIcon color={\"inherit\"}\n                                                       fontSize={\"inherit\"}/>}\n                                       sx={{\n                                           flexGrow: 1,\n                                           color: \"text.secondary\",\n                                           ml: 1\n                                       }}\n                                       title={name}\n                        />\n\n                        {entity &&\n                            <Box\n                                alignSelf={\"center\"}\n                                m={1}>\n                                <Tooltip title={value && value.path}>\n                                    <Typography variant={\"caption\"}\n                                                className={\"mono\"}>\n                                        {entity.id}\n                                    </Typography>\n                                </Tooltip>\n                            </Box>}\n\n                        {!missingEntity && entity && value && <Box>\n                            <Tooltip title={`See details for ${entity.id}`}>\n                                <span>\n                                <IconButton\n                                    onClick={seeEntityDetails}\n                                    size=\"large\">\n                                    <KeyboardTabIcon/>\n                                </IconButton>\n                                    </span>\n                            </Tooltip>\n                        </Box>}\n\n                        {value && <Box>\n                            <Tooltip title=\"Clear\">\n                                <span>\n                                <IconButton\n                                    disabled={disabled}\n                                    onClick={disabled ? undefined : clearValue}\n                                    size=\"large\">\n                                    <ClearIcon/>\n                                </IconButton>\n                                </span>\n                            </Tooltip>\n                        </Box>}\n\n                    </Box>\n\n                    {body}\n\n                </Box>\n            </Box>\n        );\n    };\n\n    return <Typography variant={\"label\"} sx={(theme) => ({\n        elevation: 0,\n        width: \"100%\",\n        padding: theme.spacing(1),\n        position: \"relative\",\n        transition: \"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms\",\n        borderRadius: `${theme.shape.borderRadius}px`,\n        backgroundColor: disabled ? \"rgba(0, 0, 0, 0.12)\" : (theme.palette.mode === \"light\" ? \"rgba(0, 0, 0, 0.06)\" : \"rgba(255, 255, 255, 0.09)\"),\n        \"&:hover\": {\n            cursor: disabled ? undefined : \"pointer\",\n            backgroundColor: disabled ? \"rgba(0, 0, 0, 0.12)\" : theme.palette.mode === \"light\" ? \"rgba(0, 0, 0, 0.09)\" : \"rgba(255, 255, 255, 0.13)\"\n        },\n        color: disabled ? (theme.palette.mode === \"light\" ? \"rgba(0, 0, 0, 0.38)\" : \"rgba(255, 255, 255, 0.38)\") : undefined,\n        fontWeight: theme.typography.fontWeightMedium\n    })}>\n\n        {collection && buildEntityView(collection)}\n\n    </Typography>;\n}\n","import React from \"react\";\n\nimport { FormControl, FormHelperText } from \"@mui/material\";\n\nimport { EntityReference, FieldProps } from \"../../types\";\nimport { FieldDescription, ReadOnlyFieldBinding } from \"../index\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { ReferenceWidget } from \"../components/ReferenceWidget\";\n\n/**\n * Field that opens a reference selection dialog.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function ReferenceFieldBinding<M extends Record<string, any>>(props: FieldProps<EntityReference>) {\n\n    if (typeof props.property.path !== \"string\") {\n        return <ReadOnlyFieldBinding {...props}/>\n    }\n\n    return <ReferenceFieldBindingInternal {...props}/>;\n\n}\n\nfunction ReferenceFieldBindingInternal<M extends Record<string, any>>({\n                                                                          propertyKey,\n                                                                          value,\n                                                                          setValue,\n                                                                          error,\n                                                                          showError,\n                                                                          disabled,\n                                                                          touched,\n                                                                          autoFocus,\n                                                                          property,\n                                                                          includeDescription,\n                                                                          context\n                                                                      }: FieldProps<EntityReference>) {\n    if (!property.path) {\n        throw new Error(\"Property path is required for ReferenceFieldBinding\");\n    }\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const validValue = value && value instanceof EntityReference;\n    const path = validValue ? value.path : property.path;\n\n    return (\n        <FormControl error={showError} fullWidth>\n\n            <ReferenceWidget\n                name={property.name}\n                path={path}\n                forceFilter={property.forceFilter}\n                previewProperties={property.previewProperties}\n                value={value}\n                disabled={Boolean(property.disabled)}\n                setValue={setValue}\n            />\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n            {showError && <FormHelperText error={true}>{error}</FormHelperText>}\n\n        </FormControl>\n    );\n}\n","import { Box, Typography } from \"@mui/material\";\nimport React, { ErrorInfo, PropsWithChildren } from \"react\";\n\nimport ErrorIcon from \"@mui/icons-material/Error\";\n\nexport class ErrorBoundary extends React.Component<PropsWithChildren<Record<string, unknown>>, { error: Error | null }> {\n    constructor(props: any) {\n        super(props);\n        this.state = { error: null };\n    }\n\n    // eslint-disable-next-line n/handle-callback-err\n    static getDerivedStateFromError(error: Error) {\n        return { error };\n    }\n\n    componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n        console.error(error);\n        // logErrorToMyService(error, errorInfo);\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <Box\n                    display={\"flex\"}\n                    flexDirection={\"column\"}\n                    m={0.5}>\n                    <Box\n                        display={\"flex\"}\n                        alignItems={\"center\"}\n                        m={0.5}>\n                        <ErrorIcon color={\"error\"} fontSize={\"small\"}/>\n                        <Box marginLeft={1}>Error</Box>\n                    </Box>\n                    <Typography variant={\"caption\"}>\n                        {this.state.error?.message ?? \"See the error in the console\"}\n                    </Typography>\n                </Box>\n            );\n        }\n\n        return this.props.children;\n    }\n}\n","import React from \"react\";\nimport { FormControl, FormHelperText, Paper } from \"@mui/material\";\n\nimport { Entity, FieldProps } from \"../../types\";\n\nimport { PropertyPreview } from \"../../preview\";\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { ErrorBoundary } from \"../../core/components/ErrorBoundary\";\nimport { getIconForProperty } from \"../../core\";\n\n/**\n *\n * Simply render the non-editable preview of a field\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function ReadOnlyFieldBinding({\n                                         propertyKey,\n                                         value,\n                                         setValue,\n                                         error,\n                                         showError,\n                                         isSubmitting,\n                                         touched,\n                                         tableMode,\n                                         property,\n                                         includeDescription,\n                                         context\n                                     }: FieldProps<any>) {\n\n    if (!context.entityId)\n        throw new Error(\"ReadOnlyFieldBinding: Entity id is null\");\n\n    const entity: Entity<any> = {\n        id: context.entityId!,\n        values: context.values,\n        path: context.path\n    };\n\n    return (\n\n        <FormControl fullWidth error={showError}>\n\n            {!tableMode && <FormHelperText filled>\n                <LabelWithIcon icon={getIconForProperty(property)}\n                               title={property.name}/>\n            </FormHelperText>}\n\n            <Paper\n                sx={(theme) => ({\n                    minHeight: \"56px\",\n                    elevation: 0,\n                    padding: theme.spacing(2),\n                    [theme.breakpoints.up(\"md\")]: {\n                        padding: theme.spacing(3)\n                    }\n                })}\n                variant={\"outlined\"}>\n\n                <ErrorBoundary>\n                    <PropertyPreview propertyKey={propertyKey}\n                                     value={value}\n                                     property={property}\n                                     entity={entity}\n                                     size={\"regular\"}/>\n                </ErrorBoundary>\n\n            </Paper>\n\n            {showError &&\n                typeof error === \"string\" &&\n                <FormHelperText error={true}>{error}</FormHelperText>}\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n        </FormControl>\n    );\n}\n","import React, { ComponentType, ReactElement, useRef } from \"react\";\nimport equal from \"react-fast-compare\"\n\nimport { FormHelperText } from \"@mui/material\";\n\nimport {\n    FastField,\n    Field,\n    FieldProps as FormikFieldProps,\n    getIn\n} from \"formik\";\n\nimport {\n    CMSType, EntityCollection,\n    FieldProps,\n    FireCMSPlugin,\n    PluginFieldBuilderParams,\n    Property,\n    PropertyFieldBindingProps,\n    PropertyOrBuilder,\n    ResolvedProperty\n} from \"../types\";\nimport { ReadOnlyFieldBinding } from \"./field_bindings/ReadOnlyFieldBinding\";\n\nimport {\n    ErrorBoundary,\n    getFieldConfig,\n    getFieldId,\n    isHidden,\n    isPropertyBuilder,\n    isReadOnly,\n    resolveProperty\n} from \"../core\";\nimport { useFireCMSContext } from \"../hooks\";\nimport path from \"path\";\n\n/**\n * This component renders a form field creating the corresponding configuration\n * from a property. For example if bound to a string property, it will generate\n * a text field.\n *\n * You can use it when you are creating a custom field, and need to\n * render additional fields mapped to properties. This is useful if you\n * need to build a complex property mapping, like an array where each index\n * is a different property.\n *\n * Please note that if you build a custom field in a component, the\n * **validation** passed in the property will have no effect. You need to set\n * the validation in the `EntityCollection` definition.\n *\n * @param propertyKey You can use nested names such as `address.street` or `friends[2]`\n * @param property\n * @param context\n * @param includeDescription\n * @param underlyingValueHasChanged\n * @param disabled\n * @param tableMode\n * @param partOfArray\n * @param autoFocus\n * @category Form custom fields\n */\n// export const PropertyFieldBinding = PropertyFieldBindingInternal;\nexport const PropertyFieldBinding = React.memo(PropertyFieldBindingInternal, (a: PropertyFieldBindingProps<any>, b: PropertyFieldBindingProps<any>) => {\n\n    const aIsBuilder = isPropertyBuilder(a.property) || a.property.fromBuilder;\n    const bIsBuilder = isPropertyBuilder(b.property) || b.property.fromBuilder;\n\n    const baseCheck = (aIsBuilder === bIsBuilder || equal(a.property, b.property)) &&\n        a.disabled === b.disabled;\n    if (!baseCheck) {\n        return false;\n    }\n\n    if (shouldPropertyReRender(b.property)) {\n        return false;\n    }\n\n    return false;\n}) as typeof PropertyFieldBindingInternal;\n\nfunction PropertyFieldBindingInternal<T extends CMSType = CMSType, CustomProps = any, M extends Record<string, any> = Record<string, any>>\n({\n     propertyKey,\n     property,\n     context,\n     includeDescription,\n     underlyingValueHasChanged,\n     disabled,\n     tableMode,\n     partOfArray,\n     autoFocus,\n     context: {\n         values,\n         collection,\n         path,\n         entityId\n     }\n }: PropertyFieldBindingProps<T, M>): ReactElement<PropertyFieldBindingProps<T, M>> {\n\n    const fireCMSContext = useFireCMSContext();\n\n    const shouldAlwaysRerender = shouldPropertyReRender(property, fireCMSContext.plugins);\n    // console.log(\"shouldAlwaysRerender\", shouldAlwaysRerender, propertyKey)\n    // we use the standard Field for user defined fields, since it rebuilds\n    // when there are changes in other values, in contrast to FastField\n    const FieldComponent = shouldAlwaysRerender ? Field : FastField;\n\n    return (\n        <FieldComponent\n            // required={property.validation?.required}\n            name={propertyKey}\n        >\n            {(fieldProps: FormikFieldProps<T>) => {\n\n                let Component: ComponentType<FieldProps<T>> | undefined;\n                const resolvedProperty: ResolvedProperty<T> | null = resolveProperty({\n                    propertyKey,\n                    propertyValue: fieldProps.field.value,\n                    propertyOrBuilder: property,\n                    values: fieldProps.form.values,\n                    path: context.path,\n                    entityId: context.entityId,\n                    fields: fireCMSContext.fields\n                });\n\n                if (resolvedProperty === null || isHidden(resolvedProperty)) {\n                    return <></>;\n                } else if (isReadOnly(resolvedProperty)) {\n                    Component = ReadOnlyFieldBinding;\n                } else if (resolvedProperty.Field) {\n                    if (typeof resolvedProperty.Field === \"function\") {\n                        Component = resolvedProperty.Field as ComponentType<FieldProps<any>>;\n                    }\n                } else {\n                    const fieldConfig = getFieldConfig(resolvedProperty);\n                    if (!fieldConfig) {\n                        throw new Error(`INTERNAL: Could not find field config for property ${propertyKey}`);\n                    }\n                    Component = fieldConfig.Field as ComponentType<FieldProps<T>>;\n\n                }\n                if (!Component) {\n                    return (\n                        <div>{`Currently the field ${resolvedProperty.dataType} is not supported`}</div>\n                    );\n                    // return null;\n                }\n\n                const componentProps: ResolvedPropertyFieldBindingProps<T, M> = {\n                    propertyKey,\n                    property: resolvedProperty,\n                    includeDescription,\n                    underlyingValueHasChanged,\n                    context,\n                    disabled,\n                    tableMode,\n                    partOfArray,\n                    autoFocus\n                };\n\n                return <FieldInternal\n                    Component={Component as ComponentType<FieldProps>}\n                    componentProps={componentProps}\n                    fieldProps={fieldProps}/>;\n            }}\n        </FieldComponent>\n    );\n\n}\n\n\ntype ResolvedPropertyFieldBindingProps<T extends CMSType = CMSType, M extends Record<string, any> = Record<string, any>> =\n    Omit<PropertyFieldBindingProps<T, M>, \"property\">\n    & {\n    property: ResolvedProperty<T>\n};\n\nfunction FieldInternal<T extends CMSType, CustomProps, M extends Record<string, any>>\n({\n     Component,\n     componentProps: {\n         propertyKey,\n         property,\n         includeDescription,\n         underlyingValueHasChanged,\n         tableMode,\n         partOfArray,\n         autoFocus,\n         context,\n         disabled\n     },\n     fieldProps\n }:\n     {\n         Component: ComponentType<FieldProps<T, any, M>>,\n         componentProps: ResolvedPropertyFieldBindingProps<T, M>,\n         fieldProps: FormikFieldProps<T>\n     }) {\n\n    const { plugins } = useFireCMSContext();\n\n    const customFieldProps: any = property.customProps;\n    const value = fieldProps.field.value;\n    const initialValue = fieldProps.meta.initialValue;\n    const error = getIn(fieldProps.form.errors, propertyKey);\n    const touched = getIn(fieldProps.form.touched, propertyKey);\n\n    const showError: boolean = error &&\n        (fieldProps.form.submitCount > 0 || property.validation?.unique) &&\n        (!Array.isArray(error) || !!error.filter((e: any) => !!e).length);\n\n    const WrappedComponent: ComponentType<FieldProps<T, any, M>> | null = useWrappedComponent(context.path, context.collection, propertyKey, property, Component, plugins);\n    const UsedComponent: ComponentType<FieldProps<T>> = WrappedComponent ?? Component;\n    // const UsedComponent: ComponentType<FieldProps<T>> = Component;\n\n    const isSubmitting = fieldProps.form.isSubmitting;\n\n    const cmsFieldProps: FieldProps<T, CustomProps, M> = {\n        propertyKey,\n        value: value as T,\n        initialValue,\n        setValue: (value: T | null, shouldValidate?: boolean) => {\n            fieldProps.form.setFieldTouched(propertyKey, true, false);\n            fieldProps.form.setFieldValue(propertyKey, value, shouldValidate);\n        },\n        setFieldValue: (otherPropertyKey: string, value: CMSType | null, shouldValidate?: boolean) => {\n            fieldProps.form.setFieldTouched(propertyKey, true, false);\n            fieldProps.form.setFieldValue(otherPropertyKey, value, shouldValidate);\n        },\n        error,\n        touched,\n        showError,\n        isSubmitting,\n        includeDescription: includeDescription ?? true,\n        property: property as ResolvedProperty<T>,\n        disabled: disabled ?? false,\n        underlyingValueHasChanged: underlyingValueHasChanged ?? false,\n        tableMode: tableMode ?? false,\n        partOfArray: partOfArray ?? false,\n        autoFocus: autoFocus ?? false,\n        customProps: customFieldProps,\n        context\n    };\n\n    return (\n        <ErrorBoundary>\n\n            <UsedComponent {...cmsFieldProps}/>\n\n            {underlyingValueHasChanged && !isSubmitting &&\n                <FormHelperText>\n                    This value has been updated elsewhere\n                </FormHelperText>}\n\n        </ErrorBoundary>);\n\n}\n\nconst shouldPropertyReRender = (property: PropertyOrBuilder | ResolvedProperty, plugins?: FireCMSPlugin[]): boolean => {\n    if (plugins?.some((plugin) => plugin.form?.fieldBuilder)) {\n        return true;\n    }\n    if (isPropertyBuilder(property)) {\n        return true;\n    }\n    const defAProperty = property as Property | ResolvedProperty;\n    const rerenderThisProperty = Boolean(defAProperty.Field) || (\"fromBuilder\" in defAProperty && defAProperty.fromBuilder);\n    if (defAProperty.dataType === \"map\" && defAProperty.properties) {\n        return rerenderThisProperty || Object.values(defAProperty.properties).some((childProperty) => shouldPropertyReRender(childProperty, plugins));\n    } else if (defAProperty.dataType === \"array\" && \"resolvedProperties\" in defAProperty) {\n        // @ts-ignore\n        return rerenderThisProperty || defAProperty.resolvedProperties?.some((childProperty) => childProperty && shouldPropertyReRender(childProperty, plugins));\n    } else {\n        return rerenderThisProperty;\n    }\n}\n\nfunction useWrappedComponent<T extends CMSType = CMSType, M extends Record<string, any> = any>(\n    path: string,\n    collection: EntityCollection<M>,\n    propertyKey: string,\n    property: ResolvedProperty<T>,\n    Component: ComponentType<FieldProps<T, any, M>>,\n    plugins?: FireCMSPlugin[]\n): ComponentType<FieldProps<T, any, M>> | null {\n\n    const wrapperRef = useRef<ComponentType<FieldProps<T, any, M>> | null>((() => {\n        let Wrapper: ComponentType<FieldProps<T, any, M>> | null = null;\n        if (plugins) {\n            plugins.forEach((plugin) => {\n                const fieldId = getFieldId(property);\n                if (fieldId && plugin.form?.fieldBuilder) {\n                    const params: PluginFieldBuilderParams<T> = {\n                        fieldConfigId: fieldId,\n                        propertyKey,\n                        property,\n                        Field: Component,\n                        plugin,\n                        path,\n                        collection\n                    };\n                    const enabled = plugin.form?.fieldBuilderEnabled?.(params);\n                    if (enabled === undefined || enabled)\n                        Wrapper = plugin.form.fieldBuilder(params) || Wrapper;\n                }\n                if (!fieldId) {\n                    console.warn(\"INTERNAL: Field id not found for property\", property);\n                }\n            });\n        }\n        return Wrapper;\n    })());\n\n    return wrapperRef.current;\n}\n","import React from \"react\";\nimport { FieldProps, Properties, ResolvedProperties } from \"../../types\";\nimport {\n    Box,\n    FormControl,\n    Grid,\n    InputLabel,\n    MenuItem,\n    Select\n} from \"@mui/material\";\nimport { SelectChangeEvent } from \"@mui/material/Select\";\n\nimport {\n    ExpandablePanel,\n    getIconForProperty,\n    isHidden,\n    pick\n} from \"../../core\";\nimport { FieldDescription, LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { PropertyFieldBinding } from \"../PropertyFieldBinding\";\n\n/**\n * Field that renders the children property fields\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function MapFieldBinding<T extends Record<string, any>>({\n                                                                   propertyKey,\n                                                                   value,\n                                                                   showError,\n                                                                   disabled,\n                                                                   property,\n                                                                   setValue,\n                                                                   tableMode,\n                                                                   includeDescription,\n                                                                   underlyingValueHasChanged,\n                                                                   autoFocus,\n                                                                   context\n                                                               }: FieldProps<T>) {\n\n    const pickOnlySomeKeys = property.pickOnlySomeKeys || false;\n    const expanded = (property.expanded === undefined ? true : property.expanded) || autoFocus;\n\n    if (!property.properties) {\n        throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${propertyKey}`);\n    }\n\n    let mapProperties: ResolvedProperties;\n    if (!pickOnlySomeKeys) {\n        mapProperties = property.properties;\n    } else if (value) {\n        mapProperties = pick(property.properties,\n            ...Object.keys(value)\n                .filter(key => key in property.properties!)\n        );\n    } else {\n        mapProperties = {};\n    }\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const mapFormView = <>\n        <Grid container spacing={2} sx={{ py: 1 }}>\n            {Object.entries(mapProperties)\n                .filter(([_, property]) => !isHidden(property))\n                .map(([entryKey, childProperty], index) => {\n                        const fieldProps = {\n                            propertyKey: `${propertyKey}.${entryKey}`,\n                            disabled,\n                            property: childProperty,\n                            includeDescription,\n                            underlyingValueHasChanged,\n                            context,\n                            tableMode: false,\n                            partOfArray: false,\n                            autoFocus: autoFocus && index === 0\n                        };\n                        return (\n                            <Grid item\n                                  sm={12}\n                                  xs={12}\n                                  key={`map-${propertyKey}-${index}`}>\n                                <PropertyFieldBinding {...fieldProps}/>\n                            </Grid>\n                        );\n                    }\n                )}\n        </Grid>\n\n        {pickOnlySomeKeys && buildPickKeysSelect(disabled, property.properties, setValue, value)}\n\n    </>;\n\n    const title = <LabelWithIcon icon={getIconForProperty(property)}\n                                 title={property.name}/>;\n\n    return (\n        <FormControl fullWidth error={showError}>\n\n            {!tableMode && <ExpandablePanel initiallyExpanded={expanded}\n                                            title={title}>{mapFormView}</ExpandablePanel>}\n\n            {tableMode && mapFormView}\n\n            {includeDescription && <FieldDescription property={property}/>}\n\n        </FormControl>\n    );\n}\n\nconst buildPickKeysSelect = (disabled: boolean, properties: Properties, setValue: (value: any) => void, value: any) => {\n\n    const keys = Object.keys(properties)\n        .filter((key) => !value || !(key in value));\n\n    const handleAddProperty = (event: SelectChangeEvent) => {\n        setValue({\n            ...value,\n            [event.target.value as string]: null\n        });\n    };\n\n    if (!keys.length) return <></>;\n\n    return <Box m={1}>\n        <FormControl fullWidth>\n            <InputLabel>Add property</InputLabel>\n            <Select\n                variant={\"standard\"}\n                value={\"\"}\n                disabled={disabled}\n                onChange={handleAddProperty}>\n                {keys.map((key) => (\n                    <MenuItem key={key} value={key}>\n                        {(properties as Properties)[key].name || key}\n                    </MenuItem>\n                ))}\n            </Select>\n        </FormControl>\n    </Box>;\n};\n\n","import { PropsWithChildren, useCallback, useState } from \"react\";\n\nimport { Accordion, AccordionDetails, AccordionSummary } from \"@mui/material\";\nimport ExpandMoreIcon from \"@mui/icons-material/ExpandMore\";\n\nexport function ExpandablePanel({\n                                    title,\n                                    children,\n                                    invisible = false,\n                                    initiallyExpanded = true,\n                                    padding = 1,\n                                    darken = true,\n                                    onExpandedChange\n                                }: PropsWithChildren<{\n    title: React.ReactNode,\n    invisible?: boolean,\n    initiallyExpanded?: boolean;\n    padding?: number | string;\n    darken?: boolean,\n    onExpandedChange?: (expanded: boolean) => void\n}>) {\n\n    const [expandedInternal, setExpandedInternal] = useState(initiallyExpanded);\n    return (\n        <Accordion variant={\"outlined\"}\n                   disableGutters\n                   expanded={expandedInternal}\n                   sx={theme => ({\n                       backgroundColor: invisible ? \"transparent\" : (darken ? undefined : \"inherit\"),\n                       borderRadius: invisible ? 0 : `${theme.shape.borderRadius}px`,\n                       border: invisible ? \"none\" : undefined,\n                       \"&::before\": {\n                           display: \"none\"\n                       },\n                       // color: \"inherit\"\n\n                   })}\n                   TransitionProps={{ unmountOnExit: true }}\n                   onChange={useCallback((event: React.SyntheticEvent, expanded: boolean) => {\n                       onExpandedChange?.(expanded);\n                       setExpandedInternal(expanded);\n                   }, [onExpandedChange])}>\n\n            <AccordionSummary expandIcon={<ExpandMoreIcon/>}\n                              sx={(theme) => ({\n                                  color: theme.palette.text.secondary,\n                                  padding: invisible ? 0 : undefined,\n                                  minHeight: \"56px\",\n                                  alignItems: \"center\",\n                                  borderTopLeftRadius: `${theme.shape.borderRadius}px`,\n                                  borderTopRightRadius: `${theme.shape.borderRadius}px`,\n                                  borderBottomLeftRadius: !expandedInternal && !invisible ? `${theme.shape.borderRadius}px` : undefined,\n                                  borderBottomRightRadius: !expandedInternal && !invisible ? `${theme.shape.borderRadius}px` : undefined,\n                                  border: invisible ? \"none\" : undefined,\n                                  borderBottom: invisible ? `1px solid ${theme.palette.divider}` : undefined,\n                                  \"&.Mui-expanded\": {\n                                      borderBottom: `1px solid ${theme.palette.divider}`\n                                  }\n                              })}>\n                {title}\n            </AccordionSummary>\n\n            <AccordionDetails sx={(theme) => ({\n                padding: invisible ? 0 : typeof padding === \"string\" ? padding : theme.spacing(padding),\n                py: theme.spacing(2),\n                border: invisible ? \"none\" : undefined,\n                color: \"inherit\"\n            })}>\n                {children}\n            </AccordionDetails>\n\n        </Accordion>\n    )\n}\n","import React, { useCallback, useState } from \"react\";\nimport { CMSType, FieldProps, ResolvedProperty } from \"../../types\";\nimport { FormControl, FormHelperText } from \"@mui/material\";\nimport { ArrayContainer, FieldDescription, LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { ExpandablePanel } from \"../../core/components/ExpandablePanel\";\nimport { PropertyFieldBinding } from \"../PropertyFieldBinding\";\nimport { getIconForProperty } from \"../../core\";\n\n/**\n * Generic array field that allows reordering and renders the child property\n * as nodes.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function RepeatFieldBinding<T extends Array<any>>({\n                                                             propertyKey,\n                                                             value,\n                                                             error,\n                                                             showError,\n                                                             isSubmitting,\n                                                             setValue,\n                                                             tableMode,\n                                                             property,\n                                                             includeDescription,\n                                                             underlyingValueHasChanged,\n                                                             context,\n                                                             disabled\n                                                         }: FieldProps<T>) {\n\n    if (!property.of)\n        throw Error(\"RepeatFieldBinding misconfiguration. Property `of` not set\");\n\n    if (!property.resolvedProperties || !Array.isArray(property.resolvedProperties))\n        throw Error(\"RepeatFieldBinding - Internal error: Expected array in 'property.resolvedProperties'\");\n\n    const expanded = property.expanded === undefined ? true : property.expanded;\n    const ofProperty: ResolvedProperty<CMSType[]> = property.of as ResolvedProperty<CMSType[]>;\n\n    const [lastAddedId, setLastAddedId] = useState<number | undefined>();\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const buildEntry = useCallback((index: number, internalId: number) => {\n        const childProperty = property.resolvedProperties[index] ?? ofProperty;\n        const fieldProps = {\n            propertyKey: `${propertyKey}.${index}`,\n            disabled,\n            property: childProperty,\n            includeDescription,\n            underlyingValueHasChanged,\n            context,\n            tableMode: false,\n            partOfArray: true,\n            autoFocus: internalId === lastAddedId\n        };\n        return <PropertyFieldBinding {...fieldProps}/>;\n    }, [context, disabled, includeDescription, lastAddedId, ofProperty, property.resolvedProperties, propertyKey, underlyingValueHasChanged]);\n\n    const arrayContainer = <ArrayContainer value={value}\n                                           addLabel={property.name ? \"Add entry to \" + property.name : \"Add entry\"}\n                                           name={propertyKey}\n                                           buildEntry={buildEntry}\n                                           onInternalIdAdded={setLastAddedId}\n                                           disabled={isSubmitting || Boolean(property.disabled)}\n                                           includeAddButton={!property.disabled}\n                                           newDefaultEntry={property.of.defaultValue}/>;\n\n    const title = (<LabelWithIcon icon={getIconForProperty(property)}\n                                  title={property.name}/>);\n\n    return (\n\n        <FormControl fullWidth error={showError}>\n\n            {!tableMode && <ExpandablePanel initiallyExpanded={expanded}\n                                            title={title}>\n                {arrayContainer}\n            </ExpandablePanel>}\n\n            {tableMode && arrayContainer}\n\n            {includeDescription &&\n                <FieldDescription property={property}/>\n            }\n\n            {showError && typeof error === \"string\" &&\n                <FormHelperText error={true}>{error}</FormHelperText>}\n\n        </FormControl>\n    )\n        ;\n}\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport {\n    FormControl,\n    FormHelperText,\n    InputLabel,\n    MenuItem,\n    Paper,\n    Select\n} from \"@mui/material\";\nimport {\n    FastField,\n    FieldProps as FormikFieldProps,\n    useFormikContext\n} from \"formik\";\n\nimport { ArrayContainer, FieldDescription, LabelWithIcon } from \"../components\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { PropertyFieldBinding } from \"../PropertyFieldBinding\";\nimport { EnumValuesChip } from \"../../preview\";\nimport {\n    EnumValueConfig,\n    FieldProps,\n    FormContext,\n    PropertyOrBuilder\n} from \"../../types\";\nimport { ExpandablePanel, getIconForProperty } from \"../../core\";\nimport {\n    DEFAULT_ONE_OF_TYPE,\n    DEFAULT_ONE_OF_VALUE\n} from \"../../core/util/common\";\n\n/**\n * If the `oneOf` property is specified, this fields render each array entry as\n * a `type` select and the corresponding field widget to the selected `type.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function BlockFieldBinding<T extends Array<any>>({\n                                                            propertyKey,\n                                                            value,\n                                                            error,\n                                                            showError,\n                                                            isSubmitting,\n                                                            setValue,\n                                                            tableMode,\n                                                            property,\n                                                            includeDescription,\n                                                            underlyingValueHasChanged,\n                                                            context,\n                                                            disabled\n                                                        }: FieldProps<T>) {\n\n    if (!property.oneOf)\n        throw Error(\"ArrayOneOfField misconfiguration. Property `oneOf` not set\");\n\n    const expanded = property.expanded === undefined ? true : property.expanded;\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const [lastAddedId, setLastAddedId] = useState<number | undefined>();\n\n    const buildEntry = useCallback((index: number, internalId: number) => {\n        return <BlockEntry\n            key={`array_one_of_${index}`}\n            name={`${propertyKey}.${index}`}\n            index={index}\n            value={value[index]}\n            typeField={property.oneOf!.typeField ?? DEFAULT_ONE_OF_TYPE}\n            valueField={property.oneOf!.valueField ?? DEFAULT_ONE_OF_VALUE}\n            properties={property.oneOf!.properties}\n            autoFocus={internalId === lastAddedId}\n            context={context}/>;\n    }, [context, lastAddedId, property.oneOf, propertyKey, value]);\n\n    const title = (\n        <LabelWithIcon icon={getIconForProperty(property)}\n                       title={property.name}/>\n    );\n\n    const body = <ArrayContainer value={value}\n                                 name={propertyKey}\n                                 addLabel={property.name ? \"Add entry to \" + property.name : \"Add entry\"}\n                                 buildEntry={buildEntry}\n                                 onInternalIdAdded={setLastAddedId}\n                                 disabled={isSubmitting || Boolean(property.disabled)}\n                                 includeAddButton={!property.disabled}\n                                 newDefaultEntry={{\n                                     [property.oneOf!.typeField ?? DEFAULT_ONE_OF_TYPE]: Object.keys(property.oneOf.properties)[0]\n                                 }}/>;\n    return (\n\n        <FormControl fullWidth error={showError}>\n\n            {!tableMode &&\n                <ExpandablePanel initiallyExpanded={expanded} title={title}>\n                    {body}\n                </ExpandablePanel>}\n\n            {tableMode && body}\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n            {showError &&\n                typeof error === \"string\" &&\n                <FormHelperText error={true}>{error}</FormHelperText>}\n\n        </FormControl>\n    );\n}\n\ninterface BlockEntryProps {\n    name: string;\n    index: number;\n    value: any;\n    /**\n     * Name of the field to use as the discriminator for type\n     * Defaults to `type`\n     */\n    typeField: string;\n    /**\n     * Name of the  field to use as the value\n     * Defaults to `value`\n     */\n    valueField: string;\n\n    autoFocus: boolean;\n    /**\n     * Record of properties, where the key is the `type` and the value\n     * is the corresponding property\n     */\n    properties: Record<string, PropertyOrBuilder>;\n\n    /**\n     * Additional values related to the state of the form or the entity\n     */\n    context: FormContext<any>;\n\n}\n\nfunction BlockEntry({\n                        name,\n                        index,\n                        value,\n                        typeField,\n                        valueField,\n                        properties,\n                        autoFocus,\n                        context\n                    }: BlockEntryProps) {\n\n    const type = value && value[typeField];\n    const [typeInternal, setTypeInternal] = useState<string | undefined>(type ?? undefined);\n\n    const formikContext = useFormikContext();\n\n    useEffect(() => {\n        if (!type) {\n            updateType(Object.keys(properties)[0]);\n        }\n    }, []);\n\n    useEffect(() => {\n        if (type !== typeInternal) {\n            setTypeInternal(type);\n        }\n    }, [type]);\n\n    const property = typeInternal ? properties[typeInternal] : undefined;\n\n    const enumValuesConfigs: EnumValueConfig[] = Object.entries(properties)\n        .map(([key, property]) => ({\n            id: key,\n            label: property.name ?? key\n        }));\n\n    const typeFieldName = `${name}.${typeField}`;\n    const valueFieldName = `${name}.${valueField}`;\n\n    const fieldProps = property\n        ? {\n            propertyKey: valueFieldName,\n            property,\n            context,\n            autoFocus,\n            tableMode: false\n        }\n        : undefined;\n\n    const updateType = useCallback((newType: any) => {\n        setTypeInternal(newType);\n        formikContext.setFieldTouched(typeFieldName);\n        formikContext.setFieldValue(typeFieldName, newType);\n        formikContext.setFieldValue(valueFieldName, null);\n    }, [typeFieldName, valueFieldName]);\n\n    return (\n        <Paper sx={(theme) => ({\n            padding: theme.spacing(1),\n            my: 1,\n            py: 2\n        })} elevation={0}>\n\n            <FastField\n                required={true}\n                name={typeFieldName}\n            >\n                {(fieldProps: FormikFieldProps) =>\n                    (\n                        <FormControl fullWidth size=\"small\">\n                            <InputLabel\n                                id={`${name}_${index}_select_label`}>\n                                <span>Type</span>\n                            </InputLabel>\n                            <Select\n                                fullWidth\n                                sx={{ marginBottom: 2 }}\n                                labelId={`${name}_${index}_select_label`}\n                                label={\"Type\"}\n                                value={fieldProps.field.value !== undefined && fieldProps.field.value !== null ? fieldProps.field.value : \"\"}\n                                onChange={(evt: any) => {\n                                    const newType = evt.target.value;\n                                    updateType(newType);\n                                }}\n                                renderValue={(enumKey: any) =>\n                                    <EnumValuesChip\n                                        enumKey={enumKey}\n                                        enumValues={enumValuesConfigs}\n                                        small={true}/>\n                                }>\n                                {enumValuesConfigs\n                                    .map((enumValueConfig) => {\n                                        const enumKey = enumValueConfig.id;\n                                        return (\n                                            <MenuItem\n                                                key={`select_${name}_${index}_${enumKey}`}\n                                                value={enumKey}>\n                                                <EnumValuesChip\n                                                    enumKey={enumKey}\n                                                    enumValues={enumValuesConfigs}\n                                                    small={true}/>\n                                            </MenuItem>\n                                        );\n                                    })}\n                            </Select>\n                        </FormControl>\n                    )\n                }\n            </FastField>\n\n            {fieldProps && (\n                <FormControl fullWidth\n                             key={`form_control_${name}_${typeInternal}`}>\n                    <PropertyFieldBinding {...fieldProps}/>\n                </FormControl>\n            )}\n\n        </Paper>\n    );\n}\n","import React, { useDeferredValue, useEffect, useRef } from \"react\";\n\nimport { styled } from \"@mui/material/styles\";\n\nimport {\n    Box,\n    darken,\n    FormControl,\n    FormHelperText,\n    lighten,\n    Theme\n} from \"@mui/material\";\n\n// @ts-ignore\nimport MarkdownIt from \"markdown-it\";\nimport MdEditor, { Plugins } from \"react-markdown-editor-lite\";\n\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { FieldProps } from \"../../types\";\nimport { fieldBackground } from \"./utils\";\nimport { getIconForProperty } from \"../../core\";\n\nconst mdParser = new MarkdownIt();\nMdEditor.use(Plugins.AutoResize, {\n    min: 100\n})\nMdEditor.unuse(Plugins.Clear);\n\n/**\n * Render a markdown field that allows edition and seeing the preview.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function MarkdownFieldBinding({\n                                         propertyKey,\n                                         value,\n                                         setValue,\n                                         error,\n                                         showError,\n                                         disabled,\n                                         autoFocus,\n                                         touched,\n                                         property,\n                                         tableMode,\n                                         includeDescription,\n                                         context\n                                     }: FieldProps<string>) {\n\n    const [internalValue, setInternalValue] = React.useState(value);\n    const valueRef = useRef(value);\n\n    const deferred = useDeferredValue({\n        internalValue,\n        value\n    });\n\n    useEffect(() => {\n        valueRef.current = value;\n        setInternalValue(value);\n    }, [value]);\n\n    useEffect(() => {\n        if (deferred.internalValue !== valueRef.current)\n            setValue(deferred.internalValue);\n    }, [deferred]);\n\n    return (\n        <StyledFormControl\n            required={property.validation?.required}\n            error={showError}\n            fullWidth>\n\n            {!tableMode && <FormHelperText filled>\n                <LabelWithIcon icon={getIconForProperty(property)}\n                               title={property.name}/>\n            </FormHelperText>}\n\n            <MdEditor value={internalValue ?? \"\"}\n                      readOnly={disabled}\n                      renderHTML={text => mdParser.render(text)}\n                      view={{\n                          menu: true,\n                          md: true,\n                          html: false\n                      }}\n                      onChange={({\n                                     html,\n                                     text\n                                 }) => {\n                          setInternalValue(text ?? null);\n                      }}/>\n\n            <Box display={\"flex\"}>\n                <Box flexGrow={1}>\n                    {showError &&\n                        typeof error === \"string\" &&\n                        <FormHelperText error={true}>{error}</FormHelperText>}\n                    {includeDescription &&\n                        <FieldDescription property={property}/>}\n                </Box>\n            </Box>\n\n        </StyledFormControl>\n    );\n\n}\n\nconst StyledFormControl = styled(FormControl)((\n    { theme }: {\n        theme: Theme\n    }\n) => (`\n  @font-face {\n    font-family: rmel-iconfont;\n    src: url(data:application/vnd.ms-fontobject;base64,fBkAAMAYAAABAAIAAAAAAAIABQMAAAAAAAABAJABAAAAAExQAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAB9vj4gAAAAAAAAAAAAAAAAAAAAAAABoAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdAAAAA4AUgBlAGcAdQBsAGEAcgAAABYAVgBlAHIAcwBpAG8AbgAgADEALgAwAAAAGgByAG0AZQBsAC0AaQBjAG8AbgBmAG8AbgB0AAAAAAAAAQAAAAsAgAADADBHU1VCsP6z7QAAATgAAABCT1MvMj3jT5QAAAF8AAAAVmNtYXBA5I9dAAACPAAAAwhnbHlmMImhbQAABXwAAA9gaGVhZBtQ+k8AAADgAAAANmhoZWEH3gObAAAAvAAAACRobXR4aAAAAAAAAdQAAABobG9jYTX6MgAAAAVEAAAANm1heHABMAB7AAABGAAAACBuYW1lc9ztwgAAFNwAAAKpcG9zdCcpv64AABeIAAABNQABAAADgP+AAFwEAAAAAAAEAAABAAAAAAAAAAAAAAAAAAAAGgABAAAAAQAA4uPbB18PPPUACwQAAAAAANwY2ykAAAAA3BjbKQAA//8EAAMBAAAACAACAAAAAAAAAAEAAAAaAG8ADAAAAAAAAgAAAAoACgAAAP8AAAAAAAAAAQAAAAoAHgAsAAFERkxUAAgABAAAAAAAAAABAAAAAWxpZ2EACAAAAAEAAAABAAQABAAAAAEACAABAAYAAAABAAAAAAABBAABkAAFAAgCiQLMAAAAjwKJAswAAAHrADIBCAAAAgAFAwAAAAAAAAAAAAAAAAAAAAAAAAAAAABQZkVkAEDnbe2iA4D/gABcA4AAgAAAAAEAAAAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAUAAAADAAAALAAAAAQAAAHMAAEAAAAAAMYAAwABAAAALAADAAoAAAHMAAQAmgAAABYAEAADAAbnbelB7TztRe1h7XXteO2A7Y3tov//AADnbelB7TvtRO1f7W/td+2A7Yztn///AAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAWABYAFgAYABoAHgAqACwALAAuAAAAAQAEAAUAAwAGAAcACAAJAAoACwAMAA0ADgAPABAAEQASABMAAgAUABUAFgAXABgAGQAAAQYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAABPAAAAAAAAAAZAADnbQAA520AAAABAADpQQAA6UEAAAAEAADtOwAA7TsAAAAFAADtPAAA7TwAAAADAADtRAAA7UQAAAAGAADtRQAA7UUAAAAHAADtXwAA7V8AAAAIAADtYAAA7WAAAAAJAADtYQAA7WEAAAAKAADtbwAA7W8AAAALAADtcAAA7XAAAAAMAADtcQAA7XEAAAANAADtcgAA7XIAAAAOAADtcwAA7XMAAAAPAADtdAAA7XQAAAAQAADtdQAA7XUAAAARAADtdwAA7XcAAAASAADteAAA7XgAAAATAADtgAAA7YAAAAACAADtjAAA7YwAAAAUAADtjQAA7Y0AAAAVAADtnwAA7Z8AAAAWAADtoAAA7aAAAAAXAADtoQAA7aEAAAAYAADtogAA7aIAAAAZAAAAAABmAMwBHgGEAbwB/gJmAsgC/gM0A3IDogRABKgE7gUuBXAFygYKBmoGpAbEBugHRgewAAAABQAAAAADVgLWAAsAGAAlADQAQAAAEyEyFhQGByEuATQ2Fz4BNyEeARQGIyEiJgM0NjchHgEUBiMhIiY3PgEzITIeARQOASMhIiYnFhQPAQYmNRE0NhfWAlQSGRkS/awSGRnaARgTAWASGRkS/qASGfQZEgJUEhkZEv2sEhnzARgTAWAMFAsLFAz+oBIZOQgIkgseHgsC1RklGAEBGCUZ8hMYAQEYJRkZ/oUTGAEBGCUZGdkSGQsVFxQMGoYGFgaVDAwRASoRDAwAAAAADAAAAAADqwKrAA8AEwAXABsAHwAjACcAMwA3ADsAPwBDAAABIQ4BBwMeARchPgE3ES4BBTMVIxUzFSMnMxUjFTMVKwI1MzUjNTMBISImNDYzITIWFAY3IzUzNSM1MxcjNTM1IzUzA1X9ViQwAQEBMSQCqiQxAQEx/lxWVlZWgFZWVlYqVlZWVgFV/wASGBgSAQASGBgZVlZWVoBWVlZWAqsBMST+ViQxAQExJAGqJDF/VipW1lYqVlYqVv6AGCQZGSQYqlYqVtZWKlYAAwAAAAADKwMAAA8AHwAzAAAlHgEXIT4BNxEuASchDgEHMyEyFhcRDgEHIS4BJxE+ASUnJisBIg8BIyIGFBYzITI2NCYjAQABMCQBViQwAQEwJP6qJDABgAEAExcBARcT/wATFwEBFwEoHgsStBILHmsTFxcTAgARGRkRVSQwAQEwJAGrJDABATAkFxT+qxEZAQEZEQFVFBfVHg0NHhcnFxcnFwADAAAAAAOrAtkAFgAtAD4AAAEVBg8BBiIvASY0PwEnJjQ/ATYyHwEWBTc2NC8BJiIPAQYHFRYfARYyPwE2NCcBJyYGBwMGFh8BFjY3EzYmJwOrAQmwBxEHHgYGk5MGBh4HEQewCf0PkwYGHwYSBrAJAQEJsAcRBx4GBgFCKQkPBOMCBwgoCQ8E4gMHCQGIEA0KsAYGHgcRBpOTBhIGHgYGsAoVkwYRBx4GBrAKDRANCrAGBh4GEgYB2Q8DBwj9jAgQAw4DBwgCcwgPBAACAAAAAAOaAm8AEAAhAAAlJzc2NCYiDwEGFB8BFjI2NCU3JyY0NjIfARYUDwEGIiY0AXOmpg0ZJAzEDQ3EDiEaAQ2mpg0aIQ7EDQ3EDiEa2qamDiEaDcQNIg3EDRohDqamDCQZDcQNIg3EDRkkAAAAAwAAAAADuAKsAAsAFwAjAAABDgEHHgEXPgE3LgEDLgEnPgE3HgEXDgEDDgEHHgEXPgE3LgECAJjrNTXrmJjrNTXrmFZwAgJwVlZwAgJwVjRDAQFDNDRDAQFDAqwCpIaGpAICpIaGpP4OAnBWVnACAnBWVnABPgFDNDRDAQFDNDRDAAAABQAAAAADgAKrAAsAFwAjADAAQAAAEyEyNjQmIyEiBhQWFyE+ATQmJyEOARQWEyEyNjQmIyEiBhQWJx4BFyE+ATQmJyEOASUhHgEXEQ4BByEuATURNDarAQATFxcT/wARGRkRAQATFxcT/wARGRkRAQATFxcT/wARGRkaARkRAQATFxcT/wARGQHUAQARGQEBGRH/ABMXFwEAFycXFycXqwEZIhkBARkiGQFVFycXFycX1RMXAQEXJhcBARcYARcT/gARGQEBGRECABMXAAAAAAMAAAAAA6sCVgAZACYAQAAAASMiBhQWOwEeARcOAQcjIgYUFjsBPgE3LgEFHgEXIT4BNCYnIQ4BFyMuASc+ATczMjY0JisBDgEHHgEXMzI2NCYC1YASGBgSgDdIAQFIN4ASGBgSgFt4AwN4/iUBGBIBABIYGBL/ABIYVYA3SAEBSDeAEhgYEoBbeAMDeFuAEhgYAlUYJBkBSTY2SQEZJBgCeFtbeNMSGAEBGCQYAQEYkgFJNjZJARkkGAJ4W1t4AhgkGQABAAAAAAOsAisAHgAAAS4BJw4BBwYWFxY2Nz4BNzIWFwcGFhczPgE3NS4BBwMSO5ZVh9Q4ChMXFCMJK6FnP28sURMTHu4SGAECMRYBvDQ6AQKJchcqCAYPElZpASslUhYxAgEYEu8dFBMAAAABAAAAAAOyAisAHgAAAQ4BBycmBgcVHgEXMz4BLwE+ATMeARceATc+AScuAQIUVZY7URYxAgEYEu4eFBNSLW8+Z6ErCSQTFxMKOdMCKwE6NFAUFB3vEhgBAjEWUiUrAWlWEg8GCCoXcokAAAADAAAAAAL1Ar8AFAAcACQAAAE+ATcuAScjDgEHER4BFyE+ATc0JiUzHgEUBgcjEyM1Mx4BFAYCkyEpAQJmTu8UGQEBGRQBB0lpAjT+1IgdJycdiJ+fnx0nJwGKF0QkTmYCARoT/d4TGgECYUk1UtkBJjsmAf7viQEmOyYAAQAAAAADEgK/ABwAAAEeARczAyMOARQWFzM+ATQmJyMTMz4BNCYnIw4BAaUBJh0hnDsdJiYd5B0mJh0hnDsdJiYd5B0mAnodJgH+lAEmOicBASc6JgEBbAEmOicBAScABgAAAAADlgLWAAsAFwAjAEEAUgBuAAABIT4BNCYnIQ4BFBYBIQ4BFBYXIT4BNCYDIQ4BFBYXIT4BNCYFIyIGFBY7ARUjIgYUFjsBFSMiBhQWOwEyNjc1LgEDMxUeATI2PQE0JisBIgYUFhcjIgYUFjsBBwYdARQWOwEyNjQmKwE3Nj0BLgEBawIAEhgYEv4AEhkZAhL+ABIZGRICABIYGBL+ABIZGRICABIYGP1YVQkMDAlAFQoLCwoVQAkMDAlVCgsBAQtfFQELEwwMCSsJDAxeVQkMDAk3RwUMCVUKCwsKN0gFAQsCVQEYJBgBARgkGP5VARgkGAEBGCQYAQEBGCQYAQEYJBjVDBIMFgwSDBYMEgwMCYAJDAHWawkMDAmACQwMEgzWDBIMVAYICQkMDBIMVAYICQkMAAAAAAYAAAAAA4sCwAAIABEAGgAmADIAPwAAEw4BFBYyNjQmAw4BFBYyNjQmAw4BFBYyNjQmFyE+ATQmJyEOARQWNyE+ATQmJyEOARQWAx4BFyE+ATQmJyEOAbUbJCQ3JCQcGyQkNyQkHBskJDYlJI8CABIYGBL+ABIYGBICABIYGBL+ABIYGBkBGBICABIYGBL+ABIYAcABJDYkJDYkAQEBJDYkJDYk/gEBJDYkJDYkagEYJBgBARgkGP8BGCQYAQEYJBgBKhIYAQEYJBgBARgAAAACAAAAAANWAlYAFgAtAAAlMjY/ATY9AS4BKwEiBh0BFBYXMwcGFgUyNj8BNj0BNCYrASIGBxUeARczBwYWATIRGwc9CQEYEqsSGBgSViwOIAHMEBsIPAkYEqsSGAEBGBJVLA0gqxEOeRIUwhIYGBKrEhgBWB4zAREOeRIUwhIYGBKrEhgBWB4zAAAAAAMAAAAAA4ACwAAIABkAJQAAJT4BNzUjFR4BAR4BFzMVMzUzPgE0JichDgEDIT4BNCYnIQ4BFBYCACQwAaoBMP75ASQblqqWGyQkG/4qGyQrAqoSGRkS/VYSGRlAATAkKyskMAI/GyQBgIABJDYkAQEk/noBGCQYAQEYJBgAAAAAAgAA//8DKwMBABsAKAAAJT4BNxEuASIGBxEUBgcGLgI1ES4BIgYHER4BBx4BMyEyNjQmIyEiBgIiYnoCAR4tHgFBNSFBNR0BHi0eAQOm1AEYEgIAEhgYEv4AEhitD5NlARcWHh4W/uQ3UwwHDys8IwEgFh4eFv7gdpR2EhkZJBgYAAAAAwAAAAADcALHAAsALQA5AAATIT4BNCYjISIGFBYFISIGFBYXITIWFxYGByM1LgEPAQYUHwEWNjc1Mz4BJy4BBSMiBhQWFzM+ATQmwAJVEhkZEv2rEhgYAgv+BxIYGBICBiAzBgUxKGABGQtMBgZMDBgBVU1iBQhk/m2rEhgYEqsSGBgCcQEYJBgYJBisGCQYAScgKTkCIg8KCkwHEQdMCgoPIgJrTkRV/xgkGAEBGCQYAAAAAgAAAAADlgLAABQAKAAAARQWFzMRHgEyNjcRMz4BNCYnIQ4BAzMVFBYyNjc1MzI2NCYnIQ4BFBYBayQclQEkNiQBlRwkJBz+VhwkwEAkNyQBQBskJBv/ABwkJAKAGyQB/kAbJCQbAcABJDYkAQEk/tDrGyQkG+skNyQBASQ3JAAKAAAAAAN4AvgADwAWABoAIQAlACkALQA0ADgAPwAAASEOAQcRHgEXIT4BNxEuAQEjIiY9ATM1IzUzNSM1NDY7ARMjNTM1IzUzNSM1MxMjNTMVFAY3IzUzNSM1MzIWFQMs/aggKgEBKiACWCAqAQEq/h5xDxaWlpaWFg9x4ZaWlpaWlrxxlhYWlpaWcQ8WAvcBKiD9qCAqAQEqIAJYICr9XhYPcUuWS3EPFv2olkuWS5b9qJZxDxbhlkuWFg8AAAACAAD//wOAAwAADwAgAAAlES4BJyEOAQcRHgEXIT4BJRc3NjIfARYGIyEiJj8BPgEDgAEwJP2qJDABATAkAlYkMP39WYUHFAeVCAwN/gEOCwhqBxRVAlYkMAEBMCT9qiQwAQEw+2yqCAnHCxcXC4kIAQAAAAEAAAAAAzUCNgAQAAABBwYUFjI/ARcWMjY0LwEmIgHZ/hAhLBHX1xEsIRD+EC4CJv4RLCEQ19cQISwR/hAAAAABAAAAAAM1AjYAEgAAAQcnJiciDgEWHwEWMj8BNjQuAQLW1tcQFxEbDQYM/hEsEf4QIS0CJtfXDwESICAM/hAQ/hAtIAEAAAAEAAAAAANrAusAEAAhADMARAAANzMVFBYyNj0BNCYrASIGFBYTIyIGFBY7ATI2PQE0JiIGFQEyNj0BMzI2NCYrASIGHQEUFhM1NCYiBh0BFBY7ATI2NCYjyWgeLB0dFpwWHR1+aBYdHRacFh0dLB4BahYeaBYdHRacFh0dSh4sHR0WnBYdHRaxaBYdHRacFh0dLB4Bnh4sHR0WnBYdHRb9Xx0WaB4sHR0WnBYdAjloFh0dFpwWHR0sHgAAAAQAAAAAA1QC1AARACMANABGAAATDgEHFR4BFzM+ATQmKwE1NCYnPgE9ATMyNjQmJyMOAQcVHgEBIyIGFBYXMz4BNzUuASIGFQMeATsBFRQWMjY3NS4BJyMOAd0VGwEBGxWRFRsbFWEcFBQcYRUbGxWRFRsBARsCK2EVGxsVkRUbAQEbKRySARsVYRwpGwEBGxWRFRsBHwEbFZEVGwEBGykcYRUbwwEbFWEcKRsBARsVkRUb/qscKRsBARsVkRUbGxUBtRQcYRUbGxWRFRsBARsAAAAAAAASAN4AAQAAAAAAAAAVAAAAAQAAAAAAAQANABUAAQAAAAAAAgAHACIAAQAAAAAAAwANACkAAQAAAAAABAANADYAAQAAAAAABQALAEMAAQAAAAAABgANAE4AAQAAAAAACgArAFsAAQAAAAAACwATAIYAAwABBAkAAAAqAJkAAwABBAkAAQAaAMMAAwABBAkAAgAOAN0AAwABBAkAAwAaAOsAAwABBAkABAAaAQUAAwABBAkABQAWAR8AAwABBAkABgAaATUAAwABBAkACgBWAU8AAwABBAkACwAmAaUKQ3JlYXRlZCBieSBpY29uZm9udApybWVsLWljb25mb250UmVndWxhcnJtZWwtaWNvbmZvbnRybWVsLWljb25mb250VmVyc2lvbiAxLjBybWVsLWljb25mb250R2VuZXJhdGVkIGJ5IHN2ZzJ0dGYgZnJvbSBGb250ZWxsbyBwcm9qZWN0Lmh0dHA6Ly9mb250ZWxsby5jb20ACgBDAHIAZQBhAHQAZQBkACAAYgB5ACAAaQBjAG8AbgBmAG8AbgB0AAoAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdABSAGUAZwB1AGwAYQByAHIAbQBlAGwALQBpAGMAbwBuAGYAbwBuAHQAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdABWAGUAcgBzAGkAbwBuACAAMQAuADAAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdABHAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAHMAdgBnADIAdAB0AGYAIABmAHIAbwBtACAARgBvAG4AdABlAGwAbABvACAAcAByAG8AagBlAGMAdAAuAGgAdAB0AHAAOgAvAC8AZgBvAG4AdABlAGwAbABvAC4AYwBvAG0AAAAAAgAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAQIBAwEEAQUBBgEHAQgBCQEKAQsBDAENAQ4BDwEQAREBEgETARQBFQEWARcBGAEZARoBGwADdGFiCGtleWJvYXJkBmRlbGV0ZQpjb2RlLWJsb2NrBGNvZGUKdmlzaWJpbGl0eQp2aWV3LXNwbGl0BGxpbmsEcmVkbwR1bmRvBGJvbGQGaXRhbGljDGxpc3Qtb3JkZXJlZA5saXN0LXVub3JkZXJlZAVxdW90ZQ1zdHJpa2V0aHJvdWdoCXVuZGVybGluZQR3cmFwCWZvbnQtc2l6ZQRncmlkBWltYWdlC2V4cGFuZC1sZXNzC2V4cGFuZC1tb3JlD2Z1bGxzY3JlZW4tZXhpdApmdWxsc2NyZWVuAAAAAAA=);\n    src: url(data:font/ttf;base64,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) format(\"truetype\")\n  }\n\n  .rmel-iconfont {\n    font-family: rmel-iconfont !important;\n    font-size: 16px;\n    font-style: normal;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale\n  }\n\n  .rmel-icon-tab:before {\n    content: \"\\\\e76d\"\n  }\n\n  .rmel-icon-keyboard:before {\n    content: \"\\\\ed80\"\n  }\n\n  .rmel-icon-delete:before {\n    content: \"\\\\ed3c\"\n  }\n\n  .rmel-icon-code-block:before {\n    content: \"\\\\e941\"\n  }\n\n  .rmel-icon-code:before {\n    content: \"\\\\ed3b\"\n  }\n\n  .rmel-icon-visibility:before {\n    content: \"\\\\ed44\"\n  }\n\n  .rmel-icon-view-split:before {\n    content: \"\\\\ed45\"\n  }\n\n  .rmel-icon-link:before {\n    content: \"\\\\ed5f\"\n  }\n\n  .rmel-icon-redo:before {\n    content: \"\\\\ed60\"\n  }\n\n  .rmel-icon-undo:before {\n    content: \"\\\\ed61\"\n  }\n\n  .rmel-icon-bold:before {\n    content: \"\\\\ed6f\"\n  }\n\n  .rmel-icon-italic:before {\n    content: \"\\\\ed70\"\n  }\n\n  .rmel-icon-list-ordered:before {\n    content: \"\\\\ed71\"\n  }\n\n  .rmel-icon-list-unordered:before {\n    content: \"\\\\ed72\"\n  }\n\n  .rmel-icon-quote:before {\n    content: \"\\\\ed73\"\n  }\n\n  .rmel-icon-strikethrough:before {\n    content: \"\\\\ed74\"\n  }\n\n  .rmel-icon-underline:before {\n    content: \"\\\\ed75\"\n  }\n\n  .rmel-icon-wrap:before {\n    content: \"\\\\ed77\"\n  }\n\n  .rmel-icon-font-size:before {\n    content: \"\\\\ed78\"\n  }\n\n  .rmel-icon-grid:before {\n    content: \"\\\\ed8c\"\n  }\n\n  .rmel-icon-image:before {\n    content: \"\\\\ed8d\"\n  }\n\n  .rmel-icon-expand-less:before {\n    content: \"\\\\ed9f\"\n  }\n\n  .rmel-icon-expand-more:before {\n    content: \"\\\\eda0\"\n  }\n\n  .rmel-icon-fullscreen-exit:before {\n    content: \"\\\\eda1\"\n  }\n\n  .rmel-icon-fullscreen:before {\n    content: \"\\\\eda2\"\n  }\n\n  .rc-md-editor {\n    padding-bottom: 1px;\n    position: relative;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex;\n    overflow: hidden;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n    -webkit-flex-direction: column;\n    -ms-flex-direction: column;\n    flex-direction: column;\n            border-radius: 6px;\n            background-color: ${fieldBackground(theme)};\n  }\n\n  .rc-md-editor.full {\n    width: 100%;\n    height: 100% !important;\n    position: fixed;\n    left: 0;\n    top: 0;\n    z-index: 1000\n  }\n\n  .rc-md-editor .editor-container {\n    -webkit-box-flex: 1;\n    -webkit-flex: 1;\n    -ms-flex: 1;\n    flex: 1;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex;\n    width: 100%;\n    min-height: 0;\n    position: relative;\n                background-color: ${fieldBackground(theme)};\n\n  }\n\n  .rc-md-editor .editor-container > .section {\n    -webkit-box-flex: 1;\n    -webkit-flex-grow: 1;\n    -ms-flex-positive: 1;\n    flex-grow: 1;\n    -webkit-flex-shrink: 1;\n    -ms-flex-negative: 1;\n    flex-shrink: 1;\n    -webkit-flex-basis: 1px;\n    -ms-flex-preferred-size: 1px;\n    flex-basis: 1px;\n    padding: 4px;\n    \n            border: none\n  }\n\n  .rc-md-editor .editor-container > .section.in-visible {\n    display: none\n  }\n\n  .rc-md-editor .editor-container > .section > .section-container {\n    padding: 8x 16px 16px\n  }\n  \n  .rc-md-editor .editor-container > .section:last-child {\n    border-radius: unset\n  }\n\n  .rc-md-editor .editor-container .sec-md {\n    min-height: 0;\n    min-width: 0\n  }\n\n  .rc-md-editor .editor-container .sec-md .input {\n    display: block;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    width: 100%;\n    height: 100%;\n    overflow-y: scroll;\n    border: none;\n    resize: none;\n    outline: none;\n    min-height: 0;\n    color: inherit;\n    font-size: 14px;\n    line-height: 1.7;   \n             background-color: ${fieldBackground(theme)};\n\n  }\n\n  .rc-md-editor .editor-container .sec-html {\n    min-height: 0;\n    min-width: 0;         \n       background-color: ${fieldBackground(theme)};\n\n  }\n\n  .rc-md-editor .editor-container .sec-html .html-wrap {\n    height: 100%;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    overflow: auto\n  }\n\n  .custom-html-style {\n    color: inherit\n  }\n\n  .custom-html-style h1 {\n    font-size: 32px;\n    padding: 0;\n    border: none;\n    font-weight: 700;\n    margin: 32px 0;\n    line-height: 1.2\n  }\n\n  .custom-html-style h2 {\n    font-size: 24px;\n    padding: 0;\n    border: none;\n    font-weight: 700;\n    margin: 24px 0;\n    line-height: 1.7\n  }\n\n  .custom-html-style h3 {\n    font-size: 18px;\n    margin: 18px 0;\n    padding: 0;\n    line-height: 1.7;\n    border: none\n  }\n\n  .custom-html-style p {\n    font-size: 14px;\n    line-height: 1.7;\n    margin: 8px 0\n  }\n\n  .custom-html-style a {\n    color: ${darken(theme.palette.text.secondary, 0.00)}\n  }\n\n  .custom-html-style a:hover {\n    text-decoration: none\n  }\n\n  .custom-html-style strong {\n    font-weight: 700\n  }\n\n  .custom-html-style ol, .custom-html-style ul {\n    font-size: 14px;\n    line-height: 28px;\n    padding-left: 36px\n  }\n\n  .custom-html-style li {\n    margin-bottom: 8px;\n    line-height: 1.7\n  }\n\n  .custom-html-style hr {\n    margin-top: 20px;\n    margin-bottom: 20px;\n    border: 0;\n    border-top: 1px solid ${theme.palette.divider}\n  }\n\n  .custom-html-style pre {\n    display: block;\n    padding: 20px;\n    line-height: 28px;\n    word-break: break-word\n  }\n\n  .custom-html-style code, .custom-html-style pre {\n    background-color: ${darken(theme.palette.background.default, 0.10)};\n    font-size: 14px;\n    border-radius: 0;\n    overflow-x: auto\n  }\n\n  .custom-html-style code {\n    padding: 3px 0;\n    margin: 0;\n    word-break: normal\n  }\n\n  .custom-html-style code:after, .custom-html-style code:before {\n    letter-spacing: 0\n  }\n\n  .custom-html-style blockquote {\n    position: relative;\n    margin: 16px 0;\n    padding: 5px 8px 5px 30px;\n    background: none repeat scroll 0 0 ${\"rgb(39 39 41)\"};\n    color: inherit;\n    border: none;\n    border-left: 10px solid #d6dbdf\n  }\n\n  .custom-html-style img, .custom-html-style video {\n    max-width: 100%\n  }\n\n  .custom-html-style table {\n    font-size: 14px;\n    line-height: 1.7;\n    max-width: 100%;\n    overflow: auto;\n    border: 1px solid ${theme.palette.divider};\n    border-collapse: collapse;\n    border-spacing: 0;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box\n  }\n\n  .custom-html-style table td, .custom-html-style table th {\n    word-break: break-all;\n    word-wrap: break-word;\n    white-space: normal\n  }\n\n  .custom-html-style table tr {\n    border: 1px solid ${theme.palette.divider}\n  }\n\n  .custom-html-style table tr:nth-of-type(2n) {\n    background-color: transparent\n  }\n\n  .custom-html-style table th {\n    text-align: center;\n    font-weight: 700;\n    border: 1px solid ${theme.palette.divider};\n    padding: 10px 6px;\n    background-color: #f5f7fa;\n    word-break: break-word\n  }\n\n  .custom-html-style table td {\n    border: 1px solid ${theme.palette.divider};\n    text-align: left;\n    padding: 10px 15px;\n    word-break: break-word;\n    min-width: 60px\n  }\n\n  .rc-md-editor .drop-wrap {\n    display: block;\n    position: absolute;\n    left: 0;\n    top: 28px;\n    z-index: 2;\n    min-width: 20px;\n    padding: 10px 0;\n    text-align: center;\n    background-color: ${darken(theme.palette.background.default, 0.00)};\n    border-color: ${theme.palette.divider};\n    border-style: solid;\n    border-width: 1px\n  }\n\n  .rc-md-editor .drop-wrap.hidden {\n    display: none !important\n  }\n\n  .rc-md-editor .rc-md-navigation {\n    min-height: 38px;\n    padding: 0 8px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    border-bottom: 1px solid ${theme.palette.divider};\n    font-size: 16px;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-orient: horizontal;\n    -webkit-box-direction: normal;\n    -webkit-flex-direction: row;\n    -ms-flex-direction: row;\n    flex-direction: row;\n    -webkit-box-pack: justify;\n    -webkit-justify-content: space-between;\n    -ms-flex-pack: justify;\n    justify-content: space-between;\n    \n            color: \"inherit\",\n            background-color: ${theme.palette.mode === \"light\" ? \"rgb(39 39 41)\" : \"rgb(39 39 41)\"};\n        \n  }\n\n  .rc-md-editor .rc-md-navigation.in-visible {\n    display: none\n  }\n\n  .rc-md-editor .rc-md-navigation .navigation-nav {\n    -webkit-box-align: center;\n    -webkit-align-items: center;\n    -ms-flex-align: center;\n    align-items: center;\n    -webkit-box-pack: center;\n    -webkit-justify-content: center;\n    -ms-flex-pack: center;\n    justify-content: center;\n    font-size: 14px;\n    color: ${darken(theme.palette.text.secondary, 0.00)};\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap, .rc-md-editor .rc-md-navigation .navigation-nav {\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-orient: horizontal;\n    -webkit-box-direction: normal;\n    -webkit-flex-direction: row;\n    -ms-flex-direction: row;\n    flex-direction: row\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap {\n    -webkit-flex-wrap: wrap;\n    -ms-flex-wrap: wrap;\n    flex-wrap: wrap\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap .button {\n    position: relative;\n    min-width: 22px;\n    height: 28px;\n    margin-left: 3px;\n    margin-right: -2px;\n    display: inline-block;\n    cursor: pointer;\n    line-height: 28px;\n    text-align: center;\n    color: ${theme.palette.text.secondary};\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap .button:hover {\n    color: ${darken(theme.palette.text.secondary, 0.20)};\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap .button.disabled {\n    color: ${darken(theme.palette.text.disabled, 0.00)};\n    cursor: not-allowed\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap .button:first-of-type {\n    margin-left: 0\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap .button:last-child {\n    margin-right: 0\n  }\n\n  .rc-md-editor .rc-md-navigation .button-wrap .rmel-iconfont {\n    font-size: 18px\n  }\n\n  .rc-md-editor .rc-md-navigation li, .rc-md-editor .rc-md-navigation ul {\n    list-style: none;\n    margin: 0;\n    padding: 0\n  }\n\n  .rc-md-editor .rc-md-navigation .h1, .rc-md-editor .rc-md-navigation .h2, .rc-md-editor .rc-md-navigation .h3, .rc-md-editor .rc-md-navigation .h4, .rc-md-editor .rc-md-navigation .h5, .rc-md-editor .rc-md-navigation .h6, .rc-md-editor .rc-md-navigation h1, .rc-md-editor .rc-md-navigation h2, .rc-md-editor .rc-md-navigation h3, .rc-md-editor .rc-md-navigation h4, .rc-md-editor .rc-md-navigation h5, .rc-md-editor .rc-md-navigation h6 {\n    font-family: inherit;\n    font-weight: 500;\n    color: inherit;\n    padding: 0;\n    margin: 0;\n    line-height: 1.1\n  }\n\n  .rc-md-editor .rc-md-navigation h1 {\n    font-size: 34px\n  }\n\n  .rc-md-editor .rc-md-navigation h2 {\n    font-size: 30px\n  }\n\n  .rc-md-editor .rc-md-navigation h3 {\n    font-size: 24px\n  }\n\n  .rc-md-editor .rc-md-navigation h4 {\n    font-size: 18px\n  }\n\n  .rc-md-editor .rc-md-navigation h5 {\n    font-size: 14px\n  }\n\n  .rc-md-editor .rc-md-navigation h6 {\n    font-size: 12px\n  }\n\n  .rc-md-editor .tool-bar {\n    position: absolute;\n    z-index: 1;\n    right: 8px;\n    top: 8px\n  }\n\n  .rc-md-editor .tool-bar .button {\n    min-width: 24px;\n    height: 28px;\n    margin-right: 5px;\n    display: inline-block;\n    cursor: pointer;\n    font-size: 14px;\n    line-height: 28px;\n    text-align: center;\n    color: #999\n  }\n\n  .rc-md-editor .tool-bar .button:hover {\n    color: inherit\n  }\n\n  .rc-md-editor .rc-md-divider {\n    display: block;\n    width: 1px;\n    background-color: ${darken(theme.palette.background.paper, 0.0)}\n  }\n\n  .rc-md-editor .table-list.wrap {\n    position: relative;\n    margin: 0 10px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box\n  }\n\n  .rc-md-editor .table-list.wrap .list-item {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: inline-block;\n    width: 20px;\n    height: 20px;\n    background-color: ${darken(theme.palette.background.paper, 0.05)};\n    border-radius: 4px\n  }\n\n  .rc-md-editor .table-list.wrap .list-item.active {\n    background: ${lighten(theme.palette.background.paper, 0.20)}\n  }\n\n  .rc-md-editor .tab-map-list .list-item {\n    width: 120px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box\n  }\n\n  .rc-md-editor .tab-map-list .list-item:hover {\n    background: ${darken(theme.palette.background.default, 0.10)}\n  }\n\n  .rc-md-editor .tab-map-list .list-item.active {\n    font-weight: 700\n  }\n\n  .rc-md-editor .header-list .list-item {\n    width: 100px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    padding: 8px 0\n  }\n\n  .rc-md-editor .header-list .list-item:hover {\n    background: ${darken(theme.palette.background.default, 0.10)}\n  }\n\n`\n));\n","import {\n    CMSType,\n    EntityReference,\n    GeoPoint,\n    ResolvedArrayProperty,\n    ResolvedMapProperty,\n    ResolvedProperties,\n    ResolvedProperty\n} from \"../types\";\nimport * as yup from \"yup\";\nimport {\n    AnySchema,\n    ArraySchema,\n    BooleanSchema,\n    DateSchema,\n    NumberSchema,\n    ObjectSchema,\n    StringSchema\n} from \"yup\";\nimport { enumToObjectEntries } from \"../core/util/enums\";\nimport { getValueInPath, hydrateRegExp, isPropertyBuilder } from \"../core\";\n\n// Add custom unique function for array values\ndeclare module \"yup\" {\n    // tslint:disable-next-line\n    interface ArraySchema<T> {\n        uniqueInArray(mapper: (a: T) => T, message: string): ArraySchema<T>;\n    }\n}\nyup.addMethod(yup.array, \"uniqueInArray\", function (\n    mapper = (a: any) => a,\n    message: string\n) {\n    return this.test(\"uniqueInArray\", message, values => {\n        return !values || values.length === new Set(values.map(mapper)).size;\n    });\n});\n\nexport type CustomFieldValidator = (props: {\n    name: string,\n    value: any,\n    property: ResolvedProperty,\n    entityId?: string,\n    parentProperty?: ResolvedMapProperty | ResolvedArrayProperty,\n}) => Promise<boolean>;\n\ninterface PropertyContext<T extends CMSType> {\n    property: ResolvedProperty<T>,\n    parentProperty?: ResolvedMapProperty | ResolvedArrayProperty,\n    entityId: string,\n    customFieldValidator?: CustomFieldValidator,\n    name?: any\n}\n\nexport function getYupEntitySchema<M extends Record<string, any>>(\n    entityId: string,\n    properties: ResolvedProperties<M>,\n    customFieldValidator?: CustomFieldValidator): ObjectSchema<any> {\n    const objectSchema: any = {};\n    Object.entries(properties as Record<string, ResolvedProperty>)\n        .forEach(([name, property]) => {\n            objectSchema[name] = mapPropertyToYup({\n                property: property as ResolvedProperty<any>,\n                customFieldValidator,\n                name,\n                entityId\n            });\n        });\n    return yup.object().shape(objectSchema);\n}\n\nexport function mapPropertyToYup<T extends CMSType>(propertyContext: PropertyContext<T>): AnySchema<unknown> {\n\n    const property = propertyContext.property;\n    if (isPropertyBuilder(property)) {\n        console.error(\"Error in property\", propertyContext);\n        throw Error(\"Trying to create a yup mapping from a property builder. Please use resolved properties only\");\n    }\n\n    if (property.dataType === \"string\") {\n        return getYupStringSchema(propertyContext as PropertyContext<string>);\n    } else if (property.dataType === \"number\") {\n        return getYupNumberSchema(propertyContext as PropertyContext<number>);\n    } else if (property.dataType === \"boolean\") {\n        return getYupBooleanSchema(propertyContext as PropertyContext<boolean>);\n    } else if (property.dataType === \"map\") {\n        return getYupMapObjectSchema(propertyContext as PropertyContext<object>);\n    } else if (property.dataType === \"array\") {\n        return getYupArraySchema(propertyContext as PropertyContext<any[]>);\n    } else if (property.dataType === \"date\") {\n        return getYupDateSchema(propertyContext as PropertyContext<Date>);\n    } else if (property.dataType === \"geopoint\") {\n        return getYupGeoPointSchema(propertyContext as PropertyContext<GeoPoint>);\n    } else if (property.dataType === \"reference\") {\n        return getYupReferenceSchema(propertyContext as PropertyContext<EntityReference>);\n    }\n    console.error(\"Unsupported data type in yup mapping\", property)\n    throw Error(\"Unsupported data type in yup mapping\");\n}\n\nexport function getYupMapObjectSchema<M extends Record<string, any>>({\n                                                                         property,\n                                                                         entityId,\n                                                                         customFieldValidator,\n                                                                         name\n                                                                     }: PropertyContext<M>): ObjectSchema<any> {\n    const objectSchema: any = {};\n    const validation = property.validation;\n    if (property.properties)\n        Object.entries(property.properties).forEach(([childName, childProperty]: [string, ResolvedProperty]) => {\n            objectSchema[childName] = mapPropertyToYup<any>({\n                property: childProperty,\n                parentProperty: property as ResolvedMapProperty,\n                customFieldValidator,\n                name: `${name}[${childName}]`,\n                entityId\n            });\n        });\n\n    return yup.object().shape(objectSchema);\n    // const object: ObjectSchema<any> = yup.object().shape(objectSchema);\n    // return validation?.required\n    //     ? object.required(validation?.requiredMessage ? validation.requiredMessage : \"Required\").nullable(true)\n    //     : yup.object().optional().default(undefined).notRequired().nullable(true).test(\n    //         \"empty-check\",\n    //         \"Optional map can be empty\",\n    //         (o: any, testContext: any) => {\n    //             try {\n    //                 if (!o || Object.keys(o).length === 0) return true;\n    //                 return object.validateSync(o);\n    //             } catch (e) {\n    //                 testContext.createError(e);\n    //                 console.error(e);\n    //                 return false;\n    //             }\n    //         });\n}\n\nfunction getYupStringSchema({\n                                property,\n                                parentProperty,\n                                customFieldValidator,\n                                name,\n                                entityId\n                            }: PropertyContext<string>): StringSchema {\n    let collection: StringSchema<any> = yup.string();\n    const validation = property.validation;\n    if (property.enumValues) {\n        if (validation?.required)\n            collection = collection.required(validation?.requiredMessage ? validation.requiredMessage : \"Required\");\n        collection = collection.oneOf(\n            enumToObjectEntries(property.enumValues)\n                .map((enumValueConfig) => enumValueConfig.id)\n        ).nullable(true);\n    }\n    if (validation) {\n        collection = validation.required\n            ? collection.required(validation?.requiredMessage ? validation.requiredMessage : \"Required\").nullable(true)\n            : collection.notRequired().nullable(true);\n        if (validation.unique && customFieldValidator && name)\n            collection = collection.test(\"unique\", \"This value already exists and should be unique\",\n                (value, context) =>\n                    customFieldValidator({\n                        name,\n                        property,\n                        parentProperty,\n                        value,\n                        entityId\n                    }));\n        if (validation.min || validation.min === 0) collection = collection.min(validation.min, `${property.name} must be min ${validation.min} characters long`);\n        if (validation.max || validation.max === 0) collection = collection.max(validation.max, `${property.name} must be max ${validation.max} characters long`);\n        if (validation.matches) {\n            const regExp = typeof validation.matches === \"string\" ? hydrateRegExp(validation.matches) : validation.matches;\n            if (regExp) {\n                collection = collection.matches(regExp, validation.matchesMessage ? { message: validation.matchesMessage } : undefined)\n            }\n        }\n        if (validation.trim) collection = collection.trim();\n        if (validation.lowercase) collection = collection.lowercase();\n        if (validation.uppercase) collection = collection.uppercase();\n        if (property.email) collection = collection.email(`${property.name} must be an email`);\n        if (property.url) collection = collection.url(`${property.name} must be a url`);\n    } else {\n        collection = collection.notRequired().nullable(true);\n    }\n    return collection;\n}\n\nfunction getYupNumberSchema({\n                                property,\n                                parentProperty,\n                                customFieldValidator,\n                                name,\n                                entityId\n                            }: PropertyContext<number>): NumberSchema {\n    const validation = property.validation;\n    let collection: NumberSchema<any> = yup.number().typeError(\"Must be a number\");\n    if (validation) {\n        collection = validation.required\n            ? collection.required(validation.requiredMessage ? validation.requiredMessage : \"Required\").nullable(true)\n            : collection.notRequired().nullable(true);\n        if (validation.unique && customFieldValidator && name)\n            collection = collection.test(\"unique\",\n                \"This value already exists and should be unique\",\n                (value) => customFieldValidator({\n                    name,\n                    property,\n                    parentProperty,\n                    value,\n                    entityId\n                }));\n        if (validation.min || validation.min === 0) collection = collection.min(validation.min, `${property.name} must be higher or equal to ${validation.min}`);\n        if (validation.max || validation.max === 0) collection = collection.max(validation.max, `${property.name} must be lower or equal to ${validation.max}`);\n        if (validation.lessThan || validation.lessThan === 0) collection = collection.lessThan(validation.lessThan, `${property.name} must be higher than ${validation.lessThan}`);\n        if (validation.moreThan || validation.moreThan === 0) collection = collection.moreThan(validation.moreThan, `${property.name} must be lower than ${validation.moreThan}`);\n        if (validation.positive) collection = collection.positive(`${property.name} must be positive`);\n        if (validation.negative) collection = collection.negative(`${property.name} must be negative`);\n        if (validation.integer) collection = collection.integer(`${property.name} must be an integer`);\n    } else {\n        collection = collection.notRequired().nullable(true);\n    }\n    return collection;\n}\n\nfunction getYupGeoPointSchema({\n                                  property,\n                                  parentProperty,\n                                  customFieldValidator,\n                                  name,\n                                  entityId\n                              }: PropertyContext<GeoPoint>): AnySchema {\n    let collection: ObjectSchema<any> = yup.object();\n    const validation = property.validation;\n    if (validation?.unique && customFieldValidator && name)\n        collection = collection.test(\"unique\",\n            \"This value already exists and should be unique\",\n            (value) => customFieldValidator({\n                name,\n                property,\n                parentProperty,\n                value,\n                entityId\n            }));\n    if (validation?.required) {\n        collection = collection.required(validation.requiredMessage).nullable(true);\n    } else {\n        collection = collection.notRequired().nullable(true);\n    }\n    return collection;\n}\n\nfunction getYupDateSchema({\n                              property,\n                              parentProperty,\n                              customFieldValidator,\n                              name,\n                              entityId\n                          }: PropertyContext<Date>): AnySchema | DateSchema {\n    if (property.autoValue) {\n        return yup.object().nullable();\n    }\n    let collection: DateSchema<any> = yup.date();\n    const validation = property.validation;\n    if (validation) {\n        collection = validation.required\n            ? collection.required(validation?.requiredMessage ? validation.requiredMessage : \"Required\")\n            : collection.notRequired();\n        if (validation.unique && customFieldValidator && name)\n            collection = collection.test(\"unique\",\n                \"This value already exists and should be unique\",\n                (value) => customFieldValidator({\n                    name,\n                    property,\n                    parentProperty,\n                    value,\n                    entityId\n                }));\n        if (validation.min) collection = collection.min(validation.min, `${property.name} must be after ${validation.min}`);\n        if (validation.max) collection = collection.max(validation.max, `${property.name} must be before ${validation.min}`);\n    } else {\n        collection = collection.notRequired();\n    }\n    return collection\n        .transform((v: any) => (v instanceof Date ? v : null))\n        .nullable();\n}\n\nfunction getYupReferenceSchema({\n                                   property,\n                                   parentProperty,\n                                   customFieldValidator,\n                                   name,\n                                   entityId\n                               }: PropertyContext<EntityReference>): AnySchema {\n    let collection: ObjectSchema<any> = yup.object();\n    const validation = property.validation;\n    if (validation) {\n        collection = validation.required\n            ? collection.required(validation?.requiredMessage ? validation.requiredMessage : \"Required\").nullable(true)\n            : collection.notRequired().nullable(true);\n        if (validation.unique && customFieldValidator && name)\n            collection = collection.test(\"unique\",\n                \"This value already exists and should be unique\",\n                (value) => customFieldValidator({\n                    name,\n                    property,\n                    parentProperty,\n                    value,\n                    entityId\n                }));\n    } else {\n        collection = collection.notRequired().nullable(true);\n    }\n    return collection;\n}\n\nfunction getYupBooleanSchema({\n                                 property,\n                                 parentProperty,\n                                 customFieldValidator,\n                                 name,\n                                 entityId\n                             }: PropertyContext<boolean>): BooleanSchema {\n    let collection: BooleanSchema<any> = yup.boolean();\n    const validation = property.validation;\n    if (validation) {\n        collection = validation.required\n            ? collection.required(validation?.requiredMessage ? validation.requiredMessage : \"Required\").nullable(true)\n            : collection.notRequired().nullable(true);\n        if (validation.unique && customFieldValidator && name)\n            collection = collection.test(\"unique\",\n                \"This value already exists and should be unique\",\n                (value) => customFieldValidator({\n                    name,\n                    property,\n                    parentProperty,\n                    value,\n                    entityId\n                }));\n    } else {\n        collection = collection.notRequired().nullable(true);\n    }\n    return collection;\n}\n\nfunction hasUniqueInArrayModifier(property: ResolvedProperty): boolean | [string, ResolvedProperty][] {\n    if (property.validation?.uniqueInArray) {\n        return true;\n    } else if (property.dataType === \"map\" && property.properties) {\n        return Object.entries(property.properties)\n            .filter(([key, childProperty]) => childProperty.validation?.uniqueInArray);\n    }\n    return false;\n}\n\nfunction getYupArraySchema({\n                               property,\n                               parentProperty,\n                               customFieldValidator,\n                               name,\n                               entityId\n                           }: PropertyContext<any[]>): AnySchema<any> {\n\n    let arraySchema: ArraySchema<any> = yup.array();\n\n    if (property.of) {\n        if (Array.isArray(property.of)) {\n            const yupProperties = (property.of as ResolvedProperty[]).map((p, index) => ({\n                [`${name}[${index}]`]: mapPropertyToYup({\n                    property: p as ResolvedProperty<any>,\n                    parentProperty: property,\n                    entityId\n                })\n            })).reduce((a, b) => ({ ...a, ...b }), {});\n            return yup.array().of(\n                yup.mixed().test(\n                    \"Dynamic object validation\",\n                    \"Dynamic object validation error\",\n                    (object, context) => {\n                        const yupProperty = getValueInPath(yupProperties, context.path);\n                        return yupProperty.validate(object);\n                    }\n                )\n            );\n        } else {\n            arraySchema = arraySchema.of(mapPropertyToYup({\n                property: property.of,\n                parentProperty: property,\n                entityId\n            }));\n            const arrayUniqueFields = hasUniqueInArrayModifier(property.of);\n            if (arrayUniqueFields) {\n                if (typeof arrayUniqueFields === \"boolean\") {\n                    arraySchema = arraySchema.uniqueInArray(v => v, `${property.name} should have unique values within the array`);\n                } else if (Array.isArray(arrayUniqueFields)) {\n                    arrayUniqueFields.forEach(([name, childProperty]) => {\n                            arraySchema = arraySchema.uniqueInArray(v => v && v[name], `${property.name} → ${childProperty.name ?? name}: should have unique values within the array`);\n                        }\n                    );\n                }\n            }\n        }\n    }\n    const validation = property.validation;\n\n    if (validation) {\n        arraySchema = validation.required\n            ? arraySchema.required(validation?.requiredMessage ? validation.requiredMessage : \"Required\").nullable(true)\n            : arraySchema.notRequired().nullable(true);\n        if (validation.min || validation.min === 0) arraySchema = arraySchema.min(validation.min, `${property.name} should be min ${validation.min} entries long`);\n        if (validation.max) arraySchema = arraySchema.max(validation.max, `${property.name} should be max ${validation.max} entries long`);\n    } else {\n        arraySchema = arraySchema.notRequired().nullable(true);\n    }\n    return arraySchema;\n}\n","import React, { useEffect } from \"react\";\nimport { useFormikContext } from \"formik\";\n\nexport const ErrorFocus = ({ containerRef }:\n                               { containerRef?: React.RefObject<HTMLDivElement> }) => {\n    const { isSubmitting, isValidating, errors } = useFormikContext();\n\n    useEffect(() => {\n        const keys = Object.keys(errors);\n\n        // Whenever there are errors and the form is submitting but finished validating.\n        if (keys.length > 0 && isSubmitting && !isValidating) {\n            const errorElement = containerRef?.current?.querySelector<HTMLDivElement>(\n                `#form_field_${keys[0]}`\n            );\n\n            if (errorElement && containerRef?.current) {\n                const scrollableParent = getScrollableParent(containerRef.current);\n                if (scrollableParent) {\n                    const top = errorElement.getBoundingClientRect().top;\n                    scrollableParent.scrollTo({\n                        top: scrollableParent.scrollTop + top - 64,\n                        behavior: \"smooth\"\n                    });\n                }\n                const input = errorElement.querySelector(\"input\");\n                if (input) input.focus();\n            }\n        }\n    }, [isSubmitting, isValidating, errors, containerRef]);\n\n    // This component does not render anything by itself.\n    return null;\n};\n\nconst isScrollable = (ele: HTMLElement | null) => {\n    const hasScrollableContent = ele && ele.scrollHeight > ele.clientHeight;\n\n    const overflowYStyle = ele ? window.getComputedStyle(ele).overflowY : null;\n    const isOverflowHidden = overflowYStyle && overflowYStyle.indexOf(\"hidden\") !== -1;\n\n    return hasScrollableContent && !isOverflowHidden;\n};\n\nconst getScrollableParent = (ele: HTMLElement | null): HTMLElement | null => {\n    return (!ele || ele === document.body)\n        ? document.body\n        : (isScrollable(ele) ? ele : getScrollableParent(ele.parentNode as HTMLElement));\n};\n","import {\n    ArrayProperty,\n    CMSType,\n    EntityCollection,\n    EntityValues,\n    EnumValueConfig,\n    EnumValues,\n    FieldConfig,\n    NumberProperty,\n    Properties,\n    PropertiesOrBuilders,\n    Property,\n    PropertyOrBuilder,\n    ResolvedArrayProperty,\n    ResolvedEntityCollection,\n    ResolvedNumberProperty,\n    ResolvedProperties,\n    ResolvedProperty,\n    ResolvedStringProperty,\n    StringProperty,\n    UserConfigurationPersistence\n} from \"../../types\";\nimport { getValueInPath, mergeDeep } from \"./objects\";\nimport { getDefaultValuesFor, isPropertyBuilder } from \"./entities\";\nimport { DEFAULT_ONE_OF_TYPE } from \"./common\";\nimport { getIn } from \"formik\";\n\nexport const resolveCollection = <M extends Record<string, any>, >\n({\n     collection,\n     path,\n     entityId,\n     values,\n     previousValues,\n     userConfigPersistence,\n     fields\n }: {\n    collection: EntityCollection<M> | ResolvedEntityCollection<M>;\n    path: string,\n    entityId?: string,\n    values?: Partial<EntityValues<M>>,\n    previousValues?: Partial<EntityValues<M>>,\n    userConfigPersistence?: UserConfigurationPersistence;\n    fields?: Record<string, FieldConfig>;\n}): ResolvedEntityCollection<M> => {\n\n    const collectionOverride = userConfigPersistence?.getCollectionConfig<M>(path);\n    const storedProperties = getValueInPath(collectionOverride, \"properties\");\n\n    const defaultValues = getDefaultValuesFor(collection.properties);\n    const usedValues = values ?? defaultValues;\n    const usedPreviousValues = previousValues ?? values ?? defaultValues;\n\n    const resolvedProperties = Object.entries(collection.properties)\n        .map(([key, propertyOrBuilder]) => {\n            const propertyValue = usedValues ? getIn(usedValues, key) : undefined;\n            return ({\n                [key]: resolveProperty({\n                    propertyKey: key,\n                    propertyOrBuilder: propertyOrBuilder as PropertyOrBuilder | ResolvedProperty,\n                    values: usedValues,\n                    previousValues: usedPreviousValues,\n                    path,\n                    propertyValue,\n                    entityId,\n                    fields\n                })\n            });\n        })\n        .filter((a) => a !== null)\n        .reduce((a, b) => ({ ...a, ...b }), {}) as ResolvedProperties<M>;\n\n    const properties: Properties = mergeDeep(resolvedProperties, storedProperties);\n    const cleanedProperties = Object.entries(properties)\n        .filter(([_, property]) => Boolean(property?.dataType))\n        .map(([id, property]) => ({ [id]: property }))\n        .reduce((a, b) => ({ ...a, ...b }), {});\n\n    return {\n        ...collection,\n        properties: cleanedProperties,\n        originalCollection: collection\n    } as ResolvedEntityCollection<M>;\n\n};\n\n/**\n * Resolve property builders, enums and arrays.\n * @param propertyOrBuilder\n * @param propertyValue\n * @param values\n */\nexport function resolveProperty<T extends CMSType = CMSType, M extends Record<string, any> = any>({\n                                                                                                      propertyOrBuilder,\n                                                                                                      propertyValue,\n                                                                                                      fromBuilder = false,\n                                                                                                      ...props\n                                                                                                  }: {\n    propertyKey?: string,\n    propertyOrBuilder: PropertyOrBuilder<T, M> | ResolvedProperty<T>,\n    propertyValue?: unknown,\n    values?: Partial<M>,\n    previousValues?: Partial<M>,\n    path?: string,\n    entityId?: string,\n    index?: number,\n    fromBuilder?: boolean;\n    fields?: Record<string, FieldConfig<any>>;\n}): ResolvedProperty<T> | null {\n\n    if (typeof propertyOrBuilder === \"object\" && \"resolved\" in propertyOrBuilder) {\n        return propertyOrBuilder as ResolvedProperty<T>;\n    }\n\n    let resolvedProperty: ResolvedProperty<T> | null = null;\n\n    if (!propertyOrBuilder) {\n        return null;\n    } else if (isPropertyBuilder(propertyOrBuilder)) {\n        const path = props.path;\n        if (!path)\n            throw Error(\"Trying to resolve a property builder without specifying the entity path\");\n\n        const result: Property<T> | null = propertyOrBuilder({\n            ...props,\n            path,\n            propertyValue,\n            values: props.values ?? {},\n            previousValues: props.previousValues ?? props.values ?? {}\n        });\n\n        if (!result) {\n            console.debug(\"Property builder not returning `Property` so it is not rendered\", path, props.entityId, propertyOrBuilder);\n            return null;\n        }\n\n        resolvedProperty = resolveProperty({\n            ...props,\n            propertyValue,\n            propertyOrBuilder: result,\n            fromBuilder: true\n        });\n    } else {\n        const property = propertyOrBuilder as Property<T>;\n        if (property.dataType === \"map\" && property.properties) {\n            const properties = resolveProperties({\n                ...props,\n                properties: property.properties,\n                propertyValue\n            });\n            resolvedProperty = {\n                ...property,\n                resolved: true,\n                fromBuilder,\n                properties\n            } as ResolvedProperty<T>;\n        } else if (property.dataType === \"array\") {\n            resolvedProperty = resolveArrayProperty({\n                property,\n                propertyValue,\n                fromBuilder,\n                ...props\n            }) as ResolvedProperty<any>;\n        } else if ((property.dataType === \"string\" || property.dataType === \"number\") && property.enumValues) {\n            resolvedProperty = resolvePropertyEnum(property, fromBuilder) as ResolvedProperty<any>;\n        }\n    }\n\n    if (!resolvedProperty) {\n        resolvedProperty = {\n            ...propertyOrBuilder,\n            resolved: true,\n            fromBuilder\n        } as ResolvedProperty<T>;\n    }\n\n    if (resolvedProperty.fieldConfig) {\n        const cmsFields = props.fields;\n        if (!cmsFields)\n            throw Error(\"Trying to resolve a property that inherits from a custom field but no custom fields were provided. Use the property `fields` in your top level component to provide them\");\n        const customField: FieldConfig<any> = cmsFields[resolvedProperty.fieldConfig];\n        if (!customField)\n            throw Error(`Trying to resolve a property that inherits from a custom field but no custom field with id ${resolvedProperty.fieldConfig} was found. Check the \\`fields\\` in your top level component`);\n        if (customField.defaultProperty) {\n            const customFieldProperty = resolveProperty<any>({\n                propertyOrBuilder: customField.defaultProperty,\n                propertyValue,\n                ...props\n            });\n            if (customFieldProperty) {\n                resolvedProperty = mergeDeep(customFieldProperty, resolvedProperty);\n            }\n        }\n        if (customField.Field) {\n            resolvedProperty!.Field = customField.Field;\n        }\n    }\n\n    return resolvedProperty\n        ? {\n            ...resolvedProperty,\n            resolved: true\n        }\n        : null;\n}\n\nexport function resolveArrayProperty<T extends any[], M>({\n                                                             propertyKey,\n                                                             property,\n                                                             propertyValue,\n                                                             ...props\n                                                         }: {\n    propertyKey?: string,\n    property: ArrayProperty<T> | ResolvedArrayProperty<T>,\n    propertyValue: any,\n    values?: Partial<M>,\n    previousValues?: Partial<M>,\n    path?: string,\n    entityId?: string,\n    index?: number,\n    fromBuilder?: boolean;\n    fields?: Record<string, FieldConfig>;\n}): ResolvedArrayProperty {\n\n    if (property.of) {\n        if (Array.isArray(property.of)) {\n            return {\n                ...property,\n                resolved: true,\n                fromBuilder: props.fromBuilder,\n                resolvedProperties: property.of.map((p, index) => {\n                    return resolveProperty({\n                        propertyKey: `${propertyKey}.${index}`,\n                        propertyOrBuilder: p as Property<any>,\n                        propertyValue: Array.isArray(propertyValue) ? propertyValue[index] : undefined,\n                        ...props,\n                        index\n                    });\n                })\n            } as ResolvedArrayProperty;\n        } else {\n            const of = property.of;\n            const resolvedProperties: ResolvedProperty[] = Array.isArray(propertyValue)\n                ? propertyValue.map((v: any, index: number) => resolveProperty({\n                    propertyKey: `${propertyKey}.${index}`,\n                    propertyOrBuilder: of,\n                    propertyValue: v,\n                    ...props,\n                    index\n                })).filter(e => Boolean(e)) as ResolvedProperty[]\n                : [];\n            const ofProperty = resolveProperty({\n                propertyKey: `${propertyKey}`,\n                propertyOrBuilder: of,\n                propertyValue: undefined,\n                ...props\n            });\n            if (!ofProperty)\n                throw Error(\"When using a property builder as the 'of' prop of an ArrayProperty, you must return a valid child property\")\n            return {\n                ...property,\n                resolved: true,\n                fromBuilder: props.fromBuilder,\n                of: ofProperty,\n                resolvedProperties\n            } as ResolvedArrayProperty;\n        }\n    } else if (property.oneOf) {\n        const typeField = property.oneOf?.typeField ?? DEFAULT_ONE_OF_TYPE;\n        const resolvedProperties: ResolvedProperty[] = Array.isArray(propertyValue)\n            ? propertyValue.map((v, index) => {\n                const type = v && v[typeField];\n                const childProperty = property.oneOf?.properties[type];\n                if (!type || !childProperty) return null;\n                return resolveProperty({\n                    propertyKey: `${propertyKey}.${index}`,\n                    propertyOrBuilder: childProperty,\n                    propertyValue,\n                    ...props\n                });\n            }).filter(e => Boolean(e)) as ResolvedProperty[]\n            : [];\n        const properties = resolveProperties<any>({\n            properties: property.oneOf.properties,\n            propertyValue: undefined,\n            ...props\n        });\n        return {\n            ...property,\n            resolved: true,\n            oneOf: {\n                ...property.oneOf,\n                properties\n            },\n            fromBuilder: props.fromBuilder,\n            resolvedProperties\n        } as ResolvedArrayProperty;\n    } else if (!property.Field) {\n        throw Error(\"The array property needs to declare an 'of' or a 'oneOf' property, or provide a custom `Field`\")\n    } else {\n        return {\n            ...property,\n            resolved: true,\n            fromBuilder: props.fromBuilder\n        } as ResolvedArrayProperty;\n    }\n\n}\n\n/**\n * Resolve enums and arrays for properties\n * @param properties\n * @param value\n */\nexport function resolveProperties<M extends Record<string, any>>({\n                                                                     properties,\n                                                                     propertyValue,\n                                                                     ...props\n                                                                 }: {\n    properties: PropertiesOrBuilders<M>,\n    propertyValue: unknown,\n    values?: Partial<M>,\n    previousValues?: Partial<M>,\n    path?: string,\n    entityId?: string,\n    index?: number,\n    fromBuilder?: boolean;\n    fields?: Record<string, FieldConfig>;\n}): ResolvedProperties<M> {\n    return Object.entries<PropertyOrBuilder>(properties as Record<string, PropertyOrBuilder>)\n        .map(([key, property]) => {\n            return {\n                [key]: resolveProperty({\n                    propertyKey: key,\n                    propertyOrBuilder: property,\n                    propertyValue: propertyValue && typeof propertyValue === \"object\" ? getValueInPath(propertyValue, key) : undefined,\n                    ...props\n                })\n            };\n        })\n        .filter((a) => a !== null)\n        .reduce((a, b) => ({ ...a, ...b }), {}) as ResolvedProperties<M>;\n}\n\n/**\n * Resolve enum aliases for a string or number property\n * @param property\n * @param fromBuilder\n */\nexport function resolvePropertyEnum(property: StringProperty | NumberProperty, fromBuilder?: boolean): ResolvedStringProperty | ResolvedNumberProperty {\n    if (typeof property.enumValues === \"object\") {\n        return {\n            ...property,\n            resolved: true,\n            enumValues: resolveEnumValues(property.enumValues)?.filter((value) => value && value.id && value.label) ?? [],\n            fromBuilder: fromBuilder ?? false\n        }\n    }\n    return property as ResolvedStringProperty | ResolvedNumberProperty;\n}\n\nexport function resolveEnumValues(input: EnumValues): EnumValueConfig[] | undefined {\n    if (typeof input === \"object\") {\n        return Object.entries(input).map(([id, value]) =>\n            (typeof value === \"string\"\n                ? {\n                    id,\n                    label: value\n                }\n                : value));\n    } else if (Array.isArray(input)) {\n        return input as EnumValueConfig[];\n    } else {\n        return undefined;\n    }\n}\n","import React, { useMemo } from \"react\";\n\nimport { styled } from \"@mui/material/styles\";\n\nimport {\n    FormControl,\n    IconButton,\n    InputAdornment,\n    InputLabel,\n    MenuItem,\n    Select as MuiSelect,\n    TextField as MuiTextField,\n    Theme,\n    Tooltip\n} from \"@mui/material\";\nimport OpenInNewIcon from \"@mui/icons-material/OpenInNew\";\n\nimport { ErrorMessage } from \"formik\";\n\nimport {\n    Entity,\n    EntityStatus,\n    EnumValueConfig,\n    EnumValues,\n    FireCMSContext\n} from \"../../types\";\n\nimport {\n    useClipboard,\n    useFireCMSContext,\n    useSnackbarController\n} from \"../../hooks\";\nimport { resolveEnumValues } from \"../../core/util/resolutions\";\n\nconst PREFIX = \"CustomIdField\";\n\nconst classes = {\n    input: `${PREFIX}-input`,\n    select: `${PREFIX}-select`\n};\n\nconst StyledFormControl = styled(FormControl)((\n    { theme }: {\n        theme: Theme\n    }\n) => ({\n    marginBottom: \"16px\",\n    [`& .${classes.input}`]: {\n        minHeight: \"64px\"\n    },\n\n    [`& .${classes.select}`]: {\n        paddingTop: theme.spacing(1 / 2)\n    }\n}));\n\nexport function CustomIdField<M extends Record<string, any>, UserType>({\n                                                                           customId,\n                                                                           entityId,\n                                                                           status,\n                                                                           onChange,\n                                                                           error,\n                                                                           entity\n                                                                       }: {\n    customId?: boolean | EnumValues | \"optional\"\n    entityId?: string\n    status: EntityStatus,\n    onChange: (id?: string) => void,\n    error: boolean,\n    entity: Entity<M> | undefined\n}) {\n\n    const disabled = status === \"existing\" || !customId;\n    const idSetAutomatically = status !== \"existing\" && !customId;\n\n    const enumValues: EnumValueConfig[] | undefined = useMemo(() => {\n        if (!customId || typeof customId === \"boolean\" || customId === \"optional\")\n            return undefined;\n        return resolveEnumValues(customId);\n    }, [customId]);\n\n    const snackbarController = useSnackbarController();\n    const { copy } = useClipboard({\n        onSuccess: (text) => snackbarController.open({\n            type: \"success\",\n            message: `Copied ${text}`\n        })\n    });\n\n    const appConfig: FireCMSContext | undefined = useFireCMSContext();\n    const inputProps = {\n        sx: (theme:Theme) => ({\n            minHeight: \"64px\",\n            borderRadius: `${theme.shape.borderRadius}px`\n        }),\n        disableUnderline: true,\n        endAdornment: entity\n            ? (\n                <InputAdornment position=\"end\">\n\n                    <IconButton onClick={(e) => copy(entity.id)}\n                                aria-label=\"copy-id\"\n                                size=\"large\">\n                        <Tooltip title={\"Copy\"}>\n                            <svg\n                                className={\"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall\"}\n                                fill={\"currentColor\"}\n                                width=\"20\" height=\"20\" viewBox=\"0 0 24 24\">\n                                <path\n                                    d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"/>\n                            </svg>\n                        </Tooltip>\n                    </IconButton>\n\n                    {appConfig?.entityLinkBuilder &&\n                        <a href={appConfig.entityLinkBuilder({ entity })}\n                           rel=\"noopener noreferrer\"\n                           target=\"_blank\">\n                            <IconButton onClick={(e) => e.stopPropagation()}\n                                        aria-label=\"go-to-datasource\"\n                                        size=\"large\">\n                                <Tooltip title={\"Open in the console\"}>\n                                    <OpenInNewIcon fontSize={\"small\"}/>\n                                </Tooltip>\n                            </IconButton>\n                        </a>}\n\n                </InputAdornment>\n            )\n            : undefined\n    };\n\n    const fieldProps: any = {\n        label: idSetAutomatically ? \"ID is set automatically\" : \"ID\",\n        disabled,\n        name: \"id\",\n        type: null,\n        value: (entity && status === \"existing\" ? entity.id : entityId) ?? \"\",\n        variant: \"filled\",\n        sx: (theme:Theme) => ({\n            minHeight: \"64px\",\n            borderRadius: `${theme.shape.borderRadius}px`\n        })\n    };\n\n    return (\n        <StyledFormControl fullWidth\n                           error={error}\n                           {...fieldProps}\n                           key={\"custom-id-field\"}>\n\n            {enumValues &&\n                <>\n                    <InputLabel id={\"id-label\"}>{fieldProps.label}</InputLabel>\n                    <MuiSelect\n                        labelId={\"id-label\"}\n                        fullWidth\n                        className={classes.select}\n                        disableUnderline={true}\n                        error={error}\n                        {...fieldProps}\n                        onChange={(event: any) => onChange(event.target.value)}>\n                        {enumValues.map((enumConfig) =>\n                            <MenuItem\n                                key={`custom-id-item-${enumConfig.id}`}\n                                value={enumConfig.id}>\n                                {`${enumConfig.id} - ${enumConfig.label}`}\n                            </MenuItem>)}\n                    </MuiSelect>\n                </>}\n\n            {!enumValues &&\n                <MuiTextField {...fieldProps}\n                              error={error}\n                              InputProps={inputProps}\n                              helperText={customId === \"optional\" ? \"Autogenerated ID, it can be manually changed\" : (status === \"new\" || status === \"copy\" ? \"ID of the new document\" : \"ID of the document\")}\n                              onChange={(event) => {\n                                  let value = event.target.value;\n                                  if (value) value = value.trim();\n                                  return onChange(value.length ? value : undefined);\n                              }}/>}\n\n            <ErrorMessage name={\"id\"}\n                          component=\"div\">\n                {(_) => \"You need to specify an ID\"}\n            </ErrorMessage>\n\n        </StyledFormControl>\n    );\n}\n","import React, {\n    MutableRefObject,\n    useCallback,\n    useEffect,\n    useMemo,\n    useRef,\n    useState\n} from \"react\";\nimport { alpha, Box, Button, Grid, Typography } from \"@mui/material\";\nimport {\n    CMSAnalyticsEvent,\n    Entity,\n    EntityCollection,\n    EntityStatus,\n    EntityValues,\n    FormContext,\n    PluginFormActionProps,\n    PropertyFieldBindingProps,\n    ResolvedEntityCollection\n} from \"../types\";\nimport { Form, Formik, FormikHelpers, FormikProps } from \"formik\";\nimport { PropertyFieldBinding } from \"./PropertyFieldBinding\";\nimport { CustomFieldValidator, getYupEntitySchema } from \"./validation\";\nimport equal from \"react-fast-compare\"\nimport {\n    CustomDialogActions,\n    getDefaultValuesFor,\n    isHidden,\n    isReadOnly,\n    resolveCollection\n} from \"../core\";\nimport { useDataSource, useFireCMSContext } from \"../hooks\";\nimport { ErrorFocus } from \"./components/ErrorFocus\";\nimport { CustomIdField } from \"./components/CustomIdField\";\n\n/**\n * @category Components\n */\nexport interface EntityFormProps<M extends Record<string, any>> {\n\n    /**\n     * New or existing status\n     */\n    status: EntityStatus;\n\n    /**\n     * Path of the collection this entity is located\n     */\n    path: string;\n\n    /**\n     * The collection is used to build the fields of the form\n     */\n    collection: EntityCollection<M>\n\n    /**\n     * The updated entity is passed from the parent component when the underlying data\n     * has changed in the datasource\n     */\n    entity?: Entity<M>;\n\n    /**\n     * The callback function called when Save is clicked and validation is correct\n     */\n    onEntitySave?: (\n        props:\n            {\n                collection: ResolvedEntityCollection<M>,\n                path: string,\n                entityId: string | undefined,\n                values: EntityValues<M>,\n                previousValues?: EntityValues<M>,\n                closeAfterSave: boolean\n            }\n    ) => Promise<void>;\n\n    /**\n     * The callback function called when discard is clicked\n     */\n    onDiscard?: () => void;\n\n    /**\n     * The callback function when the form is dirty, so the values are different\n     * from the original ones\n     */\n    onModified?: (dirty: boolean) => void;\n\n    /**\n     * The callback function when the form original values have been modified\n     */\n    onValuesChanged?: (values?: EntityValues<M>) => void;\n\n    /**\n     *\n     * @param id\n     */\n    onIdChange?: (id: string) => void;\n\n    currentEntityId?: string;\n\n    onFormContextChange?: (formContext: FormContext<M>) => void;\n\n    hideId?: boolean;\n\n}\n\n/**\n * This is the form used internally by the CMS\n * @param status\n * @param path\n * @param collection\n * @param entity\n * @param onEntitySave\n * @param onDiscard\n * @param onModified\n * @param onValuesChanged\n * @constructor\n * @category Components\n */\nexport const EntityForm = React.memo<EntityFormProps<any>>(EntityFormInternal,\n    (a: EntityFormProps<any>, b: EntityFormProps<any>) => {\n        return a.status === b.status &&\n            a.path === b.path &&\n            equal(a.entity?.values, b.entity?.values);\n    }) as typeof EntityFormInternal;\n\nfunction EntityFormInternal<M extends Record<string, any>>({\n                                                               status,\n                                                               path,\n                                                               collection: inputCollection,\n                                                               entity,\n                                                               onEntitySave,\n                                                               onDiscard,\n                                                               onModified,\n                                                               onValuesChanged,\n                                                               onIdChange,\n                                                               onFormContextChange,\n                                                               hideId\n                                                           }: EntityFormProps<M>) {\n\n    const context = useFireCMSContext();\n    const dataSource = useDataSource();\n    const plugins = context.plugins;\n\n    const initialResolvedCollection = useMemo(() => resolveCollection({\n        collection: inputCollection,\n        path,\n        values: entity?.values,\n        fields: context.fields\n    }), [entity?.values, path]);\n\n    const mustSetCustomId: boolean = (status === \"new\" || status === \"copy\") &&\n        (Boolean(initialResolvedCollection.customId) && initialResolvedCollection.customId !== \"optional\");\n\n    const initialEntityId = useMemo(() => {\n        if (status === \"new\" || status === \"copy\") {\n            if (mustSetCustomId) {\n                return undefined;\n            } else {\n                return dataSource.generateEntityId(path);\n            }\n        } else {\n            return entity?.id;\n        }\n    }, []);\n\n    const closeAfterSaveRef = useRef(false);\n\n    const baseDataSourceValues: Partial<EntityValues<M>> = useMemo(() => {\n        const properties = initialResolvedCollection.properties;\n        if ((status === \"existing\" || status === \"copy\") && entity) {\n            return entity.values ?? getDefaultValuesFor(properties);\n        } else if (status === \"new\") {\n            return getDefaultValuesFor(properties);\n        } else {\n            console.error({\n                status,\n                entity\n            });\n            throw new Error(\"Form has not been initialised with the correct parameters\");\n        }\n    }, [status, initialResolvedCollection, entity]);\n\n    const [entityId, setEntityId] = React.useState<string | undefined>(initialEntityId);\n    const [entityIdError, setEntityIdError] = React.useState<boolean>(false);\n    const [savingError, setSavingError] = React.useState<Error | undefined>();\n\n    const [initialValues, setInitialValues] = useState<EntityValues<M>>(entity?.values ?? baseDataSourceValues as EntityValues<M>);\n    const [internalValues, setInternalValues] = useState<EntityValues<M> | undefined>(initialValues);\n\n    const doOnValuesChanges = useCallback((values?: EntityValues<M>) => {\n        setInternalValues(values);\n        if (onValuesChanged)\n            onValuesChanged(values);\n    }, [onValuesChanged]);\n\n    useEffect(() => {\n        if (entityId && onIdChange)\n            onIdChange(entityId);\n    }, [entityId, onIdChange]);\n\n    const collection = useMemo(() => resolveCollection<M>({\n        collection: inputCollection,\n        path,\n        entityId,\n        values: internalValues,\n        previousValues: initialValues,\n        fields: context.fields\n    }), [inputCollection, path, entityId, internalValues, initialValues]);\n\n    const onIdUpdate = collection.callbacks?.onIdUpdate;\n    useEffect(() => {\n        if (onIdUpdate && internalValues && (status === \"new\" || status === \"copy\")) {\n            try {\n                setEntityId(\n                    onIdUpdate({\n                        collection,\n                        path,\n                        entityId,\n                        values: internalValues,\n                        context\n                    })\n                );\n            } catch (e) {\n                console.error(e);\n            }\n        }\n    }, [collection, context, entityId, internalValues, path, status]);\n\n    const underlyingChanges: Partial<EntityValues<M>> = useMemo(() => {\n        if (initialValues && status === \"existing\") {\n            return Object.entries(collection.properties)\n                .map(([key, property]) => {\n                    if (isHidden(property)) {\n                        return {};\n                    }\n                    const initialValue = initialValues[key];\n                    const latestValue = baseDataSourceValues[key];\n                    if (!equal(initialValue, latestValue)) {\n                        return { [key]: latestValue };\n                    }\n                    return {};\n                })\n                .reduce((a, b) => ({ ...a, ...b }), {}) as Partial<EntityValues<M>>;\n        } else {\n            return {};\n        }\n    }, [baseDataSourceValues, collection.properties, initialValues, status]);\n\n    const saveValues = useCallback((values: EntityValues<M>, formikActions: FormikHelpers<EntityValues<M>>) => {\n\n        if (mustSetCustomId && !entityId) {\n            console.error(\"Missing custom Id\");\n            setEntityIdError(true);\n            formikActions.setSubmitting(false);\n            return;\n        }\n\n        setSavingError(undefined);\n        setEntityIdError(false);\n\n        if (status === \"existing\") {\n            if (!entity?.id) throw Error(\"Form misconfiguration when saving, no id for existing entity\");\n        } else if (status === \"new\" || status === \"copy\") {\n            if (collection.customId) {\n                if (collection.customId !== \"optional\" && !entityId) {\n                    throw Error(\"Form misconfiguration when saving, entityId should be set\");\n                }\n            }\n        } else {\n            throw Error(\"New FormType added, check EntityForm\");\n        }\n\n        onEntitySave?.({\n            collection,\n            path,\n            entityId,\n            values,\n            previousValues: entity?.values,\n            closeAfterSave: closeAfterSaveRef.current\n        })\n            .then(_ => {\n                const eventName: CMSAnalyticsEvent = status === \"new\"\n                    ? \"new_entity_saved\"\n                    : (status === \"copy\" ? \"entity_copied\" : (status === \"existing\" ? \"entity_edited\" : \"unmapped_event\"));\n                context.onAnalyticsEvent?.(eventName, { path });\n                setInitialValues(values);\n                formikActions.resetForm({\n                    values,\n                    submitCount: 0,\n                    touched: {}\n                });\n            })\n            .catch(e => {\n                console.error(e);\n                setSavingError(e);\n            })\n            .finally(() => {\n                closeAfterSaveRef.current = false;\n                formikActions.setSubmitting(false);\n            });\n\n    }, [status, path, collection, entity, onEntitySave, mustSetCustomId, entityId]);\n\n    const uniqueFieldValidator: CustomFieldValidator = useCallback(({\n                                                                        name,\n                                                                        value,\n                                                                        property\n                                                                    }) => dataSource.checkUniqueField(path, name, value, property, entityId),\n        [dataSource, path, entityId]);\n\n    const validationSchema = useMemo(() => entityId\n            ? getYupEntitySchema(\n                entityId,\n                collection.properties,\n                uniqueFieldValidator)\n            : undefined,\n        [entityId, collection.properties]);\n\n    return (\n        <Formik\n            initialValues={baseDataSourceValues as M}\n            onSubmit={saveValues}\n            validationSchema={validationSchema}\n            validate={(values) => console.debug(\"Validating\", values)}\n            onReset={() => onDiscard && onDiscard()}\n        >\n            {(props) => {\n\n                const pluginActions: React.ReactNode[] = [];\n\n                // eslint-disable-next-line react-hooks/rules-of-hooks\n                const formContext: FormContext<M> = {\n                    setFieldValue: props.setFieldValue,\n                    values: props.values,\n                    collection: resolveCollection({ collection, path }),\n                    entityId,\n                    path\n                };\n\n                // eslint-disable-next-line react-hooks/rules-of-hooks\n                useEffect(() => {\n                    if (onFormContextChange) {\n                        onFormContextChange(formContext);\n                    }\n                }, [onFormContextChange, formContext]);\n\n                if (plugins && collection) {\n                    const actionProps: PluginFormActionProps = {\n                        entityId,\n                        path,\n                        status,\n                        collection,\n                        context,\n                        currentEntityId: entityId,\n                        formContext\n                    };\n                    pluginActions.push(...plugins.map((plugin, i) => (\n                        plugin.form?.Actions\n                            ? <plugin.form.Actions\n                                key={`actions_${plugin.name}`} {...actionProps}/>\n                            : null\n                    )).filter(Boolean));\n                }\n\n                return <>\n\n                    <Box\n                        sx={(theme) => ({\n                            paddingLeft: theme.spacing(4),\n                            paddingRight: theme.spacing(4),\n                            paddingTop: theme.spacing(3),\n                            paddingBottom: theme.spacing(4),\n                            marginBottom: theme.spacing(2),\n                            [theme.breakpoints.down(\"lg\")]: {\n                                paddingLeft: theme.spacing(2),\n                                paddingRight: theme.spacing(2),\n                                paddingTop: theme.spacing(2),\n                                paddingBottom: theme.spacing(3)\n                            },\n                            [theme.breakpoints.down(\"md\")]: {\n                                padding: theme.spacing(2)\n                            }\n                        })}\n                    >\n\n                        {pluginActions.length > 0 && <Box\n                            sx={(theme) => ({\n                                width: \"100%\",\n                                display: \"flex\",\n                                justifyContent: \"flex-end\",\n                                background: theme.palette.mode === \"light\" ? \"rgba(255,255,255,0.6)\" : alpha(theme.palette.background.paper, 0.1),\n                                backdropFilter: \"blur(8px)\",\n                                borderBottom: `1px solid ${theme.palette.divider}`,\n                                flexDirection: \"row\",\n                                alignItems: \"center\",\n                                position: \"absolute\",\n                                top: 0,\n                                right: 0,\n                                left: 0,\n                                textAlign: \"right\",\n                                zIndex: 2,\n                                \"& > *:not(:last-child)\": {\n                                    [theme.breakpoints.down(\"md\")]: {\n                                        mr: theme.spacing(1)\n                                    },\n                                    mr: theme.spacing(2)\n                                }\n                            })}>\n                            {pluginActions}\n                        </Box>}\n\n                        <Box\n                            sx={(theme) => ({\n                                width: \"100%\",\n                                marginTop: theme.spacing(4 + (pluginActions ? 4 : 0)),\n                                paddingY: 2,\n                                display: \"flex\",\n                                alignItems: \"center\",\n                                [theme.breakpoints.down(\"lg\")]: {\n                                    marginTop: theme.spacing(3 + (pluginActions ? 4 : 0))\n                                },\n                                [theme.breakpoints.down(\"md\")]: {\n                                    marginTop: theme.spacing(2 + (pluginActions ? 4 : 0))\n                                }\n                            })}>\n\n                            <Typography\n                                sx={{\n                                    marginTop: 4,\n                                    marginBottom: collection.hideIdFromForm ? 0 : 4,\n                                    flexGrow: 1\n                                }}\n                                variant={\"h4\"}>{collection.singularName ?? collection.name + \" entry\"}\n                            </Typography>\n                        </Box>\n\n                        {!hideId &&\n                            <CustomIdField customId={collection.customId}\n                                           entityId={entityId}\n                                           status={status}\n                                           onChange={setEntityId}\n                                           error={entityIdError}\n                                           entity={entity}/>}\n\n                        {entityId && <InnerForm\n                            {...props}\n                            initialValues={initialValues}\n                            onModified={onModified}\n                            onValuesChanged={doOnValuesChanges}\n                            underlyingChanges={underlyingChanges}\n                            path={path}\n                            entity={entity}\n                            entityId={entityId}\n                            collection={collection}\n                            formContext={formContext}\n                            status={status}\n                            savingError={savingError}\n                            closeAfterSaveRef={closeAfterSaveRef}/>}\n\n                    </Box>\n                </>\n            }}\n        </Formik>\n    );\n}\n\nfunction InnerForm<M extends Record<string, any>>(props: FormikProps<M> & {\n    initialValues: Partial<M>,\n    onModified: ((modified: boolean) => void) | undefined,\n    onValuesChanged?: (changedValues?: EntityValues<M>) => void,\n    underlyingChanges: Partial<M>,\n    path: string\n    entity: Entity<M> | undefined,\n    collection: EntityCollection<M>,\n    entityId: string,\n    formContext: FormContext<M>,\n    status: \"new\" | \"existing\" | \"copy\",\n    savingError?: Error,\n    closeAfterSaveRef: MutableRefObject<boolean>,\n}) {\n\n    const {\n        initialValues,\n        values,\n        onModified,\n        onValuesChanged,\n        underlyingChanges,\n        entityId,\n        formContext,\n        entity,\n        touched,\n        setFieldValue,\n        collection,\n        path,\n        isSubmitting,\n        status,\n        handleSubmit,\n        savingError,\n        dirty,\n        errors,\n        closeAfterSaveRef\n    } = props;\n\n    const modified = dirty;\n    useEffect(() => {\n        if (onModified)\n            onModified(modified);\n        if (onValuesChanged)\n            onValuesChanged(values);\n    }, [modified, values]);\n\n    useEffect(() => {\n        if (underlyingChanges && entity) {\n            // we update the form fields from the Firestore data\n            // if they were not touched\n            Object.entries(underlyingChanges).forEach(([key, value]) => {\n                const formValue = values[key];\n                if (!equal(value, formValue) && !touched[key]) {\n                    console.debug(\"Updated value from the datasource:\", key, value);\n                    setFieldValue(key, value !== undefined ? value : null);\n                }\n            });\n        }\n    }, [underlyingChanges, entity, values, touched, setFieldValue]);\n\n    const formFields = (\n        <Grid container spacing={6}>\n            {Object.entries(collection.properties)\n                .map(([key, property]) => {\n\n                    const underlyingValueHasChanged: boolean =\n                        !!underlyingChanges &&\n                        Object.keys(underlyingChanges).includes(key) &&\n                        !!touched[key];\n\n                    const disabled = isSubmitting || isReadOnly(property) || Boolean(property.disabled);\n                    const cmsFormFieldProps: PropertyFieldBindingProps<any, M> = {\n                        propertyKey: key,\n                        disabled,\n                        property,\n                        includeDescription: true,\n                        underlyingValueHasChanged,\n                        context: formContext,\n                        tableMode: false,\n                        partOfArray: false,\n                        autoFocus: false\n                    };\n\n                    return (\n                        <Grid item\n                              xs={12}\n                              id={`form_field_${key}`}\n                              key={`field_${collection.name}_${key}`}>\n                            <PropertyFieldBinding {...cmsFormFieldProps}/>\n                        </Grid>\n                    );\n                })}\n\n        </Grid>\n    );\n\n    const disabled = isSubmitting || (!modified && status === \"existing\");\n    const formRef = React.createRef<HTMLDivElement>();\n\n    return (\n\n        <Form onSubmit={handleSubmit}\n              noValidate>\n            <Box sx={{ mt: 4 }}\n                 ref={formRef}>\n\n                {formFields}\n\n                <ErrorFocus containerRef={formRef}/>\n\n            </Box>\n\n            <Box sx={{ height: 56 }}/>\n\n            <CustomDialogActions position={\"absolute\"}>\n\n                {savingError &&\n                    <Box textAlign=\"right\">\n                        <Typography color={\"error\"}>\n                            {savingError.message}\n                        </Typography>\n                    </Box>}\n\n                {status === \"existing\" &&\n                    <Button\n                        variant=\"text\"\n                        color=\"primary\"\n                        disabled={disabled}\n                        type=\"reset\"\n                    >\n                        Discard\n                    </Button>}\n\n                <Button\n                    variant=\"text\"\n                    color=\"primary\"\n                    type=\"submit\"\n                    disabled={disabled}\n                    onClick={() => {\n                        closeAfterSaveRef.current = false;\n                    }}\n                >\n                    {status === \"existing\" && \"Save\"}\n                    {status === \"copy\" && \"Create copy\"}\n                    {status === \"new\" && \"Create\"}\n                </Button>\n\n                <Button\n                    variant=\"contained\"\n                    color=\"primary\"\n                    type=\"submit\"\n                    disabled={disabled}\n                    onClick={() => {\n                        closeAfterSaveRef.current = true;\n                    }}\n                >\n                    {status === \"existing\" && \"Save and close\"}\n                    {status === \"copy\" && \"Create copy and close\"}\n                    {status === \"new\" && \"Create and close\"}\n                </Button>\n\n            </CustomDialogActions>\n        </Form>\n    );\n}\n","import React from \"react\";\nimport { FieldProps } from \"../../types\";\nimport { Box, FormControl, FormHelperText } from \"@mui/material\";\nimport { FieldDescription } from \"../index\";\nimport { LabelWithIcon } from \"../components\";\nimport { PropertyFieldBinding } from \"../PropertyFieldBinding\";\nimport { useClearRestoreValue } from \"../../hooks\";\nimport { ExpandablePanel, getIconForProperty } from \"../../core\";\n\n/**\n * Array field used for custom\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function ArrayCustomShapedFieldBinding<T extends Array<any>>({\n                                                                        propertyKey,\n                                                                        value,\n                                                                        error,\n                                                                        showError,\n                                                                        isSubmitting,\n                                                                        setValue,\n                                                                        tableMode,\n                                                                        property,\n                                                                        includeDescription,\n                                                                        underlyingValueHasChanged,\n                                                                        context,\n                                                                        disabled\n                                                                    }: FieldProps<T, any, any>) {\n\n    if (!Array.isArray(property.resolvedProperties))\n        throw Error(\"ArrayCustomShapedFieldBinding misconfiguration. Property `of` not set\");\n\n    const expanded = property.expanded === undefined ? true : property.expanded;\n\n    useClearRestoreValue({\n        property,\n        value,\n        setValue\n    });\n\n    const title = <LabelWithIcon icon={getIconForProperty(property)}\n                                 title={property.name}/>;\n\n    const body = property.resolvedProperties.map((childProperty, index) => {\n        const fieldProps = {\n            propertyKey: `${propertyKey}[${index}]`,\n            disabled,\n            property: childProperty,\n            includeDescription,\n            underlyingValueHasChanged,\n            context,\n            tableMode: false,\n            partOfArray: true,\n            autoFocus: false\n        };\n        return <Box key={`custom_shaped_array_${index}`} pb={1}>\n            <PropertyFieldBinding {...fieldProps}/>\n        </Box>;\n    });\n\n    return (\n\n        <FormControl fullWidth error={showError}>\n\n            {!tableMode && <ExpandablePanel initiallyExpanded={expanded} title={title}>\n                {body}\n            </ExpandablePanel>}\n\n            {tableMode && body}\n\n            {includeDescription &&\n                <FieldDescription property={property}/>}\n\n            {showError && typeof error === \"string\" &&\n                <FormHelperText error={true}>{error}</FormHelperText>}\n\n        </FormControl>\n    );\n}\n","import React from \"react\";\nimport ShortTextIcon from \"@mui/icons-material/ShortText\";\nimport SubjectIcon from \"@mui/icons-material/Subject\";\nimport AddLinkIcon from \"@mui/icons-material/AddLink\";\nimport ListIcon from \"@mui/icons-material/List\";\nimport ScheduleIcon from \"@mui/icons-material/Schedule\";\nimport UploadFileIcon from \"@mui/icons-material/UploadFile\";\nimport DriveFolderUploadIcon from \"@mui/icons-material/DriveFolderUpload\";\nimport RepeatIcon from \"@mui/icons-material/Repeat\";\nimport ViewStreamIcon from \"@mui/icons-material/ViewStream\";\nimport ListAltIcon from \"@mui/icons-material/ListAlt\";\nimport LinkIcon from \"@mui/icons-material/Link\";\nimport HttpIcon from \"@mui/icons-material/Http\";\nimport FlagIcon from \"@mui/icons-material/Flag\";\nimport NumbersIcon from \"@mui/icons-material/Numbers\";\nimport FormatListNumberedIcon from \"@mui/icons-material/FormatListNumbered\";\nimport FormatQuoteIcon from \"@mui/icons-material/FormatQuote\";\nimport EmailIcon from \"@mui/icons-material/Email\";\nimport BallotOutlinedIcon from \"@mui/icons-material/BallotOutlined\";\n\nimport {\n    ArrayEnumSelectBinding,\n    ArrayOfReferencesFieldBinding,\n    ArrayProperty,\n    BlockFieldBinding,\n    DateTimeFieldBinding,\n    FieldConfig,\n    FieldConfigId,\n    FieldProps,\n    isPropertyBuilder,\n    MapFieldBinding,\n    MarkdownFieldBinding,\n    Property,\n    ReferenceFieldBinding,\n    RepeatFieldBinding,\n    ResolvedProperty,\n    SelectFieldBinding,\n    StorageUploadFieldBinding,\n    SwitchFieldBinding,\n    TextFieldBinding\n} from \"../index\";\nimport {\n    ArrayCustomShapedFieldBinding\n} from \"../form/field_bindings/ArrayCustomShapedFieldBinding\";\n\nexport const DEFAULT_FIELD_CONFIGS: Record<FieldConfigId, FieldConfig<any>> = {\n    text_field: {\n        name: \"Text field\",\n        description: \"Simple short text\",\n        dataType: \"string\",\n        Icon: ShortTextIcon,\n        color: \"#2d7ff9\",\n        Field: TextFieldBinding\n    },\n    multiline: {\n        name: \"Multiline\",\n        description: \"Text with multiple lines\",\n        dataType: \"string\",\n        Icon: SubjectIcon,\n        color: \"#2d7ff9\",\n        Field: TextFieldBinding\n    },\n    markdown: {\n        name: \"Markdown\",\n        description: \"Text with advanced markdown syntax\",\n        dataType: \"string\",\n        Icon: FormatQuoteIcon,\n        color: \"#2d7ff9\",\n        Field: MarkdownFieldBinding\n    },\n    url: {\n        name: \"Url\",\n        description: \"Text with URL validation\",\n        dataType: \"string\",\n        Icon: HttpIcon,\n        color: \"#154fb3\",\n        Field: TextFieldBinding\n    },\n    email: {\n        name: \"Email\",\n        description: \"Text with email validation\",\n        dataType: \"string\",\n        Icon: EmailIcon,\n        color: \"#154fb3\",\n        Field: TextFieldBinding\n    },\n    select: {\n        name: \"Select/enum\",\n        description: \"Select one text value from within an enumeration\",\n        dataType: \"string\",\n        Icon: ListIcon,\n        color: \"#4223c9\",\n        Field: SelectFieldBinding\n    },\n    multi_select: {\n        name: \"Multi select\",\n        description: \"Select multiple text values from within an enumeration\",\n        dataType: \"array\",\n        Icon: ListAltIcon,\n        color: \"#4223c9\",\n        Field: ArrayEnumSelectBinding\n    },\n    number_input: {\n        name: \"Number input\",\n        description: \"Simple number field with validation\",\n        dataType: \"number\",\n        Icon: NumbersIcon,\n        color: \"#bec920\",\n        Field: TextFieldBinding\n    },\n    number_select: {\n        name: \"Number select\",\n        description: \"Select a number value from within an enumeration\",\n        dataType: \"number\",\n        Icon: FormatListNumberedIcon,\n        color: \"#bec920\",\n        Field: SelectFieldBinding\n    },\n    multi_number_select: {\n        name: \"Multiple number select\",\n        description: \"Select multiple number values from within an enumeration\",\n        dataType: \"array\",\n        Icon: FormatListNumberedIcon,\n        color: \"#bec920\",\n        Field: ArrayEnumSelectBinding\n    },\n    file_upload: {\n        name: \"File upload\",\n        description: \"Input for uploading single files\",\n        dataType: \"string\",\n        Icon: UploadFileIcon,\n        color: \"#f92d9a\",\n        Field: StorageUploadFieldBinding as React.ComponentType<FieldProps<string>>\n    },\n    multi_file_upload: {\n        name: \"Multiple file upload\",\n        description: \"Input for uploading multiple files\",\n        dataType: \"array\",\n        Icon: DriveFolderUploadIcon,\n        color: \"#f92d9a\",\n        Field: StorageUploadFieldBinding\n    },\n    reference: {\n        name: \"Reference\",\n        description: \"The value refers to a different collection\",\n        dataType: \"reference\",\n        Icon: LinkIcon,\n        color: \"#ff0042\",\n        Field: ReferenceFieldBinding\n    },\n    multi_references: {\n        name: \"Multiple references\",\n        description: \"Multiple values that refer to a different collection\",\n        dataType: \"array\",\n        Icon: AddLinkIcon,\n        color: \"#ff0042\",\n        Field: ArrayOfReferencesFieldBinding\n    },\n    switch: {\n        name: \"Switch\",\n        description: \"True or false field (or yes or no, 0 or 1...)\",\n        dataType: \"boolean\",\n        Icon: FlagIcon,\n        color: \"#20d9d2\",\n        Field: SwitchFieldBinding\n    },\n    date_time: {\n        name: \"Date/time\",\n        description: \"A date time select field\",\n        dataType: \"date\",\n        Icon: ScheduleIcon,\n        color: \"#8b46ff\",\n        Field: DateTimeFieldBinding\n    },\n    group: {\n        name: \"Group\",\n        description: \"Group of multiple fields\",\n        dataType: \"map\",\n        Icon: BallotOutlinedIcon,\n        color: \"#ff9408\",\n        Field: MapFieldBinding\n    },\n    repeat: {\n        name: \"Repeat/list\",\n        description: \"A field that gets repeated multiple times (e.g. multiple text fields)\",\n        dataType: \"array\",\n        Icon: RepeatIcon,\n        color: \"#ff9408\",\n        Field: RepeatFieldBinding\n    },\n    custom_array: {\n        name: \"Custom array\",\n        description: \"A field that saved its value as an array of custom objects\",\n        dataType: \"array\",\n        Icon: RepeatIcon,\n        color: \"#ff9408\",\n        Field: ArrayCustomShapedFieldBinding\n    },\n    block: {\n        name: \"Block\",\n        description: \"A complex field that allows the user to compose different fields together, with a key->value format\",\n        dataType: \"array\",\n        Icon: ViewStreamIcon,\n        color: \"#ff9408\",\n        Field: BlockFieldBinding\n    }\n};\n\nexport function getFieldConfig(property: Property | ResolvedProperty): FieldConfig | undefined {\n    const fieldId = getFieldId(property);\n    return fieldId ? DEFAULT_FIELD_CONFIGS[fieldId] : undefined;\n}\n\nexport function getFieldId(property: Property | ResolvedProperty): FieldConfigId | undefined {\n    if (property.dataType === \"string\") {\n        if (property.multiline) {\n            return \"multiline\";\n        } else if (property.markdown) {\n            return \"markdown\";\n        } else if (property.storage) {\n            return \"file_upload\";\n        } else if (property.url) {\n            return \"url\";\n        } else if (property.email) {\n            return \"email\";\n        } else if (property.enumValues) {\n            return \"select\";\n        } else {\n            return \"text_field\";\n        }\n    } else if (property.dataType === \"number\") {\n        if (property.enumValues) {\n            return \"number_select\";\n        }\n        return \"number_input\";\n    } else if (property.dataType === \"map\") {\n        if (property.properties)\n            return \"group\";\n    } else if (property.dataType === \"array\") {\n        const of = (property as ArrayProperty).of;\n        const oneOf = (property as ArrayProperty).oneOf;\n        if (Array.isArray(of)) {\n            return \"custom_array\";\n        } else if (isPropertyBuilder(of)) {\n            return \"repeat\";\n        } else if (of?.dataType === \"string\" && of.enumValues) {\n            return \"multi_select\";\n        } else if (of?.dataType === \"number\" && of.enumValues) {\n            return \"multi_number_select\";\n        } else if (of?.dataType === \"string\" && of.storage) {\n            return \"multi_file_upload\";\n        } else if (of?.dataType === \"reference\") {\n            return \"multi_references\";\n        } else if (oneOf) {\n            return \"block\";\n        } else {\n            return \"repeat\";\n        }\n    } else if (property.dataType === \"boolean\") {\n        return \"switch\";\n    } else if (property.dataType === \"date\") {\n        return \"date_time\";\n    } else if (property.dataType === \"reference\") {\n        return \"reference\";\n    }\n\n    console.error(\"Unsupported field config mapping\", property);\n    return undefined;\n}\n","import React from \"react\";\nimport AdjustIcon from \"@mui/icons-material/Adjust\";\nimport FunctionsIcon from \"@mui/icons-material/Functions\";\nimport Crop75Icon from \"@mui/icons-material/Crop75\";\n\nimport {\n    FieldConfig,\n    PropertiesOrBuilders,\n    PropertyOrBuilder,\n    ResolvedProperty\n} from \"../../types\";\nimport { getFieldConfig } from \"../form_field_configs\";\nimport { Box } from \"@mui/material\";\nimport { isPropertyBuilder } from \"./entities\";\nimport { resolveProperty } from \"./resolutions\";\n\nexport function isReferenceProperty(propertyOrBuilder: PropertyOrBuilder,\n                                    fields?: Record<string, FieldConfig>) {\n    const resolvedProperty = resolveProperty({\n        propertyKey: \"ignore\", // TODO\n        propertyOrBuilder,\n        fields\n    });\n    if (!resolvedProperty) return null;\n    if (resolvedProperty.dataType === \"reference\") {\n        return true;\n    }\n    if (resolvedProperty.dataType === \"array\") {\n        if (Array.isArray(resolvedProperty.of)) return false;\n        else return resolvedProperty.of?.dataType === \"reference\"\n    }\n    return false;\n}\n\nexport function getIdIcon(\n    color: \"inherit\" | \"primary\" | \"secondary\" | \"action\" | \"disabled\" | \"error\" = \"inherit\",\n    fontSize: \"inherit\" | \"medium\" | \"large\" | \"small\" | undefined = \"inherit\"): React.ReactNode {\n    return <AdjustIcon color={color} fontSize={fontSize}/>;\n}\n\nfunction getIconForWidget(widget: FieldConfig | undefined,\n                          color: \"inherit\" | \"primary\" | \"secondary\" | \"action\" | \"disabled\" | \"error\",\n                          fontSize: \"inherit\" | \"medium\" | \"large\" | \"small\" | undefined) {\n    const Icon = widget?.Icon ?? Crop75Icon;\n    return <Icon color={color} fontSize={fontSize}/>;\n}\n\nexport function getIconForProperty(\n    property: PropertyOrBuilder | ResolvedProperty,\n    color: \"inherit\" | \"primary\" | \"secondary\" | \"action\" | \"disabled\" | \"error\" = \"inherit\",\n    fontSize: \"inherit\" | \"medium\" | \"large\" | \"small\" | undefined = \"inherit\"): React.ReactNode {\n\n    if (isPropertyBuilder(property)) {\n        return <FunctionsIcon color={color} fontSize={fontSize}/>;\n    } else {\n        const widget = getFieldConfig(property);\n        return getIconForWidget(widget, color, fontSize);\n    }\n}\n\nexport function getBadgeForWidget(\n    widget: FieldConfig | undefined,\n    color: \"inherit\" | \"primary\" | \"secondary\" | \"action\" | \"disabled\" | \"error\" = \"inherit\"): React.ReactNode {\n\n    return <Box sx={{\n        background: widget?.color ?? \"#888\",\n        height: \"32px\",\n        width: \"32px\",\n        padding: 0.5,\n        borderRadius: \"50%\",\n        boxShadow: \"0px 2px 1px -1px rgb(0 0 0 / 20%), 0px 1px 1px 0px rgb(0 0 0 / 14%), 0px 1px 3px 0px rgb(0 0 0 / 12%)\",\n        color: \"white\"\n    }}>\n        {getIconForWidget(widget, color, \"medium\")}\n    </Box>\n}\n\nexport function getColorForProperty(property: PropertyOrBuilder): string {\n    if (isPropertyBuilder(property)) {\n        return \"#888\";\n    } else {\n        const widget = getFieldConfig(property);\n        return widget?.color ?? \"#666\";\n    }\n}\n\n/**\n * Get a property in a property tree from a path like\n * `address.street`\n * @param properties\n * @param path\n */\nexport function getPropertyInPath<M extends Record<string, any>>(properties: PropertiesOrBuilders<M>, path: string): PropertyOrBuilder<any, M> | undefined {\n    if (typeof properties === \"object\") {\n        if (path in properties) {\n            return properties[path];\n        }\n        if (path.includes(\".\")) {\n            const pathSegments = path.split(\".\");\n            const childProperty = properties[pathSegments[0]];\n            if (typeof childProperty === \"object\" && childProperty.dataType === \"map\" && childProperty.properties) {\n                return getPropertyInPath(childProperty.properties, pathSegments.slice(1).join(\".\"))\n            }\n        }\n    }\n    return undefined;\n}\n\nexport function getResolvedPropertyInPath(properties: Record<string, ResolvedProperty>, path: string): ResolvedProperty | undefined {\n    if (typeof properties === \"object\") {\n        if (path in properties) {\n            return properties[path];\n        }\n        if (path.includes(\".\")) {\n            const pathSegments = path.split(\".\");\n            const childProperty = properties[pathSegments[0]];\n            if (childProperty.dataType === \"map\" && childProperty.properties) {\n                return getResolvedPropertyInPath(childProperty.properties, pathSegments.slice(1).join(\".\"))\n            }\n        }\n    }\n    return undefined;\n}\n\n// replace the dot notation with brackets\n// address.street => address[street]\nexport function getBracketNotation(path: string): string {\n    return path.replace(/\\.([^.]*)/g, \"[$1]\"); ;\n}\n","import {\n    AuthController,\n    Entity,\n    EntityCollection,\n    Permissions,\n    User\n} from \"../../types\";\n\nconst DEFAULT_PERMISSIONS = {\n    read: true,\n    edit: true,\n    create: true,\n    delete: true\n};\n\nexport function resolvePermissions<M extends Record<string, any>, UserType extends User>\n(collection: EntityCollection<M>,\n authController: AuthController<UserType>,\n pathSegments: string[],\n entity: Entity<M> | null): Permissions {\n\n    const permission = collection.permissions;\n    if (permission === undefined) {\n        return DEFAULT_PERMISSIONS;\n    } else if (typeof permission === \"object\") {\n        return permission as Permissions;\n    } else if (typeof permission === \"function\") {\n        return permission({\n            entity,\n            user: authController.user,\n            authController,\n            collection,\n            pathSegments\n        });\n    }\n    console.error(\"Permissions:\", permission);\n    throw Error(\"New type of permission added and not mapped\");\n}\n\nexport function canEditEntity<M extends Record<string, any>, UserType extends User>\n(\n    collection: EntityCollection<M>,\n    authController: AuthController<UserType>,\n    paths: string[],\n    entity: Entity<M> | null): boolean {\n    return resolvePermissions(collection, authController, paths, entity).edit ?? DEFAULT_PERMISSIONS.edit;\n}\n\nexport function canCreateEntity<M extends Record<string, any>, UserType extends User>\n(\n    collection: EntityCollection<M>,\n    authController: AuthController<UserType>,\n    paths: string[],\n    entity: Entity<M> | null): boolean {\n    return resolvePermissions(collection, authController, paths, entity).create ?? DEFAULT_PERMISSIONS.create;\n}\n\nexport function canDeleteEntity<M extends Record<string, any>, UserType extends User>\n(\n    collection: EntityCollection<M>,\n    authController: AuthController<UserType>,\n    paths: string[],\n    entity: Entity<M> | null): boolean {\n    return resolvePermissions(collection, authController, paths, entity).delete ?? DEFAULT_PERMISSIONS.delete;\n}\n\n// export function resolveCollectionsPermissions(roles: Role[]): Record<string, Permissions> {\n//     const collectionIds = Array.from(new Set(roles.flatMap(role => Object.keys(role.collections))));\n//     return collectionIds\n//         .map((colId) => {\n//             const rolesWithCollection = roles.filter((role) => colId in Object.keys(role.collections));\n//             return {\n//                 [colId]: rolesWithCollection\n//                     .map(role => role.collections[colId])\n//                     .reduce((permA, permB) => {\n//                         return {\n//                             read: permA.read ?? permB.read ?? false,\n//                             create: permA.create ?? permB.create ?? false,\n//                             edit: permA.edit ?? permB.edit ?? false,\n//                             delete: permA.delete ?? permB.delete ?? false\n//                         };\n//                     })\n//             };\n//         })\n//         .reduce((a, b) => ({ ...a, ...b }), {});\n// }\n","import * as mui from \"@mui/icons-material\";\n\nimport { CMSView, EntityCollection } from \"../../types\";\nimport { SvgIconTypeMap } from \"@mui/material\";\nimport { hashString } from \"./hash\";\n\nexport function getIcon(iconKey?: string) {\n    if (!iconKey) return undefined;\n    return iconKey in mui ? mui[iconKey as keyof typeof mui] : undefined;\n}\n\nexport function getIconForView(collectionOrView: EntityCollection | CMSView): React.ComponentType<SvgIconTypeMap[\"props\"]> {\n    const icon = getIcon(collectionOrView.icon);\n    if (collectionOrView?.icon && icon)\n        return icon;\n    const iconsCount = collectionIconKeys.length;\n    const key = collectionIconKeys[hashString(collectionOrView.path) % iconsCount] as keyof typeof mui\n    return mui[key];\n}\n\nexport const collectionIconKeys:string[] = [\"AcUnit\", \"Adjust\", \"AlignHorizontalCenter\", \"Album\", \"AllInclusive\", \"AllOut\", \"Animation\", \"Assistant\", \"Attractions\", \"Audiotrack\", \"AutoAwesome\", \"AutoAwesomeMosaic\", \"BeachAccess\", \"Bolt\", \"Brightness1\", \"BreakfastDining\", \"BrokenImage\", \"Brightness5\", \"Cable\", \"CalendarViewMonth\", \"CatchingPokemon\", \"Casino\", \"Category\", \"Cloud\", \"ColorLens\", \"CreditCard\", \"Coronavirus\", \"Earbuds\", \"EggAlt\", \"FiberSmartRecord\", \"Flag\", \"Healing\", \"HeatPump\", \"Hive\", \"Hub\", \"LocalFireDepartment\", \"LocalPizza\", \"Memory\", \"Outlet\", \"Pages\", \"PanoramaPhotosphere\", \"SignalCellular0Bar\", \"SportsBaseball\", \"Storm\", \"Stairs\"];\n","/**\n * Returns the plural of an English word.\n *\n * @export\n * @param {string} word\n * @param {number} [amount]\n * @returns {string}\n */\nexport function plural(word: string, amount?: number): string {\n    if (amount !== undefined && amount === 1) {\n        return word\n    }\n    const plurals: { [key: string]: string } = {\n        \"(quiz)$\": \"$1zes\",\n        \"^(ox)$\": \"$1en\",\n        \"([m|l])ouse$\": \"$1ice\",\n        \"(matr|vert|ind)ix|ex$\": \"$1ices\",\n        \"(x|ch|ss|sh)$\": \"$1es\",\n        \"([^aeiouy]|qu)y$\": \"$1ies\",\n        \"(hive)$\": \"$1s\",\n        \"(?:([^f])fe|([lr])f)$\": \"$1$2ves\",\n        \"(shea|lea|loa|thie)f$\": \"$1ves\",\n        sis$: \"ses\",\n        \"([ti])um$\": \"$1a\",\n        \"(tomat|potat|ech|her|vet)o$\": \"$1oes\",\n        \"(bu)s$\": \"$1ses\",\n        \"(alias)$\": \"$1es\",\n        \"(octop)us$\": \"$1i\",\n        \"(ax|test)is$\": \"$1es\",\n        \"(us)$\": \"$1es\",\n        \"([^s]+)$\": \"$1s\"\n    }\n    const irregular: { [key: string]: string } = {\n        move: \"moves\",\n        foot: \"feet\",\n        goose: \"geese\",\n        sex: \"sexes\",\n        child: \"children\",\n        man: \"men\",\n        tooth: \"teeth\",\n        person: \"people\"\n    }\n    const uncountable: string[] = [\n        \"sheep\",\n        \"fish\",\n        \"deer\",\n        \"moose\",\n        \"series\",\n        \"species\",\n        \"money\",\n        \"rice\",\n        \"information\",\n        \"equipment\",\n        \"bison\",\n        \"cod\",\n        \"offspring\",\n        \"pike\",\n        \"salmon\",\n        \"shrimp\",\n        \"swine\",\n        \"trout\",\n        \"aircraft\",\n        \"hovercraft\",\n        \"spacecraft\",\n        \"sugar\",\n        \"tuna\",\n        \"you\",\n        \"wood\"\n    ]\n    // save some time in the case that singular and plural are the same\n    if (uncountable.indexOf(word.toLowerCase()) >= 0) {\n        return word;\n    }\n    // check for irregular forms\n    for (const w in irregular) {\n        const pattern = new RegExp(`${w}$`, \"i\")\n        const replace = irregular[w]\n        if (pattern.test(word)) {\n            return word.replace(pattern, replace);\n        }\n    }\n    // check for matches using regular expressions\n    for (const reg in plurals) {\n        const pattern = new RegExp(reg, \"i\")\n        if (pattern.test(word)) {\n            return word.replace(pattern, plurals[reg])\n        }\n    }\n    return word;\n}\n\n/**\n * Returns the singular of an English word.\n *\n * @export\n * @param {string} word\n * @param {number} [amount]\n * @returns {string}\n */\nexport function singular(word: string, amount?: number): string {\n    if (amount !== undefined && amount !== 1) {\n        return word;\n    }\n    const singulars: { [key: string]: string } = {\n        \"(quiz)zes$\": \"$1\",\n        \"(matr)ices$\": \"$1ix\",\n        \"(vert|ind)ices$\": \"$1ex\",\n        \"^(ox)en$\": \"$1\",\n        \"(alias)es$\": \"$1\",\n        \"(octop|vir)i$\": \"$1us\",\n        \"(cris|ax|test)es$\": \"$1is\",\n        \"(shoe)s$\": \"$1\",\n        \"(o)es$\": \"$1\",\n        \"(bus)es$\": \"$1\",\n        \"([m|l])ice$\": \"$1ouse\",\n        \"(x|ch|ss|sh)es$\": \"$1\",\n        \"(m)ovies$\": \"$1ovie\",\n        \"(s)eries$\": \"$1eries\",\n        \"([^aeiouy]|qu)ies$\": \"$1y\",\n        \"([lr])ves$\": \"$1f\",\n        \"(tive)s$\": \"$1\",\n        \"(hive)s$\": \"$1\",\n        \"(li|wi|kni)ves$\": \"$1fe\",\n        \"(shea|loa|lea|thie)ves$\": \"$1f\",\n        \"(^analy)ses$\": \"$1sis\",\n        \"((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$\": \"$1$2sis\",\n        \"([ti])a$\": \"$1um\",\n        \"(n)ews$\": \"$1ews\",\n        \"(h|bl)ouses$\": \"$1ouse\",\n        \"(corpse)s$\": \"$1\",\n        \"(us)es$\": \"$1\",\n        s$: \"\"\n    }\n    const irregular: { [key: string]: string } = {\n        move: \"moves\",\n        foot: \"feet\",\n        goose: \"geese\",\n        sex: \"sexes\",\n        child: \"children\",\n        man: \"men\",\n        tooth: \"teeth\",\n        person: \"people\"\n    }\n    const uncountable: string[] = [\n        \"sheep\",\n        \"fish\",\n        \"deer\",\n        \"moose\",\n        \"series\",\n        \"species\",\n        \"money\",\n        \"rice\",\n        \"information\",\n        \"equipment\",\n        \"bison\",\n        \"cod\",\n        \"offspring\",\n        \"pike\",\n        \"salmon\",\n        \"shrimp\",\n        \"swine\",\n        \"trout\",\n        \"aircraft\",\n        \"hovercraft\",\n        \"spacecraft\",\n        \"sugar\",\n        \"tuna\",\n        \"you\",\n        \"wood\"\n    ]\n    // save some time in the case that singular and plural are the same\n    if (uncountable.indexOf(word.toLowerCase()) >= 0) {\n        return word;\n    }\n    // check for irregular forms\n    for (const w in irregular) {\n        const pattern = new RegExp(`${irregular[w]}$`, \"i\");\n        if (pattern.test(word)) {\n            return word.replace(pattern, w);\n        }\n    }\n    // check for matches using regular expressions\n    for (const reg in singulars) {\n        const pattern = new RegExp(reg, \"i\");\n        if (pattern.test(word)) {\n            return word.replace(pattern, singulars[reg]);\n        }\n    }\n    return word;\n}\n","import { EntityCollection, FieldConfig } from \"../../types\";\nimport { isReferenceProperty } from \"./property_utils\";\nimport { isPropertyBuilder } from \"./entities\";\n\nexport function getReferencePreviewKeys(targetCollection: EntityCollection<any>,\n                                        fields?: Record<string, FieldConfig>,\n                                        previewProperties?: string[],\n                                        limit = 3) {\n    const allProperties = Object.keys(targetCollection.properties);\n    let listProperties = previewProperties?.filter(p => allProperties.includes(p as string));\n    if (listProperties && listProperties.length > 0) {\n        return listProperties;\n    } else {\n        listProperties = allProperties;\n        return listProperties.filter(key => {\n            const propertyOrBuilder = targetCollection.properties[key];\n            return propertyOrBuilder && !isPropertyBuilder(propertyOrBuilder) && !isReferenceProperty(propertyOrBuilder, fields);\n        }).slice(0, limit);\n    }\n}\n","import * as React from \"react\";\n\nimport { styled } from \"@mui/material/styles\";\n\nimport {\n    Box,\n    IconButton,\n    Table,\n    TableBody,\n    TableCell,\n    TableContainer,\n    TableRow,\n    Theme,\n    Typography\n} from \"@mui/material\";\nimport {\n    Entity,\n    EntityCollection,\n    FireCMSContext,\n    ResolvedEntityCollection,\n    ResolvedProperties\n} from \"../../types\";\nimport { PropertyPreview } from \"../../preview\";\nimport OpenInNewIcon from \"@mui/icons-material/OpenInNew\";\nimport { getIconForProperty, getIdIcon, resolveCollection } from \"../util\";\nimport { ErrorBoundary } from \"./ErrorBoundary\";\nimport { useFireCMSContext } from \"../../hooks\";\n\nconst PREFIX = \"EntityPreview\";\n\nconst classes = {\n    property: `${PREFIX}-property`,\n    valuePreview: `${PREFIX}-valuePreview`,\n    iconCell: `${PREFIX}-iconCell`,\n    titleCell: `${PREFIX}-titleCell`\n};\n\nconst StyledTableContainer = styled(TableContainer)((\n    { theme }: {\n        theme: Theme\n    }\n) => ({\n    [`& .${classes.property}`]: {\n        display: \"flex\"\n    },\n\n    [`& .${classes.valuePreview}`]: {\n        height: \"72px\",\n        padding: theme.spacing(2, 3)\n    },\n\n    [`& .${classes.iconCell}`]: {\n        paddingTop: theme.spacing(1)\n    },\n\n    [`& .${classes.titleCell}`]: {\n        width: \"25%\",\n        padding: theme.spacing(1)\n    }\n}));\n\n/**\n * @category Components\n */\nexport interface EntityPreviewProps<M extends Record<string, any>> {\n    entity: Entity<M>;\n    collection: EntityCollection<M>;\n    path: string;\n}\n\n/**\n * Use this component to render a preview of a property values\n * @param entity\n * @param collection\n * @param path\n * @constructor\n * @category Components\n */\nexport function EntityPreview<M extends Record<string, any>>(\n    {\n        entity,\n        collection,\n        path\n    }: EntityPreviewProps<M>) {\n\n    const context = useFireCMSContext();\n    const resolvedCollection: ResolvedEntityCollection<M> = React.useMemo(() => resolveCollection<M>({\n        collection,\n        path,\n        entityId: entity.id,\n        values: entity.values,\n        fields: context.fields\n    }), [collection, path, entity]);\n\n    const appConfig: FireCMSContext | undefined = useFireCMSContext();\n\n    const properties: ResolvedProperties = resolvedCollection.properties;\n\n    return (\n        <>\n\n            <Box\n                sx={(theme) => ({\n                    width: \"100%\",\n                    marginTop: theme.spacing(3),\n                    paddingLeft: theme.spacing(4),\n                    paddingRight: theme.spacing(4),\n                    paddingTop: theme.spacing(3),\n                    [theme.breakpoints.down(\"lg\")]: {\n                        marginTop: theme.spacing(2),\n                        paddingLeft: theme.spacing(2),\n                        paddingRight: theme.spacing(2),\n                        paddingTop: theme.spacing(2)\n                    },\n                    [theme.breakpoints.down(\"md\")]: {\n                        marginTop: theme.spacing(1),\n                        paddingLeft: theme.spacing(2),\n                        paddingRight: theme.spacing(2),\n                        paddingTop: theme.spacing(2)\n                    }\n                })}>\n\n                <Typography\n                    sx={{\n                        marginTop: 4,\n                        marginBottom: 4\n                    }}\n                    variant={\"h4\"}>{collection.singularName ?? collection.name + \" entry\"}\n                </Typography>\n\n            </Box>\n\n            <StyledTableContainer>\n                <Table aria-label=\"entity table\">\n                    <TableBody>\n                        <TableRow>\n                            <TableCell align=\"right\"\n                                       component=\"td\"\n                                       scope=\"row\"\n                                       className={classes.titleCell}>\n                                <Typography variant={\"caption\"}\n                                            color={\"textSecondary\"}>\n                                    Id\n                                </Typography>\n                            </TableCell>\n                            <TableCell padding=\"none\"\n                                       className={classes.iconCell}>\n                                {getIdIcon(\"disabled\", \"small\")}\n                            </TableCell>\n                            <TableCell className={classes.valuePreview}>\n                                <Box display=\"flex\" alignItems=\"center\">\n                                    {entity.id}\n                                    {appConfig?.entityLinkBuilder &&\n                                        <a href={appConfig.entityLinkBuilder({ entity })}\n                                           rel=\"noopener noreferrer\"\n                                           target=\"_blank\">\n                                            <IconButton\n                                                aria-label=\"go-to-entity-datasource\"\n                                                size=\"large\">\n                                                <OpenInNewIcon\n                                                    fontSize={\"small\"}/>\n                                            </IconButton>\n                                        </a>}\n                                </Box>\n                            </TableCell>\n                        </TableRow>\n\n                        {collection && Object.entries(properties)\n                            .map(([key, property]) => {\n                                const value = (entity.values)[key];\n                                return (\n                                    <TableRow\n                                        key={\"entity_prev\" + property.name + key}>\n                                        <TableCell align=\"right\"\n                                                   component=\"td\"\n                                                   scope=\"row\"\n                                                   className={classes.titleCell}>\n                                            <Typography\n                                                sx={{ paddingLeft: 2 }}\n                                                variant={\"caption\"}\n                                                color={\"textSecondary\"}>\n                                                {property.name}\n                                            </Typography>\n                                        </TableCell>\n\n                                        <TableCell padding=\"none\"\n                                                   className={classes.iconCell}>\n                                            {getIconForProperty(property, \"disabled\", \"small\")}\n                                        </TableCell>\n\n                                        <TableCell\n                                            className={classes.valuePreview}>\n                                            <ErrorBoundary>\n                                                <PropertyPreview\n                                                    propertyKey={key}\n                                                    value={value}\n                                                    entity={entity}\n                                                    property={property}\n                                                    size={\"regular\"}/>\n                                            </ErrorBoundary>\n                                        </TableCell>\n\n                                    </TableRow>\n                                );\n                            })}\n                    </TableBody>\n                </Table>\n            </StyledTableContainer>\n\n        </>\n    );\n\n}\n\nexport default EntityPreview;\n","import {\n    EntityCollection,\n    Property,\n    ResolvedArrayProperty,\n    ResolvedProperty\n} from \"../../../../types\";\n\nexport function getCellAlignment(property: Property | ResolvedProperty): \"right\" | \"left\" | \"center\" {\n    if (property.dataType === \"boolean\") {\n        return \"center\";\n    } else if (property.dataType === \"number\") {\n        if (property.enumValues)\n            return \"left\";\n        return \"right\";\n    } else if (property.dataType === \"date\") {\n        return \"right\";\n    } else {\n        return \"left\";\n    }\n}\n\nexport function isPropertyFilterable(property: ResolvedProperty): boolean {\n    if (property.dataType === \"boolean\") {\n        return true;\n    } else if (property.dataType === \"number\") {\n        return true;\n    } else if (property.dataType === \"string\") {\n        return true;\n    } else if (property.dataType === \"date\") {\n        return true;\n    } else if (property.dataType === \"array\") {\n        if (Array.isArray(property.of)) {\n            return false;\n        }\n        if (property.of)\n            return isPropertyFilterable(property.of);\n        else\n            return false;\n    } else {\n        return false;\n    }\n}\n\nexport function getPropertyColumnWidth(property: ResolvedProperty): number {\n\n    if (property.columnWidth) {\n        return property.columnWidth;\n    }\n\n    if (property.dataType === \"string\") {\n        if (property.url) {\n            return 280;\n        } else if (property.storage) {\n            return 160;\n        } else if (property.enumValues) {\n            return 200;\n        } else if (property.multiline) {\n            return 300;\n        } else if (property.markdown) {\n            return 300;\n        } else if (property.email) {\n            return 200;\n        } else {\n            return 200;\n        }\n    } else if (property.dataType === \"array\") {\n        const arrayProperty = property as ResolvedArrayProperty;\n        if (arrayProperty.of) {\n            if (Array.isArray(property.of)) {\n                return 300;\n            } else {\n                return getPropertyColumnWidth(arrayProperty.of as ResolvedProperty);\n            }\n        } else {\n            return 300;\n        }\n    } else if (property.dataType === \"number\") {\n        if (property.enumValues) {\n            return 200;\n        }\n        return 140;\n    } else if (property.dataType === \"map\") {\n        return 360;\n    } else if (property.dataType === \"date\") {\n        return 200;\n    } else if (property.dataType === \"reference\") {\n        return 220;\n    } else if (property.dataType === \"boolean\") {\n        return 140;\n    } else {\n        return 200;\n    }\n}\n\nexport function getSubcollectionColumnId(collection: EntityCollection) {\n    return `subcollection:${collection.alias ?? collection.path}`;\n}\n","import React, { useEffect, useRef, useState } from \"react\";\n\nimport { useDebounce } from \"../../../util\";\nimport { TextareaAutosize } from \"../../fields/TextareaAutosize\";\n\nexport function TableInput(props: {\n    error: Error | undefined;\n    value: string;\n    multiline: boolean;\n    focused: boolean;\n    disabled: boolean;\n    updateValue: (newValue: (string | null)) => void;\n}) {\n\n    const { disabled, value, multiline, updateValue, focused } = props;\n    const [internalValue, setInternalValue] = useState<typeof value>(value);\n    const focusedState = useRef<boolean>(false);\n\n    const doUpdate = React.useCallback(() => {\n        const emptyInitialValue = !value;\n        if (emptyInitialValue && !internalValue)\n            return;\n        if (internalValue !== value)\n            updateValue(internalValue);\n    }, [internalValue, value]);\n\n    useDebounce(internalValue, doUpdate, 3000);\n\n    // update on external value change\n    useEffect(\n        () => {\n            if (value !== internalValue)\n                setInternalValue(value);\n        }, [value]\n    );\n\n    const ref = React.createRef<HTMLTextAreaElement>();\n    useEffect(() => {\n        if (ref.current && focused && !focusedState.current) {\n            focusedState.current = true;\n            ref.current.focus({ preventScroll: true });\n            ref.current.selectionStart = ref.current.value.length;\n            ref.current.selectionEnd = ref.current.value.length;\n        } else {\n            focusedState.current = focused;\n        }\n    }, [focused, ref]);\n\n    return (\n        <TextareaAutosize\n            ref={ref}\n            style={{\n                padding: 0,\n                margin: 0,\n                width: \"100%\",\n                color: \"unset\",\n                fontWeight: \"unset\",\n                lineHeight: \"unset\",\n                fontSize: \"unset\",\n                fontFamily: \"unset\",\n                background: \"unset\",\n                border: \"unset\",\n                resize: \"none\",\n                outline: \"none\"\n            }}\n            value={internalValue ?? \"\"}\n            onChange={(evt) => {\n                const newValue = evt.target.value as string;\n                if (multiline || !newValue.endsWith(\"\\n\"))\n                    setInternalValue(newValue);\n            }}\n            onBlur={() => {\n                doUpdate();\n            }}\n        />\n    );\n}\n","import { EnumValueConfig } from \"../../../../types\";\nimport { ArrayEnumPreview, EnumValuesChip } from \"../../../../preview\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { Checkbox, ListItemText, MenuItem, Select } from \"@mui/material\";\nimport { enumToObjectEntries, isEnumValueDisabled } from \"../../../util/enums\";\nimport { SelectChangeEvent } from \"@mui/material/Select/SelectInput\";\n\nexport function TableSelect(props: {\n    name: string;\n    enumValues: EnumValueConfig[];\n    error: Error | undefined;\n    multiple: boolean;\n    disabled: boolean;\n    small: boolean;\n    internalValue: string | number | string[] | number[] | undefined;\n    valueType: \"string\" | \"number\";\n    updateValue: (newValue: (string | number | string[] | number[] | null)) => void;\n    focused: boolean;\n    onBlur?: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\n}) {\n\n    const {\n        name,\n        enumValues,\n        error,\n        internalValue,\n        disabled,\n        small,\n        focused,\n        updateValue,\n        multiple,\n        valueType\n    } = props;\n\n    const [open, setOpen] = useState<boolean>(false);\n    const handleOpen = useCallback(() => {\n        setOpen(true);\n    }, []);\n\n    const handleClose = useCallback(() => {\n        setOpen(false);\n    }, []);\n\n    const validValue = (Array.isArray(internalValue) && multiple) ||\n        (!Array.isArray(internalValue) && !multiple);\n\n    const ref = React.createRef<HTMLInputElement>();\n    useEffect(() => {\n        if (ref.current && focused) {\n            ref.current?.focus({ preventScroll: true });\n        }\n    }, [focused, ref]);\n\n    const onChange = useCallback((evt: SelectChangeEvent<any>) => {\n        if (valueType === \"number\") {\n            if (multiple) {\n                const newValue = (evt.target.value as string[]).map((v) => parseFloat(v));\n                updateValue(newValue);\n            } else {\n                updateValue(parseFloat(evt.target.value as string));\n            }\n        } else if (valueType === \"string\") {\n            if (!evt.target.value)\n                updateValue(null)\n            else\n                updateValue(evt.target.value);\n        } else {\n            throw Error(\"Missing mapping in TableSelect\");\n        }\n    }, [multiple, updateValue, valueType]);\n    const renderValue = (enumKey: unknown) => {\n        if (multiple && Array.isArray(enumKey)) {\n            return <ArrayEnumPreview value={enumKey}\n                                     name={name}\n                                     enumValues={enumValues}\n                                     size={small ? \"small\" : \"regular\"}/>;\n        } else {\n            return <EnumValuesChip\n                enumKey={enumKey}\n                enumValues={enumValues}\n                small={small}/>;\n        }\n    };\n    return (\n        <Select\n            variant={\"standard\"}\n            key={`table_select_${name}`}\n            inputRef={ref}\n            sx={{\n                height: \"100%\"\n            }}\n            open={open}\n            disabled={disabled}\n            multiple={multiple}\n            onClose={handleClose}\n            onOpen={handleOpen}\n            fullWidth\n            inputProps={{\n                sx: {\n                    height: \"100% !important\",\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    padding: \"0px 0 0px\",\n                    background: \"transparent !important\"\n                }\n            }}\n            disableUnderline\n            error={!!error}\n            value={validValue\n                ? (multiple ? (internalValue as any[]).map(v => v.toString()) : internalValue)\n                : (multiple ? [] : \"\")}\n            onChange={onChange}\n            renderValue={renderValue}>\n\n            {enumToObjectEntries(enumValues).map((enumValueConfig) => {\n\n                const enumKey = enumValueConfig.id;\n                const chip = <EnumValuesChip\n                    enumKey={enumKey}\n                    enumValues={enumValues}\n                    small={true}/>;\n                if (multiple) {\n                    return (\n                        <MenuItem key={`select-${name}-${enumKey}`}\n                                  value={enumKey}\n                                  disabled={isEnumValueDisabled(enumValueConfig)}\n                                  dense={true}>\n                            <Checkbox\n                                checked={Array.isArray(internalValue) && internalValue.map(v => v.toString()).includes(enumKey.toString())}/>\n                            <ListItemText primary={chip}/>\n                        </MenuItem>\n                    );\n                } else {\n                    return (\n                        <MenuItem key={`select-${name}-${enumKey}`}\n                                  value={enumKey}\n                                  disabled={isEnumValueDisabled(enumValueConfig)}\n                                  dense={true}>\n                            {chip}\n                        </MenuItem>\n                    );\n                }\n            })}\n        </Select>\n    );\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Input } from \"@mui/material\";\nimport { useDebounce } from \"../../../util\";\n\nexport function NumberTableInput(props: {\n    error: Error | undefined;\n    value: number;\n    align: \"right\" | \"left\" | \"center\";\n    updateValue: (newValue: (number | null)) => void;\n    focused: boolean;\n    disabled: boolean;\n    onBlur?: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\n}) {\n\n    const { align, value, updateValue, focused, onBlur, disabled } = props;\n    const propStringValue = (value && typeof value === \"number\") ? value.toString() : \"\";\n    const [internalValue, setInternalValue] = useState<string | null>(propStringValue);\n\n    const doUpdate = React.useCallback(() => {\n        if (internalValue !== propStringValue) {\n            if (internalValue !== undefined && internalValue !== null) {\n                const numberValue = parseFloat(internalValue);\n                if (isNaN(numberValue))\n                    return;\n                if (numberValue !== undefined && numberValue !== null)\n                    updateValue(numberValue);\n            } else {\n                updateValue(null);\n            }\n        }\n\n    }, [internalValue, value]);\n\n    useDebounce(internalValue, doUpdate, 3000);\n\n    useEffect(\n        () => {\n            if (!focused && propStringValue !== internalValue)\n                setInternalValue(value !== undefined && value !== null ? value.toString() : null);\n        },\n        [value, focused]\n    );\n\n    const ref = React.createRef<HTMLInputElement>();\n\n    useEffect(() => {\n        if (ref.current && focused) {\n            ref.current.focus({ preventScroll: true });\n        }\n    }, [focused, ref]);\n\n    const regexp = /^-?[0-9]+[,.]?[0-9]*$/;\n\n    return (\n        <Input\n            inputRef={ref}\n            sx={{\n                width: \"100%\",\n                fontSize: \"unset\",\n                fontFamily: \"unset\",\n                background: \"unset\",\n                border: \"unset\",\n                resize: \"none\",\n                outline: \"none\",\n                padding: 0,\n                margin: 0,\n                color: \"unset\",\n                fontWeight: \"unset\",\n                lineHeight: \"unset\",\n                textAlign: \"right\"\n            }}\n            inputProps={{\n                style: {\n                    textAlign: align\n                }\n            }}\n            disabled={disabled}\n            disableUnderline\n            value={internalValue ?? \"\"}\n            onBlur={onBlur}\n            onChange={(evt) => {\n                const newValue = evt.target.value.replace(\",\", \".\");\n                if (newValue.length === 0)\n                    setInternalValue(null);\n                if (regexp.test(newValue) || newValue.startsWith(\"-\"))\n                    setInternalValue(newValue);\n            }}\n        />\n    );\n}\n","import React, { useEffect } from \"react\";\nimport { Switch } from \"@mui/material\";\n\nexport function TableSwitch(props: {\n    error: Error | undefined;\n    internalValue?: boolean;\n    focused: boolean;\n    disabled: boolean;\n    updateValue: (newValue: (boolean | null)) => void;\n}) {\n    const { disabled, internalValue, updateValue, focused } = props;\n\n    const ref = React.createRef<HTMLTextAreaElement>();\n    useEffect(() => {\n        if (ref.current && focused) {\n            ref.current.focus({ preventScroll: true });\n        }\n    }, [focused, ref]);\n\n    return (\n        <Switch\n            inputRef={ref}\n            color={\"secondary\"}\n            checked={Boolean(internalValue)}\n            disabled={disabled}\n            onChange={(evt) => {\n                const value = evt.target.checked as boolean;\n                updateValue(value);\n            }}\n        />\n    );\n}\n","import React from \"react\";\nimport { Box, TextField as MuiTextField } from \"@mui/material\";\nimport { DateTimePicker } from \"@mui/x-date-pickers/DateTimePicker\";\nimport { DatePicker } from \"@mui/x-date-pickers/DatePicker\";\n\nexport function TableDateField(props: {\n    name: string;\n    error: Error | undefined;\n    mode?: \"date\" | \"date_time\";\n    internalValue: Date | undefined | null;\n    updateValue: (newValue: (Date | null)) => void;\n    focused: boolean;\n    disabled: boolean;\n    onBlur?: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\n}) {\n\n    const {\n        disabled,\n        error,\n        mode,\n        internalValue,\n        updateValue\n    } = props;\n\n    const PickerComponent = mode === undefined || mode === \"date_time\"\n        ? DateTimePicker\n        : DatePicker;\n\n    return (\n        <PickerComponent\n            value={internalValue ?? null}\n            disabled={disabled}\n            onChange={(dateValue: Date | null) => {\n                updateValue(dateValue);\n            }}\n            renderInput={(params) =>\n                <MuiTextField {...params}\n                              fullWidth\n                              variant={\"standard\"}\n                              error={Boolean(error)}\n                                  style={{\n                                      height: \"100%\"\n                                  }}\n                                  InputProps={{\n                                      ...params.InputProps,\n                                      style: { fontSize: 14 },\n                                      disableUnderline: true,\n                                      endAdornment: <Box sx={{ pr: 1 }}>\n                                          {params.InputProps?.endAdornment}\n                                      </Box>\n                                  }}\n                    />}\n                InputAdornmentProps={{\n                    style: {\n                        fontSize: \"small\",\n                        height: 26\n                    }\n                }}\n            />\n    );\n}\n","import React, { useCallback, useState } from \"react\";\nimport { Box, Button } from \"@mui/material\";\nimport { ReferencePreview } from \"../../../../preview\";\nimport { ErrorView } from \"../../index\";\nimport {\n    CollectionSize,\n    Entity,\n    EntityReference,\n    FilterValues\n} from \"../../../../types\";\n\nimport { getPreviewSizeFrom } from \"../../../../preview/util\";\nimport { getReferenceFrom } from \"../../../util\";\nimport { useNavigationContext, useReferenceDialog } from \"../../../../hooks\";\n\nexport function TableReferenceField(props: {\n    name: string;\n    disabled: boolean;\n    internalValue: EntityReference | EntityReference[] | undefined | null;\n    updateValue: (newValue: (EntityReference | EntityReference [] | null)) => void;\n    size: CollectionSize;\n    multiselect: boolean;\n    previewProperties?: string[];\n    title?: string;\n    path: string;\n    forceFilter?: FilterValues<string>;\n}) {\n\n    const {\n        name,\n        internalValue,\n        updateValue,\n        multiselect,\n        path,\n        size,\n        previewProperties,\n        title,\n        disabled,\n        forceFilter\n    } = props;\n\n    const [onHover, setOnHover] = useState(false);\n\n    const hoverTrue = useCallback(() => setOnHover(true), []);\n    const hoverFalse = useCallback(() => setOnHover(false), []);\n\n    const navigationContext = useNavigationContext();\n\n    const collection = navigationContext.getCollection(path);\n    if (!collection) {\n        throw Error(`Couldn't find the corresponding collection view for the path: ${path}`);\n    }\n\n    const onSingleEntitySelected = useCallback((entity: Entity<any>) => {\n        updateValue(entity ? getReferenceFrom(entity) : null);\n    }, [updateValue]);\n\n    const onMultipleEntitiesSelected = useCallback((entities: Entity<any>[]) => {\n        updateValue(entities.map((e) => getReferenceFrom(e)));\n    }, [updateValue]);\n\n    const selectedEntityIds = internalValue\n        ? (Array.isArray(internalValue)\n            ? internalValue.map((ref) => ref.id)\n            : internalValue.id ? [internalValue.id] : [])\n        : [];\n\n    const referenceDialogController = useReferenceDialog({\n            multiselect,\n            path,\n            collection,\n            onMultipleEntitiesSelected,\n            onSingleEntitySelected,\n            selectedEntityIds,\n            forceFilter\n        }\n    );\n\n    const handleOpen = useCallback(() => {\n        if (disabled)\n            return;\n        referenceDialogController.open();\n    }, [disabled, referenceDialogController]);\n\n    const valueNotSet = !internalValue || (Array.isArray(internalValue) && internalValue.length === 0);\n\n    const buildSingleReferenceField = () => {\n        if (internalValue instanceof EntityReference)\n            return <ReferencePreview\n                onClick={disabled ? undefined : handleOpen}\n                size={getPreviewSizeFrom(size)}\n                reference={internalValue as EntityReference}\n                onHover={onHover}\n                disabled={!path}\n                previewProperties={previewProperties}\n            />;\n        else\n            return <ErrorView error={\"Data is not a reference\"}/>;\n    };\n\n    const buildMultipleReferenceField = () => {\n        if (Array.isArray(internalValue))\n            return <>\n                {internalValue.map((reference, index) =>\n                    <Box sx={{ m: 0.5, width: \"100%\" }}\n                         key={`preview_array_ref_${name}_${index}`}>\n                        <ReferencePreview\n                            onClick={disabled ? undefined : handleOpen}\n                            size={\"tiny\"}\n                            reference={reference}\n                            onHover={onHover}\n                            disabled={!path}\n                            previewProperties={previewProperties}\n                        />\n                    </Box>\n                )\n                }\n            </>;\n        else\n            return <ErrorView error={\"Data is not an array of references\"}/>;\n    };\n\n    if (!collection)\n        return <ErrorView error={\"The specified collection does not exist\"}/>;\n\n    return (\n        <Box sx={{ width: \"100%\" }}\n             onMouseEnter={hoverTrue}\n             onMouseMove={hoverTrue}\n             onMouseLeave={hoverFalse}>\n\n            {internalValue && !multiselect && buildSingleReferenceField()}\n\n            {internalValue && multiselect && buildMultipleReferenceField()}\n\n            {valueNotSet &&\n                <Button\n                    onClick={handleOpen}\n                    size={\"small\"}\n                    variant=\"outlined\"\n                    color=\"primary\">\n                    Edit {title}\n                </Button>}\n\n        </Box>\n    );\n}\n","import * as React from \"react\";\nimport { useMemo, useState } from \"react\";\n\nimport { Box, IconButton, Theme, Typography, useTheme } from \"@mui/material\";\n\nimport EditIcon from \"@mui/icons-material/Edit\";\n\nimport {\n    Entity,\n    ResolvedArrayProperty,\n    ResolvedStringProperty,\n    StorageConfig\n} from \"../../../../types\";\nimport { useDropzone } from \"react-dropzone\";\nimport { PreviewSize, PropertyPreview } from \"../../../../preview\";\nimport { ErrorBoundary } from \"../../ErrorBoundary\";\nimport { useSnackbarController, useStorageSource } from \"../../../../hooks\";\nimport { getThumbnailMeasure } from \"../../../../preview/util\";\nimport {\n    StorageFieldItem,\n    useStorageUploadController\n} from \"../../../util/useStorageUploadController\";\nimport {\n    StorageUploadProgress\n} from \"../../../../form/components/StorageUploadProgress\";\n\nconst dropZoneMixin = (hasValue: boolean) => ({\n    transition: \"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms\",\n    position: \"relative\",\n    height: \"100%\",\n    width: \"100%\",\n    outline: 0,\n    display: \"flex\",\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    justifyContent: hasValue ? \"start\" : \"center\",\n    alignItems: \"center\",\n    border: \"2px solid\",\n    borderColor: \"transparent\"\n});\n\nconst activeDropMixin = (theme: Theme) => ({\n    background: theme.palette.mode === \"light\"\n        ? \"repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important\"\n        : \"repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important\",\n    borderRadius: `${theme.shape.borderRadius}px`,\n    border: \"2px solid\",\n    borderColor: \"transparent\"\n});\n\nconst acceptDropMixin = (theme: Theme) => ({\n    background: \"repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important\",\n    // background: \"repeating-linear-gradient( 45deg, rgba(0, 0, 0, 0.09), rgba(0, 0, 0, 0.09) 10px, rgba(0, 0, 0, 0.12) 10px, rgba(0, 0, 0, 0.12) 20px) !important\",\n    borderColor: theme.palette.success.light,\n    border: \"2px solid\"\n});\n\nconst rejectDropMixin = (theme: Theme) => ({\n    borderColor: theme.palette.error.light,\n    border: \"2px solid\"\n});\n\n/**\n * Field that allows to upload files to Google Cloud Storage.\n *\n * This is one of the internal components that get mapped natively inside forms\n * and tables to the specified properties.\n * @category Form fields\n */\nexport function TableStorageUpload(props: {\n    propertyKey: string;\n    error: Error | undefined;\n    disabled: boolean;\n    value: string | string[] | null;\n    updateValue: (newValue: (string | string[] | null)) => void;\n    focused: boolean;\n    property: ResolvedStringProperty | ResolvedArrayProperty<string[]>;\n    entity: Entity<any>;\n    path: string;\n    previewSize: PreviewSize;\n    onBlur?: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\n}) {\n\n    const {\n        propertyKey,\n        error,\n        value,\n        disabled,\n        property,\n        entity,\n        path,\n        previewSize,\n        updateValue\n    } = props;\n\n    const storageSource = useStorageSource();\n\n    const {\n        internalValue,\n        setInternalValue,\n        onFilesAdded,\n        storage,\n        onFileUploadComplete,\n        storagePathBuilder,\n        multipleFilesSupported\n    } = useStorageUploadController({\n        entityValues: entity.values,\n        entityId: entity.id,\n        path,\n        property,\n        propertyKey,\n        storageSource,\n        onChange: updateValue,\n        value,\n        disabled\n    });\n\n    return (\n\n        <StorageUpload\n            internalValue={internalValue}\n            setInternalValue={setInternalValue}\n            name={propertyKey}\n            disabled={disabled}\n            autoFocus={false}\n            property={property}\n            onChange={updateValue}\n            entity={entity}\n            storagePathBuilder={storagePathBuilder}\n            storage={storage}\n            multipleFilesSupported={multipleFilesSupported}\n            onFilesAdded={onFilesAdded}\n            onFileUploadComplete={onFileUploadComplete}\n            previewSize={previewSize}/>\n\n    );\n}\n\ninterface StorageUploadProps {\n    internalValue: StorageFieldItem[];\n    setInternalValue: (v: StorageFieldItem[]) => void;\n    name: string;\n    property: ResolvedStringProperty | ResolvedArrayProperty<string[]>;\n    onChange: (value: string | string[] | null) => void;\n    multipleFilesSupported: boolean;\n    autoFocus: boolean;\n    disabled: boolean;\n    entity: Entity<any>;\n    previewSize: PreviewSize;\n    storage: StorageConfig;\n    onFilesAdded: (acceptedFiles: File[]) => void;\n    storagePathBuilder: (file: File) => string;\n    onFileUploadComplete: (uploadedPath: string, entry: StorageFieldItem, fileMetadata?: any) => Promise<void>;\n}\n\nfunction StorageUpload({\n                           property,\n                           name,\n                           internalValue,\n                           setInternalValue,\n                           entity,\n                           onChange,\n                           multipleFilesSupported,\n                           previewSize: previewSizeInput,\n                           disabled,\n                           autoFocus,\n                           storage,\n                           onFilesAdded,\n                           onFileUploadComplete,\n                           storagePathBuilder\n                       }: StorageUploadProps) {\n\n    const [onHover, setOnHover] = useState(false);\n\n    const previewSize = multipleFilesSupported && previewSizeInput === \"regular\" ? \"small\" : previewSizeInput;\n    if (multipleFilesSupported) {\n        const arrayProperty = property as ResolvedArrayProperty<string[]>;\n        if (Array.isArray(arrayProperty.of)) {\n            throw Error(\"Using array properties instead of single one in `of` in ArrayProperty\");\n        }\n        if (arrayProperty.of) {\n            if (arrayProperty.of.dataType !== \"string\") {\n                throw Error(\"Storage field using array must be of data type string\");\n            }\n        } else {\n            throw Error(\"Storage field using array must be of data type string\");\n        }\n    }\n\n    const metadata: any | undefined = storage?.metadata;\n    const hasValue = Boolean(internalValue);\n\n    const snackbarContext = useSnackbarController();\n\n    const {\n        open,\n        getRootProps,\n        getInputProps,\n        isDragActive,\n        isDragAccept,\n        isDragReject\n    } = useDropzone({\n            accept: storage.acceptedFiles ? storage.acceptedFiles.map(e => ({ [e]: [] })).reduce((a, b) => ({ ...a, ...b }), {}) : undefined,\n            disabled,\n            maxSize: storage.maxSize,\n            noClick: true,\n            noKeyboard: true,\n            onDrop: onFilesAdded,\n            onDropRejected: (fileRejections, event) => {\n                for (const fileRejection of fileRejections) {\n                    for (const error of fileRejection.errors) {\n                        snackbarContext.open({\n                            type: \"error\",\n                            message: `Error uploading file: File is larger than ${storage.maxSize} bytes`\n                        });\n                    }\n                }\n            }\n        }\n    );\n\n    const { ...rootProps } = getRootProps();\n\n    const helpText = multipleFilesSupported\n        ? \"Drag 'n' drop some files here, or click here to edit\"\n        : \"Drag 'n' drop a file here, or click here edit\";\n\n    const renderProperty = multipleFilesSupported\n        ? (property as ResolvedArrayProperty<string[]>).of as ResolvedStringProperty\n        : property as ResolvedStringProperty;\n\n    const imageSize = useMemo(() => getThumbnailMeasure(previewSize), [previewSize]);\n\n    const theme = useTheme();\n\n    return (\n        <Box {...rootProps}\n             onMouseEnter={() => setOnHover(true)}\n             onMouseMove={() => setOnHover(true)}\n             onMouseLeave={() => setOnHover(false)}\n             sx={{\n                 ...dropZoneMixin(hasValue),\n                 ...(isDragActive ? activeDropMixin(theme) : {}),\n                 ...(isDragAccept ? acceptDropMixin(theme) : {}),\n                 ...(isDragReject ? rejectDropMixin(theme) : {})\n             }}\n        >\n\n            <input autoFocus={autoFocus} {...getInputProps()} />\n\n            {internalValue.map((entry, index) => {\n                let child;\n                if (entry.storagePathOrDownloadUrl) {\n                    child = (\n                        <TableStorageItemPreview\n                            key={`storage_preview_${index}`}\n                            property={renderProperty}\n                            value={entry.storagePathOrDownloadUrl}\n                            entity={entity}\n                            size={previewSize}/>\n                    );\n                } else if (entry.file) {\n                    child = (\n                        <StorageUploadProgress\n                            key={`storage_progress_${index}`}\n                            entry={entry}\n                            metadata={metadata}\n                            storagePath={storagePathBuilder(entry.file)}\n                            onFileUploadComplete={onFileUploadComplete}\n                            imageSize={imageSize}\n                            simple={true}\n                        />\n                    );\n                }\n\n                return child;\n            })\n            }\n\n            {!internalValue && <Box\n                sx={{\n                    flexGrow: 1,\n                    m: 2,\n                    maxWidth: 200\n                }}\n                onClick={open}>\n                <Typography\n                    sx={{\n                        color: (theme) => (theme.palette.mode === \"light\" ? \"#999\" : \"#444\")\n                    }}\n                    variant={\"body2\"}\n                    align={\"center\"}>\n                    {helpText}\n                </Typography>\n            </Box>}\n\n            {onHover &&\n                <IconButton\n                    color={\"inherit\"}\n                    size={\"small\"}\n                    onClick={open}\n                    sx={{\n                        position: \"absolute\",\n                        bottom: 2,\n                        right: 2\n                    }}>\n                    <EditIcon sx={{\n                        width: 16,\n                        height: 16,\n                        fill: \"#888\"\n                    }\n                    }/>\n                </IconButton>\n            }\n\n        </Box>\n    );\n\n}\n\ninterface TableStorageItemPreviewProps {\n    property: ResolvedStringProperty;\n    value: string,\n    size: PreviewSize;\n    entity: Entity<any>;\n}\n\nexport function TableStorageItemPreview({\n                                            property,\n                                            value,\n                                            size,\n                                            entity\n                                        }: TableStorageItemPreviewProps) {\n\n    return (\n        <Box\n            m={1}\n            position={\"relative\"}\n        >\n\n            {value &&\n                <ErrorBoundary>\n                    <PropertyPreview\n                        propertyKey={\"ignore\"} // TODO: Fix this\n                        value={value}\n                        property={property}\n                        entity={entity}\n                        size={size}/>\n                </ErrorBoundary>\n            }\n\n        </Box>\n    );\n\n}\n","import { TableSize } from \"./VirtualTableProps\";\n\nexport function getRowHeight(size: TableSize): number {\n    switch (size) {\n        case \"xl\":\n            return 400;\n        case \"l\":\n            return 280;\n        case \"m\":\n            return 140;\n        case \"s\":\n            return 80;\n        case \"xs\":\n            return 54;\n        default:\n            throw Error(\"Missing mapping for collection size -> height\");\n    }\n}\n","import React, { useCallback, useEffect, useMemo, useState } from \"react\";\nimport useMeasure from \"react-use-measure\";\nimport { styled } from \"@mui/system\";\n\nimport {\n    Box,\n    darken,\n    IconButton,\n    lighten,\n    Tooltip,\n    useTheme\n} from \"@mui/material\";\n\nimport ErrorOutlineIcon from \"@mui/icons-material/ErrorOutline\";\nimport RemoveCircleIcon from \"@mui/icons-material/RemoveCircle\";\nimport isEqual from \"react-fast-compare\";\nimport { TableSize } from \"../../Table\";\nimport { getRowHeight } from \"../../Table/common\";\nimport { ErrorBoundary } from \"../../ErrorBoundary\";\nimport { ErrorTooltip } from \"../../ErrorTooltip\";\n\ninterface TableCellProps {\n    children: React.ReactNode;\n    /**\n     * The value is used only to check changes and force re-renders\n     */\n    value?: any;\n    disabled: boolean;\n    saved?: boolean;\n    error?: Error;\n    allowScroll?: boolean;\n    align: \"right\" | \"left\" | \"center\";\n    size: TableSize;\n    disabledTooltip?: string;\n    width: number;\n    focused: boolean;\n    showExpandIcon?: boolean;\n    removePadding?: boolean;\n    fullHeight?: boolean;\n    selected?: boolean;\n    selectedRow: boolean;\n    onSelect?: (cellRect: DOMRect | undefined) => void;\n    openPopup?: (cellRect: DOMRect | undefined) => void;\n}\n\nfunction getBackgroundColor(onHover: any, selectedRow: boolean, disabled: boolean, saved: boolean, theme: any, isSelected: boolean) {\n    if (onHover && !disabled) {\n        if (theme.palette.mode === \"dark\") {\n            return lighten(theme.palette.background.paper, 0.03);\n        } else {\n            return darken(theme.palette.background.default, 0.02);\n        }\n    }\n    if (isSelected) {\n        if (theme.palette.mode === \"dark\") {\n            return lighten(theme.palette.background.paper, 0.035);\n        } else {\n            return darken(theme.palette.background.default, 0.025);\n        }\n    }\n    if (selectedRow || saved) {\n        if (theme.palette.mode === \"dark\") {\n            return lighten(theme.palette.background.paper, 0.022);\n        } else {\n            return darken(theme.palette.background.default, 0.008);\n        }\n    }\n    return undefined;\n}\n\ntype TableCellRootProps = {\n    width: number,\n    padding: string;\n    border: string;\n    justifyContent: string;\n    contain: string,\n    alignItems?: string,\n    backgroundColor?: string\n}\nconst TableCellRoot = styled(\"div\", {})<TableCellRootProps>(({\n                                                                 theme,\n                                                                 justifyContent,\n                                                                 padding,\n                                                                 border,\n                                                                 width,\n                                                                 alignItems,\n                                                                 backgroundColor\n                                                             }) => ({\n    width: width ?? \"100%\",\n    alignItems,\n    backgroundColor,\n    padding,\n    border,\n    justifyContent,\n    display: \"flex\",\n    position: \"relative\",\n    height: \"100%\",\n    borderRadius: \"4px\",\n    overflow: \"hidden\",\n    // contain: \"content\",\n    contain: \"content\",\n    transition: \"border-color 400ms ease-in-out, background-color 600ms ease\"\n}));\n\ntype TableCellInnerProps = {\n    justifyContent: string;\n    scrollable: boolean;\n    faded: boolean;\n    fullHeight: boolean;\n\n}\nconst TableCellInner = styled(\"div\", {})<TableCellInnerProps>(({\n                                                                   theme,\n                                                                   justifyContent,\n                                                                   scrollable,\n                                                                   faded,\n                                                                   fullHeight\n                                                               }) => ({\n\n    display: \"flex\",\n    width: \"100%\",\n    flexDirection: \"column\",\n    height: fullHeight ? \"100%\" : undefined,\n    justifyContent,\n    overflow: scrollable ? \"auto\" : undefined,\n    WebkitMaskImage: faded ? \"linear-gradient(to bottom, black 60%, transparent 100%)\" : undefined,\n    maskImage: faded ? \"linear-gradient(to bottom, black 60%, transparent 100%)\" : undefined,\n    alignItems: faded ? \"start\" : (scrollable ? \"start\" : undefined)\n\n}));\n\nexport const TableCell = React.memo<TableCellProps>(\n    function TableCell({\n                           children,\n                           focused,\n                           size,\n                           selected,\n                           disabled,\n                           disabledTooltip,\n                           saved,\n                           selectedRow,\n                           error,\n                           align,\n                           allowScroll,\n                           openPopup,\n                           removePadding,\n                           fullHeight,\n                           onSelect,\n                           width,\n                           showExpandIcon = true\n                       }: TableCellProps) {\n\n        const [measureRef, bounds] = useMeasure();\n        const theme = useTheme();\n        const ref = React.createRef<HTMLDivElement>();\n\n        const [isOverflowing, setIsOverflowing] = useState<boolean>(false);\n        const maxHeight = useMemo(() => getRowHeight(size), [size]);\n\n        const [onHover, setOnHover] = useState(false);\n        const [internalSaved, setInternalSaved] = useState(saved);\n\n        const showError = !disabled && error;\n\n        const iconRef = React.createRef<HTMLButtonElement>();\n        useEffect(() => {\n            if (iconRef.current && focused) {\n                iconRef.current.focus({ preventScroll: true });\n            }\n        }, [focused]);\n\n        useEffect(() => {\n            if (saved) {\n                setInternalSaved(true);\n            }\n            const handler = setTimeout(() => {\n                setInternalSaved(false);\n            }, 500);\n            return () => {\n                clearTimeout(handler);\n            };\n        }, [saved]);\n\n        let p = theme.spacing(0);\n        if (!removePadding) {\n            switch (size) {\n                case \"l\":\n                case \"xl\":\n                    p = theme.spacing(2);\n                    break;\n                case \"m\":\n                    p = theme.spacing(1);\n                    break;\n                case \"s\":\n                    p = theme.spacing(0.5);\n                    break;\n                default:\n                    p = theme.spacing(0.25);\n                    break;\n            }\n        }\n\n        let justifyContent;\n        switch (align) {\n            case \"right\":\n                justifyContent = \"flex-end\";\n                break;\n            case \"center\":\n                justifyContent = \"center\";\n                break;\n            case \"left\":\n            default:\n                justifyContent = \"flex-start\";\n        }\n\n        const doOpenPopup = useCallback(() => {\n            if (openPopup) {\n                const cellRect = ref && ref?.current?.getBoundingClientRect();\n                openPopup(cellRect);\n            }\n        }, [ref]);\n\n        const onClick = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\n            if (event.detail === 3) {\n                doOpenPopup();\n            }\n        }, [doOpenPopup]);\n\n        const onSelectCallback = useCallback(() => {\n            if (!onSelect) return;\n            const cellRect = ref && ref?.current?.getBoundingClientRect();\n            if (disabled) {\n                onSelect(undefined);\n            } else if (!selected && cellRect) {\n                onSelect(cellRect);\n            }\n        }, [ref, onSelect, selected, disabled]);\n\n        const onFocus = useCallback((event: React.SyntheticEvent<HTMLDivElement>) => {\n            onSelectCallback();\n            event.stopPropagation();\n        }, [onSelectCallback]);\n\n        useEffect(() => {\n            if (bounds) {\n                const newOverflowingValue = bounds.height > maxHeight;\n                if (isOverflowing !== newOverflowingValue)\n                    setIsOverflowing(newOverflowingValue);\n            }\n        }, [bounds, isOverflowing, maxHeight]);\n\n        const isSelected = !showError && selected;\n\n        let border: string;\n        if (internalSaved) {\n            border = `2px solid ${theme.palette.success.light}`;\n        } else if (isSelected) {\n            border = \"2px solid #5E9ED6\";\n        } else if (showError) {\n            border = `2px solid ${theme.palette.error.light} !important`\n        } else {\n            border = \"2px solid transparent\"\n        }\n\n        const scrollable = !disabled && allowScroll && isOverflowing;\n        const faded = !disabled && !allowScroll && isOverflowing;\n\n        const setOnHoverTrue = useCallback(() => setOnHover(true), []);\n        const setOnHoverFalse = useCallback(() => setOnHover(false), []);\n\n        return (\n            <TableCellRoot\n                tabIndex={selected || disabled ? undefined : 0}\n                ref={ref}\n                onFocus={onFocus}\n                onClick={onClick}\n                onMouseEnter={setOnHoverTrue}\n                onMouseMove={setOnHoverTrue}\n                onMouseLeave={setOnHoverFalse}\n                padding={p}\n                contain={scrollable ? \"content\" : \"size\"}\n                border={border}\n                justifyContent={justifyContent}\n                width={width}\n                alignItems={disabled || !isOverflowing ? \"center\" : undefined}\n                backgroundColor={getBackgroundColor(onHover, selectedRow, disabled, internalSaved ?? false, theme, isSelected ?? false)}\n            >\n\n                <ErrorBoundary>\n\n                    {fullHeight && !faded && children}\n\n                    {(!fullHeight || faded) && <TableCellInner\n                        fullHeight={fullHeight ?? false}\n                        justifyContent={justifyContent}\n                        scrollable={scrollable ?? false}\n                        faded={faded}>\n\n                        {!fullHeight && <div ref={measureRef}\n                                             style={{\n                                                 display: \"flex\",\n                                                 width: \"100%\",\n                                                 justifyContent,\n                                                 height: fullHeight ? \"100%\" : undefined\n                                             }}>\n                            {children}\n                        </div>}\n\n                    </TableCellInner>}\n                </ErrorBoundary>\n\n                {disabled && onHover && disabledTooltip &&\n                    <Box sx={{\n                        position: \"absolute\",\n                        top: 4,\n                        right: 4,\n                        fontSize: \"14px\"\n                    }}>\n                        <Tooltip title={disabledTooltip}>\n                            <RemoveCircleIcon color={\"disabled\"}\n                                              fontSize={\"inherit\"}/>\n                        </Tooltip>\n                    </Box>}\n\n                {(showError || showExpandIcon) &&\n                    <Box sx={{\n                        position: \"absolute\",\n                        top: \"2px\",\n                        right: \"2px\"\n                    }}>\n\n                        {selected && !disabled && showExpandIcon &&\n                            <IconButton\n                                ref={iconRef}\n                                color={\"inherit\"}\n                                size={\"small\"}\n                                onClick={doOpenPopup}>\n                                <svg\n                                    className={\"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall\"}\n                                    fill={\"#888\"}\n                                    width=\"20\"\n                                    height=\"20\"\n                                    viewBox=\"0 0 24 24\">\n                                    <path className=\"cls-2\"\n                                          d=\"M20,5a1,1,0,0,0-1-1L14,4h0a1,1,0,0,0,0,2h2.57L13.29,9.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L18,7.42V10a1,1,0,0,0,1,1h0a1,1,0,0,0,1-1Z\"/>\n                                    <path className=\"cls-2\"\n                                          d=\"M10.71,13.29a1,1,0,0,0-1.42,0L6,16.57V14a1,1,0,0,0-1-1H5a1,1,0,0,0-1,1l0,5a1,1,0,0,0,1,1h5a1,1,0,0,0,0-2H7.42l3.29-3.29A1,1,0,0,0,10.71,13.29Z\"/>\n                                </svg>\n                            </IconButton>\n                        }\n\n                        {showError && <ErrorTooltip\n                            arrow\n                            placement={\"left\"}\n                            title={showError.message}>\n                            <ErrorOutlineIcon\n                                fontSize={\"inherit\"}\n                                color={\"error\"}\n                            />\n                        </ErrorTooltip>\n                        }\n\n                    </Box>\n                }\n\n            </TableCellRoot>\n        );\n    }, isEqual) as React.FunctionComponent<TableCellProps>;\n","import React, {\n    useCallback,\n    useEffect,\n    useMemo,\n    useRef,\n    useState\n} from \"react\";\nimport equal from \"react-fast-compare\"\nimport {\n    CMSType,\n    Entity,\n    EntityCollection,\n    EntityReference,\n    ResolvedArrayProperty,\n    ResolvedNumberProperty,\n    ResolvedProperty,\n    ResolvedStringProperty\n} from \"../../../../types\";\nimport { TableInput } from \"../../Table/fields/TableInput\";\nimport { TableSelect } from \"../../Table/fields/TableSelect\";\nimport { NumberTableInput } from \"../../Table/fields/TableNumberInput\";\nimport { TableSwitch } from \"../../Table/fields/TableSwitch\";\nimport { TableDateField } from \"../../Table/fields/TableDateField\";\nimport { PropertyPreview } from \"../../../../preview\";\nimport { TableReferenceField } from \"../fields/TableReferenceField\";\n\nimport { getPreviewSizeFrom } from \"../../../../preview/util\";\nimport { isReadOnly } from \"../../../util\";\nimport { TableStorageUpload } from \"../fields/TableStorageUpload\";\nimport {\n    CustomFieldValidator,\n    mapPropertyToYup\n} from \"../../../../form/validation\";\nimport { useEntityCollectionTableController } from \"../EntityCollectionTable\";\nimport {\n    useClearRestoreValue,\n    useDataSource,\n    useFireCMSContext\n} from \"../../../../hooks\";\nimport { TableCell } from \"./TableCell\";\nimport { getRowHeight } from \"../../Table/common\";\n\nexport interface PropertyTableCellProps<T extends CMSType, M extends Record<string, any>> {\n    propertyKey: string;\n    columnIndex: number;\n    align: \"right\" | \"left\" | \"center\";\n    customFieldValidator?: CustomFieldValidator;\n    value: T;\n    readonly: boolean;\n    collection: EntityCollection<M>;\n    setFocused: (value: boolean) => void;\n    property: ResolvedProperty<T>;\n    height: number;\n    width: number;\n    entity: Entity<any>;\n    path: string;\n}\n\nfunction isStorageProperty<T>(property: ResolvedProperty) {\n    if (property.dataType === \"string\" && (property as ResolvedStringProperty).storage)\n        return true;\n    if (property.dataType === \"array\") {\n        if (Array.isArray(property.of)) {\n            return false;\n        } else {\n            return ((property as ResolvedArrayProperty).of as ResolvedProperty)?.dataType === \"string\" &&\n                ((property as ResolvedArrayProperty).of as ResolvedStringProperty)?.storage\n        }\n    }\n    return false;\n}\n\nexport const PropertyTableCell = React.memo<PropertyTableCellProps<any, any>>(\n    function PropertyTableCell<T extends CMSType, M extends Record<string, any>>({\n                                                                                     propertyKey,\n                                                                                     columnIndex,\n                                                                                     customFieldValidator,\n                                                                                     value,\n                                                                                     property,\n                                                                                     align,\n                                                                                     width,\n                                                                                     height,\n                                                                                     collection,\n                                                                                     path,\n                                                                                     entity,\n                                                                                     readonly\n                                                                                 }: PropertyTableCellProps<T, M>) {\n\n        const dataSource = useDataSource();\n        const context = useFireCMSContext();\n\n        const {\n            onValueChange,\n            size,\n            selectedCell,\n            focused,\n            select,\n            setPopupCell,\n            selectedEntityIds\n        } = useEntityCollectionTableController();\n        const selectedRow = selectedEntityIds?.includes(entity.id) ?? false;\n\n        const selected = selectedCell?.columnIndex === columnIndex &&\n            selectedCell?.entity.id === entity.id;\n\n        const [internalValue, setInternalValue] = useState<any | null>(value);\n        const internalValueRef = useRef(value);\n\n        const [error, setError] = useState<Error | undefined>();\n        const [saved, setSaved] = useState<boolean>(false);\n\n        const onValueUpdated = useCallback(() => {\n            setSaved(true)\n            setTimeout(() => {\n                setSaved(false);\n            }, 100);\n        }, []);\n\n        const customField = Boolean(property.Field);\n        const customPreview = Boolean(property.Preview);\n        const readOnlyProperty = isReadOnly(property);\n        const disabledTooltip: string | undefined = typeof property.disabled === \"object\" ? property.disabled.disabledMessage : undefined;\n        const disabled = Boolean(property.disabled);\n\n        const validation = useMemo(() => mapPropertyToYup({\n            property,\n            entityId: entity.id,\n            customFieldValidator,\n            name: propertyKey\n        }), [entity.id, property, propertyKey]);\n\n        useEffect(\n            () => {\n                if (!equal(value, internalValueRef.current)) {\n                    setInternalValue(value);\n                    internalValueRef.current = value;\n                    onValueUpdated();\n                }\n            },\n            [onValueUpdated, value]\n        );\n\n        const saveValues = useCallback((value: any) => {\n            setSaved(false);\n            validation\n                .validate(value)\n                .then(() => {\n                    setError(undefined);\n                    if (onValueChange) {\n                        onValueChange({\n                            value,\n                            propertyKey,\n                            setError,\n                            onValueUpdated,\n                            entity,\n                            fullPath: path,\n                            collection,\n                            dataSource,\n                            context\n                        });\n                    }\n                })\n                .catch((e) => {\n                    setError(e);\n                });\n        }, [entity, onValueChange, propertyKey, validation]);\n\n        useEffect(() => {\n            validation\n                .validate(internalValue)\n                .catch((e) => {\n                    setError(e);\n                });\n        }, [internalValue, validation]);\n\n        const updateValue = useCallback(\n            (newValue: any | null) => {\n\n                let updatedValue: any;\n                if (newValue === undefined) {\n                    updatedValue = null;\n                } else {\n                    updatedValue = newValue;\n                }\n                internalValueRef.current = updatedValue;\n                setInternalValue(updatedValue);\n                saveValues(updatedValue);\n            },\n            [saveValues]\n        );\n\n        useClearRestoreValue<any>({\n            property,\n            value: internalValue,\n            setValue: updateValue\n        });\n\n        const onSelect = useCallback((cellRect: DOMRect | undefined) => {\n            if (!cellRect) {\n                select(undefined);\n            } else {\n                select({\n                    columnIndex,\n                    width,\n                    height,\n                    entity,\n                    cellRect,\n                    propertyKey: propertyKey as keyof M,\n                    collection\n                });\n            }\n        }, [collection, columnIndex, entity, height, propertyKey, select, width]);\n\n        const openPopup = useCallback((cellRect: DOMRect | undefined) => {\n            if (!cellRect) {\n                setPopupCell(undefined);\n            } else {\n                setPopupCell({\n                    columnIndex,\n                    width,\n                    height,\n                    entity,\n                    cellRect,\n                    propertyKey: propertyKey as keyof M,\n                    collection\n                });\n            }\n        }, [collection, columnIndex, entity, height, propertyKey, width]);\n\n        let innerComponent: React.ReactNode | undefined;\n        let allowScroll = false;\n        let showExpandIcon = false;\n        let removePadding = false;\n        let fullHeight = false;\n\n        if (readonly || readOnlyProperty) {\n            return <TableCell\n                size={size}\n                width={width}\n                focused={focused}\n                saved={saved}\n                selectedRow={selectedRow}\n                key={`preview_cell_${propertyKey}_${entity.id}`}\n                value={internalValue}\n                align={align ?? \"left\"}\n                disabledTooltip={disabledTooltip ?? (readOnlyProperty ? \"Read only\" : undefined)}\n                disabled={true}>\n                <PropertyPreview\n                    width={width}\n                    height={getRowHeight(size)}\n                    propertyKey={propertyKey}\n                    property={property}\n                    entity={entity}\n                    value={value}\n                    size={getPreviewSizeFrom(size)}\n                />\n            </TableCell>;\n        }\n\n        if (!customField && (!customPreview || selected)) {\n            const isAStorageProperty = isStorageProperty(property);\n            if (isAStorageProperty) {\n                innerComponent = <TableStorageUpload error={error}\n                                                     disabled={disabled}\n                                                     focused={focused}\n                                                     property={property as ResolvedStringProperty | ResolvedArrayProperty<string[]>}\n                                                     entity={entity}\n                                                     path={path}\n                                                     value={internalValue}\n                                                     previewSize={getPreviewSizeFrom(size)}\n                                                     updateValue={updateValue}\n                                                     propertyKey={propertyKey as string}\n                />;\n                showExpandIcon = true;\n                fullHeight = true;\n                removePadding = true;\n            } else if (selected && property.dataType === \"number\") {\n                const numberProperty = property as ResolvedNumberProperty;\n                if (numberProperty.enumValues) {\n                    innerComponent = <TableSelect name={propertyKey as string}\n                                                  multiple={false}\n                                                  disabled={disabled}\n                                                  focused={focused}\n                                                  valueType={\"number\"}\n                                                  small={getPreviewSizeFrom(size) !== \"regular\"}\n                                                  enumValues={numberProperty.enumValues}\n                                                  error={error}\n                                                  internalValue={internalValue as string | number}\n                                                  updateValue={updateValue}\n                    />;\n                    fullHeight = true;\n                } else {\n                    innerComponent = <NumberTableInput\n                        align={align}\n                        error={error}\n                        focused={focused}\n                        disabled={disabled}\n                        value={internalValue as number}\n                        updateValue={updateValue}\n                    />;\n                    allowScroll = true;\n                }\n            } else if (selected && property.dataType === \"string\") {\n                const stringProperty = property as ResolvedStringProperty;\n                if (stringProperty.enumValues) {\n                    innerComponent = <TableSelect name={propertyKey as string}\n                                                  multiple={false}\n                                                  focused={focused}\n                                                  disabled={disabled}\n                                                  valueType={\"string\"}\n                                                  small={getPreviewSizeFrom(size) !== \"regular\"}\n                                                  enumValues={stringProperty.enumValues}\n                                                  error={error}\n                                                  internalValue={internalValue as string | number}\n                                                  updateValue={updateValue}\n                    />;\n                    fullHeight = true;\n                } else if (!stringProperty.storage) {\n                    const multiline = Boolean(stringProperty.multiline) || Boolean(stringProperty.markdown);\n                    innerComponent = <TableInput error={error}\n                                                 disabled={disabled}\n                                                 multiline={multiline}\n                                                 focused={focused}\n                                                 value={internalValue as string}\n                                                 updateValue={updateValue}\n                    />;\n                    allowScroll = true;\n                }\n            } else if (property.dataType === \"boolean\") {\n                innerComponent = <TableSwitch error={error}\n                                              disabled={disabled}\n                                              focused={focused && selected}\n                                              internalValue={internalValue as boolean}\n                                              updateValue={updateValue}\n                />;\n            } else if (property.dataType === \"date\") {\n                innerComponent = <TableDateField name={propertyKey as string}\n                                                 error={error}\n                                                 disabled={disabled}\n                                                 mode={property.mode}\n                                                 focused={focused}\n                                                 internalValue={internalValue as Date}\n                                                 updateValue={updateValue}\n                />;\n                allowScroll = true;\n            } else if (property.dataType === \"reference\") {\n                if (typeof property.path === \"string\") {\n                    innerComponent =\n                        <TableReferenceField name={propertyKey as string}\n                                             internalValue={internalValue as EntityReference}\n                                             updateValue={updateValue}\n                                             disabled={disabled}\n                                             size={size}\n                                             path={property.path}\n                                             multiselect={false}\n                                             previewProperties={property.previewProperties}\n                                             title={property.name}\n                                             forceFilter={property.forceFilter}\n                        />;\n                }\n                allowScroll = false;\n            } else if (property.dataType === \"array\") {\n                const arrayProperty = (property as ResolvedArrayProperty);\n\n                if (!arrayProperty.of && !arrayProperty.oneOf) {\n                    throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${propertyKey}`);\n                }\n                if (arrayProperty.of && !Array.isArray(arrayProperty.of)) {\n                    if (arrayProperty.of.dataType === \"string\" || arrayProperty.of.dataType === \"number\") {\n                        if (selected && arrayProperty.of.enumValues) {\n                            innerComponent =\n                                <TableSelect name={propertyKey as string}\n                                             multiple={true}\n                                             disabled={disabled}\n                                             focused={focused}\n                                             small={getPreviewSizeFrom(size) !== \"regular\"}\n                                             valueType={arrayProperty.of.dataType}\n                                             enumValues={arrayProperty.of.enumValues}\n                                             error={error}\n                                             internalValue={internalValue as string | number}\n                                             updateValue={updateValue}\n                                />;\n                            allowScroll = true;\n                            fullHeight = true;\n                        }\n                    } else if (arrayProperty.of.dataType === \"reference\") {\n                        if (typeof arrayProperty.of.path === \"string\") {\n                            innerComponent =\n                                <TableReferenceField\n                                    name={propertyKey as string}\n                                    disabled={disabled}\n                                    internalValue={internalValue as EntityReference[]}\n                                    updateValue={updateValue}\n                                    size={size}\n                                    multiselect={true}\n                                    path={arrayProperty.of.path}\n                                    previewProperties={arrayProperty.of.previewProperties}\n                                    title={arrayProperty.of.name}\n                                    forceFilter={arrayProperty.of.forceFilter}\n                                />;\n                        }\n                        allowScroll = false;\n                    }\n                }\n\n            }\n        }\n\n        if (!innerComponent) {\n            allowScroll = false;\n            showExpandIcon = selected && !innerComponent && !disabled && !readOnlyProperty;\n            innerComponent = (\n                <PropertyPreview\n                    width={width}\n                    height={height}\n                    entity={entity}\n                    propertyKey={propertyKey as string}\n                    value={internalValue}\n                    property={property}\n                    size={getPreviewSizeFrom(size)}\n                />\n            );\n        }\n\n        return (\n            <TableCell\n                key={`table_cell_${entity.id}_${propertyKey}`}\n                size={size}\n                width={width}\n                focused={focused}\n                onSelect={onSelect}\n                selected={selected}\n                selectedRow={selectedRow}\n                disabled={disabled || readOnlyProperty}\n                disabledTooltip={disabledTooltip ?? \"Disabled\"}\n                removePadding={removePadding}\n                fullHeight={fullHeight}\n                saved={saved}\n                error={error}\n                align={align}\n                allowScroll={allowScroll}\n                showExpandIcon={showExpandIcon}\n                openPopup={!disabled ? openPopup : undefined}\n                value={internalValue}\n            >\n\n                {innerComponent}\n\n            </TableCell>\n        );\n\n    },\n    areEqual) as React.FunctionComponent<PropertyTableCellProps<any, any>>;\n\nfunction areEqual(prevProps: PropertyTableCellProps<any, any>, nextProps: PropertyTableCellProps<any, any>) {\n    return prevProps.height === nextProps.height &&\n        prevProps.propertyKey === nextProps.propertyKey &&\n        prevProps.align === nextProps.align &&\n        prevProps.width === nextProps.width &&\n        equal(prevProps.property, nextProps.property) &&\n        equal(prevProps.value, nextProps.value) &&\n        equal(prevProps.entity.values, nextProps.entity.values)\n        ;\n}\n","import React, { useEffect } from \"react\";\n\ninterface DraggableProps {\n    containerRef: React.RefObject<HTMLDivElement>,\n    innerRef: React.RefObject<HTMLDivElement>,\n    // ref: React.RefObject<HTMLDivElement>,\n    x?: number;\n    y?: number;\n    onMove: (x: number, y: number) => void,\n}\n\nexport function useDraggable({\n                                 containerRef,\n                                 innerRef,\n                                 x,\n                                 y,\n                                 onMove\n                             }: DraggableProps) {\n\n    let relX = 0;\n    let relY = 0;\n\n    const listeningRef = React.useRef(false);\n\n    const onMouseDown = (event: any) => {\n        if (event.button !== 0 || !containerRef.current || event.defaultPrevented || event.innerClicked) {\n            return;\n        }\n\n        const { x, y } = containerRef.current.getBoundingClientRect();\n\n        relX = event.screenX - x;\n        relY = event.screenY - y;\n        document.addEventListener(\"mousemove\", onMouseMove);\n        document.addEventListener(\"mouseup\", onMouseUp);\n        document.addEventListener(\"selectstart\", onSelect);\n        listeningRef.current = true;\n        // event.stopPropagation();\n    };\n    const onMouseDownInner = (event: any) => {\n        // @ts-ignore\n        event.innerClicked = true;\n    };\n\n    const onSelect = (event: any) => {\n        event.preventDefault()\n        event.stopPropagation();\n    };\n\n    const onMouseUp = (event: any) => {\n        document.removeEventListener(\"mousemove\", onMouseMove);\n        document.removeEventListener(\"mouseup\", onMouseUp);\n        document.removeEventListener(\"selectstart\", onSelect);\n        event.stopPropagation();\n        listeningRef.current = false;\n    };\n\n    const onMouseMove = (event: any) => {\n        if (event.target.localName === \"input\" || !listeningRef.current)\n            return;\n        onMove(\n            event.screenX - relX,\n            event.screenY - relY\n        );\n        event.stopPropagation();\n    };\n\n    const update = () => {\n        if (containerRef.current) {\n            containerRef.current.style.top = `${y}px`;\n            containerRef.current.style.left = `${x}px`;\n        }\n    };\n\n    useEffect(() => {\n        const current = containerRef.current;\n        const innerCurrent = innerRef.current;\n        if (!current || !innerCurrent)\n            return;\n        if (innerCurrent)\n            innerCurrent.addEventListener(\"mousedown\", onMouseDownInner);\n        if (current)\n            current.addEventListener(\"mousedown\", onMouseDown);\n        update();\n        return () => {\n            if (current)\n                current.removeEventListener(\"mousedown\", onMouseDown);\n            if (innerCurrent)\n                innerCurrent.removeEventListener(\"mousedown\", onMouseDownInner);\n        };\n    });\n\n}\n","import { useLayoutEffect, useState } from \"react\";\n\ninterface WindowSize {\n    width: number,\n    height: number\n}\n\nexport function useWindowSize(): WindowSize {\n    const [size, setSize] = useState<WindowSize>({ width: 0, height: 0 });\n    useLayoutEffect(() => {\n        function updateSize() {\n            setSize({ width: window.innerWidth, height: window.innerHeight });\n        }\n\n        window.addEventListener(\"resize\", updateSize);\n        updateSize();\n        return () => window.removeEventListener(\"resize\", updateSize);\n    }, []);\n    return size;\n}\n","import { RefObject, useCallback, useEffect, useRef } from \"react\";\n\ninterface Props {\n    onResize: (event: Event) => void;\n}\n\nexport const ElementResizeListener: React.FC<Props> = ({ onResize }) => {\n    const rafRef = useRef(0);\n    const objectRef: RefObject<HTMLObjectElement> = useRef(null);\n    const onResizeRef = useRef(onResize);\n\n    onResizeRef.current = onResize;\n\n    const _onResize = useCallback((e: Event) => {\n        if (rafRef.current) {\n            cancelAnimationFrame(rafRef.current);\n        }\n        rafRef.current = requestAnimationFrame(() => {\n            onResizeRef.current(e);\n        });\n    }, []);\n\n    const onLoad = useCallback(() => {\n        const obj = objectRef.current;\n        if (obj && obj.contentDocument && obj.contentDocument.defaultView) {\n            obj.contentDocument.defaultView.addEventListener(\"resize\", _onResize);\n        }\n    }, [_onResize]);\n\n    useEffect(() => {\n        const obj = objectRef.current;\n        return () => {\n            if (obj && obj.contentDocument && obj.contentDocument.defaultView) {\n                obj.contentDocument.defaultView.removeEventListener(\"resize\", _onResize);\n            }\n        };\n    }, [_onResize]);\n\n    return (\n        <object\n            onLoad={onLoad}\n            ref={objectRef}\n            tabIndex={-1}\n            type={\"text/html\"}\n            data={\"about:blank\"}\n            title={\"\"}\n            style={{\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                height: \"100%\",\n                width: \"100%\",\n                pointerEvents: \"none\",\n                zIndex: -1,\n                opacity: 0\n            }}\n        />\n    );\n};\n","import { alpha, Box, Breakpoint, Container } from \"@mui/material\";\nimport React from \"react\";\n\nexport function CustomDialogActions({\n                                        children,\n                                        position = \"sticky\",\n                                        maxWidth,\n                                        translucent = true\n                                    }: {\n    children: React.ReactNode,\n    position?: \"sticky\" | \"absolute\",\n    maxWidth?: Breakpoint,\n    translucent?: boolean\n}) {\n    const component = maxWidth\n        ? <Container maxWidth={maxWidth}>\n            {children}\n        </Container>\n        : children;\n\n    return <Box sx={(theme) => ({\n        background: translucent ? theme.palette.mode === \"light\" ? \"rgba(255,255,255,0.6)\" : alpha(theme.palette.background.paper, 0.1) : undefined,\n        backdropFilter: translucent ? \"blur(8px)\" : undefined,\n        borderTop: `1px solid ${theme.palette.divider}`,\n        py: 1,\n        px: 2,\n        display: \"flex\",\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        justifyContent: \"flex-end\",\n        position,\n        bottom: 0,\n        right: 0,\n        left: 0,\n        textAlign: \"right\",\n        zIndex: 2,\n        \"& > *:not(:last-child)\": {\n            [theme.breakpoints.down(\"md\")]: {\n                mr: theme.spacing(1)\n            },\n            mr: theme.spacing(2)\n        }\n    })}\n    >\n        {component}\n    </Box>;\n}\n","import React, {\n    useCallback,\n    useEffect,\n    useLayoutEffect,\n    useMemo,\n    useState\n} from \"react\";\nimport equal from \"react-fast-compare\"\n\nimport { Box, Button, IconButton, Portal, Typography } from \"@mui/material\";\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\n\nimport {\n    Entity,\n    EntityCollection,\n    EntityValues,\n    FireCMSPlugin,\n    FormContext,\n    PropertyFieldBindingProps,\n    ResolvedEntityCollection,\n    ResolvedProperties,\n    ResolvedProperty\n} from \"../../../../../types\";\nimport { Form, Formik, FormikProps } from \"formik\";\nimport { useDraggable } from \"./useDraggable\";\nimport {\n    CustomFieldValidator,\n    getYupEntitySchema\n} from \"../../../../../form/validation\";\nimport { useWindowSize } from \"./useWindowSize\";\nimport { ElementResizeListener } from \"./ElementResizeListener\";\nimport { OnCellValueChangeParams } from \"../../types\";\nimport { ErrorView } from \"../../../ErrorView\";\nimport { isReadOnly, resolveCollection } from \"../../../../util\";\nimport { CustomDialogActions } from \"../../../CustomDialogActions\";\nimport { PropertyFieldBinding } from \"../../../../../form\";\nimport { useDataSource, useFireCMSContext } from \"../../../../../hooks\";\n\ninterface PopupFormFieldProps<M extends Record<string, any>> {\n    entity?: Entity<M>;\n    customFieldValidator?: CustomFieldValidator;\n    path: string;\n    tableKey: string;\n    propertyKey?: keyof M;\n    collection?: EntityCollection<M>;\n    cellRect?: DOMRect;\n    open: boolean;\n    onClose: () => void;\n    columnIndex?: number;\n\n    /**\n     * Callback when the value of a cell has been edited\n     * @param params\n     */\n    onCellValueChange?: (params: OnCellValueChangeParams<any, M>) => Promise<void>;\n}\n\nexport function PopupFormField<M extends Record<string, any>>(props: PopupFormFieldProps<M>) {\n    if (!props.open) return null;\n    return <PopupFormFieldInternal {...props} />;\n\n}\n\nexport function PopupFormFieldInternal<M extends Record<string, any>>({\n                                                                          tableKey,\n                                                                          entity,\n                                                                          customFieldValidator,\n                                                                          propertyKey,\n                                                                          collection: inputCollection,\n                                                                          path,\n                                                                          cellRect,\n                                                                          open,\n                                                                          onClose,\n                                                                          columnIndex,\n                                                                          onCellValueChange\n                                                                      }: PopupFormFieldProps<M>) {\n\n    const dataSource = useDataSource();\n    const fireCMSContext = useFireCMSContext();\n\n    const [savingError, setSavingError] = React.useState<any>();\n    const [popupLocation, setPopupLocation] = useState<{\n        x: number,\n        y: number\n    }>();\n    const [internalValue, setInternalValue] = useState<EntityValues<M> | undefined>(entity?.values);\n\n    const collection: ResolvedEntityCollection<M> | undefined = inputCollection\n        ? resolveCollection<M>({\n            collection: inputCollection,\n            path,\n            values: internalValue,\n            entityId: entity?.id,\n            fields: fireCMSContext.fields\n        })\n        : undefined;\n\n    const windowSize = useWindowSize();\n\n    const containerRef = React.useRef<HTMLDivElement>(null);\n    const innerRef = React.useRef<HTMLDivElement>(null);\n\n    const initialPositionSet = React.useRef<boolean>(false);\n\n    useDraggable({\n        containerRef,\n        innerRef,\n        x: popupLocation?.x,\n        y: popupLocation?.y,\n        onMove: (x, y) => onMove({\n            x,\n            y\n        })\n    });\n\n    useEffect(\n        () => {\n            initialPositionSet.current = false;\n        },\n        [propertyKey, entity]\n    );\n\n    const getInitialLocation = useCallback(() => {\n        if (!cellRect) throw Error(\"getInitialLocation error\");\n\n        return {\n            x: cellRect.left < windowSize.width - cellRect.right\n                ? cellRect.x + cellRect.width / 2\n                : cellRect.x - cellRect.width / 2,\n            y: cellRect.top < windowSize.height - cellRect.bottom\n                ? cellRect.y + cellRect.height / 2\n                : cellRect.y - cellRect.height / 2\n        };\n    }, [cellRect, windowSize.height, windowSize.width]);\n\n    const normalizePosition = useCallback(({\n                                               x,\n                                               y\n                                           }: { x: number, y: number }) => {\n\n        const draggableBoundingRect = containerRef.current?.getBoundingClientRect();\n        if (!draggableBoundingRect)\n            throw Error(\"normalizePosition called before draggableBoundingRect is set\");\n\n        return {\n            x: Math.max(0, Math.min(x, windowSize.width - draggableBoundingRect.width)),\n            y: Math.max(0, Math.min(y, windowSize.height - draggableBoundingRect.height))\n        };\n    }, [windowSize]);\n\n    const updatePopupLocation = useCallback((position?: {\n        x: number,\n        y: number\n    }) => {\n\n        const draggableBoundingRect = containerRef.current?.getBoundingClientRect();\n        if (!cellRect || !draggableBoundingRect) return;\n        const newPosition = normalizePosition(position ?? getInitialLocation());\n        if (!popupLocation || newPosition.x !== popupLocation.x || newPosition.y !== popupLocation.y)\n            setPopupLocation(newPosition);\n    }, [cellRect, getInitialLocation, normalizePosition, popupLocation]);\n\n    useEffect(\n        () => {\n            initialPositionSet.current = false;\n        },\n        [propertyKey]\n    );\n\n    useLayoutEffect(\n        () => {\n            const draggableBoundingRect = containerRef.current?.getBoundingClientRect();\n            if (!cellRect || !draggableBoundingRect || initialPositionSet.current) return;\n            updatePopupLocation();\n            initialPositionSet.current = true;\n        },\n        [cellRect, updatePopupLocation, initialPositionSet.current]\n    );\n\n    useLayoutEffect(\n        () => {\n            updatePopupLocation(popupLocation);\n        },\n        [windowSize, cellRect]\n    );\n\n    const validationSchema = useMemo(() => {\n        if (!collection || !entity) return;\n        return getYupEntitySchema(\n            entity.id,\n            propertyKey && collection.properties[propertyKey as string]\n                ? { [propertyKey]: collection.properties[propertyKey as string] } as ResolvedProperties<any>\n                : {} as ResolvedProperties<any>,\n            customFieldValidator);\n    }, [path, propertyKey, collection, entity]);\n\n    const adaptResize = useCallback(() => {\n        return updatePopupLocation(popupLocation);\n    }, [popupLocation, updatePopupLocation]);\n\n    const onMove = useCallback((position: { x: number, y: number }) => {\n        return updatePopupLocation(position);\n    }, [updatePopupLocation]);\n\n    const saveValue = async (values: M) => {\n        setSavingError(null);\n        if (inputCollection && entity && onCellValueChange && propertyKey) {\n            return onCellValueChange({\n                value: values[propertyKey as string],\n                propertyKey: propertyKey as string,\n                entity,\n                setError: setSavingError,\n                onValueUpdated: () => {\n                },\n                fullPath: path,\n                collection: inputCollection,\n                dataSource,\n                context: fireCMSContext\n            });\n        }\n        return Promise.resolve();\n    };\n\n    if (!entity)\n        return <></>;\n\n    const form = entity && (\n        <Box sx={theme => ({\n            overflow: \"auto\",\n            borderRadius: `${theme.shape.borderRadius}px`,\n            backgroundColor: theme.palette.background.paper,\n            visibility: !open ? \"hidden\" : undefined,\n            cursor: \"grab\"\n        })}>\n            <Formik\n                initialValues={(entity?.values ?? {}) as EntityValues<M>}\n                validationSchema={validationSchema}\n                validateOnMount={true}\n                validate={(values) => console.debug(\"Validating\", values)}\n                onSubmit={(values, actions) => {\n                    saveValue(values)\n                        .then(() => onClose())\n                        .finally(() => actions.setSubmitting(false));\n                }}\n            >\n                {({\n                      handleChange,\n                      values,\n                      errors,\n                      touched,\n                      dirty,\n                      setFieldValue,\n                      setFieldTouched,\n                      handleSubmit,\n                      isSubmitting\n                  }: FormikProps<EntityValues<M>>) => {\n\n                    if (!equal(values, internalValue)) {\n                        setInternalValue(values);\n                    }\n\n                    if (!entity)\n                        return <ErrorView\n                            error={\"PopupFormField misconfiguration\"}/>;\n\n                    if (!collection)\n                        return <></>;\n\n                    const disabled = isSubmitting;\n\n                    const formContext: FormContext<M> = {\n                        collection,\n                        entityId: entity.id,\n                        values,\n                        path,\n                        setFieldValue\n                    };\n\n                    const property: ResolvedProperty<any> | undefined = propertyKey && collection.properties[propertyKey];\n\n                    const fieldProps: PropertyFieldBindingProps<any, M> | undefined = propertyKey && property\n                        ? {\n                            propertyKey: propertyKey as string,\n                            disabled: isSubmitting || isReadOnly(property) || !!property.disabled,\n                            property,\n                            includeDescription: false,\n                            underlyingValueHasChanged: false,\n                            context: formContext,\n                            tableMode: true,\n                            partOfArray: false,\n                            autoFocus: open\n                        }\n                        : undefined;\n\n                    let internalForm = <><Box\n                        key={`popup_form_${tableKey}_${entity.id}_${columnIndex}`}\n                        sx={{\n                            width: 520,\n                            maxWidth: \"100vw\",\n                            maxHeight: \"85vh\"\n                        }}>\n                        <Form\n                            onSubmit={handleSubmit}\n                            noValidate>\n\n                            <Box\n                                sx={{\n                                    mb: 1,\n                                    padding: 2,\n                                    display: \"flex\",\n                                    flexDirection: \"column\",\n                                    position: \"relative\"\n                                }}>\n                                <Box\n                                    ref={innerRef}\n                                    sx={{\n                                        cursor: \"auto !important\"\n                                    }}>\n                                    {fieldProps &&\n                                        <PropertyFieldBinding {...fieldProps}/>}\n                                </Box>\n                            </Box>\n\n                            <CustomDialogActions>\n                                <Button\n                                    variant=\"contained\"\n                                    color=\"primary\"\n                                    type=\"submit\"\n                                    disabled={disabled}\n                                >\n                                    Save\n                                </Button>\n                            </CustomDialogActions>\n\n                        </Form>\n\n                    </Box></>;\n\n                    const plugins = fireCMSContext.plugins;\n                    if (plugins) {\n                        // const formController: FormContext<M> = {\n                        //     values,\n                        //     setFieldValue\n                        // }\n                        plugins.forEach((plugin: FireCMSPlugin) => {\n                            if (plugin.form?.provider) {\n                                internalForm = (\n                                    <plugin.form.provider.Component\n                                        status={\"existing\"}\n                                        path={path}\n                                        collection={collection}\n                                        entity={entity}\n                                        context={fireCMSContext}\n                                        currentEntityId={entity.id}\n                                        formContext={formContext}\n                                        {...plugin.form.provider.props}>\n                                        {internalForm}\n                                    </plugin.form.provider.Component>\n                                );\n                            }\n                        });\n                    }\n                    return internalForm;\n                }}\n            </Formik>\n\n            {savingError &&\n                <Typography color={\"error\"}>\n                    {savingError.message}\n                </Typography>\n            }\n        </Box>\n    );\n\n    const draggable = (\n        <Box\n            key={`draggable_${propertyKey as string}_${entity.id}_${open}`}\n            sx={theme => ({\n                display: \"inline-block\",\n                // userSelect: \"none\",\n                position: \"fixed\",\n                zIndex: 1300,\n                boxShadow: \"0 0 0 2px rgba(128,128,128,0.2)\",\n                backgroundColor: theme.palette.background.paper,\n                borderRadius: `${theme.shape.borderRadius}px`,\n                visibility: !open ? \"hidden\" : undefined,\n                cursor: \"grab\"\n            })}\n            ref={containerRef}>\n\n            <ElementResizeListener onResize={adaptResize}/>\n\n            <Box\n                sx={{\n                    overflow: \"hidden\"\n                }}>\n\n                {form}\n\n                <Box sx={{\n                    position: \"absolute\",\n                    top: -14,\n                    right: -14,\n                    backgroundColor: \"#888\",\n                    borderRadius: \"32px\"\n                }}>\n                    <IconButton\n                        size={\"small\"}\n                        onClick={(event) => {\n                            event.stopPropagation();\n                            onClose();\n                        }}>\n                        <ClearIcon sx={{ color: \"white\" }}\n                                   fontSize={\"small\"}/>\n                    </IconButton>\n                </Box>\n            </Box>\n\n        </Box>\n    );\n\n    return (\n        <Portal container={document.body}>\n            {draggable}\n        </Portal>\n    );\n\n}\n","import { Box, CircularProgress, CircularProgressProps } from \"@mui/material\";\nimport React from \"react\";\n\n/**\n *\n * @param props\n * @constructor\n * @ignore\n */\nexport function CircularProgressCenter(props: CircularProgressProps) {\n    return (\n        <Box\n            sx={{\n                display: \"flex\",\n                width: \"100vw\",\n                maxHeight: \"100%\",\n                maxWidth: \"100%\",\n                height: \"100vh\",\n                \"@supports (height: 100dvh)\": {\n                    height: \"100dvh\"\n                }\n            }}>\n            <Box m=\"auto\">\n                <CircularProgress {...props}/>\n            </Box>\n        </Box>\n    );\n}\n","import React, {\n    RefObject,\n    useCallback,\n    useEffect,\n    useRef,\n    useState\n} from \"react\";\nimport equal from \"react-fast-compare\";\nimport {\n    Badge,\n    Box,\n    Button,\n    darken,\n    Divider,\n    Grid,\n    IconButton,\n    lighten,\n    Popover\n} from \"@mui/material\";\nimport ArrowUpwardIcon from \"@mui/icons-material/ArrowUpward\";\nimport ArrowDownwardIcon from \"@mui/icons-material/ArrowDownward\";\nimport ArrowDropDownCircleIcon from \"@mui/icons-material/ArrowDropDownCircle\";\n\nimport {\n    TableColumn,\n    TableSort,\n    TableWhereFilterOp\n} from \"./VirtualTableProps\";\nimport { ErrorBoundary } from \"../ErrorBoundary\";\n\ninterface FilterFormProps<T> {\n    column: TableColumn<T>;\n    onFilterUpdate: (filter?: [TableWhereFilterOp, any], newOpenFilterState?: boolean) => void;\n    filter?: [TableWhereFilterOp, any];\n    onHover: boolean,\n    createFilterField: (props: FilterFormFieldProps<T>) => React.ReactNode;\n    popupOpen: boolean;\n    setPopupOpen: (open: boolean) => void;\n    anchorEl: RefObject<HTMLDivElement>;\n}\n\nexport type FilterFormFieldProps<CustomProps> = {\n    id: React.Key,\n    filterValue: [TableWhereFilterOp, any] | undefined,\n    setFilterValue: (filterValue?: [TableWhereFilterOp, any]) => void;\n    column: TableColumn<CustomProps>;\n    popupOpen: boolean;\n    setPopupOpen: (open: boolean) => void;\n};\n\ntype VirtualTableHeaderProps<M extends Record<string, any>> = {\n    resizeHandleRef: RefObject<HTMLDivElement>;\n    columnIndex: number;\n    isResizingIndex: number;\n    column: TableColumn<any>;\n    onColumnSort: (key: Extract<keyof M, string>) => void;\n    filter?: [TableWhereFilterOp, any];\n    sort: TableSort;\n    onFilterUpdate: (column: TableColumn, filterForProperty?: [TableWhereFilterOp, any]) => void;\n    onClickResizeColumn?: (columnIndex: number, column: TableColumn) => void;\n    createFilterField?: (props: FilterFormFieldProps<any>) => React.ReactNode;\n};\n\nexport const VirtualTableHeader = React.memo<VirtualTableHeaderProps<any>>(\n    function VirtualTableHeader<M extends Record<string, any>>({\n                                                                   resizeHandleRef,\n                                                                   columnIndex,\n                                                                   isResizingIndex,\n                                                                   sort,\n                                                                   onColumnSort,\n                                                                   onFilterUpdate,\n                                                                   filter,\n                                                                   column,\n                                                                   onClickResizeColumn,\n                                                                   createFilterField\n                                                               }: VirtualTableHeaderProps<M>) {\n\n        const ref = useRef<HTMLDivElement>(null);\n\n        const [onHover, setOnHover] = useState(false);\n\n        const [openFilter, setOpenFilter] = React.useState(false);\n\n        const handleSettingsClick = useCallback((event: any) => {\n            setOpenFilter(true);\n        }, []);\n\n        const handleClose = useCallback(() => {\n            setOpenFilter(false);\n        }, []);\n\n        const update = useCallback((filterForProperty?: [TableWhereFilterOp, any], newOpenFilterState?: boolean) => {\n            onFilterUpdate(column, filterForProperty);\n            if (newOpenFilterState !== undefined)\n                setOpenFilter(newOpenFilterState);\n        }, [column, onFilterUpdate]);\n\n        const thisColumnIsResizing = isResizingIndex === columnIndex;\n        const anotherColumnIsResizing = isResizingIndex !== columnIndex && isResizingIndex > 0;\n\n        const hovered = !anotherColumnIsResizing && (onHover || thisColumnIsResizing);\n\n        return (\n            <ErrorBoundary>\n                <Grid\n                    sx={theme => ({\n                        width: column.width,\n                        // position: \"relative\",\n                        padding: \"0px 12px\",\n                        color: hovered ? theme.palette.text.primary : theme.palette.text.secondary,\n                        backgroundColor: hovered ? darken(theme.palette.background.default, 0.05) : theme.palette.background.default,\n                        transition: \"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms\",\n                        height: \"100%\",\n                        fontSize: \"0.750rem\",\n                        textTransform: \"uppercase\",\n                        fontWeight: 600,\n                        position: column.frozen ? \"sticky\" : \"relative\",\n                        left: column.frozen ? 0 : undefined,\n                        zIndex: column.frozen ? 1 : 0,\n                        userSelect: \"none\"\n                    })}\n                    ref={ref}\n                    wrap={\"nowrap\"}\n                    alignItems={\"center\"}\n                    onMouseEnter={() => setOnHover(true)}\n                    onMouseMove={() => setOnHover(true)}\n                    onMouseLeave={() => setOnHover(false)}\n                    container>\n\n                    <Grid item xs={true} sx={{\n                        overflow: \"hidden\",\n                        flexShrink: 1\n                    }}>\n                        <Box sx={{\n                            display: \"flex\",\n                            justifyContent: column.headerAlign,\n                            alignItems: \"center\",\n                            flexDirection: \"row\"\n                        }}>\n                            <Box sx={{\n                                paddingTop: \"4px\"\n                            }}>\n                                {column.icon && column.icon(onHover || openFilter)}\n                            </Box>\n                            <Box sx={{\n                                display: \"-webkit-box\",\n                                margin: \"0px 4px\",\n                                overflow: \"hidden\",\n                                justifyContent: column.align,\n                                WebkitLineClamp: 2,\n                                WebkitBoxOrient: \"vertical\",\n                                textOverflow: \"ellipsis\"\n                            }}>\n                                {column.title}\n                            </Box>\n\n                        </Box>\n                    </Grid>\n\n                    {column.sortable && (sort || hovered || openFilter) &&\n                        <Grid item>\n                            <Badge color=\"secondary\"\n                                   variant=\"dot\"\n                                   overlap=\"circular\"\n                                   invisible={!sort}>\n                                <IconButton\n                                    size={\"small\"}\n                                    sx={(theme) => ({\n                                        backgroundColor: theme.palette.mode === \"light\" ? \"#f5f5f5\" : theme.palette.background.default\n                                    })}\n                                    onClick={() => {\n                                        onColumnSort(column.key as Extract<keyof M, string>);\n                                    }}\n                                >\n                                    {!sort &&\n                                        <ArrowUpwardIcon fontSize={\"small\"}/>}\n                                    {sort === \"asc\" &&\n                                        <ArrowUpwardIcon fontSize={\"small\"}/>}\n                                    {sort === \"desc\" &&\n                                        <ArrowDownwardIcon fontSize={\"small\"}/>}\n                                </IconButton>\n                            </Badge>\n                        </Grid>\n                    }\n\n                    {column.filter && <Grid item>\n                        <Badge color=\"secondary\"\n                               variant=\"dot\"\n                               overlap=\"circular\"\n                               invisible={!filter}>\n                            <IconButton\n                                sx={(theme) => ({\n                                    backgroundColor: theme.palette.mode === \"light\" ? \"#f5f5f5\" : theme.palette.background.default\n                                })}\n                                size={\"small\"}\n                                onClick={handleSettingsClick}>\n                                <ArrowDropDownCircleIcon fontSize={\"small\"}\n                                                         color={onHover || openFilter ? undefined : \"disabled\"}/>\n                            </IconButton>\n\n                        </Badge>\n                    </Grid>}\n\n                    {column.resizable && <Box\n                        ref={resizeHandleRef}\n                        sx={(theme) => ({\n                            position: \"absolute\",\n                            height: \"100%\",\n                            width: \"4px\",\n                            top: 0,\n                            right: 0,\n                            cursor: \"col-resize\",\n                            backgroundColor: hovered ? (theme.palette.mode === \"dark\" ? lighten(theme.palette.background.default, 0.1) : darken(theme.palette.background.default, 0.15)) : undefined\n                        })}\n                        onMouseDown={onClickResizeColumn ? () => onClickResizeColumn(columnIndex, column) : undefined}\n                    />}\n                </Grid>\n\n                {column.filter && createFilterField &&\n                    <FilterForm column={column}\n                                filter={filter}\n                                onHover={onHover}\n                                onFilterUpdate={update}\n                                createFilterField={createFilterField}\n                                popupOpen={openFilter}\n                                setPopupOpen={setOpenFilter}\n                                anchorEl={ref}/>}\n\n            </ErrorBoundary>\n        );\n    }, equal) as React.FunctionComponent<VirtualTableHeaderProps<any>>;\n\nfunction FilterForm<M>({\n                           column,\n                           onFilterUpdate,\n                           filter,\n                           onHover,\n                           createFilterField,\n                           popupOpen,\n                           setPopupOpen,\n                           anchorEl\n                       }: FilterFormProps<M>) {\n\n    const id = column.key;\n\n    const [filterInternal, setFilterInternal] = useState<[TableWhereFilterOp, any] | undefined>(filter);\n\n    useEffect(() => {\n        setFilterInternal(filter);\n    }, [filter]);\n\n    if (!column.filter) return null;\n\n    const submit = () => {\n        onFilterUpdate(filterInternal, false);\n    };\n\n    const reset = (e: any) => {\n        onFilterUpdate(undefined, false);\n    };\n\n    const filterIsSet = !!filter;\n\n    const filterField = createFilterField({\n        id,\n        filterValue: filterInternal,\n        setFilterValue: setFilterInternal,\n        column,\n        popupOpen,\n        setPopupOpen\n    });\n\n    if (!filterField) return null;\n    return (\n        <Popover\n            id={`popover_${column.key}`}\n            open={popupOpen}\n            elevation={3}\n            anchorEl={anchorEl.current}\n            onClose={() => setPopupOpen(false)}\n            anchorOrigin={{\n                vertical: \"bottom\",\n                horizontal: \"right\"\n            }}\n            transformOrigin={{\n                vertical: \"top\",\n                horizontal: \"right\"\n            }}\n        >\n            <Box sx={theme => ({\n                // backgroundColor: theme.palette.background.default\n            })}>\n                <Box sx={theme => ({\n                    p: 2,\n                    fontSize: \"0.750rem\",\n                    fontWeight: 600,\n                    textTransform: \"uppercase\"\n                })}>\n                    {column.title ?? id}\n                </Box>\n                <Divider/>\n                {filterField && <Box p={2}>\n                    {filterField}\n                </Box>}\n                <Box display=\"flex\"\n                     justifyContent=\"flex-end\"\n                     m={2}>\n                    <Box mr={1}>\n                        <Button\n                            disabled={!filterIsSet}\n                            color=\"primary\"\n                            type=\"reset\"\n                            aria-label=\"filter clear\"\n                            onClick={reset}>Clear</Button>\n                    </Box>\n                    <Button\n                        variant=\"outlined\"\n                        color=\"primary\"\n                        onClick={submit}>Filter</Button>\n                </Box>\n            </Box>\n        </Popover>\n    );\n\n}\n","import React, { createRef, useCallback, useEffect, useState } from \"react\";\n\nimport { TableColumn, TableWhereFilterOp } from \"./VirtualTableProps\";\nimport { ErrorBoundary } from \"../ErrorBoundary\";\nimport { VirtualTableHeader } from \"./VirtualTableHeader\";\nimport { VirtualTableContextProps } from \"./types\";\nimport { Box } from \"@mui/material\";\n\nexport const VirtualTableHeaderRow = ({\n                                          columns,\n                                          currentSort,\n                                          onColumnSort,\n                                          onFilterUpdate,\n                                          sortByProperty,\n                                          filter,\n                                          onColumnResize,\n                                          onColumnResizeEnd,\n                                          createFilterField\n                                      }: VirtualTableContextProps<any>) => {\n\n    const columnRefs = columns.map(() => createRef<HTMLDivElement>());\n    const [isResizing, setIsResizing] = useState(-1);\n\n    const adjustWidthColumn = useCallback((index: number, width: number, end: boolean) => {\n        const column = columns[index];\n        const minWidth = 100;\n        const maxWidth = 800;\n        const newWidth = width > maxWidth ? maxWidth : (width < minWidth ? minWidth : width);\n        const params = {\n            width: newWidth,\n            key: column.key as string,\n            column: {\n                ...column,\n                width: newWidth\n            } as TableColumn\n        };\n        if (!end)\n            onColumnResize(params);\n        else\n            onColumnResizeEnd(params);\n    }, [columns, onColumnResize, onColumnResizeEnd]);\n\n    const getEventNewWidth = useCallback((e: MouseEvent) => {\n        if (isResizing >= 0) {\n            const left = columnRefs[isResizing].current?.parentElement?.getBoundingClientRect().left;\n            if (!left) return;\n            return e.clientX - left;\n        }\n        return undefined;\n    }, [columnRefs, isResizing]);\n\n    const setCursorDocument = useCallback((isResizing: boolean) => {\n        document.body.style.cursor = isResizing ? \"col-resize\" : \"auto\";\n    }, []);\n\n    const handleOnMouseMove = useCallback((e: MouseEvent) => {\n        e.stopPropagation();\n        e.preventDefault();\n        const newWidth = getEventNewWidth(e);\n        if (newWidth)\n            adjustWidthColumn(isResizing, newWidth, false);\n    }, [adjustWidthColumn, getEventNewWidth, isResizing]);\n\n    const handleOnMouseUp = useCallback((e: MouseEvent) => {\n        e.stopPropagation();\n        e.preventDefault();\n        const newWidth = getEventNewWidth(e);\n        if (newWidth)\n            adjustWidthColumn(isResizing, newWidth, true);\n        setIsResizing(-1);\n        setCursorDocument(false);\n    }, [adjustWidthColumn, getEventNewWidth, isResizing, setCursorDocument]);\n\n    const removeResizingListeners = useCallback(() => {\n        document.removeEventListener(\"mousemove\", handleOnMouseMove);\n        document.removeEventListener(\"mouseup\", handleOnMouseUp);\n    }, [handleOnMouseMove, handleOnMouseUp]);\n\n    const attachResizeListeners = useCallback(() => {\n        document.addEventListener(\"mousemove\", handleOnMouseMove);\n        document.addEventListener(\"mouseup\", handleOnMouseUp);\n    }, [handleOnMouseMove, handleOnMouseUp]);\n\n    useEffect(() => {\n        if (isResizing >= 0) {\n            attachResizeListeners();\n        } else {\n            removeResizingListeners();\n        }\n        return () => {\n            removeResizingListeners();\n        };\n    }, [attachResizeListeners, isResizing, removeResizingListeners]);\n\n    const onClickResizeColumn = useCallback((index: number) => {\n        setIsResizing(index);\n        setCursorDocument(true);\n    }, [setCursorDocument]);\n\n    return (\n        <Box sx={theme => ({\n            position: \"sticky\",\n            minWidth: \"100%\",\n            backgroundColor: theme.palette.background.default,\n            display: \"flex\",\n            width: \"fit-content\",\n            flexDirection: \"row\",\n            top: 0,\n            left: 0,\n            zIndex: 2,\n            height: 50,\n            borderBottom: `1px solid ${theme.palette.divider}`\n        })}>\n            {columns.map((c, columnIndex) => {\n                const column = columns[columnIndex];\n\n                const filterForThisProperty: [TableWhereFilterOp, any] | undefined =\n                    column && filter && filter[column.key]\n                        ? filter[column.key]\n                        : undefined;\n                return <ErrorBoundary key={\"header_\" + column.key}>\n                    <VirtualTableHeader\n                        resizeHandleRef={columnRefs[columnIndex]}\n                        columnIndex={columnIndex}\n                        isResizingIndex={isResizing}\n                        onFilterUpdate={onFilterUpdate}\n                        filter={filterForThisProperty}\n                        sort={sortByProperty === column.key ? currentSort : undefined}\n                        onColumnSort={onColumnSort}\n                        onClickResizeColumn={onClickResizeColumn}\n                        column={column}\n                        createFilterField={createFilterField}/>\n                </ErrorBoundary>;\n            })}\n        </Box>\n    );\n};\n","import React, { useCallback, useState } from \"react\";\n\nimport equal from \"react-fast-compare\"\n\nimport { lighten, styled } from \"@mui/material\";\n\nimport { getRowHeight } from \"./common\";\nimport { VirtualTableRowProps } from \"./types\";\nimport { OnRowClickParams, TableSize } from \"./VirtualTableProps\";\n\ntype VirtualTableRowInnerProps = {\n    size: TableSize;\n    cursor?: \"pointer\" | \"default\";\n    onRowClick?: (props: OnRowClickParams<any>) => void;\n    hovered?: boolean;\n}\n\nconst VirtualTableRowInner = styled(\"div\", {})<VirtualTableRowInnerProps>(({\n                                                                               theme,\n                                                                               size,\n                                                                               cursor,\n                                                                               hovered\n                                                                           }) => ({\n    display: \"flex\",\n    minWidth: \"100%\",\n    height: getRowHeight(size),\n    cursor,\n    flexDirection: \"row\",\n    fontSize: \"0.875rem\",\n    borderBottom: `1px solid ${theme.palette.divider}`,\n    backgroundColor: hovered\n        ? (theme.palette.mode === \"dark\"\n            ? lighten(theme.palette.background.paper, 0.01)\n            : \"rgb(252, 252, 253)\") //darken(theme.palette.background.default, 0.005))\n        : undefined\n}));\n\nexport const VirtualTableRow = React.memo<VirtualTableRowProps<any>>(\n    function VirtualTableRow<T>({\n                                    rowData,\n                                    rowIndex,\n                                    children,\n                                    onRowClick,\n                                    size,\n                                    style,\n                                    hoverRow\n                                }: VirtualTableRowProps<T>) {\n\n        const [hovered, setHovered] = useState(false);\n\n        const onClick = useCallback((event: React.SyntheticEvent) => onRowClick\n            ? onRowClick({\n                rowData,\n                rowIndex,\n                event\n            })\n            : undefined, [onRowClick, rowData, rowIndex]);\n\n        const setOnHoverTrue = useCallback(() => setHovered(true), []);\n        const setOnHoverFalse = useCallback(() => setHovered(false), []);\n\n        return (\n            <VirtualTableRowInner\n                onClick={onClick}\n                size={size}\n                cursor={onRowClick ? \"pointer\" : undefined}\n                hovered={hoverRow && hovered}\n                style={{ ...(style), width: \"fit-content\" }}\n                onMouseEnter={setOnHoverTrue}\n                onMouseMove={setOnHoverTrue}\n                onMouseLeave={setOnHoverFalse}>\n\n                {children}\n\n            </VirtualTableRowInner>\n        );\n    },\n    equal\n);\n","import React from \"react\";\n\nimport equal from \"react-fast-compare\"\n\nimport { CellRendererParams, TableColumn } from \"./VirtualTableProps\";\n\ntype VirtualTableCellProps<T extends any> = {\n    dataKey: string;\n    column: TableColumn;\n    columns: TableColumn[];\n    rowData: any;\n    cellData: any;\n    rowIndex: any;\n    columnIndex: number;\n    cellRenderer: (params: CellRendererParams<T>) => React.ReactNode;\n};\n\nexport const VirtualTableCell = React.memo<VirtualTableCellProps<any>>(\n    function VirtualTableCell<T extends any>(props: VirtualTableCellProps<T>) {\n        return props.rowData && props.cellRenderer(\n            {\n                cellData: props.cellData,\n                rowData: props.rowData,\n                rowIndex: props.rowIndex,\n                isScrolling: false,\n                column: props.column,\n                columns: props.columns,\n                columnIndex: props.columnIndex,\n                width: props.column.width\n            } as CellRendererParams<T>\n        );\n    },\n    (a, b) => {\n        return equal(a, b);\n    }\n);\n","import React, {\n    createContext,\n    forwardRef,\n    RefObject,\n    useCallback,\n    useEffect,\n    useRef,\n    useState\n} from \"react\";\n\nimport equal from \"react-fast-compare\"\n\nimport { Box, Typography } from \"@mui/material\";\nimport AssignmentIcon from \"@mui/icons-material/Assignment\";\n\n// @ts-ignore\nimport { FixedSizeList as List } from \"react-window\";\nimport useMeasure from \"react-use-measure\";\n\nimport { CircularProgressCenter } from \"../CircularProgressCenter\";\nimport {\n    OnTableColumnResizeParams,\n    TableColumn,\n    TableFilterValues,\n    TableWhereFilterOp,\n    VirtualTableProps\n} from \"./VirtualTableProps\";\n\nimport { getRowHeight } from \"./common\";\nimport { VirtualTableContextProps } from \"./types\";\nimport { VirtualTableHeaderRow } from \"./VirtualTableHeaderRow\";\nimport { VirtualTableRow } from \"./VirtualTableRow\";\nimport { VirtualTableCell } from \"./VirtualTableCell\";\n\nconst VirtualListContext = createContext<VirtualTableContextProps<any>>({} as any);\nVirtualListContext.displayName = \"VirtualListContext\";\n\ntype InnerElementProps = { children: React.ReactNode, style: any };\n\n// eslint-disable-next-line react/display-name\nconst innerElementType = forwardRef<HTMLDivElement, InnerElementProps>(({\n                                                                            children,\n                                                                            ...rest\n                                                                        }: InnerElementProps, ref) => {\n\n        return (\n            <VirtualListContext.Consumer>\n                {(virtualTableProps) => {\n                    const customView = virtualTableProps.customView;\n                    return (\n                        <>\n                            <div style={{\n                                position: \"relative\",\n                                height: \"100%\"\n                            }}>\n                                <div ref={ref}\n                                     {...rest}\n                                     style={{\n                                         ...rest?.style,\n                                         minHeight: \"100%\",\n                                         position: \"relative\"\n                                     }}>\n                                    <VirtualTableHeaderRow {...virtualTableProps}/>\n                                    {!customView && children}\n                                </div>\n                            </div>\n                            {customView && <div style={{\n                                position: \"sticky\",\n                                top: \"56px\",\n                                flexGrow: 1,\n                                height: \"calc(100% - 56px)\",\n                                marginTop: \"calc(56px - 100vh)\",\n                                left: 0\n                            }}>{customView}</div>}\n                        </>\n                    );\n                }}\n            </VirtualListContext.Consumer>\n        );\n    })\n;\n\n/**\n * This is a Table component that allows displaying arbitrary data, not\n * necessarily related to entities or properties. It is the component\n * that powers the entity collections but has a generic API, so it\n * can be reused.\n *\n * @category Components\n */\nexport const VirtualTable = React.memo<VirtualTableProps<any>>(\n    function VirtualTable<T extends Record<string, any>>({\n                                                             data,\n                                                             onResetPagination,\n                                                             onEndReached,\n                                                             size = \"m\",\n                                                             columns: columnsProp,\n                                                             onRowClick,\n                                                             onColumnResize,\n                                                             filter: filterInput,\n                                                             checkFilterCombination,\n                                                             onFilterUpdate,\n                                                             sortBy,\n                                                             error,\n                                                             emptyMessage,\n                                                             onSortByUpdate,\n                                                             loading,\n                                                             cellRenderer,\n                                                             hoverRow,\n                                                             createFilterField\n                                                         }: VirtualTableProps<T>) {\n\n        const sortByProperty: string | undefined = sortBy ? sortBy[0] : undefined;\n        const currentSort: \"asc\" | \"desc\" | undefined = sortBy ? sortBy[1] : undefined;\n\n        const [columns, setColumns] = useState(columnsProp);\n\n        const tableRef = useRef<HTMLDivElement>(null);\n        const endReachCallbackThreshold = useRef<number>(0);\n\n        useEffect(() => {\n            setColumns(columnsProp);\n        }, [columnsProp]);\n\n        const [measureRef, bounds] = useMeasure();\n\n        const onColumnResizeInternal = useCallback((params: OnTableColumnResizeParams) => {\n            setColumns(columns.map((column) => column.key === params.column.key ? params.column : column));\n        }, [columns]);\n\n        const onColumnResizeEndInternal = useCallback((params: OnTableColumnResizeParams) => {\n            setColumns(columns.map((column) => column.key === params.column.key ? params.column : column));\n            if (onColumnResize) {\n                onColumnResize(params);\n            }\n        }, [columns, onColumnResize]);\n\n        // saving the current filter as a ref as a workaround for header closure\n        const filterRef = useRef<TableFilterValues<any> | undefined>();\n\n        useEffect(() => {\n            filterRef.current = filterInput;\n        }, [filterInput]);\n\n        const scrollToTop = useCallback(() => {\n            endReachCallbackThreshold.current = 0;\n            if (tableRef.current) {\n                // scrollRef.current = [scrollRef.current[0], 0];\n                tableRef.current.scrollTo(tableRef.current?.scrollLeft, 0);\n            }\n        }, []);\n\n        const onColumnSort = useCallback((key: string) => {\n\n            const isDesc = sortByProperty === key && currentSort === \"desc\";\n            const isAsc = sortByProperty === key && currentSort === \"asc\";\n            const newSort = isAsc ? \"desc\" : (isDesc ? undefined : \"asc\");\n            const newSortProperty: string | undefined = isDesc ? undefined : key;\n\n            const filter = filterRef.current;\n\n            const newSortBy: [string, \"asc\" | \"desc\"] | undefined = newSort && newSortProperty ? [newSortProperty, newSort] : undefined;\n            if (filter) {\n                if (checkFilterCombination && !checkFilterCombination(filter, newSortBy)) {\n                    if (onFilterUpdate)\n                        onFilterUpdate(undefined);\n                }\n            }\n\n            if (onResetPagination) {\n                onResetPagination();\n            }\n\n            if (onSortByUpdate) {\n                onSortByUpdate(newSortBy);\n            }\n\n            scrollToTop();\n        }, [checkFilterCombination, currentSort, onFilterUpdate, onResetPagination, onSortByUpdate, scrollToTop, sortByProperty]);\n\n        const resetSort = useCallback(() => {\n            endReachCallbackThreshold.current = 0;\n            if (onSortByUpdate)\n                onSortByUpdate(undefined);\n        }, [onSortByUpdate]);\n\n        const maxScroll = Math.max((data?.length ?? 0) * getRowHeight(size) - bounds.height, 0);\n        const onEndReachedInternal = useCallback((scrollOffset: number) => {\n            if (onEndReached && (data?.length ?? 0) > 0 && scrollOffset > endReachCallbackThreshold.current + 500) {\n                endReachCallbackThreshold.current = scrollOffset;\n                onEndReached();\n            }\n        }, [data, onEndReached]);\n\n        const onScroll = useCallback(({\n                                          scrollOffset,\n                                          scrollUpdateWasRequested\n                                      }: {\n            scrollDirection: \"forward\" | \"backward\",\n            scrollOffset: number,\n            scrollUpdateWasRequested: boolean;\n        }) => {\n            if (!scrollUpdateWasRequested && (scrollOffset >= maxScroll - 500))\n                onEndReachedInternal(scrollOffset);\n        }, [maxScroll, onEndReachedInternal]);\n\n        const onFilterUpdateInternal = useCallback((column: TableColumn, filterForProperty?: [TableWhereFilterOp, any]) => {\n\n            endReachCallbackThreshold.current = 0;\n            const filter = filterRef.current;\n            let newFilterValue: TableFilterValues<any> = filter ? { ...filter } : {};\n\n            if (!filterForProperty) {\n                delete newFilterValue[column.key];\n            } else {\n                newFilterValue[column.key] = filterForProperty;\n            }\n            const newSortBy: [string, \"asc\" | \"desc\"] | undefined = sortByProperty && currentSort ? [sortByProperty, currentSort] : undefined;\n            const isNewFilterCombinationValid = !checkFilterCombination || checkFilterCombination(newFilterValue, newSortBy);\n            if (!isNewFilterCombinationValid) {\n                newFilterValue = filterForProperty ? { [column.key]: filterForProperty } as TableFilterValues<Extract<keyof T, string>> : {};\n            }\n\n            if (onFilterUpdate) onFilterUpdate(newFilterValue);\n\n            if (column.key !== sortByProperty) {\n                resetSort();\n            }\n        }, [checkFilterCombination, currentSort, onFilterUpdate, resetSort, sortByProperty]);\n\n        const buildErrorView = useCallback(() => (\n            <Box\n                sx={{\n                    height: \"calc(100% - 64px)\",\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    position: \"sticky\",\n                    left: 0\n                }}>\n\n                <Typography variant={\"h6\"}>\n                    {\"Error fetching data from the data source\"}\n                </Typography>\n\n                {error?.message && <Typography>\n                    {error?.message}\n                </Typography>}\n\n            </Box>\n        ), [error?.message]);\n\n        const buildEmptyView = useCallback(() => {\n            if (loading)\n                return <CircularProgressCenter/>;\n            return <Box sx={{\n                display: \"flex\",\n                overflow: \"auto\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                p: 2,\n                gap: 2,\n                height: \"100%\"\n            }}>\n                <AssignmentIcon/>\n                <Typography>\n                    {emptyMessage}\n                </Typography>\n            </Box>;\n        }, [emptyMessage, loading]);\n\n        const empty = !loading && (data?.length ?? 0) === 0;\n        const customView = error ? buildErrorView() : (empty ? buildEmptyView() : undefined);\n\n        return (\n            <Box\n                ref={measureRef}\n                sx={{\n                    height: \"100%\",\n                    width: \"100%\"\n                }}>\n                <VirtualListContext.Provider\n                    value={{\n                        data,\n                        size,\n                        cellRenderer,\n                        columns,\n                        currentSort,\n                        onRowClick,\n                        customView,\n                        onColumnResize: onColumnResizeInternal,\n                        onColumnResizeEnd: onColumnResizeEndInternal,\n                        filter: filterRef.current,\n                        onColumnSort,\n                        onFilterUpdate: onFilterUpdateInternal,\n                        sortByProperty,\n                        hoverRow: hoverRow ?? false,\n                        createFilterField\n                    }}>\n\n                    <MemoizedList\n                        outerRef={tableRef}\n                        key={size}\n                        width={bounds.width}\n                        height={bounds.height}\n                        itemCount={data?.length ?? 0}\n                        onScroll={onScroll}\n                        itemSize={getRowHeight(size)}/>\n\n                </VirtualListContext.Provider>\n            </Box>\n        );\n    },\n    equal\n);\n\nfunction MemoizedList({\n                          outerRef,\n                          width,\n                          height,\n                          itemCount,\n                          onScroll,\n                          itemSize\n                      }: {\n    outerRef: RefObject<HTMLDivElement>;\n    width: number;\n    height: number;\n    itemCount: number;\n    onScroll: (params: {\n        scrollDirection: \"forward\" | \"backward\",\n        scrollOffset: number,\n        scrollUpdateWasRequested: boolean;\n    }) => void;\n    itemSize: number;\n}) {\n\n    const Row = useCallback(({\n                                 index,\n                                 style\n                             }: any) => {\n        return <VirtualListContext.Consumer>\n            {({\n                  onRowClick,\n                  data,\n                  columns,\n                  size = \"m\",\n                  cellRenderer,\n                  hoverRow\n              }) => {\n                const rowData = data && data[index];\n                return (\n                    <VirtualTableRow\n                        key={`row_${index}`}\n                        rowData={rowData}\n                        rowIndex={index}\n                        onRowClick={onRowClick}\n                        columns={columns}\n                        hoverRow={hoverRow}\n                        style={{\n                            ...style,\n                            top: `calc(${style.top}px + 50px)`\n                        }}\n                        size={size}>\n                        {columns.map((column: TableColumn, columnIndex: number) => {\n                            const cellData = rowData && rowData[column.key];\n                            return <VirtualTableCell\n                                key={`cell_${column.key}`}\n                                dataKey={column.key}\n                                cellRenderer={cellRenderer}\n                                column={column}\n                                columns={columns}\n                                rowData={rowData}\n                                cellData={cellData}\n                                rowIndex={index}\n                                columnIndex={columnIndex}/>;\n                        })}\n                    </VirtualTableRow>\n                );\n\n            }}\n        </VirtualListContext.Consumer>;\n    }, []);\n\n    return <List\n        outerRef={outerRef}\n        innerElementType={innerElementType}\n        width={width}\n        height={height}\n        overscanCount={4}\n        itemCount={itemCount}\n        onScroll={onScroll}\n        itemSize={itemSize}>\n        {Row}\n    </List>;\n}\n","import { CollectionSize, Entity } from \"../../../../types\";\n\nimport React, { MouseEvent, useCallback } from \"react\";\nimport {\n    alpha,\n    Box,\n    Checkbox,\n    IconButton,\n    ListItemIcon,\n    ListItemText,\n    Menu,\n    MenuItem,\n    Skeleton,\n    Tooltip,\n    Typography,\n    useMediaQuery,\n    useTheme\n} from \"@mui/material\";\nimport { Delete, FileCopy, KeyboardTab, MoreVert } from \"@mui/icons-material\";\n\n/**\n *\n * @param entity\n * @param width\n * @param frozen\n * @param isSelected\n * @param selectionEnabled\n * @param size\n * @param toggleEntitySelection\n * @param onCopyClicked\n * @param onEditClicked\n * @param onDeleteClicked\n * @constructor\n *\n * @category Collection components\n */\nexport function EntityCollectionRowActions<M extends Record<string, any>>({\n                                                                              entity,\n                                                                              width,\n                                                                              frozen,\n                                                                              isSelected,\n                                                                              selectionEnabled,\n                                                                              size,\n                                                                              toggleEntitySelection,\n                                                                              onCopyClicked,\n                                                                              onEditClicked,\n                                                                              onDeleteClicked,\n                                                                              hideId\n                                                                          }:\n                                                                              {\n                                                                                  entity: Entity<M>,\n                                                                                  width: number,\n                                                                                  frozen?: boolean,\n                                                                                  size: CollectionSize,\n                                                                                  isSelected?: boolean,\n                                                                                  selectionEnabled?: boolean,\n                                                                                  toggleEntitySelection?: (selectedEntity: Entity<M>) => void\n                                                                                  onEditClicked?: (selectedEntity: Entity<M>) => void,\n                                                                                  onCopyClicked?: (selectedEntity: Entity<M>) => void,\n                                                                                  onDeleteClicked?: (selectedEntity: Entity<M>) => void,\n                                                                                  hideId?: boolean\n                                                                              }) {\n\n    const theme = useTheme();\n    const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n    const editEnabled = Boolean(onEditClicked);\n    const copyEnabled = Boolean(onCopyClicked);\n    const deleteEnabled = Boolean(onDeleteClicked);\n\n    const [anchorEl, setAnchorEl] = React.useState<any | null>(null);\n\n    const openMenu = useCallback((event: React.MouseEvent) => {\n        setAnchorEl(event.currentTarget);\n        event.stopPropagation();\n    }, [setAnchorEl]);\n\n    const closeMenu = useCallback(() => {\n        setAnchorEl(null);\n    }, [setAnchorEl]);\n\n    const onCheckboxChange = useCallback((event: React.ChangeEvent) => {\n        if (toggleEntitySelection)\n            toggleEntitySelection(entity);\n        event.preventDefault();\n        event.stopPropagation();\n    }, [entity, toggleEntitySelection]);\n\n    const onDeleteClick = useCallback((event: MouseEvent) => {\n        event.stopPropagation();\n        if (onDeleteClicked)\n            onDeleteClicked(entity);\n        setAnchorEl(null);\n    }, [entity, onDeleteClicked, setAnchorEl]);\n\n    const onCopyClick = useCallback((event: MouseEvent) => {\n        event.stopPropagation();\n        if (onCopyClicked)\n            onCopyClicked(entity);\n        setAnchorEl(null);\n    }, [entity, onCopyClicked, setAnchorEl]);\n\n    const onClick = useCallback((event: MouseEvent) => {\n        event.stopPropagation();\n        if (toggleEntitySelection)\n            toggleEntitySelection(entity);\n    }, [entity, toggleEntitySelection]);\n\n    return (\n        <Box\n            style={{\n                width\n            }}\n            onClick={onClick}\n            sx={theme => ({\n                height: \"100%\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                flexDirection: \"column\",\n                position: frozen ? \"sticky\" : \"initial\",\n                left: frozen ? 0 : \"initial\",\n                background: theme.palette.mode === \"dark\" ? alpha(theme.palette.background.default, 0.96) : alpha(theme.palette.background.default, 0.96),\n                // backdropFilter: frozen ? \"blur(8px)\" : undefined,\n                contain: \"strict\",\n                zIndex: 1\n            })}>\n\n            {(editEnabled || deleteEnabled || selectionEnabled) &&\n                <Box sx={{\n                    minWidth: 138,\n                    display: \"flex\",\n                    justifyContent: \"center\"\n                }}>\n                    {editEnabled &&\n                        <Tooltip title={`Edit ${entity.id}`}>\n                            <IconButton\n                                onClick={(event: MouseEvent) => {\n                                    event.stopPropagation();\n                                    if (onEditClicked)\n                                        onEditClicked(entity);\n                                }}\n                                size={largeLayout ? \"medium\" : \"small\"}>\n                                <KeyboardTab/>\n                            </IconButton>\n                        </Tooltip>\n                    }\n\n                    {selectionEnabled &&\n                        <Tooltip title={`Select ${entity.id}`}>\n                            <Checkbox\n                                size={largeLayout ? \"medium\" : \"small\"}\n                                checked={isSelected}\n                                onChange={onCheckboxChange}\n                            />\n                        </Tooltip>}\n\n                    {(copyEnabled || deleteEnabled) &&\n                        <IconButton onClick={openMenu}\n                                    size={largeLayout ? \"medium\" : \"small\"}>\n                            <MoreVert/>\n                        </IconButton>\n                    }\n\n                    {(copyEnabled || deleteEnabled) && <Menu\n                        anchorEl={anchorEl}\n                        open={Boolean(anchorEl)}\n                        onClose={closeMenu}\n                        elevation={3}\n                    >\n                        {deleteEnabled && <MenuItem onClick={onDeleteClick}>\n                            <ListItemIcon>\n                                <Delete/>\n                            </ListItemIcon>\n                            <ListItemText primary={\"Delete\"}/>\n                        </MenuItem>}\n\n                        {copyEnabled && <MenuItem onClick={onCopyClick}>\n                            <ListItemIcon>\n                                <FileCopy/>\n                            </ListItemIcon>\n                            <ListItemText primary=\"Copy\"/>\n                        </MenuItem>}\n\n                    </Menu>}\n\n                </Box>}\n\n            {!hideId && size !== \"xs\" && (\n                <Box sx={{\n                    width: 138,\n                    textAlign: \"center\",\n                    textOverflow: \"ellipsis\",\n                    overflow: \"hidden\"\n                }}>\n\n                    {entity\n                        ? <Typography\n                            className={\"mono\"}\n                            variant={\"caption\"}\n                            color={\"textSecondary\"}> {entity.id} </Typography>\n                        : <Skeleton variant=\"text\"/>\n                    }\n                </Box>\n            )}\n\n        </Box>\n    );\n\n}\n","import React, { useCallback, useDeferredValue, useState } from \"react\";\nimport { darken, Theme } from \"@mui/material/styles\";\nimport InputBase from \"@mui/material/InputBase\";\nimport { Box, IconButton } from \"@mui/material\";\n\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport ClearIcon from \"@mui/icons-material/Clear\";\n\ninterface SearchBarProps {\n    onTextSearch: (searchString?: string) => void;\n    placeholder?: string;\n    expandable?: boolean;\n    large?: boolean;\n}\n\nexport function SearchBar({\n                              onTextSearch,\n                              placeholder = \"Search\",\n                              expandable = false,\n                              large = false\n                          }: SearchBarProps) {\n\n    const [searchText, setSearchText] = useState<string>(\"\");\n    const [active, setActive] = useState<boolean>(false);\n\n    const deferredValues = useDeferredValue(searchText);\n\n    /**\n     * Debounce on Search text update\n     */\n    React.useEffect(() => {\n        if (deferredValues) {\n            onTextSearch(deferredValues);\n        } else {\n            onTextSearch(undefined);\n        }\n    }, [deferredValues]);\n\n    const clearText = useCallback(() => {\n        setSearchText(\"\");\n        onTextSearch(undefined);\n    }, []);\n\n    return (\n        <Box sx={theme => ({\n            position: \"relative\",\n            display: \"flex\",\n            alignItems: \"center\",\n            height: large ? 56 : 40,\n            width: expandable ? undefined : \"100%\",\n            minWidth: \"200px\",\n            borderRadius: `${theme.shape.borderRadius}px`,\n            backgroundColor: theme.palette.mode === \"light\" ? darken(theme.palette.background.default, 0.05) : darken(theme.palette.background.default, 0.2),\n            \"&:hover\": {\n                backgroundColor: theme.palette.mode === \"light\" ? darken(theme.palette.background.default, 0.08) : darken(theme.palette.background.default, 0.3)\n            },\n            [theme.breakpoints.up(\"sm\")]: {\n                width: \"auto\"\n            }\n        })}>\n            <Box sx={theme => ({\n                padding: theme.spacing(0, 2),\n                height: \"100%\",\n                position: \"absolute\",\n                pointerEvents: \"none\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\"\n            })}>\n                <SearchIcon htmlColor={\"#888\"}/>\n            </Box>\n            <InputBase\n                placeholder={placeholder}\n                value={searchText}\n                onChange={(event) => {\n                    setSearchText(event.target.value);\n                }}\n                onFocus={() => setActive(true)}\n                onBlur={() => setActive(false)}\n                sx={{\n                    width: expandable ? undefined : \"100%\",\n                    color: \"inherit\",\n                    minHeight: \"inherit\"\n                }}\n                inputProps={{\n                    sx: (theme: Theme) => ({\n                        padding: theme.spacing(1, 1, 1, 0),\n                        // vertical padding + font size from searchIcon\n                        paddingLeft: `calc(1em + ${theme.spacing(4)})`,\n                        transition: theme.transitions.create(\"width\"),\n                        width: \"100%\",\n                        [theme.breakpoints.up(\"sm\")]: {\n                            width: expandable ? active ? \"20ch\" : \"12ch\" : \"100%\"\n                        }\n                    }),\n                    \"aria-label\": placeholder\n                }}\n                endAdornment={searchText\n                    ? <IconButton\n                        sx={{ mr: large ? 2 : 1 }}\n                        size={\"small\"}\n                        onClick={clearText}>\n                        <ClearIcon fontSize={\"small\"}/>\n                    </IconButton>\n                    : <div style={{ width: 26 }}/>\n                }\n            />\n        </Box>\n    );\n}\n","import { alpha, darken, styled } from \"@mui/material/styles\";\nimport Select, { SelectProps } from \"@mui/material/Select\";\nimport InputBase from \"@mui/material/InputBase\";\nimport MenuItem, { MenuItemProps } from \"@mui/material/MenuItem\";\n\nconst StyledInput = styled(InputBase)(({ theme }) => ({\n    \"label + &\": {\n        // marginTop: theme.spacing(3)\n    },\n    \"& .MuiInputBase-input\": {\n        borderRadius: 4,\n        position: \"relative\",\n        backgroundColor: theme.palette.mode === \"light\" ? alpha(theme.palette.common.black, 0.05) : darken(theme.palette.background.default, 0.2),\n        fontSize: 14,\n        fontWeight: theme.typography.fontWeightMedium,\n        padding: \"8px 26px 8px 12px\",\n        transition: theme.transitions.create([\"border-color\", \"box-shadow\"]),\n        \"&:focus\": {\n            borderRadius: 4\n        }\n    }\n}));\n\nexport function FilledSelect<T>(props: SelectProps<T>) {\n    return <Select\n        input={<StyledInput/>}\n        renderValue={(value: any) => value.toUpperCase()}\n        {...props}\n        MenuProps={{\n            MenuListProps: {\n                disablePadding: true,\n                style: {\n                    borderRadius: 4\n                }\n            },\n            elevation: 1\n        }}\n    >\n        {props.children}\n    </Select>\n}\n\nexport function FilledMenuItem(props: MenuItemProps) {\n    return <MenuItem\n        {...props}\n        sx={(theme) => ({\n            backgroundColor: theme.palette.background.default,\n            fontSize: 14,\n            fontWeight: theme.typography.fontWeightMedium,\n            paddingTop: theme.spacing(1),\n            paddingBottom: theme.spacing(1),\n            \"&:hover\": {\n                backgroundColor: darken(theme.palette.background.default, 0.1)\n            },\n            \"&:focus\": {\n                backgroundColor: darken(theme.palette.background.default, 0.2),\n                \"& .MuiListItemIcon-root, & .MuiListItemText-primary\": {\n                    color: theme.palette.text.primary\n                }\n            }\n        })}\n    >\n        {props.children}\n    </MenuItem>\n}\n","import React from \"react\";\nimport {\n    Box,\n    CircularProgress,\n    Hidden,\n    IconButton,\n    Tooltip,\n    useMediaQuery,\n    useTheme\n} from \"@mui/material\";\n\nimport { CollectionSize } from \"../../../../types\";\nimport { SearchBar } from \"./SearchBar\";\nimport FilterListOffIcon from \"@mui/icons-material/FilterListOff\";\nimport { FilledMenuItem, FilledSelect } from \"../../fields/FilledSelect\";\n\ninterface CollectionTableToolbarProps {\n    size: CollectionSize;\n    filterIsSet: boolean;\n    loading: boolean;\n    forceFilter: boolean;\n    actionsStart?: React.ReactNode;\n    actions?: React.ReactNode;\n    title?: React.ReactNode,\n    onTextSearch?: (searchString?: string) => void;\n    onSizeChanged: (size: CollectionSize) => void;\n    clearFilter: () => void;\n}\n\nexport function CollectionTableToolbar<M extends Record<string, any>>(props: CollectionTableToolbarProps) {\n\n    const theme = useTheme();\n    const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n    const filterView = !props.forceFilter && props.filterIsSet &&\n        <Tooltip title=\"Clear filter\">\n            <IconButton\n                sx={{ height: \"fit-content\" }}\n                aria-label=\"filter clear\"\n                onClick={props.clearFilter}\n                size=\"medium\">\n                <FilterListOffIcon/>\n            </IconButton>\n        </Tooltip>;\n\n    const sizeSelect = (\n        <FilledSelect\n            variant={\"standard\"}\n            value={props.size}\n            sx={{\n                width: 56,\n                height: 40\n            }}\n            onChange={(evt: any) => props.onSizeChanged(evt.target.value)}\n            renderValue={(value: any) => value.toUpperCase()}\n        >\n            {[\"xs\", \"s\", \"m\", \"l\", \"xl\"].map((value) => (\n                <FilledMenuItem\n                    key={`size-select-${value}`} value={value}>\n                    {value.toUpperCase()}\n                </FilledMenuItem>\n            ))}\n        </FilledSelect>\n    );\n\n    return (\n        <Box\n            sx={{\n                minHeight: 56,\n                overflowX: \"auto\",\n                [theme.breakpoints.down(\"sm\")]: {\n                    px: theme.spacing(1)\n                },\n                px: theme.spacing(2),\n                backgroundColor: theme.palette.background.default,\n                borderBottom: `1px solid ${theme.palette.divider}`,\n                display: \"flex\",\n                flexDirection: \"row\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                width: \"100%\"\n            }}\n        >\n\n            <Box display={\"flex\"}\n                 alignItems=\"center\"\n                 sx={{\n                     \"& > *\": {\n                         [theme.breakpoints.down(\"md\")]: {\n                             marginRight: `${theme.spacing(1)} !important`\n                         },\n                         marginRight: `${theme.spacing(2)} !important`\n                     }\n                 }}>\n\n                {props.title && <Hidden lgDown>\n                    {props.title}\n                </Hidden>}\n\n                {sizeSelect}\n\n                {props.actionsStart}\n\n                {filterView}\n\n            </Box>\n\n            <Box sx={{\n                display: \"flex\",\n                alignItems: \"center\",\n                \"& > *\": {\n                    [theme.breakpoints.down(\"md\")]: {\n                        marginRight: `${theme.spacing(0.5)} !important`\n                    },\n                    marginRight: `${theme.spacing(1)} !important`\n                }\n            }}>\n\n                {largeLayout && <Box width={22}>\n                    {props.loading &&\n                        <CircularProgress size={16} thickness={8}/>}\n                </Box>}\n\n                {props.onTextSearch &&\n                    <SearchBar\n                        key={\"search-bar\"}\n                        onTextSearch={props.onTextSearch}\n                        expandable={true}/>\n                }\n\n                {props.actions}\n\n            </Box>\n\n        </Box>\n    );\n}\n","import {\n    Box,\n    Button,\n    FormControl,\n    MenuItem,\n    Select as MuiSelect\n} from \"@mui/material\";\nimport React, { useMemo, useState } from \"react\";\nimport { TableWhereFilterOp } from \"../../Table\";\nimport { Entity, EntityCollection, EntityReference } from \"../../../../types\";\nimport { ReferencePreview } from \"../../../../preview\";\nimport { getReferenceFrom } from \"../../../util\";\nimport { useNavigationContext, useReferenceDialog } from \"../../../../hooks\";\n\ninterface ReferenceFilterFieldProps {\n    name: string,\n    value?: [op: TableWhereFilterOp, fieldValue: any];\n    setValue: (filterValue?: [TableWhereFilterOp, any]) => void;\n    isArray?: boolean;\n    path?: string;\n    title?: string;\n    previewProperties?: string[];\n    popupOpen: boolean;\n    setPopupOpen: (open: boolean) => void;\n}\n\nconst operationLabels = {\n    \"==\": \"==\",\n    \"!=\": \"!=\",\n    \">\": \">\",\n    \"<\": \"<\",\n    \">=\": \">=\",\n    \"<=\": \"<=\",\n    in: \"In\",\n    \"not-in\": \"Not in\",\n    \"array-contains\": \"Contains\",\n    \"array-contains-any\": \"Contains Any\"\n};\n\nconst multipleSelectOperations = [\"array-contains-any\", \"in\", \"not-in\"];\n\nexport function ReferenceFilterField({\n                                         name,\n                                         value,\n                                         setValue,\n                                         isArray,\n                                         path,\n                                         title,\n                                         previewProperties,\n                                         setPopupOpen\n                                     }: ReferenceFilterFieldProps) {\n\n    const possibleOperations: (keyof typeof operationLabels) [] = isArray\n        ? [\"array-contains\"]\n        : [\"==\", \"!=\", \">\", \"<\", \">=\", \"<=\"];\n\n    const [onHover, setOnHover] = React.useState(false);\n\n    isArray\n        ? possibleOperations.push(\"array-contains-any\")\n        : possibleOperations.push(\"in\", \"not-in\");\n\n    const [fieldOperation, fieldValue] = value || [possibleOperations[0], undefined];\n    const [operation, setOperation] = useState<TableWhereFilterOp>(fieldOperation);\n    const [internalValue, setInternalValue] = useState<EntityReference | EntityReference[] | undefined>(fieldValue);\n\n    const selectedEntityIds = internalValue\n        ? (Array.isArray(internalValue) ? internalValue.map((ref) => ref.id) : [internalValue.id])\n        : [];\n\n    function updateFilter(op: TableWhereFilterOp, val?: EntityReference | EntityReference[]) {\n\n        const prevOpIsArray = multipleSelectOperations.includes(operation);\n        const newOpIsArray = multipleSelectOperations.includes(op);\n        let newValue = val;\n        if (prevOpIsArray !== newOpIsArray) {\n            // @ts-ignore\n            newValue = newOpIsArray ? (newValue instanceof EntityReference ? [newValue] : []) : undefined\n        }\n\n        setOperation(op);\n        setInternalValue(newValue);\n\n        const hasNewValue = newValue !== null && Array.isArray(newValue)\n            ? newValue.length > 0\n            : newValue !== undefined;\n        if (op && hasNewValue) {\n            setValue(\n                [op, newValue]\n            );\n        } else {\n            setValue(\n                undefined\n            );\n        }\n    }\n\n    const navigationContext = useNavigationContext();\n    const collection: EntityCollection | undefined = useMemo(() => {\n        return path ? navigationContext.getCollection(path) : undefined;\n    }, [path]);\n\n    const onSingleEntitySelected = (entity: Entity<any>) => {\n        updateFilter(operation, getReferenceFrom(entity));\n    };\n\n    const onMultipleEntitiesSelected = (entities: Entity<any>[]) => {\n        updateFilter(operation, entities.map(e => getReferenceFrom(e)));\n    };\n\n    const multiple = multipleSelectOperations.includes(operation);\n\n    const referenceDialogController = useReferenceDialog({\n            multiselect: multiple,\n            path,\n            collection,\n            onSingleEntitySelected,\n            onMultipleEntitiesSelected,\n            selectedEntityIds,\n            onClose: () => {\n                setPopupOpen(true);\n            }\n        }\n    );\n\n    const doOpenDialog = () => {\n        setPopupOpen(false);\n        referenceDialogController.open();\n    };\n\n    const buildEntry = (reference: EntityReference) => {\n        return (\n            <Box\n                sx={{ mb: 0.5 }}\n                onMouseEnter={() => setOnHover(true)}\n                onMouseMove={() => setOnHover(true)}\n                onMouseLeave={() => setOnHover(false)}>\n                <ReferencePreview\n                    disabled={!path}\n                    previewProperties={previewProperties}\n                    size={\"regular\"}\n                    onClick={doOpenDialog}\n                    reference={reference}\n                    onHover={onHover}\n                    allowEntityNavigation={false}\n                />\n            </Box>\n        );\n    };\n\n    return (\n\n        <Box\n            display={\"flex\"}\n            width={440}\n            flexDirection={\"row\"}>\n            <Box width={120}>\n                <FormControl fullWidth>\n                    <MuiSelect value={operation}\n                               fullWidth\n                               onChange={(evt: any) => {\n                                   updateFilter(evt.target.value, internalValue);\n                               }}>\n                        {possibleOperations.map((op) =>\n                            <MenuItem\n                                key={`filter_op_${name}_${op}`}\n                                value={op}>{operationLabels[op]}</MenuItem>\n                        )}\n\n                    </MuiSelect>\n                </FormControl>\n            </Box>\n\n            <Box flexGrow={1} ml={1}>\n\n                <FormControl fullWidth\n                             sx={{ height: \"100%\" }}>\n                    {internalValue && Array.isArray(internalValue) && <Box>\n                        {internalValue.map((ref, index) => buildEntry(ref))}\n                    </Box>}\n                    {internalValue && !Array.isArray(internalValue) && <Box>\n                        {buildEntry(internalValue)}\n                    </Box>}\n                    {(!internalValue || (Array.isArray(internalValue) && internalValue.length === 0)) &&\n                        <Button onClick={doOpenDialog}\n                                sx={{ height: \"100%\" }}>\n                            {multiple ? \"Select references\" : \"Select reference\"}\n                        </Button>\n                    }\n                </FormControl>\n            </Box>\n\n        </Box>\n    );\n\n}\n","import {\n    Box,\n    FormControl,\n    IconButton,\n    MenuItem,\n    OutlinedInput,\n    Select as MuiSelect\n} from \"@mui/material\";\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport React, { useState } from \"react\";\nimport { EnumValuesChip } from \"../../../../preview\";\nimport { TableEnumValues, TableWhereFilterOp } from \"../../Table\";\n\ninterface StringNumberFilterFieldProps {\n    name: string,\n    dataType: \"string\" | \"number\";\n    value?: [op: TableWhereFilterOp, fieldValue: any];\n    setValue: (value?: [op: TableWhereFilterOp, newValue: any]) => void;\n    isArray?: boolean;\n    enumValues?: TableEnumValues;\n    title?: string;\n}\n\nconst operationLabels = {\n    \"==\": \"==\",\n    \"!=\": \"!=\",\n    \">\": \">\",\n    \"<\": \"<\",\n    \">=\": \">=\",\n    \"<=\": \"<=\",\n    in: \"In\",\n    \"not-in\": \"Not in\",\n    \"array-contains\": \"Contains\",\n    \"array-contains-any\": \"Any\"\n};\n\nconst multipleSelectOperations = [\"array-contains-any\", \"in\", \"not-in\"];\n\nexport function StringNumberFilterField({\n                                            name,\n                                            value,\n                                            setValue,\n                                            dataType,\n                                            isArray,\n                                            enumValues,\n                                            title\n                                        }: StringNumberFilterFieldProps) {\n\n    const possibleOperations: (keyof typeof operationLabels) [] = isArray\n        ? [\"array-contains\"]\n        : [\"==\", \"!=\", \">\", \"<\", \">=\", \"<=\"];\n\n    if (enumValues)\n        isArray\n            ? possibleOperations.push(\"array-contains-any\")\n            : possibleOperations.push(\"in\", \"not-in\");\n\n    const [fieldOperation, fieldValue] = value || [possibleOperations[0], undefined];\n    const [operation, setOperation] = useState<TableWhereFilterOp>(fieldOperation);\n    const [internalValue, setInternalValue] = useState<string | number | string[] | number[] | undefined>(fieldValue);\n\n    function updateFilter(op: TableWhereFilterOp, val: string | number | string[] | number[] | undefined) {\n        let newValue = val;\n        const prevOpIsArray = multipleSelectOperations.includes(operation);\n        const newOpIsArray = multipleSelectOperations.includes(op);\n        if (prevOpIsArray !== newOpIsArray) {\n            // @ts-ignore\n            newValue = newOpIsArray ? (typeof val === \"string\" || typeof val === \"number\" ? [val] : []) : \"\";\n        }\n\n        if (typeof newValue === \"number\" && isNaN(newValue))\n            newValue = undefined;\n\n        setOperation(op);\n        setInternalValue(newValue);\n\n        const hasNewValue = newValue !== null && Array.isArray(newValue)\n            ? newValue.length > 0\n            : newValue !== undefined;\n        if (op && hasNewValue) {\n            setValue(\n                [op, newValue]\n            );\n        } else {\n            setValue(\n                undefined\n            );\n        }\n    }\n\n    const multiple = multipleSelectOperations.includes(operation);\n    return (\n\n        <Box display={\"flex\"} width={440} alignItems={\"center\"}>\n            <Box width={80}>\n                <FormControl fullWidth>\n                    <MuiSelect value={operation}\n                               fullWidth\n                               onChange={(evt: any) => {\n                                   updateFilter(evt.target.value, internalValue);\n                               }}>\n                        {possibleOperations.map((op) =>\n                            <MenuItem\n                                key={`filter_op_${name}_${op}`}\n                                value={op}>{operationLabels[op]}</MenuItem>\n                        )}\n\n                    </MuiSelect>\n                </FormControl>\n            </Box>\n\n            <Box flexGrow={1} ml={1}>\n\n                <FormControl fullWidth>\n                    {!enumValues && <OutlinedInput\n                        fullWidth\n                        key={`filter_${name}`}\n                        type={dataType === \"number\" ? \"number\" : undefined}\n                        value={internalValue !== undefined ? internalValue : \"\"}\n                        onChange={(evt) => {\n                            const val = dataType === \"number\"\n                                ? parseFloat(evt.target.value)\n                                : evt.target.value;\n                            updateFilter(operation, val);\n                        }}\n                        endAdornment={internalValue && <IconButton\n                            sx={{\n                                position: \"absolute\",\n                                right: \"12px\",\n                                top: \"8px\"\n                            }}\n                            onClick={(e) => updateFilter(operation, undefined)}>\n                            <ClearIcon/>\n                        </IconButton>}\n                    />}\n\n                    {enumValues &&\n                        <MuiSelect\n                            fullWidth\n                            key={`filter-select-${multiple}-${name}`}\n                            multiple={multiple}\n                            value={internalValue !== undefined ? internalValue : isArray ? [] : \"\"}\n                            onChange={(evt: any) => updateFilter(operation, dataType === \"number\" ? parseInt(evt.target.value) : evt.target.value)}\n                            endAdornment={internalValue && <IconButton\n                                sx={{\n                                    position: \"absolute\",\n                                    right: \"12px\",\n                                    top: \"8px\"\n                                }}\n                                onClick={(e) => updateFilter(operation, undefined)}>\n                                <ClearIcon/>\n                            </IconButton>}\n                            renderValue={multiple\n                                ? (selected: any) =>\n                                    (\n                                        <div>\n                                            {selected.map((enumKey: any) => {\n                                                return <EnumValuesChip\n                                                    key={`select_value_${name}_${enumKey}`}\n                                                    enumKey={enumKey}\n                                                    enumValues={enumValues}\n                                                    small={true}/>;\n                                            })}\n                                        </div>\n                                    )\n                                : undefined}>\n                            {enumValues.map((enumConfig) => {\n                                return (\n                                    <MenuItem\n                                        key={`select_${name}_${enumConfig.id}`}\n                                        value={enumConfig.id}>\n                                        <EnumValuesChip\n                                            enumKey={enumConfig.id}\n                                            enumValues={enumValues}\n                                            small={true}/>\n                                    </MenuItem>\n                                );\n                            })}\n                        </MuiSelect>}\n                </FormControl>\n            </Box>\n\n        </Box>\n    );\n\n}\n","import React from \"react\";\nimport { styled } from \"@mui/material/styles\";\nimport { Checkbox, FormControlLabel, Theme } from \"@mui/material\";\nimport { TableWhereFilterOp } from \"../../Table\";\n\nconst PREFIX = \"BooleanFilterField\";\n\nconst classes = {\n    formControl: `${PREFIX}-formControl`,\n    label: `${PREFIX}-label`\n};\n\nconst Root = styled(\n    \"div\"\n)((\n    { theme }: {\n        theme: Theme\n    }\n) => ({\n    [`& .${classes.formControl}`]: {\n        width: \"200px\"\n    },\n\n    [`& .${classes.label}`]: {\n        width: \"100%\",\n        height: \"100%\"\n    }\n}));\n\ninterface BooleanFieldProps {\n    name: string,\n    value?: [op: TableWhereFilterOp, fieldValue: any];\n    setValue: (value?: [op: TableWhereFilterOp, newValue: any]) => void;\n    title?: string;\n}\n\nexport function BooleanFilterField({\n                                       name,\n                                       title,\n                                       value,\n                                       setValue\n                                   }: BooleanFieldProps) {\n\n    function updateFilter(val?: boolean) {\n        if (val !== undefined) {\n            setValue(\n                [\"==\", val]\n            );\n        } else {\n            setValue(\n                undefined\n            );\n        }\n    }\n\n    const valueSetToTrue = value && value[1];\n    const valueSet = !!value;\n\n    return (\n        <Root>\n            <FormControlLabel\n                className={classes.formControl}\n                labelPlacement={\"end\"}\n                checked={valueSet && valueSetToTrue}\n                control={\n                    <Checkbox\n                        key={`filter-${name}`}\n                        indeterminate={!valueSet}\n                        onChange={(evt) => {\n                            if (valueSetToTrue) {\n                                updateFilter(false);\n                            } else if (!valueSet) {\n                                updateFilter(true);\n                            } else {\n                                updateFilter(undefined);\n                            }\n                        }}\n                    />\n                }\n                label={!valueSet ? \"No filter\" : (valueSetToTrue ? `${title} is true` : `${title} is false`)}\n            />\n        </Root>\n    );\n}\n","import React, { useState } from \"react\";\nimport {\n    Box,\n    FormControl,\n    IconButton,\n    MenuItem,\n    Select as MuiSelect,\n    TextField\n} from \"@mui/material\";\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport { DateTimePicker } from \"@mui/x-date-pickers/DateTimePicker\";\nimport { DatePicker } from \"@mui/x-date-pickers/DatePicker\";\nimport { TableWhereFilterOp } from \"../../Table\";\n\ninterface DateTimeFilterFieldProps {\n    name: string,\n    mode?: \"date\" | \"date_time\",\n    value?: [op: TableWhereFilterOp, fieldValue: any];\n    setValue: (value?: [op: TableWhereFilterOp, newValue: any]) => void;\n    isArray?: boolean;\n    title?: string;\n}\n\nconst operationLabels = {\n    \"==\": \"==\",\n    \"!=\": \"!=\",\n    \">\": \">\",\n    \"<\": \"<\",\n    \">=\": \">=\",\n    \"<=\": \"<=\",\n    in: \"in\",\n    \"array-contains\": \"Contains\",\n    \"array-contains-any\": \"Any\"\n};\n\nconst multipleSelectOperations = [\"array-contains-any\", \"in\"];\n\nexport function DateTimeFilterField({\n                                        name,\n                                        isArray,\n                                        mode,\n                                        value,\n                                        setValue,\n                                        title\n                                    }: DateTimeFilterFieldProps) {\n\n    const possibleOperations: (keyof typeof operationLabels) [] = isArray\n        ? [\"array-contains\"]\n        : [\"==\", \"!=\", \">\", \"<\", \">=\", \"<=\"];\n\n    const [fieldOperation, fieldValue] = value || [possibleOperations[0], undefined];\n    const [operation, setOperation] = useState<TableWhereFilterOp>(fieldOperation);\n    const [internalValue, setInternalValue] = useState<Date | undefined>(fieldValue);\n\n    function updateFilter(op: TableWhereFilterOp, val: Date | undefined) {\n        let newValue: Date | undefined = val;\n        const prevOpIsArray = multipleSelectOperations.includes(operation);\n        const newOpIsArray = multipleSelectOperations.includes(op);\n        if (prevOpIsArray !== newOpIsArray) {\n            // @ts-ignore\n            newValue = newOpIsArray ? (val ? [val] : []) : \"\";\n        }\n\n        setOperation(op);\n        setInternalValue(newValue === null ? undefined : newValue);\n\n        const hasNewValue = newValue !== null && Array.isArray(newValue)\n            ? newValue.length > 0\n            : newValue !== undefined;\n        if (op && hasNewValue) {\n            setValue(\n                [op, newValue]\n            );\n        } else {\n            setValue(\n                undefined\n            );\n        }\n    }\n\n    const PickerComponent = mode === undefined || mode === \"date_time\"\n        ? DateTimePicker\n        : DatePicker;\n\n    return (\n\n        <Box display={\"flex\"} width={440} alignItems={\"center\"}>\n            <Box width={80}>\n                <FormControl fullWidth>\n                    <MuiSelect value={operation}\n                               fullWidth\n                               onChange={(evt: any) => {\n                                   updateFilter(evt.target.value, internalValue);\n                               }}>\n                        {possibleOperations.map((op) =>\n                            <MenuItem\n                                key={`filter_op_${name}_${op}`}\n                                value={op}>{operationLabels[op]}</MenuItem>\n                        )}\n\n                    </MuiSelect>\n                </FormControl>\n            </Box>\n\n            <Box flexGrow={1} ml={1}>\n                <PickerComponent\n                    value={internalValue ?? null}\n                    renderInput={(params) =>\n                        (\n                            <TextField {...params}\n                                   fullWidth\n                                   sx={{\n                                       minHeight: \"56px\"\n                                   }}\n                                   InputProps={{\n                                       ...params.InputProps,\n                                       sx: {\n                                           minHeight: \"56px\"\n                                       },\n                                       endAdornment: <Box\n                                           sx={{\n                                               pr: 2,\n                                               gap: 2\n                                           }}>\n                                           <IconButton\n                                               sx={{\n                                                   position: \"absolute\",\n                                                   right: \"56px\",\n                                                   top: \"12px\"\n                                               }}\n                                               onClick={(e) => updateFilter(operation, undefined)}>\n                                               <ClearIcon/>\n                                           </IconButton>\n                                           {params.InputProps?.endAdornment}\n                                       </Box>\n                                   }}\n                                   variant={\"outlined\"}/>\n                        )}\n                    onChange={(dateValue: Date | null) => {\n                        updateFilter(operation, dateValue === null ? undefined : dateValue);\n                    }}\n                />\n\n            </Box>\n\n        </Box>\n    );\n\n}\n","import React, { useCallback, useContext, useEffect, useMemo } from \"react\";\nimport { Box, Button, useMediaQuery, useTheme } from \"@mui/material\";\nimport equal from \"react-fast-compare\";\nimport {\n    getCellAlignment,\n    getPropertyColumnWidth,\n    getSubcollectionColumnId\n} from \"./internal/common\";\nimport {\n    AdditionalFieldDelegate,\n    CollectionSize,\n    Entity,\n    EntityCollection,\n    FilterValues,\n    FireCMSContext,\n    PropertyOrBuilder,\n    ResolvedEntityCollection,\n    ResolvedProperty,\n    SaveEntityProps,\n    User\n} from \"../../../types\";\nimport { renderSkeletonText } from \"../../../preview\";\nimport { CustomFieldValidator } from \"../../../form/validation\";\nimport { PropertyTableCell } from \"./internal/PropertyTableCell\";\nimport { ErrorBoundary } from \"../ErrorBoundary\";\nimport {\n    saveEntityWithCallbacks,\n    useDataSource,\n    useFireCMSContext,\n    useSideEntityController\n} from \"../../../hooks\";\nimport { PopupFormField } from \"./internal/popup_field/PopupFormField\";\nimport { CellRendererParams, TableColumn, VirtualTable } from \"../Table\";\nimport {\n    getIconForProperty,\n    getPropertyInPath,\n    getResolvedPropertyInPath,\n    getValueInPath,\n    resolveCollection,\n    resolveEnumValues,\n    resolveProperty\n} from \"../../util\";\nimport { getRowHeight } from \"../Table/common\";\nimport {\n    EntityCollectionRowActions\n} from \"./internal/EntityCollectionRowActions\";\nimport {\n    EntityCollectionTableController,\n    OnCellValueChange,\n    SelectedCellProps,\n    UniqueFieldValidator\n} from \"./types\";\nimport KeyboardTabIcon from \"@mui/icons-material/KeyboardTab\";\nimport { setIn } from \"formik\";\nimport { CollectionTableToolbar } from \"./internal/CollectionTableToolbar\";\nimport { EntityCollectionTableProps } from \"./EntityCollectionTableProps\";\nimport { TableCell } from \"./internal/TableCell\";\nimport { FilterFormFieldProps } from \"../Table/VirtualTableHeader\";\nimport { ReferenceFilterField } from \"./filters/ReferenceFilterField\";\nimport { StringNumberFilterField } from \"./filters/StringNumberFilterField\";\nimport { BooleanFilterField } from \"./filters/BooleanFilterField\";\nimport { DateTimeFilterField } from \"./filters/DateTimeFilterfield\";\n\nconst DEFAULT_STATE = {} as any;\n\nexport const EntityCollectionTableContext = React.createContext<EntityCollectionTableController<any>>(DEFAULT_STATE);\n\nexport const useEntityCollectionTableController = () => useContext<EntityCollectionTableController<any>>(EntityCollectionTableContext);\n\n/**\n * This component is in charge of rendering a collection table with a high\n * degree of customization. It is in charge of fetching data from\n * the {@link DataSource} and holding the state of filtering and sorting.\n *\n * This component is used internally by {@link EntityCollectionView} and\n * {@link useReferenceDialog}\n *\n * Please note that you only need to use this component if you are building\n * a custom view. If you just need to create a default view you can do it\n * exclusively with config options.\n *\n * If you want to bind a {@link EntityCollection} to a table with the default\n * options you see in collections in the top level navigation, you can\n * check {@link EntityCollectionView}\n *\n * If you need a table that is not bound to the datasource or entities and\n * properties at all, you can check {@link VirtualTable}\n *\n * @see EntityCollectionTableProps\n * @see EntityCollectionView\n * @see VirtualTable\n * @category Components\n */\nexport const EntityCollectionTable = React.memo<EntityCollectionTableProps<any>>(\n    function EntityCollectionTable<M extends Record<string, any>, AdditionalKey extends string, UserType extends User>\n    ({\n         fullPath,\n         initialFilter,\n         initialSort,\n         filterCombinations,\n         forceFilter,\n         actionsStart,\n         actions,\n         title,\n         tableRowActionsBuilder,\n         selectionController,\n         highlightedEntities,\n         onEntityClick,\n         onColumnResize,\n         onSizeChanged,\n         textSearchEnabled = false,\n         hoverRow = true,\n         inlineEditing = false,\n         tableController:\n             {\n                 data,\n                 dataLoading,\n                 noMoreToLoad,\n                 dataLoadingError,\n                 filterValues,\n                 setFilterValues,\n                 sortBy,\n                 setSortBy,\n                 searchString,\n                 setSearchString,\n                 clearFilter,\n                 itemCount,\n                 setItemCount,\n                 pageSize,\n                 paginationEnabled,\n                 checkFilterCombination\n             },\n         ...collection\n     }: EntityCollectionTableProps<M>) {\n\n        const theme = useTheme();\n        const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n        const disabledFilterChange = Boolean(forceFilter);\n        const selectedEntities = selectionController?.selectedEntities?.length > 0 ? selectionController?.selectedEntities : highlightedEntities;\n\n        const tableKey = React.useRef<string>(Math.random().toString(36));\n\n        const context: FireCMSContext<UserType> = useFireCMSContext();\n\n        const dataSource = useDataSource();\n        const sideEntityController = useSideEntityController();\n\n        const resolvedCollection = useMemo(() => resolveCollection<M>({\n            collection,\n            path: fullPath,\n            fields: context.fields\n        }), [collection, fullPath]);\n\n        const [size, setSize] = React.useState<CollectionSize>(resolvedCollection.defaultSize ?? \"m\");\n\n        const [selectedCell, setSelectedCell] = React.useState<SelectedCellProps<M> | undefined>(undefined);\n        const [popupCell, setPopupCell] = React.useState<SelectedCellProps<M> | undefined>(undefined);\n        const [focused, setFocused] = React.useState<boolean>(false);\n\n        const selectedEntityIds = selectedEntities?.map(e => e.id);\n\n        const filterIsSet = !!filterValues && Object.keys(filterValues).length > 0;\n\n        const additionalFields = useMemo(() => {\n            const subcollectionColumns: AdditionalFieldDelegate<M, any, any>[] = collection.subcollections?.map((subcollection) => {\n                return {\n                    id: getSubcollectionColumnId(subcollection),\n                    name: subcollection.name,\n                    width: 200,\n                    dependencies: [],\n                    Builder: ({ entity }) => (\n                        <Button color={\"primary\"}\n                                variant={\"outlined\"}\n                                startIcon={<KeyboardTabIcon\n                                    fontSize={\"small\"}/>}\n                                onClick={(event) => {\n                                    event.stopPropagation();\n                                    sideEntityController.open({\n                                        path: fullPath,\n                                        entityId: entity.id,\n                                        selectedSubPath: subcollection.alias ?? subcollection.path,\n                                        collection,\n                                        updateUrl: true\n                                    });\n                                }}>\n                            {subcollection.name}\n                        </Button>\n                    )\n                };\n            }) ?? [];\n            return [...(collection.additionalFields ?? collection.additionalColumns ?? []), ...subcollectionColumns];\n        }, [collection, fullPath]);\n\n        const uniqueFieldValidator: UniqueFieldValidator = useCallback(\n            ({\n                 name,\n                 value,\n                 property,\n                 entityId\n             }) => dataSource.checkUniqueField(fullPath, name, value, property, entityId),\n            [fullPath]);\n\n        const loadNextPage = () => {\n            if (!paginationEnabled || dataLoading || noMoreToLoad)\n                return;\n            if (itemCount !== undefined)\n                setItemCount(itemCount + pageSize);\n        };\n\n        const resetPagination = useCallback(() => {\n            setItemCount(pageSize);\n        }, [pageSize]);\n\n        const onRowClick = useCallback(({ rowData }: { rowData: Entity<M> }) => {\n            if (inlineEditing)\n                return;\n            return onEntityClick && onEntityClick(rowData);\n        }, [onEntityClick, inlineEditing]);\n\n        const updateSize = useCallback((size: CollectionSize) => {\n            if (onSizeChanged)\n                onSizeChanged(size);\n            setSize(size);\n        }, []);\n\n        const onTextSearch = useCallback((newSearchString?: string) => setSearchString(newSearchString), []);\n\n        const additionalFieldsMap: Record<string, AdditionalFieldDelegate<M, string, UserType>> = useMemo(() => {\n            return (additionalFields\n                ? additionalFields\n                    .map((aC) => ({ [aC.id]: aC }))\n                    .reduce((a, b) => ({ ...a, ...b }), {})\n                : {}) as Record<string, AdditionalFieldDelegate<M, string, UserType>>;\n        }, [additionalFields]);\n\n        // on ESC key press\n        useEffect(() => {\n            const escFunction = (event: any) => {\n                if (event.keyCode === 27) {\n                    unselect();\n                }\n            };\n            document.addEventListener(\"keydown\", escFunction, false);\n            return () => {\n                document.removeEventListener(\"keydown\", escFunction, false);\n            };\n        });\n\n        const select = useCallback((cell?: SelectedCellProps<M>) => {\n            setSelectedCell(cell);\n            setFocused(true);\n        }, []);\n\n        const unselect = useCallback(() => {\n            setSelectedCell(undefined);\n            setFocused(false);\n        }, []);\n\n        const onPopupClose = useCallback(() => {\n            setPopupCell(undefined);\n            setFocused(true);\n        }, []);\n\n        const displayedColumnIds = useColumnIds<M>(resolvedCollection, true);\n\n        const customFieldValidator: CustomFieldValidator | undefined = uniqueFieldValidator;\n\n        const propertyCellRenderer = useCallback(({\n                                                      column,\n                                                      columnIndex,\n                                                      rowData,\n                                                      rowIndex\n                                                  }: CellRendererParams<any>) => {\n\n            const entity: Entity<M> = rowData;\n\n            const propertyKey = column.key;\n\n            const propertyOrBuilder: PropertyOrBuilder<any, M> | undefined = getPropertyInPath<M>(collection.properties, propertyKey);\n            if (!propertyOrBuilder) {\n                return null;\n            }\n            const property = resolveProperty({\n                propertyKey,\n                propertyOrBuilder,\n                path: fullPath,\n                propertyValue: entity.values ? getValueInPath(entity.values, propertyKey) : undefined,\n                values: entity.values,\n                entityId: entity.id,\n                fields: context.fields\n            });\n\n            if (!property) {\n                return null;\n            }\n\n            return (\n                <ErrorBoundary>\n                    {entity\n                        ? <PropertyTableCell\n                            key={`property_table_cell_${entity.id}_${propertyKey}`}\n                            readonly={!inlineEditing}\n                            align={column.align ?? \"left\"}\n                            propertyKey={propertyKey as string}\n                            property={property}\n                            setFocused={setFocused}\n                            value={entity?.values ? getValueInPath(entity.values, propertyKey) : undefined}\n                            collection={collection}\n                            customFieldValidator={customFieldValidator}\n                            columnIndex={columnIndex}\n                            width={column.width}\n                            height={getRowHeight(size)}\n                            entity={entity}\n                            path={entity.path}/>\n                        : renderSkeletonText()\n                    }\n                </ErrorBoundary>);\n\n        }, [collection, customFieldValidator, fullPath, inlineEditing, size, selectedEntityIds]);\n\n        const additionalCellRenderer = useCallback(({\n                                                        column,\n                                                        rowData,\n                                                        width\n                                                    }: CellRendererParams<any>) => {\n\n            const entity: Entity<M> = rowData;\n\n            const additionalField = additionalFieldsMap[column.key as AdditionalKey];\n            const value = additionalField.dependencies\n                ? Object.entries(entity.values)\n                    .filter(([key, value]) => additionalField.dependencies!.includes(key as Extract<keyof M, string>))\n                    .reduce((a, b) => ({ ...a, ...b }), {})\n                : entity;\n\n            if (additionalField.builder) {\n                console.warn(\"`additionalField.builder` is deprecated. Use `additionalField.Builder` instead.\");\n            }\n\n            const Builder = additionalField.builder ?? additionalField.Builder;\n            if (!Builder) {\n                throw new Error(\"No builder provided for additional field\");\n            }\n\n            return (\n                <TableCell\n                    key={`additional_table_cell_${entity.id}_${column.key}`}\n                    width={width}\n                    size={size}\n                    focused={focused}\n                    value={value}\n                    selected={false}\n                    selectedRow={selectedEntityIds?.includes(entity.id) ?? false}\n                    disabled={true}\n                    align={\"left\"}\n                    allowScroll={false}\n                    showExpandIcon={false}\n                    disabledTooltip={\"This column can't be edited directly\"}\n                >\n                    <ErrorBoundary>\n                        <Builder entity={entity}\n                                 context={context}/>\n                    </ErrorBoundary>\n                </TableCell>\n            );\n\n        }, [additionalFieldsMap, size, selectedEntityIds]);\n\n        const allColumns: TableColumn[] = useMemo(() => {\n                const columnsResult: TableColumn[] = Object.entries<ResolvedProperty>(resolvedCollection.properties)\n                    .flatMap(([key, property]) => {\n                        if (property.dataType === \"map\" && property.spreadChildren && property.properties) {\n                            return Object.keys(property.properties).map(childKey => `${key}.${childKey}`);\n                        }\n                        return [key];\n                    })\n                    .map((key) => {\n                        const property = getResolvedPropertyInPath(resolvedCollection.properties, key);\n                        if (!property)\n                            throw Error(\"Internal error: no property found in path \" + key);\n                        const filterable = filterableProperty(property);\n                        return ({\n                            key: key as string,\n                            align: getCellAlignment(property),\n                            icon: (hoverOrOpen) => getIconForProperty(property, hoverOrOpen ? undefined : \"disabled\", \"small\"),\n                            title: property.name ?? key as string,\n                            sortable: forceFilter ? Object.keys(forceFilter).includes(key) : true,\n                            filter: !disabledFilterChange && filterable,\n                            width: getPropertyColumnWidth(property),\n                            resizable: true,\n                            custom: property\n                        });\n                    });\n\n                const additionalTableColumns: TableColumn[] = additionalFields\n                    ? additionalFields.map((additionalField) =>\n                        ({\n                            key: additionalField.id,\n                            type: \"additional\",\n                            align: \"left\",\n                            sortable: false,\n                            title: additionalField.name,\n                            width: additionalField.width ?? 200\n                        }))\n                    : [];\n                return [...columnsResult, ...additionalTableColumns];\n            },\n            [additionalFields, disabledFilterChange, forceFilter, resolvedCollection.properties]);\n\n        const idColumn: TableColumn = useMemo(() => ({\n            key: \"id_ewcfedcswdf3\",\n            width: largeLayout ? 160 : 130,\n            title: \"ID\",\n            resizable: false,\n            frozen: largeLayout,\n            headerAlign: \"center\"\n        }), [largeLayout])\n\n        const columns: TableColumn[] = useMemo(() => [\n            idColumn,\n            ...displayedColumnIds\n                .map((p) => {\n                    return allColumns.find(c => c.key === p);\n                }).filter(c => !!c) as TableColumn[]\n        ], [allColumns, displayedColumnIds, idColumn]);\n\n        const cellRenderer = useCallback((props: CellRendererParams<any>) => {\n            const column = props.column;\n            const columns = props.columns;\n            const columnKey = column.key;\n            if (props.columnIndex === 0) {\n                if (tableRowActionsBuilder)\n                    return tableRowActionsBuilder({\n                        entity: props.rowData,\n                        size,\n                        width: column.width,\n                        frozen: column.frozen\n                    });\n                else\n                    return <EntityCollectionRowActions entity={props.rowData}\n                                                       width={column.width}\n                                                       frozen={column.frozen}\n                                                       size={size}/>;\n            } else if (additionalFieldsMap[columnKey]) {\n                return additionalCellRenderer(props);\n            } else if (props.columnIndex < columns.length + 1) {\n                return propertyCellRenderer(props);\n            } else {\n                throw Error(\"Internal: columns not mapped properly\");\n            }\n        }, [additionalFieldsMap, tableRowActionsBuilder, size, additionalCellRenderer, propertyCellRenderer])\n\n        const onFilterUpdate = useCallback((updatedFilterValues?: FilterValues<any>) => {\n            setFilterValues({ ...updatedFilterValues, ...forceFilter } as FilterValues<any>);\n        }, [forceFilter]);\n\n        return (\n\n            <EntityCollectionTableContext.Provider\n                value={{\n                    setPopupCell,\n                    select,\n                    onValueChange,\n                    size,\n                    selectedCell,\n                    selectedEntityIds,\n                    focused\n                }}\n            >\n\n                <Box sx={(theme) => ({\n                    height: \"100%\",\n                    width: \"100%\",\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    backgroundColor: theme.palette.background.paper\n                })}>\n\n                    <CollectionTableToolbar\n                        forceFilter={disabledFilterChange}\n                        filterIsSet={filterIsSet}\n                        onTextSearch={textSearchEnabled ? onTextSearch : undefined}\n                        clearFilter={clearFilter}\n                        size={size}\n                        onSizeChanged={updateSize}\n                        title={title}\n                        actionsStart={actionsStart}\n                        actions={actions}\n                        loading={dataLoading}/>\n\n                    <Box sx={{ flexGrow: 1 }}>\n                        <VirtualTable\n                            data={data}\n                            columns={columns}\n                            cellRenderer={cellRenderer}\n                            onRowClick={inlineEditing ? undefined : onRowClick}\n                            onEndReached={loadNextPage}\n                            onResetPagination={resetPagination}\n                            error={dataLoadingError}\n                            paginationEnabled={paginationEnabled}\n                            onColumnResize={onColumnResize}\n                            size={size}\n                            loading={dataLoading}\n                            filter={filterValues}\n                            onFilterUpdate={onFilterUpdate}\n                            sortBy={sortBy}\n                            onSortByUpdate={setSortBy as ((sortBy?: [string, \"asc\" | \"desc\"]) => void)}\n                            hoverRow={hoverRow}\n                            checkFilterCombination={checkFilterCombination}\n                            createFilterField={createFilterField}\n                        />\n                    </Box>\n\n                    <PopupFormField\n                        key={`popup_form_${popupCell?.columnIndex}_${popupCell?.entity?.id}`}\n                        open={Boolean(popupCell)}\n                        onClose={onPopupClose}\n                        cellRect={popupCell?.cellRect}\n                        columnIndex={popupCell?.columnIndex}\n                        propertyKey={popupCell?.propertyKey}\n                        collection={popupCell?.collection}\n                        entity={popupCell?.entity}\n                        tableKey={tableKey.current}\n                        customFieldValidator={customFieldValidator}\n                        path={fullPath}\n                        onCellValueChange={onValueChange}\n                    />\n\n                </Box>\n            </EntityCollectionTableContext.Provider>\n        );\n\n    },\n    equal\n);\n\nconst onValueChange: OnCellValueChange<any, any> = ({\n                                                        fullPath,\n                                                        collection,\n                                                        dataSource,\n                                                        context,\n                                                        value,\n                                                        propertyKey,\n                                                        onValueUpdated,\n                                                        setError,\n                                                        entity\n                                                    }) => {\n\n    const updatedValues = setIn({ ...entity.values }, propertyKey, value);\n\n    const saveProps: SaveEntityProps = {\n        path: fullPath,\n        entityId: entity.id,\n        values: updatedValues,\n        previousValues: entity.values,\n        collection,\n        status: \"existing\"\n    };\n\n    return saveEntityWithCallbacks({\n        ...saveProps,\n        callbacks: collection.callbacks,\n        dataSource,\n        context,\n        onSaveSuccess: () => onValueUpdated(),\n        onSaveFailure: (e: Error) => {\n            console.error(\"Save failure\");\n            console.error(e);\n            setError(e);\n        }\n    });\n\n};\n\nfunction getDefaultColumnKeys<M extends Record<string, any> = any>(collection: ResolvedEntityCollection<M>, includeSubcollections: boolean) {\n    const propertyKeys = Object.keys(collection.properties);\n\n    if (collection.additionalColumns) {\n        console.warn(\"`additionalColumns` is deprecated and will be removed in previous versions. Use `additionalFields` instead, with the same structure.\");\n    }\n\n    const additionalFields = collection.additionalFields ?? collection.additionalColumns ?? [];\n    const subCollections: EntityCollection[] = collection.subcollections ?? [];\n\n    const columnIds: string[] = [\n        ...propertyKeys,\n        ...additionalFields.map((field) => field.id)\n    ];\n\n    if (includeSubcollections) {\n        const subCollectionIds = subCollections\n            .map((collection) => getSubcollectionColumnId(collection));\n        columnIds.push(...subCollectionIds.filter((subColId) => !columnIds.includes(subColId)));\n    }\n    return hideAndExpandKeys(collection, columnIds);\n}\n\nfunction useColumnIds<M extends Record<string, any>>(collection: ResolvedEntityCollection<M>, includeSubcollections: boolean): string[] {\n    return useMemo(() => {\n        if (collection.propertiesOrder)\n            return hideAndExpandKeys(collection, collection.propertiesOrder);\n        return getDefaultColumnKeys(collection, includeSubcollections);\n\n    }, [collection, includeSubcollections]);\n}\n\nfunction hideAndExpandKeys<M extends Record<string, any>>(collection: ResolvedEntityCollection<M>, keys: string[]): string[] {\n\n    return keys.flatMap((key) => {\n        const property = collection.properties[key];\n        if (property) {\n            if (property.hideFromCollection)\n                return [null];\n            if (property.disabled && typeof property.disabled === \"object\" && property.disabled.hidden)\n                return [null];\n            if (property.dataType === \"map\" && property.spreadChildren && property.properties) {\n                return Object.keys(property.properties).map(childKey => `${key}.${childKey}`);\n            }\n            return [key];\n        }\n\n        const additionalField = collection.additionalFields?.find(field => field.id === key);\n        if (additionalField) {\n            return [key];\n        }\n\n        return [null];\n    }).filter((key) => key !== null) as string[];\n}\n\nfunction createFilterField({\n                               id,\n                               filterValue,\n                               setFilterValue,\n                               column,\n                               popupOpen,\n                               setPopupOpen\n                           }: FilterFormFieldProps<ResolvedProperty>): React.ReactNode {\n    const property: ResolvedProperty | undefined = column.custom;\n    if (!property) {\n        return null;\n    }\n    const isArray = property?.dataType === \"array\";\n    const baseProperty: ResolvedProperty = isArray ? property.of : property;\n    if (!baseProperty) {\n        return null;\n    }\n    if (baseProperty.dataType === \"reference\") {\n        return <ReferenceFilterField value={filterValue}\n                                     setValue={setFilterValue}\n                                     name={id as string}\n                                     isArray={isArray}\n                                     path={baseProperty.path}\n                                     title={property?.name}\n                                     previewProperties={baseProperty?.previewProperties}\n                                     popupOpen={popupOpen}\n                                     setPopupOpen={setPopupOpen}/>;\n    } else if (baseProperty.dataType === \"number\" || baseProperty.dataType === \"string\") {\n        const name = baseProperty.name;\n        const enumValues = baseProperty.enumValues ? resolveEnumValues(baseProperty.enumValues) : undefined;\n        return <StringNumberFilterField value={filterValue}\n                                        setValue={setFilterValue}\n                                        name={id as string}\n                                        dataType={baseProperty.dataType}\n                                        isArray={isArray}\n                                        enumValues={enumValues}\n                                        title={name}/>;\n    } else if (baseProperty.dataType === \"boolean\") {\n        const name = baseProperty.name;\n        return <BooleanFilterField value={filterValue}\n                                   setValue={setFilterValue}\n                                   name={id as string}\n                                   title={name}/>;\n\n    } else if (baseProperty.dataType === \"date\") {\n        const title = baseProperty.name;\n        return <DateTimeFilterField value={filterValue}\n                                    setValue={setFilterValue}\n                                    name={id as string}\n                                    mode={baseProperty.mode}\n                                    isArray={isArray}\n                                    title={title}/>;\n    }\n\n    return (\n        <div>{`Currently the field ${property.dataType} is not supported`}</div>\n    );\n}\n\nfunction filterableProperty(property: ResolvedProperty, partOfArray = false): boolean {\n    if (partOfArray) {\n        return [\"string\", \"number\", \"date\", \"reference\"].includes(property.dataType);\n    }\n    if (property.dataType === \"array\") {\n        if (property.of)\n            return filterableProperty(property.of, true);\n        else\n            return false;\n    }\n    return [\"string\", \"number\", \"boolean\", \"date\", \"reference\", \"array\"].includes(property.dataType);\n}\n","import React from \"react\";\nimport { Backdrop, Modal, Paper, Slide, useTheme } from \"@mui/material\";\n\nexport interface SideDialogDrawerProps {\n\n    /**\n     * The contents of the drawer.\n     */\n    children: React.ReactNode,\n\n    /**\n     * Callback fired when the component requests to be closed.\n     */\n    onClose?: (force: boolean) => void,\n\n    /**\n     * If `true`, the drawer is open.\n     */\n    open: boolean,\n\n    /**\n     * The offset position of this view determines if it needs to be translated\n     * when nested\n     */\n    offsetPosition: number;\n\n}\n\nconst defaultTransitionDuration = {\n    enter: 225,\n    exit: 175\n};\n\n/**\n * The props of the [Modal](/api/modal/) component are available\n * when `variant=\"temporary\"` is set.\n */\nexport const SideDialogDrawer = React.forwardRef<HTMLDivElement, SideDialogDrawerProps>(function EntityDrawer(props, ref) {\n\n    const {\n        children,\n        onClose,\n        open,\n        offsetPosition\n    } = props;\n\n    const theme = useTheme();\n    return (\n        <Modal\n            BackdropProps={{\n                transitionDuration: defaultTransitionDuration,\n                sx: {\n                    backgroundColor: theme.palette.mode === \"dark\" ? \"rgba(0, 0, 0, 0.85)\" : \"rgba(0, 0, 0, 0.6)\"\n                }\n            }}\n            BackdropComponent={Backdrop}\n            open={open}\n            onClose={onClose ? () => onClose(false) : undefined}\n            ref={ref}\n            keepMounted={true}\n            disableEnforceFocus={true}\n            disableEscapeKeyDown={true}\n            sx={{\n                transition: `transform 300ms ${theme.transitions.easing.easeOut}`,\n                transform: `translateX(-${(offsetPosition) * 200}px)`\n            }}\n        >\n            <Slide\n                in={open}\n                timeout={defaultTransitionDuration}\n                direction={\"left\"}\n            >\n                <Paper\n                    variant={\"outlined\"}\n                    square\n                    sx={{\n                        height: \"100%\",\n                        WebkitOverflowScrolling: \"touch\", // Add iOS momentum scrolling.\n                        position: \"fixed\",\n                        outline: 0,\n                        left: \"auto\",\n                        right: 0,\n                        overflow: \"hidden\",\n                        borderRadius: \"16px 0 0 16px\"\n                    }}\n                >\n                    {children}\n                </Paper>\n            </Slide>\n        </Modal>\n    );\n});\n","import React, { useCallback } from \"react\";\nimport { Blocker, Transition } from \"history\";\nimport { UNSAFE_NavigationContext, useNavigate } from \"react-router-dom\";\nimport Button from \"@mui/material/Button\";\nimport Dialog from \"@mui/material/Dialog\";\nimport DialogContent from \"@mui/material/DialogContent\";\nimport DialogContentText from \"@mui/material/DialogContentText\";\nimport DialogTitle from \"@mui/material/DialogTitle\";\nimport { CustomDialogActions } from \"../components\";\n\nexport function useNavigationUnsavedChangesDialog(when: boolean, onSuccess: () => void):\n    {\n        navigationWasBlocked: boolean,\n        handleCancel: () => void,\n        handleOk: () => void\n    } {\n\n    const [nextLocation, setNextLocation] = React.useState<any | undefined>();\n    const { navigator } = React.useContext(UNSAFE_NavigationContext);\n\n    const navigate = useNavigate();\n\n    const handleCancel = () => {\n        setNextLocation(undefined);\n    };\n\n    const handleOk = () => {\n        onSuccess();\n        setNextLocation(undefined);\n        navigate(-1);\n    };\n\n    const blocker: Blocker = useCallback(({ action, location: nextLocation, retry }) => {\n        switch (action) {\n            case \"REPLACE\": {\n                retry();\n                return;\n            }\n            case \"POP\": {\n                setNextLocation(nextLocation);\n            }\n        }\n    }, []);\n\n    React.useEffect(() => {\n        if (!when) return;\n        if (nextLocation) return;\n        if (!(\"block\" in navigator)) return;\n        const unblock = (navigator as any).block((tx: Transition) => {\n            const autoUnblockingTx = {\n                ...tx,\n                retry() {\n                    unblock();\n                    tx.retry();\n                }\n            };\n            blocker(autoUnblockingTx);\n        });\n\n        return unblock;\n    }, [navigator, blocker, when, nextLocation]);\n\n    return { navigationWasBlocked: Boolean(nextLocation), handleCancel, handleOk };\n}\n\nexport interface UnsavedChangesDialogProps {\n    open: boolean;\n    body?: React.ReactNode;\n    title?: string;\n    handleOk: () => void;\n    handleCancel: () => void;\n}\n\nexport function UnsavedChangesDialog({\n                                         open,\n                                         handleOk,\n                                         handleCancel,\n                                         body,\n                                         title\n                                     }: UnsavedChangesDialogProps) {\n\n    return (\n        <Dialog\n            keepMounted={false}\n            open={open}\n            onClose={handleCancel}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n        >\n            <DialogTitle >\n                {title ?? \"Unsaved changes\"}\n            </DialogTitle>\n            <DialogContent>\n                {body && <DialogContentText>\n                    {body}\n                </DialogContentText>}\n                <DialogContentText >\n                    Are you sure you want to leave this page?\n                </DialogContentText>\n            </DialogContent>\n            <CustomDialogActions>\n                <Button onClick={handleCancel} autoFocus> Cancel </Button>\n                <Button onClick={handleOk}> Ok </Button>\n            </CustomDialogActions>\n        </Dialog>\n    );\n}\n","import React, { useContext, useEffect, useState } from \"react\";\nimport { useSideDialogsController } from \"../hooks/useSideDialogsController\";\nimport { SideDialogDrawer } from \"./internal/SideDialogDrawer\";\nimport { ErrorBoundary } from \"./components\";\nimport {\n    UnsavedChangesDialog,\n    useNavigationUnsavedChangesDialog\n} from \"./internal/useUnsavedChangesDialog\";\nimport { Box } from \"@mui/material\";\nimport { SideDialogPanelProps } from \"../types\";\n\nexport type SideDialogContextProps = {\n    blocked: boolean,\n    setBlocked: (blocked: boolean) => void,\n    setBlockedNavigationMessage: (message?: React.ReactNode) => void,\n    width?: string,\n    close: (force?: boolean) => void\n}\n\nconst SideDialogContext = React.createContext<SideDialogContextProps>({\n    width: \"\",\n    blocked: false,\n    setBlocked: (blocked: boolean) => {\n    },\n    setBlockedNavigationMessage: (message?: React.ReactNode) => {\n    },\n    close: () => {\n    }\n});\n\n/**\n * This hook is used to access the properties of a particular side dialog,\n * in contrast with {@link useSideDialogsController} which handles the\n * state of all the dialogs.\n */\nexport const useSideDialogContext = () => useContext<SideDialogContextProps>(SideDialogContext);\n\n/**\n * This is the component in charge of rendering the side dialogs used\n * for editing entities. Use the {@link useSideEntityController} to open\n * and control the dialogs.\n * This component needs a parent {@link FireCMS}\n * {@link useSideDialogsController}\n * @category Components\n */\nexport function SideDialogs() {\n\n    const sideDialogsController = useSideDialogsController();\n\n    const sidePanels = sideDialogsController.sidePanels;\n\n    const panels: (SideDialogPanelProps | undefined)[] = [...sidePanels];\n    panels.push(undefined);\n\n    return <>\n        {\n            panels.map((panel, index) =>\n                <SideDialogView\n                    key={`side_dialog_${index}`}\n                    panel={panel}\n                    offsetPosition={sidePanels.length - index - 1}/>)\n        }\n    </>;\n}\n\nfunction SideDialogView({\n                            offsetPosition,\n                            panel\n                        }: {\n    offsetPosition: number,\n    panel?: SideDialogPanelProps\n}) {\n\n    // was the closing of the dialog requested by the drawer\n    const [drawerCloseRequested, setDrawerCloseRequested] = useState<boolean>(false);\n    const [blocked, setBlocked] = useState(false);\n    const [blockedNavigationMessage, setBlockedNavigationMessage] = useState<React.ReactNode | undefined>();\n\n    const widthRef = React.useRef<string | undefined>(panel?.width);\n    const width = widthRef.current;\n\n    const sideDialogsController = useSideDialogsController();\n\n    const {\n        navigationWasBlocked,\n        handleOk: handleNavigationOk,\n        handleCancel: handleNavigationCancel\n    } = useNavigationUnsavedChangesDialog(\n        blocked && !drawerCloseRequested,\n        () => setBlocked(false)\n    );\n\n    useEffect(() => {\n        if (panel)\n            widthRef.current = panel.width;\n    }, [panel])\n\n    const handleDrawerCloseOk = () => {\n        setBlocked(false);\n        setDrawerCloseRequested(false);\n        sideDialogsController.close();\n        panel?.onClose?.();\n    };\n\n    const handleDrawerCloseCancel = () => {\n        setDrawerCloseRequested(false);\n    };\n\n    const onCloseRequest = (force?: boolean) => {\n        if (blocked && !force) {\n            setDrawerCloseRequested(true);\n        } else {\n            sideDialogsController.close();\n            panel?.onClose?.();\n        }\n    };\n\n    return (\n        <SideDialogContext.Provider\n            value={{\n                blocked,\n                setBlocked,\n                setBlockedNavigationMessage,\n                width,\n                close: onCloseRequest\n            }}>\n\n            <SideDialogDrawer\n                open={Boolean(panel)}\n                onClose={onCloseRequest}\n                offsetPosition={offsetPosition}\n            >\n                {panel &&\n                        <Box\n                            sx={{\n                                display: \"flex\",\n                                flexDirection: \"column\",\n                                height: \"100%\",\n                                transition: \"width 250ms ease-in-out\",\n                                width: panel.width,\n                                maxWidth: \"100vw\"\n                            }}>\n                            <ErrorBoundary>\n                                {panel.component}\n                            </ErrorBoundary>\n                        </Box>}\n\n                {!panel && <div style={{ width }}/>}\n\n            </SideDialogDrawer>\n\n            <UnsavedChangesDialog\n                open={navigationWasBlocked || drawerCloseRequested}\n                handleOk={drawerCloseRequested ? handleDrawerCloseOk : handleNavigationOk}\n                handleCancel={drawerCloseRequested ? handleDrawerCloseCancel : handleNavigationCancel}\n                body={blockedNavigationMessage}/>\n\n        </SideDialogContext.Provider>\n\n    );\n}\n","import { Entity, EntityCallbacks, EntityCollection } from \"../../../../types\";\nimport React, { useCallback, useMemo, useState } from \"react\";\nimport {\n    Button,\n    CircularProgress,\n    Dialog,\n    DialogContent,\n    DialogTitle\n} from \"@mui/material\";\nimport { EntityPreview } from \"../../index\";\nimport {\n    deleteEntityWithCallbacks,\n    useDataSource,\n    useFireCMSContext,\n    useSnackbarController\n} from \"../../../../hooks\";\nimport { CustomDialogActions } from \"../../CustomDialogActions\";\nimport { resolveCollection } from \"../../../util/resolutions\";\n\nexport interface DeleteEntityDialogProps<M extends Record<string, any>> {\n    entityOrEntitiesToDelete?: Entity<M> | Entity<M>[],\n    path: string,\n    collection: EntityCollection<M>\n    open: boolean;\n    onClose: () => void;\n    callbacks?: EntityCallbacks<M>,\n\n    onEntityDelete?(path: string, entity: Entity<M>): void;\n\n    onMultipleEntitiesDelete?(path: string, entities: Entity<M>[]): void;\n}\n\nexport function DeleteEntityDialog<M extends Record<string, any>>({\n                                                                      entityOrEntitiesToDelete,\n                                                                      collection,\n                                                                      onClose,\n                                                                      open,\n                                                                      callbacks,\n                                                                      onEntityDelete,\n                                                                      onMultipleEntitiesDelete,\n                                                                      path,\n                                                                      ...other\n                                                                  }: DeleteEntityDialogProps<M>) {\n\n    const dataSource = useDataSource();\n    const snackbarController = useSnackbarController();\n    const [loading, setLoading] = useState(false);\n\n    const [entityOrEntities, setUsedEntityOrEntities] = React.useState<Entity<M> | Entity<M>[]>();\n\n    const [multipleEntities, setMultipleEntities] = React.useState<boolean>();\n    const context = useFireCMSContext();\n\n    React.useEffect(() => {\n        if (entityOrEntitiesToDelete) {\n            const revisedEntityOrEntities = Array.isArray(entityOrEntitiesToDelete) && entityOrEntitiesToDelete.length === 1\n                ? entityOrEntitiesToDelete[0]\n                : entityOrEntitiesToDelete;\n            setUsedEntityOrEntities(revisedEntityOrEntities);\n            setMultipleEntities(Array.isArray(revisedEntityOrEntities));\n        }\n    }, [entityOrEntitiesToDelete]);\n\n    const resolvedCollection = useMemo(() => resolveCollection<M>({\n        collection,\n        path,\n        fields: context.fields\n    }), [collection, path]);\n\n    const handleCancel = useCallback(() => {\n        onClose();\n    }, [onClose]);\n\n    const onDeleteSuccess = useCallback((entity: Entity<any>) => {\n        console.debug(\"Deleted\", entity);\n    }, []);\n\n    const onDeleteFailure = useCallback((entity: Entity<any>, e: Error) => {\n        snackbarController.open({\n            type: \"error\",\n            message: \"Error deleting: \" + e?.message\n        });\n\n        console.error(\"Error deleting entity\");\n        console.error(e);\n    }, [resolvedCollection.name]);\n\n    const onPreDeleteHookError = useCallback((entity: Entity<any>, e: Error) => {\n        snackbarController.open({\n            type: \"error\",\n            message: \"Error before deleting: \" + e?.message\n        });\n        console.error(e);\n    }, [resolvedCollection.name]);\n\n    const onDeleteSuccessHookError = useCallback((entity: Entity<any>, e: Error) => {\n        snackbarController.open({\n            type: \"error\",\n            message: \"Error after deleting: \" + e?.message\n        });\n        console.error(e);\n    }, [resolvedCollection.name]);\n\n    const performDelete = useCallback((entity: Entity<M>): Promise<boolean> =>\n        deleteEntityWithCallbacks({\n            dataSource,\n            entity,\n            collection: resolvedCollection,\n            callbacks,\n            onDeleteSuccess,\n            onDeleteFailure,\n            onPreDeleteHookError,\n            onDeleteSuccessHookError,\n            context\n        }), [dataSource, resolvedCollection, callbacks, onDeleteSuccess, onDeleteFailure, onPreDeleteHookError, onDeleteSuccessHookError, context]);\n\n    const handleOk = useCallback(async () => {\n        if (entityOrEntities) {\n\n            setLoading(true);\n\n            if (multipleEntities) {\n                Promise.all((entityOrEntities as Entity<M>[]).map(performDelete)).then((results) => {\n\n                    setLoading(false);\n\n                    if (onMultipleEntitiesDelete && entityOrEntities)\n                        onMultipleEntitiesDelete(path, entityOrEntities as Entity<M>[]);\n\n                    if (results.every(Boolean)) {\n                        snackbarController.open({\n                            type: \"success\",\n                            message: `${resolvedCollection.name}: multiple deleted`\n                        });\n                    } else if (results.some(Boolean)) {\n                        snackbarController.open({\n                            type: \"warning\",\n                            message: `${resolvedCollection.name}: Some of the entities have been deleted, but not all`\n                        });\n                    } else {\n                        snackbarController.open({\n                            type: \"error\",\n                            message: `${resolvedCollection.name}: Error deleting entities`\n                        });\n                    }\n                    onClose();\n                });\n\n            } else {\n                performDelete(entityOrEntities as Entity<M>).then((success) => {\n                    setLoading(false);\n                    if (success) {\n                        if (onEntityDelete && entityOrEntities)\n                            onEntityDelete(path, entityOrEntities as Entity<M>);\n                        snackbarController.open({\n                            type: \"success\",\n                            message: `${resolvedCollection.singularName ?? resolvedCollection.name} deleted`\n                        });\n                        onClose();\n                    }\n                });\n            }\n        }\n    }, [entityOrEntities, multipleEntities, performDelete, onMultipleEntitiesDelete, path, onClose, snackbarController, resolvedCollection.name, onEntityDelete]);\n\n    let content: React.ReactNode;\n    if (entityOrEntities && multipleEntities) {\n        content = <div>Multiple entities</div>;\n    } else {\n        const entity = entityOrEntities as Entity<M> | undefined;\n        content = entity\n            ? <EntityPreview\n                entity={entity}\n                collection={collection}\n                path={path}/>\n            : <></>;\n    }\n\n    const dialogTitle = multipleEntities\n        ? `${resolvedCollection.name}: Confirm multiple delete?`\n        : `Would you like to delete this ${resolvedCollection.singularName ?? resolvedCollection.name}?`;\n\n    return (\n        <Dialog\n            maxWidth=\"md\"\n            aria-labelledby=\"delete-dialog\"\n            open={open}\n            onBackdropClick={onClose}\n            {...other}\n        >\n            <DialogTitle id=\"delete-dialog-title\">\n                {dialogTitle}\n            </DialogTitle>\n\n            {!multipleEntities && <DialogContent dividers>\n                {content}\n            </DialogContent>}\n\n            <CustomDialogActions>\n\n                {loading && <CircularProgress size={16} thickness={8}/>}\n\n                <Button onClick={handleCancel}\n                        disabled={loading}\n                        color=\"primary\">\n                    Cancel\n                </Button>\n                <Button\n                    autoFocus\n                    disabled={loading}\n                    onClick={handleOk}\n                    variant=\"contained\"\n                    color=\"primary\">\n                    Ok\n                </Button>\n            </CustomDialogActions>\n\n        </Dialog>\n    );\n}\n","import {\n    Entity,\n    EntityReference,\n    ExportConfig,\n    ResolvedEntityCollection,\n    ResolvedProperties,\n    ResolvedProperty,\n    User\n} from \"../../types\";\nimport { getValueInPath } from \"./objects\";\n\ninterface Header {\n    key: string;\n    label: string;\n}\n\nexport function downloadCSV<M extends Record<string, any>>(data: Entity<M>[],\n                               additionalData: Record<string, any>[] | undefined,\n                               collection: ResolvedEntityCollection<M>,\n                               path: string,\n                               exportConfig: ExportConfig | undefined) {\n    const properties = collection.properties;\n    const headers = getExportHeaders(properties, path, exportConfig);\n    const exportableData = getExportableData(data, additionalData, properties, headers);\n    const headersData = entryToCSVRow(headers.map(h => h.label));\n    const csvData = exportableData.map(entry => entryToCSVRow(entry));\n    downloadBlob([headersData, ...csvData], `${collection.name}.csv`, \"text/csv\");\n}\n\nexport function getExportableData(data: any[],\n                                  additionalData: Record<string, any>[] | undefined,\n                                  properties: ResolvedProperties,\n                                  headers: Header[]\n) {\n\n    const mergedData: any[] = data.map(e => ({ id: e.id, ...processCSVValues(e.values, properties) }));\n    if (additionalData) {\n        additionalData.forEach((additional, index) => {\n            mergedData[index] = { ...mergedData[index], ...additional };\n        });\n    }\n    return mergedData && mergedData.map((entry) => {\n        return headers.map((header) => getValueInPath(entry, header.key));\n    });\n}\n\nfunction getExportHeaders<M extends Record<string, any>, UserType extends User>(properties: ResolvedProperties<M>,\n                                                                      path: string,\n                                                                      exportConfig?: ExportConfig<UserType>): Header[] {\n    const headers = [\n        { label: \"id\", key: \"id\" },\n        ...Object.entries(properties)\n            .map(([childKey, property]) => getHeaders(property as ResolvedProperty, childKey, \"\"))\n            .flat()\n    ];\n\n    if (exportConfig?.additionalFields) {\n        headers.push(...exportConfig.additionalFields.map((column) => ({\n            label: column.key,\n            key: column.key\n        })));\n    }\n\n    return headers;\n}\n\n/**\n * Get headers for property. There could be more than one header per property\n * @param property\n * @param propertyKey\n * @param prefix\n */\nfunction getHeaders(property: ResolvedProperty, propertyKey: string, prefix = \"\"): Header[] {\n    const currentKey = prefix ? `${prefix}.${propertyKey}` : propertyKey;\n    if (property.dataType === \"map\" && property.properties) {\n        return Object.entries(property.properties)\n            .map(([childKey, p]) => getHeaders(p, childKey, currentKey))\n            .flat();\n    } else {\n        return [{ label: currentKey, key: currentKey }];\n    }\n}\n\nfunction processCSVValue(inputValue: any,\n                         property: ResolvedProperty): any {\n\n    let value;\n    if (property.dataType === \"map\" && property.properties) {\n        value = processCSVValues(inputValue, property.properties as ResolvedProperties);\n    } else if (property.dataType === \"array\") {\n        if (property.of && Array.isArray(inputValue)) {\n            if (Array.isArray(property.of)) {\n                value = property.of.map((p, i) => processCSVValue(inputValue[i], p));\n            } else if (property.of.dataType === \"map\") {\n                value = inputValue.map((e) => JSON.stringify(e));\n            } else {\n                value = inputValue.map((e) => processCSVValue(e, property.of as ResolvedProperty));\n            }\n        } else {\n            value = inputValue;\n        }\n    } else if (property.dataType === \"reference\") {\n        const ref = inputValue ? inputValue as EntityReference : undefined;\n        value = ref ? ref.pathWithId : null;\n    } else if (property.dataType === \"date\") {\n        value = inputValue ? inputValue.getTime() : null;\n    } else {\n        value = inputValue;\n    }\n\n    return value;\n}\n\nfunction processCSVValues<M extends Record<string, any>>\n(inputValues: Record<keyof M, any>, properties: ResolvedProperties<M>): Record<keyof M, any> {\n    const updatedValues = Object.entries(properties)\n        .map(([key, property]) => {\n            const inputValue = inputValues && (inputValues)[key];\n            const updatedValue = processCSVValue(inputValue, property as ResolvedProperty);\n            if (updatedValue === undefined) return {};\n            return ({ [key]: updatedValue });\n        })\n        .reduce((a, b) => ({ ...a, ...b }), {}) as Record<keyof M, any>;\n    return { ...inputValues, ...updatedValues };\n}\n\nfunction entryToCSVRow(entry: any[]) {\n    return entry\n        .map((v: string | undefined) => {\n            if (v === null || v === undefined) return \"\";\n            const s = String(v);\n            return '\"' + s.replaceAll('\"', '\"\"') + '\"';\n        })\n        .join(\",\") + \"\\r\\n\";\n}\n\nexport function downloadBlob(content: BlobPart[], filename: string, contentType: string) {\n    const blob = new Blob(content, { type: contentType });\n    const url = URL.createObjectURL(blob);\n    const pom = document.createElement(\"a\");\n    pom.href = url;\n    pom.setAttribute(\"download\", filename);\n    pom.click();\n}\n","import React, { useCallback, useEffect, useRef } from \"react\";\nimport {\n    Alert,\n    Button,\n    CircularProgress,\n    Dialog,\n    DialogContent,\n    DialogContentText,\n    DialogTitle,\n    IconButton,\n    Tooltip\n} from \"@mui/material\";\n\nimport GetAppIcon from \"@mui/icons-material/GetApp\";\nimport {\n    Entity,\n    EntityCollection,\n    ExportConfig,\n    ResolvedEntityCollection,\n    User\n} from \"../../../../types\";\nimport {\n    useDataSource,\n    useFireCMSContext,\n    useNavigationContext\n} from \"../../../../hooks\";\nimport { downloadCSV } from \"../../../util/csv\";\nimport { CustomDialogActions } from \"../../CustomDialogActions\";\nimport { resolveCollection } from \"../../../util\";\n\ninterface ExportButtonProps<M extends Record<string, any>, UserType extends User> {\n    collection: EntityCollection<M>;\n    path: string;\n    exportConfig?: ExportConfig<UserType>;\n}\n\nconst INITIAL_DOCUMENTS_LIMIT = 200;\n\nexport function ExportButton<M extends Record<string, any>, UserType extends User>({\n                                                                                       collection: inputCollection,\n                                                                                       path: inputPath,\n                                                                                       exportConfig\n                                                                                   }: ExportButtonProps<M, UserType>\n) {\n\n    const context = useFireCMSContext<UserType>();\n    const dataSource = useDataSource();\n    const navigationContext = useNavigationContext();\n\n    const path = navigationContext.resolveAliasesFrom(inputPath);\n\n    const collection: ResolvedEntityCollection<M> = React.useMemo(() => resolveCollection({\n        collection: inputCollection,\n        path,\n        fields: context.fields\n    }), [inputCollection, path]);\n\n    const dataRef = useRef<Entity<M>[]>();\n    const additionalDataRef = useRef<Record<string, any>[]>();\n\n    const [dataLoading, setDataLoading] = React.useState<boolean>(false);\n    const [dataLoadingError, setDataLoadingError] = React.useState<Error | undefined>();\n\n    // If in the initial load, we get more than INITIAL_DOCUMENTS_LIMIT results\n    const [hasLargeAmountOfData, setHasLargeAmountOfData] = React.useState<boolean>(false);\n\n    // did the user agree to export a large amount of data\n    const [fetchLargeDataAccepted, setFetchLargeDataAccepted] = React.useState<boolean>(false);\n\n    const [open, setOpen] = React.useState(false);\n\n    const handleClickOpen = useCallback(() => {\n        setOpen(true);\n    }, [setOpen]);\n\n    const handleClose = useCallback(() => {\n        setOpen(false);\n    }, [setOpen]);\n\n    const doDownload = useCallback((data: Entity<M>[] | undefined,\n                                    additionalData: Record<string, any>[] | undefined,\n                                    collection: ResolvedEntityCollection<M>,\n                                    path: string,\n                                    exportConfig: ExportConfig<any> | undefined) => {\n        if (!data)\n            throw Error(\"Trying to perform export without loading data first\");\n\n        downloadCSV(data, additionalData, collection, path, exportConfig);\n    }, []);\n\n    const fetchAdditionalFields = useCallback(async (entities: Entity<M>[]) => {\n\n        if (!exportConfig?.additionalFields) {\n            return;\n        }\n\n        const additionalFields = exportConfig.additionalFields;\n\n        const resolvedColumnsValues: Record<string, any>[] = await Promise.all(entities.map(async (entity) => {\n            return (await Promise.all(additionalFields.map(async (column) => {\n                return {\n                    [column.key]: await column.builder({\n                        entity,\n                        context\n                    })\n                };\n            }))).reduce((a, b) => ({ ...a, ...b }), {});\n        }));\n        return resolvedColumnsValues;\n    }, [exportConfig?.additionalFields]);\n\n    const updateEntities = useCallback(async (entities: Entity<M>[]) => {\n        if (entities.length >= INITIAL_DOCUMENTS_LIMIT) {\n            setHasLargeAmountOfData(true);\n        }\n\n        const pendingDownload = dataRef.current && entities.length > dataRef.current.length && fetchLargeDataAccepted;\n\n        dataRef.current = entities;\n        const additionalFieldsData = await fetchAdditionalFields(entities);\n        additionalDataRef.current = additionalFieldsData;\n        setDataLoadingError(undefined);\n\n        if (pendingDownload) {\n            doDownload(entities, additionalFieldsData, collection, path, exportConfig);\n            handleClose();\n        }\n    }, [collection, doDownload, exportConfig, fetchAdditionalFields, fetchLargeDataAccepted, handleClose, path]);\n\n    useEffect(() => {\n\n        if (!open) return;\n\n        setDataLoading(true);\n        dataSource.fetchCollection<M>({\n            path,\n            collection,\n            limit: fetchLargeDataAccepted ? undefined : INITIAL_DOCUMENTS_LIMIT\n        })\n            .then(updateEntities)\n            .catch(setDataLoadingError)\n            .finally(() => setDataLoading(false));\n\n    }, [collection, dataSource, fetchLargeDataAccepted, open, path, updateEntities]);\n\n    const needsToAcceptFetchAllData = hasLargeAmountOfData && !fetchLargeDataAccepted;\n\n    const onOkClicked = useCallback(() => {\n        if (needsToAcceptFetchAllData) {\n            setFetchLargeDataAccepted(true);\n        } else {\n            doDownload(dataRef.current, additionalDataRef.current, collection, path, exportConfig);\n            handleClose();\n        }\n    }, [needsToAcceptFetchAllData, doDownload, collection, path, exportConfig, handleClose]);\n\n    return <>\n\n        <Tooltip title={\"Export\"}>\n            <IconButton color={\"primary\"} onClick={handleClickOpen}>\n                <GetAppIcon/>\n            </IconButton>\n        </Tooltip>\n\n        <Dialog\n            keepMounted={false}\n            open={open}\n            onClose={handleClose}\n        >\n            <DialogTitle>Export data</DialogTitle>\n\n            <DialogContent>\n                <DialogContentText>\n\n                    <div>Download the the content of this table as a CSV\n                    </div>\n                    <br/>\n\n                    {needsToAcceptFetchAllData &&\n                        <Alert elevation={3}\n                               variant=\"filled\"\n                               severity={\"warning\"}>\n                            <div>\n                                This collections has a large number\n                                of documents (more\n                                than {INITIAL_DOCUMENTS_LIMIT}).\n                            </div>\n                            <div>\n                                Would you like to proceed?\n                            </div>\n\n                        </Alert>}\n\n                </DialogContentText>\n            </DialogContent>\n\n            <CustomDialogActions>\n\n                {dataLoading && <CircularProgress size={16} thickness={8}/>}\n\n                <Button color=\"primary\" onClick={handleClose}>\n                    Cancel\n                </Button>\n\n                <Button color=\"primary\"\n                        variant=\"contained\"\n                        disabled={dataLoading}\n                        onClick={onOkClicked}>\n                    Download\n                </Button>\n\n            </CustomDialogActions>\n\n        </Dialog>\n\n    </>;\n}\n","import React from \"react\";\nimport {\n    Button,\n    IconButton,\n    Tooltip,\n    useMediaQuery,\n    useTheme\n} from \"@mui/material\";\n\nimport { Add, Delete } from \"@mui/icons-material\";\nimport { ExportButton } from \"../EntityCollectionTable/internal/ExportButton\";\n\nimport { canCreateEntity, canDeleteEntity } from \"../../util/permissions\";\nimport { useAuthController, useFireCMSContext } from \"../../../hooks\";\nimport {\n    CollectionActionsProps,\n    Entity,\n    EntityCollection,\n    ExportConfig,\n    SelectionController\n} from \"../../../types\";\nimport { fullPathToCollectionSegments } from \"../../util/paths\";\n\nexport type EntityCollectionViewActionsProps<M extends Record<string, any>> = {\n    collection: EntityCollection<M>;\n    path: string;\n    selectionEnabled: boolean;\n    exportable: boolean | ExportConfig;\n    onNewClick: () => void;\n    onMultipleDeleteClick: () => void;\n    selectionController: SelectionController<M>;\n    loadedEntities: Entity<M>[];\n\n}\n\nexport function EntityCollectionViewActions<M extends Record<string, any>>({\n                                                                               collection,\n                                                                               onNewClick,\n                                                                               exportable,\n                                                                               onMultipleDeleteClick,\n                                                                               selectionEnabled,\n                                                                               path,\n                                                                               selectionController,\n                                                                               loadedEntities\n                                                                           }: EntityCollectionViewActionsProps<M>) {\n\n    const context = useFireCMSContext();\n    const authController = useAuthController();\n\n    const theme = useTheme();\n    const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n    const selectedEntities = selectionController.selectedEntities;\n\n    const addButton = canCreateEntity(collection, authController, fullPathToCollectionSegments(path), null) &&\n        onNewClick && (largeLayout\n            ? <Button\n                id={`add_entity_${path}`}\n                onClick={onNewClick}\n                startIcon={<Add/>}\n                size=\"large\"\n                variant=\"contained\"\n                color=\"primary\">\n                Add {collection.singularName ?? collection.name}\n            </Button>\n            : <Button\n                id={`add_entity_${path}`}\n                onClick={onNewClick}\n                size=\"medium\"\n                variant=\"contained\"\n                color=\"primary\"\n            >\n                <Add/>\n            </Button>);\n\n    const multipleDeleteEnabled = canDeleteEntity(collection, authController, fullPathToCollectionSegments(path), null);\n\n    let multipleDeleteButton: React.ReactNode | undefined;\n    if (selectionEnabled) {\n        const button = largeLayout\n            ? <Button\n                disabled={!(selectedEntities?.length) || !multipleDeleteEnabled}\n                startIcon={<Delete/>}\n                onClick={onMultipleDeleteClick}\n                color={\"primary\"}\n                sx={{ minWidth: 68 }}\n            >\n                ({selectedEntities?.length})\n            </Button>\n            : <IconButton\n                color={\"primary\"}\n                disabled={!(selectedEntities?.length) || !multipleDeleteEnabled}\n                onClick={onMultipleDeleteClick}>\n                <Delete/>\n            </IconButton>;\n        multipleDeleteButton =\n            <Tooltip\n                title={multipleDeleteEnabled ? \"Delete\" : \"You have selected at least one entity you cannot delete\"}>\n                <span>{button}</span>\n            </Tooltip>\n    }\n\n    const actionProps: CollectionActionsProps = {\n        path,\n        collection,\n        selectionController,\n        context,\n        loadedEntities\n    };\n\n    const actions = collection.Actions\n        ? Array.isArray(collection.Actions)\n            ? <>\n                {collection.Actions.map((Action, i) => (\n                    <Action key={`actions_${i}`} {...actionProps} />\n                ))}\n            </>\n            : <collection.Actions {...actionProps} />\n        : undefined;\n\n    const exportButton = exportable &&\n        <ExportButton collection={collection}\n                      exportConfig={typeof collection.exportable === \"object\" ? collection.exportable : undefined}\n                      path={path}/>;\n    return (\n        <>\n            {actions}\n            {multipleDeleteButton}\n            {exportButton}\n            {addButton}\n        </>\n    );\n}\n","import { Entity } from \"../../types\";\n\nexport interface DataOrderProps<M extends Record<string, any>> {\n    data: Entity<M>[];\n    entitiesDisplayedFirst?: Entity<M>[];\n}\n\n/**\n * This hook is used to have some entities at the beginning of data.\n * @param path\n * @param entitiesDisplayedFirst\n * @category Hooks and utilities\n */\nexport function useDataOrder<M extends Record<string, any>>(\n    {\n        data,\n        entitiesDisplayedFirst\n    }: DataOrderProps<M>): Entity<M>[] {\n\n    if (!entitiesDisplayedFirst)\n        return data;\n\n    const displayedFirstId = new Set(entitiesDisplayedFirst.map((e) => e.id));\n    return [...entitiesDisplayedFirst, ...data.filter((e) => !displayedFirstId.has(e.id))];\n\n}\n","import React from \"react\";\nimport equal from \"react-fast-compare\";\n\n/**\n * Hack to prevent data updates for incomplete callbacks from Firestore\n * triggers.\n * If any deps change, the update is immediate\n * @param data\n * @param deps\n * @param timeoutMs\n */\nexport function useDebouncedData<T>(data: T[], deps: any, timeoutMs = 5000) {\n\n    const [deferredData, setDeferredData] = React.useState(data);\n    const dataLength = React.useRef(deferredData.length ?? 0);\n    const pendingUpdate = React.useRef(false);\n    const currentDeps = React.useRef(deps);\n\n    const haveDepsChanged = !equal(currentDeps.current, deps);\n    const immediateUpdate = data.length >= dataLength.current || haveDepsChanged;\n\n    React.useEffect(() => {\n\n        const performUpdate = () => {\n            if (!equal(deferredData, data)) {\n                currentDeps.current = deps;\n                dataLength.current = data.length;\n                setDeferredData(data);\n            }\n            pendingUpdate.current = false;\n        };\n\n        pendingUpdate.current = true;\n\n        let handler: any;\n        if (immediateUpdate)\n            performUpdate()\n        else\n            handler = setTimeout(performUpdate, timeoutMs);\n\n        return () => {\n            clearTimeout(handler);\n            if (pendingUpdate.current && immediateUpdate)\n                performUpdate();\n        };\n    }, [data, timeoutMs, deps, immediateUpdate]);\n\n    return immediateUpdate ? data : deferredData;\n}\n","import React, { useCallback, useMemo } from \"react\";\n\nimport { useCollectionFetch } from \"../../../hooks\";\nimport { useDataOrder } from \"../../../hooks/data/useDataOrder\";\nimport {\n    Entity,\n    EntityCollection,\n    FilterCombination,\n    FilterValues,\n    User\n} from \"../../../types\";\nimport { useDebouncedData } from \"./useDebouncedData\";\n\nconst DEFAULT_PAGE_SIZE = 50;\n\nexport type TableController<M extends Record<string, any> = any> = {\n    data: Entity<M>[];\n    dataLoading: boolean;\n    noMoreToLoad: boolean;\n    dataLoadingError?: Error;\n    filterValues?: FilterValues<Extract<keyof M, string>>;\n    setFilterValues: (filterValues: FilterValues<Extract<keyof M, string>>) => void;\n    sortBy?: [Extract<keyof M, string>, \"asc\" | \"desc\"];\n    setSortBy: (sortBy: [Extract<keyof M, string>, \"asc\" | \"desc\"]) => void;\n    searchString?: string;\n    setSearchString: (searchString?: string) => void;\n    clearFilter: () => void;\n    itemCount?: number;\n    setItemCount: (itemCount: number) => void;\n    pageSize: number;\n    paginationEnabled: boolean;\n    checkFilterCombination: (filterValues: FilterValues<any>,\n                             sortBy?: [string, \"asc\" | \"desc\"]) => boolean;\n\n}\nexport type TableControllerProps<M extends Record<string, any> = any> = {\n    fullPath: string;\n    collection: EntityCollection<M>;\n    /**\n     * List of entities that will be displayed on top, no matter the ordering.\n     * This is used for reference fields selection\n     */\n    entitiesDisplayedFirst?: Entity<M>[];\n    isFilterCombinationValid: (\n        filter: FilterValues<Extract<keyof M, string>>,\n        sort?: [string, \"asc\" | \"desc\"],\n        filterCombinations?: FilterCombination<Extract<keyof M, string>>[]) => boolean;\n    lastDeleteTimestamp?: number;\n}\n\nexport function useTableController<M extends Record<string, any> = any, UserType extends User = User>(\n    {\n        fullPath,\n        collection,\n        entitiesDisplayedFirst,\n        isFilterCombinationValid,\n        lastDeleteTimestamp\n    }: TableControllerProps<M>)\n    : TableController<M> {\n\n    const {\n        filterCombinations,\n        initialFilter,\n        initialSort,\n        forceFilter\n    } = collection;\n\n    const paginationEnabled = collection.pagination === undefined || Boolean(collection.pagination);\n    const pageSize = typeof collection.pagination === \"number\" ? collection.pagination : DEFAULT_PAGE_SIZE;\n\n    const [searchString, setSearchString] = React.useState<string | undefined>();\n    const [itemCount, setItemCount] = React.useState<number | undefined>(paginationEnabled ? pageSize : undefined);\n\n    const checkFilterCombination = useCallback((filterValues: FilterValues<any>,\n                                                sortBy?: [string, \"asc\" | \"desc\"]) => isFilterCombinationValid(filterValues, sortBy, filterCombinations), [filterCombinations]);\n\n    const initialSortInternal = useMemo(() => {\n        if (initialSort && forceFilter && !checkFilterCombination(forceFilter, initialSort)) {\n            console.warn(\"Initial sort is not compatible with the force filter. Ignoring initial sort\");\n            return undefined;\n        }\n        return initialSort;\n    }, [initialSort, forceFilter]);\n\n    const [filterValues, setFilterValues] = React.useState<FilterValues<Extract<keyof M, string>> | undefined>(forceFilter ?? initialFilter ?? undefined);\n    const [sortBy, setSortBy] = React.useState<[Extract<keyof M, string>, \"asc\" | \"desc\"] | undefined>(initialSortInternal);\n\n    const clearFilter = useCallback(() => setFilterValues(forceFilter ?? undefined), [forceFilter]);\n\n    const {\n        data: rawData,\n        dataLoading,\n        noMoreToLoad,\n        dataLoadingError\n    } = useCollectionFetch<M, UserType>({\n        path: fullPath,\n        collection,\n        filterValues,\n        sortBy,\n        searchString,\n        itemCount\n    });\n\n    const orderedData = useDataOrder({\n        data: rawData,\n        entitiesDisplayedFirst\n    });\n\n    // hack to fix Firestore listeners firing with incomplete data\n    const data = useDebouncedData(orderedData, {\n        filterValues,\n        sortBy,\n        searchString,\n        lastDeleteTimestamp\n    });\n\n    return {\n        data,\n        dataLoading,\n        noMoreToLoad,\n        dataLoadingError,\n        filterValues,\n        setFilterValues,\n        sortBy,\n        setSortBy,\n        searchString,\n        setSearchString,\n        clearFilter,\n        itemCount,\n        setItemCount,\n        paginationEnabled,\n        pageSize,\n        checkFilterCombination\n    }\n}\n","import { FilterCombination, FilterValues, WhereFilterOp } from \"../../../types\";\n\nexport function isFilterCombinationValidForFirestore<M>(\n    filterValues: FilterValues<Extract<keyof M, string>>,\n    sortBy?: [string, \"asc\" | \"desc\"],\n    indexes?: FilterCombination<string>[]\n): boolean {\n\n    const sortKey = sortBy ? sortBy[0] : undefined;\n    const sortDirection = sortBy ? sortBy[1] : undefined;\n\n    // Order by clause cannot contain a field with an equality filter\n    const values: [WhereFilterOp, any][] = Object.values(filterValues) as [WhereFilterOp, any][];\n    if (sortKey && values.map((v) => v[0]).includes(\"==\")) {\n        return false;\n    }\n\n    const filterKeys = Object.keys(filterValues);\n    const filtersCount = filterKeys.length;\n\n    if (filtersCount === 1 && (!sortKey || sortKey === filterKeys[0])) {\n        return true;\n    }\n\n    if (!indexes && filtersCount > 1) {\n        return false;\n    }\n\n    return !!indexes && indexes\n        .filter((compositeIndex) => !sortKey || sortKey in compositeIndex)\n        .find((compositeIndex) =>\n            Object.entries(filterValues).every(([key, value]) => compositeIndex[key] !== undefined && (!sortDirection || compositeIndex[key] === sortDirection))\n        ) !== undefined;\n}\n","import React, { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { Box, Popover, Typography, useTheme } from \"@mui/material\";\nimport equal from \"react-fast-compare\"\n\nimport {\n    CollectionSize,\n    Entity,\n    EntityCollection,\n    PartialEntityCollection,\n    Property,\n    SelectionController\n} from \"../../../types\";\nimport {\n    EntityCollectionTable,\n    OnColumnResizeParams\n} from \"../EntityCollectionTable\";\n\nimport {\n    EntityCollectionRowActions\n} from \"../EntityCollectionTable/internal/EntityCollectionRowActions\";\nimport {\n    DeleteEntityDialog\n} from \"../EntityCollectionTable/internal/DeleteEntityDialog\";\n\nimport {\n    canCreateEntity,\n    canDeleteEntity,\n    canEditEntity,\n    fullPathToCollectionSegments,\n    mergeDeep\n} from \"../../util\";\nimport { Markdown, renderSkeletonText } from \"../../../preview\";\nimport {\n    useAuthController,\n    useDataSource,\n    useFireCMSContext,\n    useNavigationContext,\n    useSideEntityController\n} from \"../../../hooks\";\nimport {\n    useUserConfigurationPersistence\n} from \"../../../hooks/useUserConfigurationPersistence\";\nimport { EntityCollectionViewActions } from \"./EntityCollectionViewActions\";\nimport {\n    useTableController\n} from \"../EntityCollectionTable/useTableController\";\nimport {\n    isFilterCombinationValidForFirestore\n} from \"./isFilterCombinationValidForFirestore\";\n\n/**\n * @category Components\n */\nexport type EntityCollectionViewProps<M extends Record<string, any>> = {\n    fullPath: string;\n    isSubCollection?: boolean;\n} & EntityCollection<M>;\n\n/**\n * This component is in charge of binding a datasource path with an {@link EntityCollection}\n * where it's configuration is defined. It includes an infinite scrolling table\n * and a 'Add' new entities button,\n *\n * This component is the default one used for displaying entity collections\n * and is in charge of generating all the specific actions and customization\n * of the lower level {@link EntityCollectionTable}\n *\n * Please **note** that you only need to use this component if you are building\n * a custom view. If you just need to create a default view you can do it\n * exclusively with config options.\n *\n * If you need a lower level implementation with more granular options, you\n * can use {@link EntityCollectionTable}.\n *\n * If you need a generic table that is not bound to the datasource or entities and\n * properties at all, you can check {@link VirtualTable}\n *\n * @param fullPath\n * @param collection\n * @constructor\n * @category Components\n */\nexport const EntityCollectionView = React.memo(\n    function EntityCollectionView<M extends Record<string, any>>({\n                                                                     fullPath,\n                                                                     isSubCollection,\n                                                                     ...collectionProp\n                                                                 }: EntityCollectionViewProps<M>\n    ) {\n\n        const sideEntityController = useSideEntityController();\n        const authController = useAuthController();\n        const userConfigPersistence = useUserConfigurationPersistence();\n        const context = useFireCMSContext();\n\n        const collection = useMemo(() => {\n            const userOverride = userConfigPersistence?.getCollectionConfig<M>(fullPath);\n            return userOverride ? mergeDeep(collectionProp, userOverride) : collectionProp;\n        }, [collectionProp, fullPath, userConfigPersistence?.getCollectionConfig]);\n\n        const theme = useTheme();\n\n        const [selectedNavigationEntity, setSelectedNavigationEntity] = useState<Entity<M> | undefined>(undefined);\n        const [deleteEntityClicked, setDeleteEntityClicked] = React.useState<Entity<M> | Entity<M>[] | undefined>(undefined);\n\n        const [lastDeleteTimestamp, setLastDeleteTimestamp] = React.useState<number>(0);\n\n        const unselectNavigatedEntity = useCallback(() => {\n            const currentSelection = selectedNavigationEntity;\n            setTimeout(() => {\n                if (currentSelection === selectedNavigationEntity)\n                    setSelectedNavigationEntity(undefined);\n            }, 2400);\n        }, [selectedNavigationEntity]);\n\n        const checkInlineEditing = useCallback((entity?: Entity<any>): boolean => {\n            if (!canEditEntity(collection, authController, fullPathToCollectionSegments(fullPath), entity ?? null)) {\n                return false;\n            }\n            return collection.inlineEditing === undefined || collection.inlineEditing;\n        }, [collection, authController, fullPath]);\n\n        const exportable = collection.exportable === undefined || collection.exportable;\n\n        const selectionEnabled = collection.selectionEnabled === undefined || collection.selectionEnabled;\n        const hoverRow = !checkInlineEditing();\n\n        const [anchorEl, setAnchorEl] = React.useState<HTMLElement | null>(null);\n\n        const selectionController = useSelectionController<M>();\n        const usedSelectionController = collection.selectionController ?? selectionController;\n        const {\n            selectedEntities,\n            toggleEntitySelection,\n            isEntitySelected,\n            setSelectedEntities\n        } = usedSelectionController;\n\n        useEffect(() => {\n            setDeleteEntityClicked(undefined);\n        }, [selectedEntities]);\n\n        const tableController = useTableController<M>({\n            fullPath,\n            collection,\n            entitiesDisplayedFirst: [],\n            isFilterCombinationValid: isFilterCombinationValidForFirestore,\n            lastDeleteTimestamp\n        });\n\n        const onEntityClick = useCallback((clickedEntity: Entity<M>) => {\n            setSelectedNavigationEntity(clickedEntity);\n            context.onAnalyticsEvent?.(\"edit_entity_clicked\", {\n                path: clickedEntity.path,\n                entityId: clickedEntity.id\n            });\n            return sideEntityController.open({\n                entityId: clickedEntity.id,\n                path: fullPath,\n                collection,\n                updateUrl: true,\n                onClose: unselectNavigatedEntity\n            });\n        }, [fullPath, collection, sideEntityController]);\n\n        const onNewClick = useCallback(() => {\n            context.onAnalyticsEvent?.(\"new_entity_click\", {\n                path: fullPath\n            });\n            sideEntityController.open({\n                path: fullPath,\n                collection,\n                updateUrl: true,\n                onClose: unselectNavigatedEntity\n            });\n        }, [fullPath, collection, sideEntityController]);\n\n        const onSingleDeleteClick = useCallback((selectedEntity: Entity<any>) => {\n            context.onAnalyticsEvent?.(\"single_delete_dialog_open\", {\n                path: fullPath\n            });\n            setDeleteEntityClicked(selectedEntity);\n        }, [context, fullPath]);\n\n        const onMultipleDeleteClick = useCallback(() => {\n            context.onAnalyticsEvent?.(\"multiple_delete_dialog_open\", {\n                path: fullPath\n            });\n            setDeleteEntityClicked(selectedEntities);\n        }, [context, fullPath, selectedEntities]);\n\n        const internalOnEntityDelete = useCallback((_path: string, entity: Entity<M>) => {\n            context.onAnalyticsEvent?.(\"single_entity_deleted\", {\n                path: fullPath\n            });\n            setSelectedEntities((selectedEntities) => selectedEntities.filter((e) => e.id !== entity.id));\n            setLastDeleteTimestamp(Date.now());\n        }, [context, fullPath, setSelectedEntities]);\n\n        const internalOnMultipleEntitiesDelete = useCallback((_path: string, entities: Entity<M>[]) => {\n            context.onAnalyticsEvent?.(\"multiple_entities_deleted\", {\n                path: fullPath\n            });\n            setSelectedEntities([]);\n            setDeleteEntityClicked(undefined);\n            setLastDeleteTimestamp(Date.now());\n        }, [setSelectedEntities]);\n\n        const onCollectionModifiedForUser = useCallback((path: string, partialCollection: PartialEntityCollection<M>) => {\n            if (userConfigPersistence) {\n                const currentStoredConfig = userConfigPersistence.getCollectionConfig(path);\n                const updatedConfig = mergeDeep(currentStoredConfig, partialCollection);\n                userConfigPersistence.onCollectionModified(path, updatedConfig);\n            }\n        }, [userConfigPersistence]);\n\n        const onColumnResize = useCallback(({\n                                                width,\n                                                key\n                                            }: OnColumnResizeParams) => {\n            // Only for property columns\n            if (!collection.properties[key]) return;\n            const property: Partial<Property> = { columnWidth: width };\n            const localCollection = { properties: { [key as keyof M]: property } } as PartialEntityCollection<M>;\n            onCollectionModifiedForUser(fullPath, localCollection);\n        }, [collection, onCollectionModifiedForUser, fullPath]);\n\n        const onSizeChanged = useCallback((size: CollectionSize) => {\n            if (userConfigPersistence)\n                onCollectionModifiedForUser(fullPath, { defaultSize: size })\n        }, [onCollectionModifiedForUser, fullPath, userConfigPersistence]);\n\n        const open = anchorEl != null;\n\n        const Title = useMemo(() => (\n            <Box sx={{\n                display: \"flex\",\n                flexDirection: \"row\",\n                contain: \"content\",\n                \"& > *:not(:last-child)\": {\n                    [theme.breakpoints.down(\"md\")]: {\n                        mr: theme.spacing(1)\n                    },\n                    mr: theme.spacing(2)\n                }\n            }}>\n                <Box>\n                    <Typography\n                        variant={\"h6\"}\n                        sx={{\n                            lineHeight: \"1.15\",\n                            textOverflow: \"ellipsis\",\n                            whiteSpace: \"nowrap\",\n                            overflow: \"hidden\",\n                            maxWidth: \"164px\",\n                            cursor: collection.description ? \"pointer\" : \"inherit\"\n                        }}\n                        onClick={collection.description\n                            ? (e) => {\n                                setAnchorEl(e.currentTarget);\n                                e.stopPropagation();\n                            }\n                            : undefined}\n                    >\n                        {`${collection.name}`}\n                    </Typography>\n                    <EntitiesCount fullPath={fullPath}/>\n\n                    {collection.description &&\n                        <Popover\n                            id={\"info-dialog\"}\n                            open={open}\n                            anchorEl={anchorEl}\n                            elevation={3}\n                            onClose={() => {\n                                setAnchorEl(null);\n                            }}\n                            anchorOrigin={{\n                                vertical: \"bottom\",\n                                horizontal: \"center\"\n                            }}\n                            transformOrigin={{\n                                vertical: \"top\",\n                                horizontal: \"center\"\n                            }}\n                        >\n\n                            <Box m={2}>\n                                <Markdown source={collection.description}/>\n                            </Box>\n\n                        </Popover>\n                    }\n\n                </Box>\n\n            </Box>\n        ), [theme, collection.description, collection.name, fullPath, open, anchorEl]);\n\n        const createEnabled = canCreateEntity(collection, authController, fullPathToCollectionSegments(fullPath), null);\n\n        const onCopyClicked = useCallback((clickedEntity: Entity<M>) => {\n            setSelectedNavigationEntity(clickedEntity);\n            context.onAnalyticsEvent?.(\"copy_entity_click\", {\n                path: clickedEntity.path,\n                entityId: clickedEntity.id\n            });\n            sideEntityController.open({\n                entityId: clickedEntity.id,\n                path: fullPath,\n                copy: true,\n                collection,\n                updateUrl: true,\n                onClose: unselectNavigatedEntity\n            });\n        }, [sideEntityController, collection, fullPath, unselectNavigatedEntity]);\n\n        const onEditClicked = useCallback((clickedEntity: Entity<M>) => {\n            setSelectedNavigationEntity(clickedEntity);\n            context.onAnalyticsEvent?.(\"entity_click\", {\n                path: clickedEntity.path,\n                entityId: clickedEntity.id\n            });\n            sideEntityController.open({\n                entityId: clickedEntity.id,\n                path: fullPath,\n                collection,\n                updateUrl: true,\n                onClose: unselectNavigatedEntity\n            });\n        }, [sideEntityController, collection, fullPath, unselectNavigatedEntity]);\n\n        const tableRowActionsBuilder = useCallback(({\n                                                        entity,\n                                                        size,\n                                                        width,\n                                                        frozen\n                                                    }: { entity: Entity<any>, size: CollectionSize, width: number, frozen?: boolean }) => {\n\n            const isSelected = isEntitySelected(entity);\n\n            const deleteEnabled = canDeleteEntity(collection, authController, fullPathToCollectionSegments(fullPath), entity);\n\n            return (\n                <EntityCollectionRowActions\n                    entity={entity}\n                    width={width}\n                    frozen={frozen}\n                    isSelected={isSelected}\n                    selectionEnabled={selectionEnabled}\n                    size={size}\n                    toggleEntitySelection={toggleEntitySelection}\n                    onEditClicked={onEditClicked}\n                    onCopyClicked={createEnabled ? onCopyClicked : undefined}\n                    onDeleteClicked={deleteEnabled ? onSingleDeleteClick : undefined}\n                    hideId={collection?.hideIdFromCollection}\n                />\n            );\n\n        }, [isEntitySelected, collection, authController, fullPath, selectionEnabled, toggleEntitySelection, onEditClicked, createEnabled, onCopyClicked]);\n\n        return (\n            <Box sx={{\n                overflow: \"hidden\",\n                height: \"100%\",\n                width: \"100%\"\n            }}>\n                <EntityCollectionTable\n                    key={`collection_table_${fullPath}`}\n                    fullPath={fullPath}\n                    tableController={tableController}\n                    onSizeChanged={onSizeChanged}\n                    onEntityClick={onEntityClick}\n                    onColumnResize={onColumnResize}\n                    tableRowActionsBuilder={tableRowActionsBuilder}\n                    title={Title}\n                    selectionController={usedSelectionController}\n                    highlightedEntities={selectedNavigationEntity ? [selectedNavigationEntity] : []}\n                    {...collection}\n                    actions={<EntityCollectionViewActions\n                        collection={collection}\n                        exportable={exportable}\n                        onMultipleDeleteClick={onMultipleDeleteClick}\n                        onNewClick={onNewClick}\n                        path={fullPath}\n                        loadedEntities={tableController.data}\n                        selectionController={usedSelectionController}\n                        selectionEnabled={selectionEnabled}/>}\n                    hoverRow={hoverRow}\n                    inlineEditing={checkInlineEditing()}\n                />\n\n                {deleteEntityClicked &&\n                    <DeleteEntityDialog\n                        entityOrEntitiesToDelete={deleteEntityClicked}\n                        path={fullPath}\n                        collection={collection}\n                        callbacks={collection.callbacks}\n                        open={Boolean(deleteEntityClicked)}\n                        onEntityDelete={internalOnEntityDelete}\n                        onMultipleEntitiesDelete={internalOnMultipleEntitiesDelete}\n                        onClose={() => setDeleteEntityClicked(undefined)}/>}\n\n            </Box>\n        );\n    }, equal) as React.FunctionComponent<EntityCollectionViewProps<any>>\n\nexport function useSelectionController<M extends Record<string, any>>(): SelectionController<M> {\n\n    const [selectedEntities, setSelectedEntities] = useState<Entity<M>[]>([]);\n\n    const toggleEntitySelection = useCallback((entity: Entity<M>) => {\n        let newValue;\n        if (selectedEntities.map(e => e.id).includes(entity.id)) {\n            newValue = selectedEntities.filter((item: Entity<M>) => item.id !== entity.id);\n        } else {\n            newValue = [...selectedEntities, entity];\n        }\n        setSelectedEntities(newValue);\n    }, [selectedEntities]);\n\n    const isEntitySelected = useCallback((entity: Entity<M>) => selectedEntities.map(e => e.id).includes(entity.id), [selectedEntities]);\n\n    return {\n        selectedEntities,\n        setSelectedEntities,\n        isEntitySelected,\n        toggleEntitySelection\n    };\n}\n\nfunction EntitiesCount({ fullPath }: { fullPath: string }) {\n\n    const dataSource = useDataSource();\n    const navigation = useNavigationContext();\n    const [count, setCount] = useState<number | undefined>(undefined);\n    const [error, setError] = useState<Error | undefined>(undefined);\n\n    useEffect(() => {\n        dataSource.countEntities(navigation.resolveAliasesFrom(fullPath)).then(setCount).catch(setError);\n    }, [fullPath, dataSource, navigation]);\n\n    if (error) {\n        return null;\n    }\n\n    return <Typography\n        sx={{\n            display: \"block\",\n            textOverflow: \"ellipsis\",\n            whiteSpace: \"nowrap\",\n            overflow: \"hidden\",\n            maxWidth: \"160px\",\n            textAlign: \"left\"\n        }}\n        variant={\"caption\"}\n        color={\"textSecondary\"}>\n        {count !== undefined ? `${count} entities` : renderSkeletonText()}\n    </Typography>;\n}\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport {\n    CollectionSize,\n    Entity,\n    EntityCollection,\n    FilterValues\n} from \"../../types\";\nimport {\n    Box,\n    Button,\n    Typography,\n    useMediaQuery,\n    useTheme\n} from \"@mui/material\";\nimport { Add } from \"@mui/icons-material\";\n\nimport { EntityCollectionTable } from \"./EntityCollectionTable\";\nimport {\n    EntityCollectionRowActions\n} from \"./EntityCollectionTable/internal/EntityCollectionRowActions\";\nimport {\n    useAuthController,\n    useDataSource,\n    useFireCMSContext,\n    useNavigationContext,\n    useSideEntityController\n} from \"../../hooks\";\nimport { ErrorView } from \"./ErrorView\";\nimport { CustomDialogActions } from \"./CustomDialogActions\";\nimport { useSideDialogContext } from \"../SideDialogs\";\nimport { canCreateEntity, fullPathToCollectionSegments } from \"../util\";\nimport {\n    useSelectionController\n} from \"./EntityCollectionView/EntityCollectionView\";\nimport { useTableController } from \"./EntityCollectionTable/useTableController\";\nimport {\n    isFilterCombinationValidForFirestore\n} from \"./EntityCollectionView/isFilterCombinationValidForFirestore\";\n\n/**\n * @category Components\n */\nexport interface ReferenceSelectionInnerProps<M extends Record<string, any>> {\n\n    /**\n     * Allow multiple selection of values\n     */\n    multiselect?: boolean;\n\n    /**\n     * Entity collection config\n     */\n    collection?: EntityCollection<M>;\n\n    /**\n     * Absolute path of the collection.\n     * May be not set if this hook is being used in a component and the path is\n     * dynamic. If not set, the dialog won't open.\n     */\n    path: string;\n\n    /**\n     * If you are opening the dialog for the first time, you can select some\n     * entity ids to be displayed first.\n     */\n    selectedEntityIds?: string[];\n\n    /**\n     * If `multiselect` is set to `false`, you will get the selected entity\n     * in this callback.\n     * @param entity\n     * @callback\n        */\n    onSingleEntitySelected?(entity: Entity<any> | null): void;\n\n    /**\n     * If `multiselect` is set to `true`, you will get the selected entities\n     * in this callback.\n     * @param entities\n     * @callback\n        */\n    onMultipleEntitiesSelected?(entities: Entity<any>[]): void;\n\n    /**\n     * Allow selection of entities that pass the given filter only.\n     */\n    forceFilter?: FilterValues<string>;\n\n    /**\n     * Use this description to indicate the user what to do in this dialog.\n     */\n    description?: React.ReactNode;\n\n    /**\n     * Maximum number of entities that can be selected.\n     */\n    maxSelection?: number;\n\n}\n\n/**\n * This component allows to select entities from a given collection.\n * You probably want to open this dialog as a side view using {@link useReferenceDialog}\n * @category Components\n */\nexport function ReferenceSelectionInner<M extends Record<string, any>>(\n    {\n        onSingleEntitySelected,\n        onMultipleEntitiesSelected,\n        multiselect,\n        collection,\n        path: pathInput,\n        selectedEntityIds,\n        description,\n        forceFilter,\n        maxSelection\n    }: ReferenceSelectionInnerProps<M>) {\n\n    const sideDialogContext = useSideDialogContext();\n    const sideEntityController = useSideEntityController();\n    const navigation = useNavigationContext();\n    const context = useFireCMSContext();\n\n    const fullPath = navigation.resolveAliasesFrom(pathInput);\n\n    const dataSource = useDataSource();\n\n    const [entitiesDisplayedFirst, setEntitiesDisplayedFirst] = useState<Entity<any>[]>([]);\n\n    const selectionController = useSelectionController();\n\n    /**\n     * Fetch initially selected ids\n     */\n    useEffect(() => {\n        let unmounted = false;\n        if (selectedEntityIds && collection) {\n            Promise.all(\n                selectedEntityIds.map((entityId) =>\n                    dataSource.fetchEntity({\n                        path: fullPath,\n                        entityId,\n                        collection\n                    })))\n                .then((entities) => {\n                    if (!unmounted) {\n                        const result = entities.filter(e => e !== undefined) as Entity<any>[];\n                        selectionController.setSelectedEntities(result);\n                        setEntitiesDisplayedFirst(result);\n                    }\n                });\n        } else {\n            selectionController.setSelectedEntities([]);\n            setEntitiesDisplayedFirst([]);\n        }\n        return () => {\n            unmounted = true;\n        };\n    }, [dataSource, fullPath, selectedEntityIds, collection, selectionController.setSelectedEntities]);\n\n    const onClear = useCallback(() => {\n        context.onAnalyticsEvent?.(\"reference_selection_clear\", {\n            path: fullPath\n        });\n        selectionController.setSelectedEntities([]);\n        if (!multiselect && onSingleEntitySelected) {\n            onSingleEntitySelected(null);\n        } else if (onMultipleEntitiesSelected) {\n            onMultipleEntitiesSelected([]);\n        }\n    }, [multiselect, onMultipleEntitiesSelected, onSingleEntitySelected]);\n\n    const toggleEntitySelection = useCallback((entity: Entity<any>) => {\n        let newValue;\n        const selectedEntities = selectionController.selectedEntities;\n\n        context.onAnalyticsEvent?.(\"reference_selection_toggle\", {\n            path: fullPath,\n            entityId: entity.id\n        });\n        if (selectedEntities) {\n\n            if (selectedEntities.map((e) => e.id).indexOf(entity.id) > -1) {\n                newValue = selectedEntities.filter((item: Entity<any>) => item.id !== entity.id);\n            } else {\n                if (maxSelection && selectedEntities.length >= maxSelection)\n                    return;\n                newValue = [...selectedEntities, entity];\n            }\n            selectionController.setSelectedEntities(newValue);\n\n            if (onMultipleEntitiesSelected)\n                onMultipleEntitiesSelected(newValue);\n        }\n    }, [onMultipleEntitiesSelected, selectionController.selectedEntities]);\n\n    const onEntityClick = useCallback((entity: Entity<any>) => {\n\n        if (!multiselect && onSingleEntitySelected) {\n            context.onAnalyticsEvent?.(\"reference_selected_single\", {\n                path: fullPath,\n                entityId: entity.id\n            });\n            onSingleEntitySelected(entity);\n            sideDialogContext.close(false);\n        } else {\n            toggleEntitySelection(entity);\n        }\n    }, [sideDialogContext, multiselect, onSingleEntitySelected, toggleEntitySelection]);\n\n    // create a new entity from within the reference dialog\n    const onNewClick = useCallback(() => {\n            context.onAnalyticsEvent?.(\"reference_selection_new_entity\", {\n                path: fullPath\n            });\n            sideEntityController.open({\n                path: fullPath,\n                collection,\n                updateUrl: true,\n                onUpdate: ({ entity }) => {\n                    setEntitiesDisplayedFirst([entity, ...entitiesDisplayedFirst]);\n                    onEntityClick(entity);\n                },\n                closeOnSave: true\n            });\n        },\n        [sideEntityController, fullPath, collection, entitiesDisplayedFirst, onEntityClick]);\n\n    const tableRowActionsBuilder = useCallback(({\n                                                    entity,\n                                                    size,\n                                                    width,\n                                                    frozen\n                                                }: { entity: Entity<any>, size: CollectionSize, width: number, frozen?: boolean }) => {\n        const selectedEntities = selectionController.selectedEntities;\n        const isSelected = selectedEntities && selectedEntities.map(e => e.id).indexOf(entity.id) > -1;\n        return <EntityCollectionRowActions\n            width={width}\n            frozen={frozen}\n            entity={entity}\n            size={size}\n            isSelected={isSelected}\n            selectionEnabled={multiselect}\n            toggleEntitySelection={toggleEntitySelection}\n            hideId={collection?.hideIdFromCollection}\n        />;\n\n    }, [multiselect, selectionController.selectedEntities, toggleEntitySelection, collection?.hideIdFromCollection]);\n\n    const onDone = useCallback((event: React.SyntheticEvent) => {\n        event.stopPropagation();\n        sideDialogContext.close(false);\n    }, [sideDialogContext]);\n\n    if (!collection) {\n        return <ErrorView\n            error={\"Could not find collection with id \" + collection}/>\n    }\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const tableController = useTableController<M>({\n        fullPath,\n        collection,\n        entitiesDisplayedFirst,\n        isFilterCombinationValid: isFilterCombinationValidForFirestore\n    });\n\n    return (\n\n        <Box sx={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            height: \"100%\"\n        }}>\n\n            <Box sx={{ flexGrow: 1 }}>\n                {entitiesDisplayedFirst &&\n                    <EntityCollectionTable fullPath={fullPath}\n                                           onEntityClick={onEntityClick}\n                                           forceFilter={forceFilter}\n                                           tableController={tableController}\n                                           tableRowActionsBuilder={tableRowActionsBuilder}\n                                           title={<Typography variant={\"h6\"}>\n                                               {collection.singularName ? `Select ${collection.singularName}` : `Select from ${collection.name}`}\n                                           </Typography>}\n                                           {...collection}\n                                           inlineEditing={false}\n                                           selectionController={selectionController}\n                                           actions={<ReferenceDialogActions\n                                               collection={collection}\n                                               path={fullPath}\n                                               onNewClick={onNewClick}\n                                               onClear={onClear}/>\n                                           }\n                    />}\n            </Box>\n            <CustomDialogActions translucent={false}>\n                {description &&\n                    <Typography variant={\"body2\"} sx={{\n                        flexGrow: 1,\n                        textAlign: \"left\"\n                    }}>\n                        {description}\n                    </Typography>}\n                <Button\n                    onClick={onDone}\n                    color=\"primary\"\n                    variant=\"outlined\">\n                    Done\n                </Button>\n            </CustomDialogActions>\n        </Box>\n\n    );\n\n}\n\nfunction ReferenceDialogActions({\n                                    collection,\n                                    path,\n                                    onClear,\n                                    onNewClick\n                                }: { collection: EntityCollection<any>, path: string, onClear: () => void, onNewClick: () => void }) {\n\n    const authController = useAuthController();\n\n    const theme = useTheme();\n    const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n    const addButton = canCreateEntity(collection, authController, fullPathToCollectionSegments(path), null) &&\n        onNewClick && (largeLayout\n            ? <Button\n                onClick={onNewClick}\n                startIcon={<Add/>}\n                size=\"large\"\n                variant=\"contained\"\n                color=\"primary\">\n                Add {collection.singularName ?? collection.name}\n            </Button>\n            : <Button\n                onClick={onNewClick}\n                size=\"medium\"\n                variant=\"contained\"\n                color=\"primary\"\n            >\n                <Add/>\n            </Button>);\n\n    return (\n        <>\n            <Button onClick={onClear}\n                    color=\"primary\">\n                Clear\n            </Button>\n            {addButton}\n        </>\n    );\n}\n","export function toArray<T>(input?: T | T[]):T[] {\n    return Array.isArray(input) ? input : (input ? [input] : []);\n}\n","import { Box, Typography } from \"@mui/material\";\nimport { PropsWithChildren } from \"react\";\nimport { ExpandablePanel } from \"../ExpandablePanel\";\nimport {\n    useUserConfigurationPersistence\n} from \"../../../hooks/useUserConfigurationPersistence\";\n\nexport function NavigationGroup({\n                                    children,\n                                    group\n                                }: PropsWithChildren<{ group: string | undefined }>) {\n    const userConfigurationPersistence = useUserConfigurationPersistence();\n    return (\n        <ExpandablePanel\n            invisible={true}\n            initiallyExpanded={!(userConfigurationPersistence?.collapsedGroups ?? []).includes(group ?? \"ungrouped\")}\n            onExpandedChange={expanded => {\n                if (userConfigurationPersistence) {\n\n                    if (!expanded) {\n                        const paths = (userConfigurationPersistence.collapsedGroups ?? []).concat(group ?? \"ungrouped\");\n                        userConfigurationPersistence.setCollapsedGroups(paths);\n                    } else {\n                        userConfigurationPersistence.setCollapsedGroups((userConfigurationPersistence.collapsedGroups ?? []).filter(g => g !== (group ?? \"ungrouped\")));\n                    } }\n            }}\n            title={<Typography color={\"textSecondary\"}\n                               className={\"weight-500\"}\n                               sx={{ ml: 1 }}>\n                {group?.toUpperCase() ?? \"Ungrouped views\".toUpperCase()}\n            </Typography>}>\n\n            <Box mb={2}>\n                {children}\n            </Box>\n        </ExpandablePanel>\n    );\n}\n","import {\n    Box,\n    CardActionArea,\n    CardActions,\n    CardContent,\n    IconButton,\n    Paper,\n    Typography\n} from \"@mui/material\";\nimport ArrowForwardIcon from \"@mui/icons-material/ArrowForward\";\nimport StarBorderIcon from \"@mui/icons-material/StarBorder\";\nimport StarIcon from \"@mui/icons-material/Star\";\n\nimport { useNavigate } from \"react-router-dom\";\n\nimport { Markdown } from \"../../../preview\";\nimport { useFireCMSContext } from \"../../../hooks\";\nimport { PluginHomePageActionsProps, TopNavigationEntry } from \"../../../types\";\nimport { getIconForView } from \"../../util\";\nimport {\n    useUserConfigurationPersistence\n} from \"../../../hooks/useUserConfigurationPersistence\";\n\n/**\n * This is the component used in the home page to render a card for each\n * collection.\n * @category Components\n * @param view\n * @param path\n * @param collection\n * @param url\n * @param name\n * @param description\n * @param onClick\n * @constructor\n */\nexport function NavigationCollectionCard({\n                                             view,\n                                             path,\n                                             collection,\n                                             url,\n                                             name,\n                                             description,\n                                             onClick\n                                         }: TopNavigationEntry & { onClick?: () => void }) {\n\n    const userConfigurationPersistence = useUserConfigurationPersistence();\n    const CollectionIcon = getIconForView(collection ?? view);\n\n    const navigate = useNavigate();\n    const context = useFireCMSContext();\n\n    const favourite = (userConfigurationPersistence?.favouritePaths ?? []).includes(path);\n\n    let actions: React.ReactNode | undefined;\n    if (context.plugins && collection) {\n        const actionProps: PluginHomePageActionsProps = {\n            path,\n            collection,\n            context\n        };\n        actions = <>\n            {context.plugins.map((plugin, i) => (\n                plugin.homePage?.CollectionActions\n                    ? <plugin.homePage.CollectionActions\n                        key={`actions_${i}`}\n                        {...actionProps}\n                        extraProps={plugin.homePage.extraProps}\n                    />\n                    : null\n            ))}\n        </>\n        ;\n    }\n\n    return (\n        <Paper elevation={0} sx={{\n            height: \"100%\"\n        }}>\n\n            <CardActionArea\n                component={\"div\"}\n                sx={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: \"flex-start\",\n                    minHeight: 248,\n                    height: \"100%\"\n                }}\n                onClick={() => {\n                    onClick?.();\n                    navigate(url);\n                    if (userConfigurationPersistence) {\n                        userConfigurationPersistence.setRecentlyVisitedPaths(\n                            [path, ...(userConfigurationPersistence.recentlyVisitedPaths ?? []).filter(p => p !== path)]\n                        );\n                    }\n                }}\n            >\n                <CardContent\n                    sx={{\n                        flexGrow: 1,\n                        width: \"100%\"\n                    }}>\n\n                    <Box sx={{\n                        height: 40,\n                        display: \"flex\",\n                        alignItems: \"center\",\n                        width: \"100%\",\n                        justifyContent: \"space-between\"\n                    }}>\n\n                        <CollectionIcon color={\"disabled\"}/>\n\n                        <Box\n                            sx={{\n                                display: \"flex\",\n                                alignItems: \"center\",\n                                gap: 1\n                            }}\n                            onClick={(event: React.MouseEvent) => {\n                                event.preventDefault();\n                                event.stopPropagation();\n                            }}>\n                            {actions}\n                            {userConfigurationPersistence &&\n                                <IconButton size={\"small\"}\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                e.stopPropagation();\n                                                if (favourite) {\n                                                    userConfigurationPersistence.setFavouritePaths(\n                                                        userConfigurationPersistence.favouritePaths.filter(p => p !== path)\n                                                    );\n                                                } else {\n                                                    userConfigurationPersistence.setFavouritePaths(\n                                                        [...userConfigurationPersistence.favouritePaths, path]\n                                                    );\n                                                }\n                                            }}>\n                                    {favourite\n                                        ? <StarIcon color={\"secondary\"}/>\n                                        : <StarBorderIcon color={\"disabled\"}/>}\n                                </IconButton>}\n                        </Box>\n\n                    </Box>\n\n                    <Typography gutterBottom variant=\"h5\"\n                                component=\"h2\">\n                        {name}\n                    </Typography>\n\n                    {description && <Typography variant=\"body2\"\n                                                color=\"textSecondary\"\n                                                component=\"div\">\n                        <Markdown source={description}/>\n                    </Typography>}\n                </CardContent>\n\n                <CardActions style={{ alignSelf: \"flex-end\" }}>\n\n                    <Box p={1}>\n                        <ArrowForwardIcon color=\"primary\"/>\n                    </Box>\n                </CardActions>\n\n            </CardActionArea>\n\n        </Paper>)\n        ;\n}\n","import { useNavigate } from \"react-router-dom\";\nimport { Box, Chip, Collapse, Grid } from \"@mui/material\";\nimport { useFireCMSContext, useNavigationContext } from \"../../../hooks\";\nimport {\n    useUserConfigurationPersistence\n} from \"../../../hooks/useUserConfigurationPersistence\";\nimport { TopNavigationEntry } from \"../../../types\";\nimport StarBorderIcon from \"@mui/icons-material/StarBorder\";\nimport StarIcon from \"@mui/icons-material/Star\";\nimport { NavigationGroup } from \"./NavigationGroup\";\nimport { NavigationCollectionCard } from \"./NavigationCollectionCard\";\n\nfunction NavigationChip({ entry }: { entry: TopNavigationEntry }) {\n\n    const navigate = useNavigate();\n    const userConfigurationPersistence = useUserConfigurationPersistence();\n\n    if (!userConfigurationPersistence)\n        return null;\n\n    const favourite = userConfigurationPersistence.favouritePaths.includes(entry.path);\n    return <Chip\n        key={entry.path}\n        label={entry.name}\n        onClick={() => navigate(entry.url)}\n        onDelete={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            if (favourite) {\n                userConfigurationPersistence.setFavouritePaths(\n                    userConfigurationPersistence.favouritePaths.filter(p => p !== entry.path)\n                );\n            } else {\n                userConfigurationPersistence.setFavouritePaths(\n                    [...userConfigurationPersistence.favouritePaths, entry.path]\n                );\n            }\n        }}\n        deleteIcon={favourite\n            ? <StarIcon color={\"secondary\"}/>\n            : <StarBorderIcon color={\"disabled\"}/>}\n    />;\n}\n\nexport function FavouritesView({ hidden }: { hidden: boolean }) {\n\n    const context = useFireCMSContext();\n    const navigationContext = useNavigationContext();\n    const userConfigurationPersistence = useUserConfigurationPersistence();\n\n    if (!userConfigurationPersistence)\n        return null;\n\n    const favouriteCollections = (userConfigurationPersistence?.favouritePaths ?? [])\n        .map((path) => navigationContext.topLevelNavigation?.navigationEntries.find((entry) => entry.path === path))\n        .filter(Boolean) as TopNavigationEntry[];\n\n    const recentCollections = ((userConfigurationPersistence?.recentlyVisitedPaths ?? [])\n        .map((path) => navigationContext.topLevelNavigation?.navigationEntries.find((entry) => entry.path === path))\n        .filter(Boolean) as TopNavigationEntry[])\n        .slice(0, 5);\n\n    const favouritesGroup = <Collapse\n        in={!hidden && favouriteCollections.length > 0}>\n        <NavigationGroup group={\"Favourites\"}>\n            <Grid container spacing={2}>\n                {favouriteCollections\n                    .map((entry) =>\n                        <Grid item\n                              xs={12}\n                              sm={6}\n                              lg={4}\n                              key={`nav_${entry.group}_${entry.name}`}>\n                            <NavigationCollectionCard {...entry}\n                                                      onClick={() => {\n                                                          const event = entry.type === \"collection\" ? \"home_favorite_navigate_to_collection\" : (entry.type === \"view\" ? \"home_favorite_navigate_to_view\" : \"unmapped_event\");\n                                                          context.onAnalyticsEvent?.(event, { path: entry.path });\n                                                      }}/>\n                        </Grid>)\n                }\n\n            </Grid>\n        </NavigationGroup>\n    </Collapse>;\n\n    return <Box>\n        <Box sx={{\n            display: \"flex\",\n            flexDirection: \"row\",\n            flexWrap: \"wrap\",\n            gap: 1,\n            pb: 2\n        }}>\n            {recentCollections.map((entry) => <NavigationChip key={entry.path}\n                                                              entry={entry}/>)}\n        </Box>\n        {favouritesGroup}\n    </Box>;\n}\n","import React, { useCallback, useEffect } from \"react\";\nimport { useLocation } from \"react-router-dom\";\n\nexport function useRestoreScroll() {\n\n    const scrollsMap = React.useRef<Record<string, number>>({});\n\n    const location = useLocation();\n\n    const containerRef = React.createRef<HTMLDivElement>();\n    const [scroll, setScroll] = React.useState(0);\n    const [direction, setDirection] = React.useState<\"up\" | \"down\">(\"down\");\n\n    const handleScroll = useCallback(() => {\n        if (!containerRef.current || !location.key) return;\n        scrollsMap.current[location.key] = containerRef.current.scrollTop;\n        setScroll(containerRef.current.scrollTop);\n        setDirection(containerRef.current.scrollTop > scroll ? \"down\" : \"up\");\n    }, [containerRef, location.key, scroll]);\n\n    useEffect(() => {\n        const container = containerRef.current;\n        if (!container) return;\n        container.addEventListener(\"scroll\", handleScroll, { passive: true });\n\n        return () => {\n            if (container)\n                container.removeEventListener(\"scroll\", handleScroll);\n        };\n    }, [containerRef, handleScroll, location]);\n\n    useEffect(() => {\n        if (!containerRef.current || !scrollsMap.current || !scrollsMap.current[location.key]) return;\n        containerRef.current.scrollTo(\n            {\n                top: scrollsMap.current[location.key],\n                behavior: \"auto\"\n            });\n    }, [location]);\n\n    return {\n        containerRef,\n        scroll,\n        direction\n    };\n}\n","import React, { useCallback, useEffect, useState } from \"react\";\n\nimport { Box, Container, Grid } from \"@mui/material\";\n\nimport { useFireCMSContext, useNavigationContext } from \"../../../hooks\";\nimport {\n    PluginGenericProps,\n    PluginHomePageAdditionalCardsProps\n} from \"../../../types\";\n\nimport { toArray } from \"../../util/arrays\";\nimport { NavigationGroup } from \"./NavigationGroup\";\nimport { NavigationCollectionCard } from \"./NavigationCollectionCard\";\n\n// @ts-ignore\nimport Index from \"flexsearch/dist/module/index.js\";\n\nimport { SearchBar } from \"../EntityCollectionTable/internal/SearchBar\";\nimport { FavouritesView } from \"./FavouritesView\";\nimport { useRestoreScroll } from \"../../internal/useRestoreScroll\";\n\nexport const searchIndex = new Index(\n    // @ts-ignore\n    {\n        charset: \"latin:advanced\",\n        tokenize: \"full\"\n    });\n\n/**\n * Default entry view for the CMS. This component renders navigation cards\n * for each collection defined in the navigation.\n * @constructor\n * @category Components\n */\nexport function FireCMSHomePage({ additionalChildren }: { additionalChildren?: React.ReactNode }) {\n\n    const context = useFireCMSContext();\n    const navigationContext = useNavigationContext();\n\n    if (!navigationContext.topLevelNavigation)\n        throw Error(\"Navigation not ready in FireCMSHomePage\");\n\n    const {\n        containerRef,\n        scroll,\n        direction\n    } = useRestoreScroll();\n\n    const {\n        navigationEntries,\n        groups\n    } = navigationContext.topLevelNavigation;\n\n    const [filteredUrls, setFilteredUrls] = useState<string[] | null>(null);\n\n    const filteredNavigationEntries = filteredUrls\n        ? navigationEntries.filter((entry) => filteredUrls.includes(entry.url))\n        : navigationEntries;\n\n    useEffect(() => {\n        filteredNavigationEntries.forEach((entry) => {\n            // @ts-ignore\n            searchIndex.addAsync(entry.url, `${entry.name} ${entry.description} ${entry.group} ${entry.path}`);\n        })\n    }, [navigationEntries]);\n\n    const updateSearchResults = useCallback(\n        (value?: string) => {\n            if (!value || value === \"\") {\n                setFilteredUrls(null);\n            } else {\n                // @ts-ignore\n                searchIndex.searchAsync(value).then((results) => {\n                    setFilteredUrls(results);\n                });\n            }\n        }, []);\n\n    const allGroups: Array<string | undefined> = [...groups];\n    if (filteredNavigationEntries.filter(e => !e.group).length > 0 || filteredNavigationEntries.length === 0) {\n        allGroups.push(undefined);\n    }\n\n    let additionalSections: React.ReactNode | undefined;\n    if (context.plugins) {\n        const sectionProps: PluginGenericProps = {\n            context\n        };\n        additionalSections = <>\n            {context.plugins.filter(plugin => plugin.homePage?.includeSection)\n                .map((plugin, i) => {\n                    const section = plugin.homePage!.includeSection!(sectionProps)\n                    return (\n                        <NavigationGroup\n                            group={section.title}\n                            key={`plugin_section_${plugin.name}`}>\n                            {section.children}\n                        </NavigationGroup>\n                    );\n                })}\n        </>\n        ;\n    }\n\n    return (\n        <Box ref={containerRef}\n             sx={{\n                 py: 2,\n                 overflow: \"auto\",\n                 height: \"100%\",\n                 width: \"100%\"\n             }}>\n            <Container>\n\n                <Box sx={{\n                    position: \"sticky\",\n                    py: 2,\n                    transition: \"top 0.4s ease-in-out\",\n                    top: 0,\n                    // top: direction === \"down\" ? -84 : 0,\n                    zIndex: 10\n                }}>\n                    <SearchBar onTextSearch={updateSearchResults}\n                               placeholder={\"Search collections\"}\n                               large={false}/>\n                </Box>\n\n                <FavouritesView hidden={Boolean(filteredUrls)}/>\n\n                {allGroups.map((group, index) => {\n\n                    const AdditionalCards: React.ComponentType<PluginHomePageAdditionalCardsProps>[] = [];\n                    const actionProps: PluginHomePageAdditionalCardsProps = {\n                        group,\n                        context\n                    };\n\n                    if (context.plugins) {\n                        context.plugins.forEach(plugin => {\n                            if (plugin.homePage?.AdditionalCards) {\n                                AdditionalCards.push(...toArray(plugin.homePage?.AdditionalCards));\n                            }\n                        });\n                    }\n\n                    const thisGroupCollections = filteredNavigationEntries\n                        .filter((entry) => entry.group === group || (!entry.group && group === undefined));\n                    if (thisGroupCollections.length === 0 && AdditionalCards.length === 0)\n                        return null;\n                    return (\n                        <NavigationGroup\n                            group={group}\n                            key={`plugin_section_${group}`}>\n                            <Grid container spacing={2}>\n                                {thisGroupCollections // so we don't miss empty groups\n                                    .map((entry) =>\n                                        <Grid item\n                                              xs={12}\n                                              sm={6}\n                                              lg={4}\n                                              key={`nav_${entry.group}_${entry.name}`}>\n                                            <NavigationCollectionCard {...entry}\n                                                                      onClick={() => {\n                                                                          const event = entry.type === \"collection\" ? \"home_navigate_to_collection\" : (entry.type === \"view\" ? \"home_navigate_to_view\" : \"unmapped_event\");\n                                                                          context.onAnalyticsEvent?.(event, { path: entry.path });\n                                                                      }}/>\n                                        </Grid>)\n                                }\n                                {AdditionalCards && AdditionalCards.map((AdditionalCard, i) => (\n                                    <Grid item\n                                          xs={12}\n                                          sm={6}\n                                          lg={4}\n                                          key={`nav_${group}_\"add_${i}`}>\n                                        <AdditionalCard {...actionProps}/>\n                                    </Grid>\n                                ))}\n\n                            </Grid>\n                        </NavigationGroup>\n                    );\n                })}\n\n                {additionalSections}\n\n                {additionalChildren}\n\n            </Container>\n        </Box>\n    );\n}\n","import React, { PropsWithChildren } from \"react\";\nimport { useBreadcrumbsContext } from \"../../hooks\";\n\nexport interface BreadcrumbUpdaterProps {\n    title: string;\n    path: string;\n}\n\n/**\n * This component updates the breadcrumb in the app bar when rendered\n * @param children\n * @param title\n * @param path\n * @constructor\n * @category Components\n */\nexport function BreadcrumbUpdater({\n                                      children,\n                                      title,\n                                      path\n                                  }\n                                      : PropsWithChildren<BreadcrumbUpdaterProps>) {\n\n    const breadcrumbsContext = useBreadcrumbsContext();\n    React.useEffect(() => {\n        breadcrumbsContext.set({\n            breadcrumbs: [{\n                title: title,\n                url: path\n            }]\n        });\n    }, [path, title]);\n\n    return <>{children}</>;\n}\n","import React from \"react\";\nimport { Box, Button, Typography } from \"@mui/material\";\nimport { Link as ReactLink } from \"react-router-dom\";\n\nexport function NotFoundPage() {\n\n    return (\n        <Box\n            display=\"flex\"\n            width={\"100%\"}\n            height={\"100%\"}>\n            <Box m=\"auto\"\n                 display=\"flex\"\n                 alignItems={\"center\"}\n                 flexDirection={\"column\"}>\n                <Typography variant={\"h4\"} align={\"center\"} gutterBottom={true}>\n                    Page not found\n                </Typography>\n                <Typography align={\"center\"} gutterBottom={true}>\n                    This page does not exist or you may not have access to it\n                </Typography>\n                <Button\n                    component={ReactLink}\n                    to={\"/\"}>Back to home</Button>\n            </Box>\n        </Box>\n    );\n}\n","import React from \"react\";\nimport {\n    Button,\n    Dialog,\n    DialogContent,\n    DialogContentText,\n    DialogTitle\n} from \"@mui/material\";\n\nimport { CustomDialogActions } from \"./CustomDialogActions\";\nimport { LoadingButton } from \"@mui/lab\";\n\nexport function DeleteConfirmationDialog({\n                                             open,\n                                             onAccept,\n                                             onCancel,\n                                             title,\n                                             loading,\n                                             body\n                                         }: {\n    open: boolean,\n    onAccept: () => void,\n    onCancel: () => void,\n    loading?: boolean,\n    title: React.ReactNode,\n    body?: React.ReactNode,\n}) {\n    return (\n        <Dialog\n            open={open}\n            onClose={onCancel}\n        >\n            <DialogTitle>\n                {title}\n            </DialogTitle>\n            {body && <DialogContent>\n                <DialogContentText>\n                    {body}\n                </DialogContentText>\n            </DialogContent>}\n            <CustomDialogActions>\n                <Button\n                    onClick={onCancel}\n                    autoFocus>Cancel</Button>\n\n                <LoadingButton\n                    variant=\"contained\"\n                    color=\"primary\"\n                    type=\"submit\"\n                    loading={loading}\n                    onClick={onAccept}\n                >\n                    Ok\n                </LoadingButton>\n            </CustomDialogActions>\n        </Dialog>\n    );\n}\n","import React from \"react\";\n\nexport function FireCMSLogo({\n                                width,\n                                height,\n                                style\n                            }: { width?: string, height?: string, style?: React.CSSProperties }) {\n    return (\n        <svg\n            width={width ?? \"100%\"} height={height ?? \"100%\"}\n            viewBox=\"0 0 599 599\" version=\"1.1\"\n            style={style}\n            xmlns=\"http://www.w3.org/2000/svg\">\n            <defs>\n                <radialGradient cx=\"28.6213569%\" cy=\"43.1133328%\"\n                                fx=\"28.6213569%\"\n                                fy=\"43.1133328%\" r=\"71.5003456%\"\n                                gradientTransform=\"translate(0.286214,0.431133),rotate(3.343450),scale(1.000000,0.996175),translate(-0.286214,-0.431133)\"\n                                id=\"radialGradient-1\">\n                    <stop stopColor=\"#FF5B79\" offset=\"0%\"/>\n                    <stop stopColor=\"#FA5574\" offset=\"28.0930803%\"/>\n                    <stop stopColor=\"#EC4C51\" offset=\"44.7242531%\"/>\n                    <stop stopColor=\"#9543C1\" offset=\"71.4578165%\"/>\n                    <stop stopColor=\"#3857B3\" offset=\"100%\"/>\n                </radialGradient>\n                <radialGradient cx=\"53.6205516%\" cy=\"47.2473036%\"\n                                fx=\"53.6205516%\"\n                                fy=\"47.2473036%\" r=\"50.8229649%\"\n                                gradientTransform=\"translate(0.536206,0.472473),rotate(90.000000),scale(1.000000,1.206631),translate(-0.536206,-0.472473)\"\n                                id=\"radialGradient-2\">\n                    <stop stopColor=\"#68294F\" stopOpacity=\"0\" offset=\"0%\"/>\n                    <stop stopColor=\"#5E2548\" stopOpacity=\"0.04641108\"\n                          offset=\"75.3503173%\"/>\n                    <stop stopColor=\"#0D060B\" stopOpacity=\"0.437431709\"\n                          offset=\"100%\"/>\n                </radialGradient>\n                <radialGradient cx=\"53.8605015%\" cy=\"48.1990423%\"\n                                fx=\"53.8605015%\"\n                                fy=\"48.1990423%\" r=\"59.9151549%\"\n                                gradientTransform=\"translate(0.538605,0.481990),rotate(180.000000),scale(1.000000,0.925027),translate(-0.538605,-0.481990)\"\n                                id=\"radialGradient-3\">\n                    <stop stopColor=\"#68294F\" stopOpacity=\"0\" offset=\"0%\"/>\n                    <stop stopColor=\"#5E2548\" stopOpacity=\"0.04641108\"\n                          offset=\"84.0867343%\"/>\n                    <stop stopColor=\"#FF0000\" stopOpacity=\"0.567324765\"\n                          offset=\"100%\"/>\n                </radialGradient>\n            </defs>\n            <g id=\"Page-1\" stroke=\"none\" strokeWidth=\"1\" fill=\"none\"\n               fillRule=\"evenodd\">\n                <g id=\"firecms_logo\">\n                    <circle fill=\"url(#radialGradient-1)\" cx=\"299.5\"\n                            cy=\"299.5\"\n                            r=\"299.5\"/>\n                    <circle fill=\"url(#radialGradient-2)\" cx=\"299.5\"\n                            cy=\"299.5\"\n                            r=\"299.5\"/>\n                    <circle fill=\"url(#radialGradient-3)\" cx=\"299.5\"\n                            cy=\"299.5\"\n                            r=\"299.5\"/>\n                </g>\n            </g>\n        </svg>\n    );\n\n}\n","import React from \"react\";\n\nimport { Box, Fade } from \"@mui/material\";\n\nexport function CenteredView({\n                                 children,\n                                 maxWidth,\n                                 fullScreen = false,\n                                 fadeTimeout = 800\n                             }: {\n    children: React.ReactNode;\n    maxWidth?: number | string | object;\n    fullScreen?: boolean,\n    fadeTimeout?: number\n}) {\n\n    return (\n        <Fade\n            in={true}\n            appear={true}\n            timeout={fadeTimeout}\n            mountOnEnter\n            unmountOnExit>\n            <Box\n                sx={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: \"center\",\n                    height: fullScreen ? \"100vh\" : \"100%\",\n                    \"@supports (height: 100dvh)\": {\n                        height: fullScreen ? \"100dvh\" : \"100%\"\n                    },\n                    justifyContent: !maxWidth ? \"center\" : undefined,\n                    maxHeight: \"100%\",\n                    gap: 2,\n                    p: 2\n                }}>\n                {maxWidth && <Box sx={{\n                    width: \"100%\",\n                    margin: \"auto\",\n                    maxWidth\n                }}>\n                    {children}\n                </Box>}\n\n                {!maxWidth && children}\n            </Box>\n        </Fade>\n    );\n\n}\n","import { Box, useTheme } from \"@mui/material\";\n\nexport function InfoLabel({\n                              children,\n                              mode = \"info\"\n                          }: { children: React.ReactNode, mode?: \"info\" | \"warn\" }) {\n\n    const theme = useTheme();\n    const background = mode === \"info\"\n        ? (theme.palette.mode === \"dark\" ? \"#193c47\" : \"#b9f4fe\")\n        : (theme.palette.mode === \"dark\" ? \"#4d3800\" : \"#f9e3b9\");\n\n    return (\n        <Box\n            sx={(theme) => ({\n                my: 3,\n                py: 1,\n                px: 2,\n                borderRadius: 1,\n                background\n            })}>\n            {children}\n        </Box>\n    )\n}\n","import React, { useCallback } from \"react\";\n\nimport { NavLink } from \"react-router-dom\";\nimport {\n    Box,\n    darken,\n    lighten,\n    List,\n    ListItem,\n    SvgIconTypeMap,\n    Tooltip,\n    Typography,\n    useTheme\n} from \"@mui/material\";\nimport { useFireCMSContext, useNavigationContext } from \"../hooks\";\nimport {\n    CMSAnalyticsEvent,\n    TopNavigationEntry,\n    TopNavigationResult\n} from \"../types\";\nimport { getIconForView } from \"./util\";\nimport { grey } from \"@mui/material/colors\";\n\n/**\n * Props used in case you need to override the default drawer\n * @category Core\n */\nexport type DrawerProps<T = {}> = T & {\n    hovered: boolean,\n    drawerOpen: boolean,\n    closeDrawer: () => any,\n}\n\n/**\n * Default drawer used in the CMS\n * @category Core\n */\nexport function Drawer({\n                           hovered,\n                           drawerOpen,\n                           closeDrawer\n                       }: DrawerProps) {\n\n    const context = useFireCMSContext();\n    const navigation = useNavigationContext();\n\n    const tooltipsOpen = hovered && !drawerOpen;\n\n    if (!navigation.topLevelNavigation)\n        throw Error(\"Navigation not ready in Drawer\");\n\n    const {\n        navigationEntries,\n        groups\n    }: TopNavigationResult = navigation.topLevelNavigation;\n\n    const ungroupedNavigationViews = Object.values(navigationEntries).filter(e => !e.group);\n\n    const buildGroupHeader = useCallback((group?: string) => {\n        if (!drawerOpen) return <Box sx={{ height: 16 }}/>;\n        return <Box pt={2} pl={2} pr={2} pb={0.5} sx={{\n            display: \"flex\",\n            flexDirection: \"row\",\n            alignItems: \"center\"\n        }}>\n            <Typography variant={\"caption\"}\n                        color={\"textSecondary\"}\n                        className={\"weight-500\"}\n                        sx={{ flexGrow: 1 }}>\n                {group ? group.toUpperCase() : \"Ungrouped views\".toUpperCase()}\n            </Typography>\n\n        </Box>;\n    }, [drawerOpen]);\n\n    const onClick = (view: TopNavigationEntry) => {\n        const eventName: CMSAnalyticsEvent = view.type === \"collection\"\n            ? \"drawer_navigate_to_collection\"\n            : (view.type === \"view\" ? \"drawer_navigate_to_view\" : \"unmapped_event\");\n        context.onAnalyticsEvent?.(eventName, { url: view.url });\n    };\n\n    return (\n        <List>\n\n            {groups.map((group) => (\n                <React.Fragment\n                    key={`drawer_group_${group}`}>\n                    {buildGroupHeader(group)}\n                    {Object.values(navigationEntries)\n                        .filter(e => e.group === group)\n                        .map((view, index) =>\n                            <DrawerNavigationItem\n                                key={`navigation_${index}`}\n                                Icon={getIconForView(view.collection ?? view.view)}\n                                tooltipsOpen={tooltipsOpen}\n                                drawerOpen={drawerOpen}\n                                onClick={() => onClick(view)}\n                                url={view.url}\n                                name={view.name}/>)}\n                </React.Fragment>\n            ))}\n\n            {ungroupedNavigationViews.length > 0 && buildGroupHeader()}\n\n            {ungroupedNavigationViews.map((view, index) => {\n\n                return <DrawerNavigationItem\n                    key={`navigation_${index}`}\n                    Icon={getIconForView(view.collection ?? view.view)}\n                    tooltipsOpen={tooltipsOpen}\n                    onClick={() => onClick(view)}\n                    drawerOpen={drawerOpen}\n                    url={view.url}\n                    name={view.name}/>;\n            })}\n\n        </List>\n    );\n}\n\nexport function DrawerNavigationItem({\n                                         name,\n                                         Icon,\n                                         drawerOpen,\n                                         tooltipsOpen,\n                                         url,\n                                         onClick\n                                     }: {\n    Icon: React.ComponentType<SvgIconTypeMap[\"props\"]>,\n    name: string,\n    tooltipsOpen: boolean,\n    drawerOpen: boolean,\n    url: string,\n    onClick?: () => void,\n}) {\n\n    const theme = useTheme();\n    const icon = <Icon fontSize={\"medium\"}\n                       sx={theme => ({ color: theme.palette.mode === \"dark\" ? grey[500] : grey[700] })}/>;\n    const listItem = <ListItem\n        // @ts-ignore\n        button\n        component={NavLink}\n        onClick={onClick}\n        // @ts-ignore\n        style={({ isActive }) => ({\n            fontWeight: isActive ? \"600\" : \"500\",\n            background: isActive\n                ? (theme.palette.mode === \"light\"\n                    ? darken(theme.palette.background.default, 0.1)\n                    : lighten(theme.palette.background.default, 0.08))\n                : \"inherit\",\n            minHeight: \"48px\",\n            borderRadius: \"0 16px 16px 0\"\n        })}\n        sx={theme => ({\n            pl: 3,\n            alignItems: \"center\"\n        })}\n        to={url}\n    >\n\n        {icon}\n\n        <Typography\n            variant={\"subtitle2\"}\n            sx={{\n                opacity: drawerOpen ? 1.0 : 0.0,\n                fontWeight: \"inherit\",\n                ml: 3,\n                p: 0.5\n            }}>\n            {name.toUpperCase()}\n        </Typography>\n    </ListItem>;\n\n    if (drawerOpen)\n        return listItem;\n    else\n        return <Tooltip\n            open={tooltipsOpen}\n            placement=\"right\"\n            title={name}>\n            {listItem}\n        </Tooltip>;\n}\n","import React, { PropsWithChildren, useCallback } from \"react\";\nimport equal from \"react-fast-compare\"\n\nimport {\n    alpha,\n    Box,\n    Drawer as MuiDrawer,\n    DrawerProps as MuiDrawerProps,\n    Link,\n    Toolbar,\n    Tooltip,\n    useMediaQuery,\n    useTheme\n} from \"@mui/material\";\nimport { Drawer as FireCMSDrawer, DrawerProps } from \"./Drawer\";\nimport { NavLink } from \"react-router-dom\";\nimport { useFireCMSContext, useNavigationContext } from \"../hooks\";\nimport {\n    CircularProgressCenter,\n    ErrorBoundary,\n    FireCMSAppBar,\n    FireCMSAppBarProps,\n    FireCMSLogo\n} from \"./components\";\nimport { CSSObject, styled, Theme } from \"@mui/material/styles\";\nimport OpenInNewIcon from \"@mui/icons-material/OpenInNew\";\nimport MenuIcon from \"@mui/icons-material/Menu\";\nimport IconButton from \"@mui/material/IconButton\";\nimport ChevronLeftIcon from \"@mui/icons-material/ChevronLeft\";\nimport ChevronRightIcon from \"@mui/icons-material/ChevronRight\";\nimport { useRestoreScroll } from \"./internal/useRestoreScroll\";\n\nexport const DRAWER_WIDTH = 280;\n\n/**\n * @category Core\n */\nexport interface ScaffoldProps<ExtraDrawerProps = {}> {\n\n    /**\n     * Name of the app, displayed as the main title and in the tab title\n     */\n    name: string;\n\n    /**\n     * Logo to be displayed in the drawer of the CMS\n     */\n    logo?: string;\n\n    /**\n     * In case you need to override the url displayed at the bottom of the drawer\n     * @default \"https://firecms.co/?utm_source=drawer\"\n     */\n    drawerUrl?: string;\n\n    /**\n     * In case you need to override the label displayed at the bottom of the drawer\n     * @default \"firecms.co\"\n     */\n    drawerUrlLabel?: string;\n\n    /**\n     * A component that gets rendered on the upper side of the main toolbar\n     */\n    toolbarExtraWidget?: React.ReactNode;\n\n    /**\n     * In case you need to override the view that gets rendered as a drawer\n     * @see FireCMSDrawer\n     */\n    Drawer?: React.ComponentType<DrawerProps<ExtraDrawerProps>>;\n\n    /**\n     * Additional props passed to the custom Drawer\n     */\n    drawerProps?: ExtraDrawerProps;\n\n    /**\n     * Open the drawer on hover\n     */\n    autoOpenDrawer?: boolean;\n\n    /**\n     * A component that gets rendered on the upper side of the main toolbar.\n     * `toolbarExtraWidget` has no effect if this is set.\n     */\n    FireCMSAppBarComponent?: React.ComponentType<FireCMSAppBarProps>;\n\n}\n\n/**\n * This view acts as a scaffold for FireCMS.\n *\n * It is in charge of displaying the navigation drawer, top bar and main\n * collection views.\n * This component needs a parent {@link FireCMS}\n *\n * @param props\n * @constructor\n * @category Core\n */\n\nexport const Scaffold = React.memo<PropsWithChildren<ScaffoldProps>>(\n    function Scaffold(props: PropsWithChildren<ScaffoldProps>) {\n\n        const {\n            children,\n            name,\n            logo,\n            drawerUrl,\n            drawerUrlLabel,\n            toolbarExtraWidget,\n            Drawer,\n            autoOpenDrawer,\n            FireCMSAppBarComponent = FireCMSAppBar,\n        } = props;\n\n        const theme = useTheme();\n        const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n        const navigation = useNavigationContext();\n        const { containerRef } = useRestoreScroll();\n\n        const [drawerOpen, setDrawerOpen] = React.useState(false);\n        const [onHover, setOnHover] = React.useState(false);\n\n        const setOnHoverTrue = useCallback(() => setOnHover(true), []);\n        const setOnHoverFalse = useCallback(() => setOnHover(false), []);\n\n        const UsedDrawer = Drawer || FireCMSDrawer;\n\n        const handleDrawerClose = useCallback(() => {\n            console.log(\"handleDrawerClose\");\n            setDrawerOpen(false);\n        }, []);\n\n        const computedDrawerOpen: boolean = drawerOpen || Boolean(largeLayout && autoOpenDrawer && onHover);\n        return (\n            <Box\n                sx={{\n                    display: \"flex\",\n                    height: \"100vh\",\n                    \"@supports (height: 100dvh)\": {\n                        height: \"100dvh\"\n                    },\n                    width: \"100vw\",\n                    pt: \"env(safe-area-inset-top)\",\n                    pl: \"env(safe-area-inset-left)\",\n                    pr: \"env(safe-area-inset-right)\",\n                    pb: \"env(safe-area-inset-bottom)\"\n                }}>\n\n                <FireCMSAppBarComponent title={name}\n                                        drawerOpen={computedDrawerOpen}\n                                        toolbarExtraWidget={toolbarExtraWidget}/>\n\n                <StyledDrawer\n                    onMouseEnter={setOnHoverTrue}\n                    onMouseMove={setOnHoverTrue}\n                    onMouseLeave={setOnHoverFalse}\n                    open={computedDrawerOpen}\n                    logo={logo}\n                    drawerUrl={drawerUrl}\n                    drawerUrlLabel={drawerUrlLabel}\n                    hovered={autoOpenDrawer ? onHover : false}\n                    setDrawerOpen={setDrawerOpen}>\n                    <nav>\n                        {navigation.loading\n                            ? <CircularProgressCenter/>\n                            : <UsedDrawer\n                                hovered={onHover}\n                                drawerOpen={computedDrawerOpen}\n                                closeDrawer={handleDrawerClose}/>}\n                    </nav>\n                </StyledDrawer>\n\n                <Box component={\"main\"}\n                     sx={{\n                         display: \"flex\",\n                         flexDirection: \"column\",\n                         flexGrow: 1,\n                         width: \"100%\",\n                         height: \"100%\",\n                         overflow: \"auto\"\n                     }}>\n                    <DrawerHeader/>\n                    <Box\n                        ref={containerRef}\n                        sx={{\n                            flexGrow: 1,\n                            m: largeLayout ? 2 : 0,\n                            mt: largeLayout ? 0 : 1,\n                            borderRadius: largeLayout ? \"12px\" : undefined,\n                            border: largeLayout ? `1px solid ${theme.palette.divider}` : undefined,\n                            height: \"100%\",\n                            overflow: \"auto\"\n                        }}>\n\n                        <ErrorBoundary>\n                            {children}\n                        </ErrorBoundary>\n\n                    </Box>\n                </Box>\n            </Box>\n        );\n    },\n    equal\n)\n\nconst DrawerHeader = styled(\"div\")(({ theme }) => ({\n    display: \"flex\",\n    flexDirection: \"column\",\n    // alignItems: \"center\",\n    // justifyContent: \"flex-end\",\n    // padding: theme.spacing(4, 12, 1, 3),\n    // necessary for content to be below app bar\n    ...theme.mixins.toolbar\n}));\n\nfunction StyledDrawer(props: MuiDrawerProps & {\n    logo?: string,\n    hovered: boolean,\n    setDrawerOpen: (open: boolean) => void,\n    drawerUrl?: string,\n    drawerUrlLabel?: string\n}) {\n    const context = useFireCMSContext();\n    const theme = useTheme();\n    const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n    const {\n        open,\n        logo,\n        setDrawerOpen,\n        drawerUrl = \"https://firecms.co/?utm_source=drawer\",\n        drawerUrlLabel = \"firecms.co\",\n        hovered,\n        ...drawerProps\n    } = props;\n\n    let logoComponent;\n    if (logo) {\n        logoComponent = <img\n            style={{\n                maxWidth: \"100%\",\n                maxHeight: \"100%\"\n            }}\n            src={logo}\n            alt={\"Logo\"}/>;\n    } else {\n        logoComponent = <FireCMSLogo/>;\n    }\n\n    const menuIconButton = <IconButton\n        color=\"inherit\"\n        aria-label=\"Open drawer\"\n        edge=\"start\"\n        onClick={() => setDrawerOpen(true)}\n        size=\"large\"\n        sx={{\n            position: \"absolute\",\n            top: 8,\n            left: 24\n        }}>\n        <MenuIcon/>\n    </IconButton>;\n\n    return <>\n\n        {!largeLayout && menuIconButton}\n\n        <MuiDrawer\n            {...drawerProps}\n            variant={largeLayout ? \"permanent\" : \"temporary\"}\n            open={open}\n            onClose={!largeLayout\n                ? () => {\n                    setDrawerOpen(false);\n                }\n                : undefined}\n            sx={{\n                width: DRAWER_WIDTH,\n                flexShrink: 0,\n                height: \"100%\",\n                whiteSpace: \"nowrap\",\n                boxSizing: \"border-box\",\n                border: \"none\",\n                ...(open && {\n                    ...openedMixin(theme),\n                    \"& .MuiDrawer-paper\": openedMixin(theme)\n                }),\n                ...(!open && {\n                    ...closedMixin(theme, largeLayout),\n                    \"& .MuiDrawer-paper\": closedMixin(theme, largeLayout)\n                })\n            }}\n        >\n\n            <IconButton onClick={() => setDrawerOpen(false)}\n                        sx={{\n                            position: \"absolute\",\n                            right: 16,\n                            top: 16,\n                            opacity: open ? 1.0 : 0.0,\n                            transition: theme.transitions.create(\"opacity\", {\n                                easing: theme.transitions.easing.sharp,\n                                duration: theme.transitions.duration.enteringScreen\n                            })\n                        }}>\n                {theme.direction === \"rtl\"\n                    ? <ChevronRightIcon/>\n                    : <ChevronLeftIcon/>}\n            </IconButton>\n\n            <Toolbar sx={{\n                position: \"absolute\",\n                left: open ? \"-100%\" : 0,\n                right: open ? undefined : 0,\n                opacity: open ? 0.0 : 1.0,\n                backgroundColor: theme.palette.background.default,\n                transition: theme.transitions.create([\"left\", \"opacity\"], {\n                    easing: theme.transitions.easing.sharp,\n                    duration: theme.transitions.duration.enteringScreen\n                })\n            }}>\n                {!open\n                    ? <Tooltip title={\"Open menu\"}\n                               placement={\"right\"}>\n                        {menuIconButton}\n                    </Tooltip>\n                    : menuIconButton}\n            </Toolbar>\n\n            <Box sx={{ height: \"100%\", width: \"100%\", overflow: \"auto\" }}>\n                <Link\n                    key={\"breadcrumb-home\"}\n                    color=\"inherit\"\n                    component={NavLink}\n                    to={\".\"}\n                    sx={theme => ({\n                        display: \"block\",\n                        transition: theme.transitions.create([\"padding\"], {\n                            easing: theme.transitions.easing.sharp,\n                            duration: theme.transitions.duration.enteringScreen\n                        }),\n                        p: theme.spacing(\n                            open ? 4 : 9,\n                            open ? 12 : 2,\n                            0,\n                            open ? 3 : 2)\n                    })}>\n                    <Tooltip title={\"Home\"} placement={\"right\"}>\n                        <div onClick={() => {\n                            context.onAnalyticsEvent?.(\"drawer_navigate_to_home\");\n                        }}>\n                            {logoComponent}\n                        </div>\n                    </Tooltip>\n\n                </Link>\n                {props.children}\n            </Box>\n\n            <Link sx={(theme) => ({\n                width: DRAWER_WIDTH,\n                position: \"fixed\",\n                bottom: 0,\n                left: open ? 0 : \"-100%\",\n                opacity: open ? 1.0 : 0.0,\n                transition: theme.transitions.create([\"left\", \"opacity\"], {\n                    easing: theme.transitions.easing.sharp,\n                    duration: theme.transitions.duration.enteringScreen\n                }),\n                px: \"24px\",\n                py: 1,\n                display: \"flex\",\n                alignItems: \"center\",\n                fontWeight: theme.typography.fontWeightMedium,\n                background: theme.palette.mode === \"light\" ? \"rgba(255,255,255,0.6)\" : alpha(theme.palette.background.paper, 0.1),\n                backdropFilter: \"blur(8px)\"\n                // borderTop: `1px solid ${theme.palette.divider}`\n            })}\n                  href={drawerUrl}\n                  onMouseDown={(e: React.MouseEvent) => {\n                      e.preventDefault();\n                  }}\n                  target=\"_blank\">\n                <OpenInNewIcon style={{ marginRight: \"24px\" }}\n                               fontSize={\"small\"}/>\n                {drawerUrlLabel}\n            </Link>\n\n        </MuiDrawer>\n    </>;\n}\n\nconst openedMixin = (theme: Theme): CSSObject => ({\n    willChange: \"width\",\n    pb: \"32px\",\n    width: DRAWER_WIDTH,\n    border: \"none\",\n    transition: theme.transitions.create(\"width\", {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.enteringScreen\n    }),\n    backgroundColor: theme.palette.background.default,\n    overflowX: \"hidden\"\n});\n\nconst closedMixin = (theme: Theme, large: boolean): CSSObject => ({\n    willChange: \"width\",\n    transition: theme.transitions.create(\"width\", {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen\n    }),\n    border: \"none\",\n    overflowX: \"hidden\",\n    backgroundColor: theme.palette.background.default,\n    width: large ? `calc(${theme.spacing(9)})` : \"0px\"\n});\n","import React from \"react\";\nimport {\n    Avatar,\n    Box,\n    Breadcrumbs,\n    Button,\n    Chip,\n    Hidden,\n    IconButton,\n    Link,\n    Slide,\n    Toolbar,\n    Typography,\n    useMediaQuery,\n    useTheme\n} from \"@mui/material\";\nimport LightModeOutlinedIcon from \"@mui/icons-material/LightModeOutlined\";\nimport DarkModeOutlinedIcon from \"@mui/icons-material/DarkModeOutlined\";\nimport NavigateNextIcon from \"@mui/icons-material/NavigateNext\";\nimport { Link as ReactLink } from \"react-router-dom\";\nimport { ErrorBoundary } from \"../components\";\nimport {\n    useAuthController,\n    useBreadcrumbsContext,\n    useModeController\n} from \"../../hooks\";\nimport { DRAWER_WIDTH } from \"../Scaffold\";\n\nexport interface FireCMSAppBarProps {\n    title: string;\n    /**\n     * A component that gets rendered on the upper side of the main toolbar\n     */\n    toolbarExtraWidget?: React.ReactNode;\n\n    drawerOpen: boolean;\n}\n\n/**\n * This component renders the main app bar of FireCMS.\n * You will likely not need to use this component directly.\n *\n * @param title\n * @param toolbarExtraWidget\n * @param drawerOpen\n * @constructor\n */\nexport const FireCMSAppBar = function FireCMSAppBar({\n                                                        title,\n                                                        toolbarExtraWidget,\n                                                        drawerOpen\n                                                    }: FireCMSAppBarProps) {\n\n    const breadcrumbsContext = useBreadcrumbsContext();\n    const { breadcrumbs } = breadcrumbsContext;\n\n    const authController = useAuthController();\n    const { mode, toggleMode } = useModeController();\n\n    const theme = useTheme();\n    const largeLayout = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n    const initial = authController.user?.displayName\n        ? authController.user.displayName[0].toUpperCase()\n        : (authController.user?.email ? authController.user.email[0].toUpperCase() : \"A\");\n\n    return (\n        <Box\n            sx={{\n                position: \"fixed\",\n                marginLeft: theme.spacing(8),\n                width: `calc(100% - ${theme.spacing(8)})`,\n                zIndex: largeLayout ? theme.zIndex.drawer + 1 : undefined,\n                transition: theme.transitions.create([\"width\", \"margin\"], {\n                    easing: theme.transitions.easing.sharp,\n                    duration: theme.transitions.duration.leavingScreen\n                }),\n                ...(drawerOpen && largeLayout && {\n                    marginLeft: `calc(${DRAWER_WIDTH}px - 8px)`,\n                    width: `calc(100% - ${DRAWER_WIDTH}px)`,\n                    transition: theme.transitions.create([\"width\", \"margin\"], {\n                        easing: theme.transitions.easing.sharp,\n                        duration: theme.transitions.duration.enteringScreen\n                    })\n                })\n            }}>\n\n            <Slide\n                direction=\"down\" in={true} mountOnEnter unmountOnExit>\n                <Toolbar sx={{ gap: 1 }}>\n\n                    <Hidden lgDown>\n                        <Box mr={2}>\n                            <Link\n                                underline={\"none\"}\n                                key={\"breadcrumb-home\"}\n                                color=\"inherit\"\n                                component={ReactLink}\n                                to={\".\"}>\n                                <Typography variant=\"h6\"\n                                            noWrap\n                                            className={\"weight-500\"}>\n                                    {title}\n                                </Typography>\n                            </Link>\n                        </Box>\n                    </Hidden>\n\n                    {largeLayout && <Box>\n                        <Breadcrumbs\n                            separator={<NavigateNextIcon\n                                htmlColor={\"rgb(0,0,0,0.87)\"}\n                                fontSize=\"small\"/>}\n                            aria-label=\"breadcrumb\">\n                            {breadcrumbs.map((entry, index) => (\n                                <Link\n                                    underline={\"none\"}\n                                    key={`breadcrumb-${index}`}\n                                    color=\"inherit\"\n                                    component={ReactLink}\n                                    to={entry.url}>\n                                    <Chip\n                                        sx={theme => ({\n                                            backgroundColor: theme.palette.grey[200],\n                                            height: theme.spacing(3),\n                                            color: theme.palette.grey[800],\n                                            fontWeight: theme.typography.fontWeightMedium,\n                                            \"&:hover, &:focus\": {\n                                                cursor: \"pointer\",\n                                                backgroundColor: theme.palette.grey[300]\n                                            },\n                                            \"&:active\": {\n                                                boxShadow: theme.shadows[1],\n                                                backgroundColor: theme.palette.grey[400]\n                                            }\n                                        })}\n                                        label={entry.title}\n                                    />\n                                </Link>)\n                            )\n                            }\n                        </Breadcrumbs>\n                    </Box>}\n\n                    <Box flexGrow={1}/>\n\n                    {toolbarExtraWidget &&\n                        <ErrorBoundary>\n                            {\n                                toolbarExtraWidget\n                            }\n                        </ErrorBoundary>}\n\n                    <Box p={1}>\n                        <IconButton\n                            color=\"inherit\"\n                            aria-label=\"Open drawer\"\n                            edge=\"start\"\n                            onClick={() => toggleMode()}\n                            size=\"large\">\n                            {mode === \"dark\"\n                                ? <DarkModeOutlinedIcon/>\n                                : <LightModeOutlinedIcon/>}\n                        </IconButton>\n                    </Box>\n\n                    <Box p={1}>\n                        {authController.user && authController.user.photoURL\n                            ? <Avatar\n                                src={authController.user.photoURL}/>\n                            : <Avatar>{initial}</Avatar>\n                        }\n                    </Box>\n\n                    <Button variant=\"text\"\n                            color=\"inherit\"\n                            onClick={authController.signOut}>\n                        Log Out\n                    </Button>\n\n                </Toolbar>\n            </Slide>\n        </Box>\n    );\n}\n","import { useMediaQuery, useTheme } from \"@mui/material\";\n\nexport function useLargeSideLayout() {\n    const theme = useTheme();\n    return useMediaQuery(theme.breakpoints.up(\"xl\"));\n}\n","import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport equal from \"react-fast-compare\";\nimport {\n    Box,\n    CircularProgress,\n    Divider,\n    IconButton,\n    Tab,\n    Tabs,\n    Typography,\n    useTheme\n} from \"@mui/material\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport {\n    Entity,\n    EntityCollection,\n    EntityStatus,\n    EntityValues,\n    FireCMSPlugin,\n    FormContext,\n    ResolvedEntityCollection,\n    User\n} from \"../../types\";\nimport {\n    CircularProgressCenter,\n    EntityCollectionView,\n    EntityPreview,\n    ErrorBoundary\n} from \"../components\";\nimport {\n    canEditEntity,\n    fullPathToCollectionSegments,\n    removeInitialAndTrailingSlashes\n} from \"../util\";\n\nimport {\n    ADDITIONAL_TAB_WIDTH,\n    CONTAINER_FULL_WIDTH,\n    FORM_CONTAINER_WIDTH\n} from \"./common\";\nimport {\n    saveEntityWithCallbacks,\n    useAuthController,\n    useDataSource,\n    useEntityFetch,\n    useFireCMSContext,\n    useSideEntityController,\n    useSnackbarController\n} from \"../../hooks\";\nimport { EntityForm } from \"../../form\";\nimport { useSideDialogContext } from \"../SideDialogs\";\nimport { useLargeSideLayout } from \"./useLargeSideLayout\";\n\nexport interface EntityViewProps<M extends Record<string, any>> {\n    path: string;\n    collection: EntityCollection<M>;\n    entityId?: string;\n    copy?: boolean;\n    selectedSubPath?: string;\n    formWidth?: number | string;\n    onValuesAreModified: (modified: boolean) => void;\n    onUpdate?: (params: { entity: Entity<any> }) => void;\n    onClose?: () => void;\n}\n\n/**\n * This is the default view that is used as the content of a side panel when\n * an entity is opened.\n * You probably don't want to use this view directly since it is bound to the\n * side panel. Instead, you might want to use {@link EntityForm} or\n * {@link EntityCollectionView}\n */\nexport const EntityView = React.memo<EntityViewProps<any>>(\n    function EntityView<M extends Record<string, any>, UserType extends User>({\n                                                                                  path,\n                                                                                  entityId,\n                                                                                  selectedSubPath,\n                                                                                  copy,\n                                                                                  collection,\n                                                                                  onValuesAreModified,\n                                                                                  formWidth,\n                                                                                  onUpdate,\n                                                                                  onClose\n                                                                              }: EntityViewProps<M>) {\n\n        const theme = useTheme();\n        const largeLayout = useLargeSideLayout();\n        const largeLayoutTabSelected = useRef(!largeLayout);\n\n        const resolvedFormWidth: string = typeof formWidth === \"number\" ? `${formWidth}px` : formWidth ?? FORM_CONTAINER_WIDTH;\n\n        const dataSource = useDataSource();\n        const sideDialogContext = useSideDialogContext();\n        const sideEntityController = useSideEntityController();\n        const snackbarController = useSnackbarController();\n        const context = useFireCMSContext();\n        const authController = useAuthController<UserType>();\n\n        const [formContext, setFormContext] = useState<FormContext<M> | undefined>(undefined);\n\n        const [status, setStatus] = useState<EntityStatus>(copy ? \"copy\" : (entityId ? \"existing\" : \"new\"));\n        // const [currentEntityId, setCurrentEntityId] = useState<string | undefined>(entityId);\n\n        const modifiedValuesRef = useRef<EntityValues<M> | undefined>(undefined);\n        const modifiedValues = modifiedValuesRef.current;\n\n        const subcollections = (collection.subcollections ?? []).filter(c => !c.hideFromNavigation);\n        const subcollectionsCount = subcollections?.length ?? 0;\n        const customViews = collection.views;\n        const customViewsCount = customViews?.length ?? 0;\n\n        const getTabPositionFromPath = useCallback((subPath: string): number => {\n            if (customViews) {\n                const index = customViews\n                    .map((c) => c.path)\n                    .findIndex((p) => p === subPath);\n                if (index !== -1)\n                    return index;\n            }\n\n            if (subcollections) {\n                const index = subcollections\n                    .map((c) => c.path)\n                    .findIndex((p) => p === subPath);\n                if (index !== -1)\n                    return index + customViewsCount;\n            }\n            return -1;\n        }, [customViews, customViewsCount, subcollections]);\n\n        const hasAdditionalViews = customViewsCount > 0 || subcollectionsCount > 0;\n\n        const defaultSelectedView = selectedSubPath ?? collection.defaultSelectedView;\n\n        const [tabsPosition, setTabsPosition] = React.useState(defaultSelectedView ? getTabPositionFromPath(defaultSelectedView) : -1);\n\n        const mainViewVisible = tabsPosition === -1 || largeLayout;\n\n        const {\n            entity,\n            dataLoading,\n            // eslint-disable-next-line no-unused-vars\n            dataLoadingError\n        } = useEntityFetch<M, UserType>({\n            path,\n            entityId,\n            collection,\n            useCache: false\n        });\n\n        const [currentEntityId, setCurrentEntityId] = React.useState<string | undefined>(entityId);\n        const [usedEntity, setUsedEntity] = useState<Entity<M> | undefined>(entity);\n        const [readOnly, setReadOnly] = useState<boolean | undefined>(undefined);\n\n        useEffect(() => {\n            if (entity)\n                setUsedEntity(entity);\n        }, [entity]);\n\n        useEffect(() => {\n            if (status === \"new\") {\n                setReadOnly(false);\n            } else {\n                const editEnabled = usedEntity ? canEditEntity(collection, authController, fullPathToCollectionSegments(path), usedEntity ?? null) : false;\n                if (usedEntity)\n                    setReadOnly(!editEnabled);\n            }\n        }, [authController, usedEntity, status]);\n\n        // useEffect(() => {\n        //     if (defaultSelectedView) {\n        //         setTabsPosition(getTabPositionFromPath(defaultSelectedView));\n        //     }\n        // }, [getTabPositionFromPath, defaultSelectedView]);\n\n        useEffect(() => {\n            if (largeLayoutTabSelected.current === largeLayout)\n                return;\n            // open first tab by default in large layouts\n            if (selectedSubPath !== defaultSelectedView)\n                sideEntityController.replace({\n                    path,\n                    entityId,\n                    selectedSubPath: defaultSelectedView,\n                    updateUrl: true\n                });\n            largeLayoutTabSelected.current = largeLayout;\n        }, [defaultSelectedView, largeLayout, selectedSubPath]);\n\n        const onPreSaveHookError = useCallback((e: Error) => {\n            snackbarController.open({\n                type: \"error\",\n                message: \"Error before saving: \" + e?.message\n            });\n            console.error(e);\n        }, [snackbarController]);\n\n        const onSaveSuccessHookError = useCallback((e: Error) => {\n            snackbarController.open({\n                type: \"error\",\n                message: \"Error after saving (entity is saved): \" + e?.message\n            });\n            console.error(e);\n        }, [snackbarController]);\n\n        const onSaveSuccess = (updatedEntity: Entity<M>, closeAfterSave: boolean) => {\n\n            snackbarController.open({\n                type: \"success\",\n                message: `${collection.singularName ?? collection.name}: Saved correctly`\n            });\n\n            // setCurrentEntityId(updatedEntity.id);\n            setUsedEntity(updatedEntity);\n            setStatus(\"existing\");\n\n            onValuesAreModified(false);\n\n            if (onUpdate)\n                onUpdate({ entity: updatedEntity });\n\n            if (closeAfterSave) {\n                sideDialogContext.setBlocked(false);\n                sideDialogContext.close(true);\n                onClose?.();\n            } else {\n                sideEntityController.replace({\n                    path,\n                    entityId: updatedEntity.id,\n                    selectedSubPath,\n                    updateUrl: true\n                });\n            }\n\n        };\n\n        const onSaveFailure = useCallback((e: Error) => {\n\n            snackbarController.open({\n                type: \"error\",\n                message: \"Error saving: \" + e?.message\n            });\n\n            console.error(\"Error saving entity\", path, entityId);\n            console.error(e);\n        }, [entityId, path, snackbarController]);\n\n        const onEntitySave = useCallback(async ({\n                                                    collection,\n                                                    path,\n                                                    entityId,\n                                                    values,\n                                                    previousValues,\n                                                    closeAfterSave\n                                                }: {\n            collection: ResolvedEntityCollection<M>,\n            path: string,\n            entityId: string | undefined,\n            values: EntityValues<M>,\n            previousValues?: EntityValues<M>,\n            closeAfterSave: boolean\n        }): Promise<void> => {\n\n            if (!status)\n                return;\n\n            return saveEntityWithCallbacks({\n                path,\n                entityId,\n                values,\n                previousValues,\n                collection,\n                status,\n                dataSource,\n                context,\n                onSaveSuccess: (updatedEntity: Entity<M>) => onSaveSuccess(updatedEntity, closeAfterSave),\n                onSaveFailure,\n                onPreSaveHookError,\n                onSaveSuccessHookError\n            });\n        }, [status, collection, dataSource, context, onSaveSuccess, onSaveFailure, onPreSaveHookError, onSaveSuccessHookError]);\n\n        const customViewsView: React.ReactNode[] | undefined = customViews && customViews.map(\n            (customView, colIndex) => {\n                if (tabsPosition !== colIndex)\n                    return null;\n                if (customView.Builder) {\n                    console.warn(\"customView.builder is deprecated, use customView.Builder instead\", customView);\n                }\n                const Builder = customView.Builder ?? customView.builder;\n                if (!Builder) {\n                    console.error(\"customView.Builder is not defined\");\n                    return null;\n                }\n                return <Box\n                    sx={{\n                        width: ADDITIONAL_TAB_WIDTH,\n                        height: \"100%\",\n                        overflow: \"auto\",\n                        borderLeft: `1px solid ${theme.palette.divider}`,\n                        [theme.breakpoints.down(\"lg\")]: {\n                            borderLeft: \"inherit\",\n                            width: CONTAINER_FULL_WIDTH\n                        }\n                    }}\n                    key={`custom_view_${customView.path}`}\n                    role=\"tabpanel\"\n                    flexGrow={1}>\n                    <ErrorBoundary>\n                        <Builder\n                            collection={collection}\n                            entity={usedEntity}\n                            modifiedValues={modifiedValues ?? usedEntity?.values}\n                        />\n                    </ErrorBoundary>\n                </Box>;\n            }\n        ).filter(Boolean);\n\n        const loading = (dataLoading && !usedEntity) || ((!usedEntity || readOnly === undefined) && (status === \"existing\" || status === \"copy\"));\n\n        const subCollectionsViews = subcollections && subcollections.map(\n            (subcollection, colIndex) => {\n                const fullPath = usedEntity ? `${path}/${usedEntity?.id}/${removeInitialAndTrailingSlashes(subcollection.alias ?? subcollection.path)}` : undefined;\n                if (tabsPosition !== colIndex + customViewsCount)\n                    return null;\n                return (\n                    <Box\n                        sx={{\n                            width: ADDITIONAL_TAB_WIDTH,\n                            height: \"100%\",\n                            overflow: \"auto\",\n                            borderLeft: `1px solid ${theme.palette.divider}`,\n                            [theme.breakpoints.down(\"lg\")]: {\n                                borderLeft: \"inherit\",\n                                width: CONTAINER_FULL_WIDTH\n                            }\n                        }}\n                        key={`subcol_${subcollection.alias ?? subcollection.path}`}\n                        role=\"tabpanel\"\n                        flexGrow={1}>\n\n                        {loading && <CircularProgressCenter/>}\n\n                        {!loading &&\n                            (usedEntity && fullPath\n                                ? <EntityCollectionView\n                                    fullPath={fullPath}\n                                    isSubCollection={true}\n                                    {...subcollection}/>\n                                : <Box\n                                    sx={{\n                                        width: \"100%\",\n                                        height: \"100%\",\n                                        p: 3\n                                    }}\n                                    display={\"flex\"}\n                                    alignItems={\"center\"}\n                                    justifyContent={\"center\"}>\n                                    <Typography variant={\"label\"}>\n                                        You need to save your entity before\n                                        adding additional collections\n                                    </Typography>\n                                </Box>)\n                        }\n\n                    </Box>\n                );\n            }\n        ).filter(Boolean);\n\n        const getSelectedSubPath = useCallback((value: number) => {\n            if (value === -1) return undefined;\n\n            if (customViews && value < customViewsCount) {\n                return customViews[value].path;\n            }\n\n            if (subcollections) {\n                return subcollections[value - customViewsCount].path;\n            }\n\n            throw Error(\"Something is wrong in getSelectedSubPath\");\n        }, [customViewsCount]);\n\n        const onDiscard = useCallback(() => {\n            onValuesAreModified(false);\n        }, []);\n\n        const onSideTabClick = useCallback((value: number) => {\n            setTabsPosition(value);\n            if (entityId) {\n                sideEntityController.replace({\n                    path,\n                    entityId,\n                    selectedSubPath: getSelectedSubPath(value),\n                    updateUrl: true\n                });\n            }\n        }, [entityId, sideEntityController, path, getSelectedSubPath]);\n\n        const onValuesChanged = useCallback((values?: EntityValues<M>) => {\n            modifiedValuesRef.current = values;\n        }, []);\n\n        const onIdChange = useCallback((id: string) => {\n            setUsedEntity((value) => value\n                ? {\n                    ...value,\n                    id\n                }\n                : undefined);\n            setCurrentEntityId(id);\n        }, []);\n\n        function buildForm() {\n            const plugins = context.plugins;\n            let form = <EntityForm\n                status={status}\n                path={path}\n                collection={collection}\n                onEntitySave={onEntitySave}\n                onDiscard={onDiscard}\n                onValuesChanged={onValuesChanged}\n                onModified={onValuesAreModified}\n                entity={usedEntity}\n                onIdChange={onIdChange}\n                onFormContextChange={setFormContext}\n                hideId={collection.hideIdFromForm}\n            />;\n            if (plugins) {\n                plugins.forEach((plugin: FireCMSPlugin) => {\n                    if (plugin.form?.provider) {\n                        form = (\n                            <plugin.form.provider.Component\n                                status={status}\n                                path={path}\n                                collection={collection}\n                                onEntitySave={onEntitySave}\n                                onDiscard={onDiscard}\n                                onValuesChanged={onValuesChanged}\n                                onModified={onValuesAreModified}\n                                entity={usedEntity}\n                                context={context}\n                                currentEntityId={currentEntityId}\n                                formContext={formContext}\n                                {...plugin.form.provider.props}>\n                                {form}\n                            </plugin.form.provider.Component>\n                        );\n                    }\n                });\n            }\n            return <ErrorBoundary>{form}</ErrorBoundary>;\n        }\n\n        const form = (readOnly === undefined)\n            ? <></>\n            : (!readOnly\n                ? buildForm()\n                : (\n                    <EntityPreview\n                        entity={usedEntity as Entity<M>}\n                        path={path}\n                        collection={collection}/>\n                ));\n\n        const subcollectionTabs = subcollections && subcollections.map(\n            (subcollection) =>\n                <Tab\n                    sx={{\n                        fontSize: \"0.875rem\",\n                        minWidth: \"140px\"\n                    }}\n                    wrapped={true}\n                    key={`entity_detail_collection_tab_${subcollection.name}`}\n                    label={subcollection.name}/>\n        );\n\n        const customViewTabs = customViews && customViews.map(\n            (view) =>\n                <Tab\n                    sx={{\n                        fontSize: \"0.875rem\",\n                        minWidth: \"140px\"\n                    }}\n                    wrapped={true}\n                    key={`entity_detail_custom_tab_${view.name}`}\n                    label={view.name}/>\n        );\n\n        const header = (\n            <Box sx={{\n                paddingLeft: 2,\n                paddingRight: 2,\n                paddingTop: 1,\n                display: \"flex\",\n                alignItems: \"end\",\n                backgroundColor: theme.palette.mode === \"light\" ? theme.palette.background.default : theme.palette.background.paper\n            }}>\n\n                <Box\n                    sx={{\n                        pb: 1,\n                        alignSelf: \"center\"\n                    }}>\n                    <IconButton onClick={() => {\n                        onClose?.();\n                        return sideDialogContext.close(false);\n                    }}\n                                size=\"large\">\n                        <CloseIcon/>\n                    </IconButton>\n                </Box>\n\n                <Box flexGrow={1}/>\n\n                {loading && <Box\n                    sx={{\n                        alignSelf: \"center\"\n                    }}>\n                    <CircularProgress size={16} thickness={8}/>\n                </Box>}\n\n                <Tabs\n                    value={tabsPosition + 1}\n                    indicatorColor=\"secondary\"\n                    textColor=\"inherit\"\n                    onChange={(ev, value) => {\n                        onSideTabClick(value - 1);\n                    }}\n                    sx={{\n                        paddingLeft: theme.spacing(1),\n                        paddingRight: theme.spacing(1),\n                        paddingTop: theme.spacing(0)\n                    }}\n                    variant=\"scrollable\"\n                    scrollButtons=\"auto\"\n                >\n                    <Tab\n                        label={collection.singularName ?? collection.name}\n                        disabled={!hasAdditionalViews}\n                        onClick={() => {\n                            onSideTabClick(-1);\n                        }}\n                        sx={{\n                            display: !hasAdditionalViews ? \"none\" : undefined,\n                            fontSize: \"0.875rem\",\n                            minWidth: \"140px\"\n                        }}\n                        wrapped={true}\n                    />\n                    {customViewTabs}\n                    {subcollectionTabs}\n\n                </Tabs>\n            </Box>\n\n        );\n\n        return (\n            <Box\n                sx={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    height: \"100%\",\n                    width: \"100%\",\n                    transition: \"width 250ms ease-in-out\"\n                }}>\n                {\n                    <>\n\n                        {header}\n\n                        <Divider/>\n\n                        <Box sx={{\n                            flexGrow: 1,\n                            height: \"100%\",\n                            width: `calc(${ADDITIONAL_TAB_WIDTH} + ${resolvedFormWidth})`,\n                            maxWidth: \"100%\",\n                            [`@media (max-width: ${resolvedFormWidth})`]: {\n                                width: resolvedFormWidth\n                            },\n                            display: \"flex\",\n                            overflow: \"auto\",\n                            flexDirection: \"row\"\n                        }}>\n\n                            <Box sx={{\n                                position: \"relative\",\n                                maxWidth: \"100%\"\n                            }}>\n                                <Box\n                                    role=\"tabpanel\"\n                                    hidden={!mainViewVisible}\n                                    id={`form_${path}`}\n                                    sx={{\n                                        width: resolvedFormWidth,\n                                        maxWidth: \"100%\",\n                                        height: \"100%\",\n                                        overflow: \"auto\",\n                                        [theme.breakpoints.down(\"sm\")]: {\n                                            maxWidth: CONTAINER_FULL_WIDTH,\n                                            width: CONTAINER_FULL_WIDTH\n                                        }\n                                    }}>\n\n                                    {loading\n                                        ? <CircularProgressCenter/>\n                                        : form}\n\n                                </Box>\n                            </Box>\n\n                            {customViewsView}\n\n                            {subCollectionsViews}\n\n                        </Box>\n\n                    </>\n                }\n\n            </Box>\n        );\n    },\n    equal\n)\n","import React, { useCallback, useEffect, useMemo } from \"react\";\n\nimport { EntitySidePanelProps } from \"../types\";\nimport { FORM_CONTAINER_WIDTH } from \"./internal/common\";\nimport { useNavigationContext, useSideEntityController } from \"../hooks\";\n\nimport { ErrorBoundary } from \"./components\";\nimport { EntityView } from \"./internal/EntityView\";\nimport { useSideDialogContext } from \"./SideDialogs\";\n\n/**\n * This is the component in charge of rendering the side dialog used\n * for editing entities. Use the {@link useSideEntityController} to open\n * and control the dialogs.\n * This component needs a parent {@link FireCMS}\n * {@link useSideEntityController}\n * @category Components\n */\nexport function EntitySidePanel(props: EntitySidePanelProps) {\n\n    const {\n        blocked,\n        setBlocked,\n        setBlockedNavigationMessage\n    } = useSideDialogContext();\n\n    const navigationContext = useNavigationContext();\n\n    const collection = useMemo(() => {\n        if (!props) return undefined;\n        let usedCollection = props.collection;\n\n        if (!usedCollection) {\n            usedCollection = !props ? undefined : navigationContext.getCollection(props.path, props.entityId);\n            if (!usedCollection) {\n                console.error(\"ERROR: No collection found in path `\", props.path, \"`. Entity id: \", props.entityId);\n                throw Error(\"ERROR: No collection found in path `\" + props.path + \"`. Make sure you have defined a collection for this path in the root navigation.\");\n            }\n        }\n        return usedCollection;\n    }, [navigationContext, props]);\n\n    useEffect(() => {\n        function beforeunload(e: any) {\n            if (blocked && collection) {\n                e.preventDefault();\n                e.returnValue = `You have unsaved changes in this ${collection.name}. Are you sure you want to leave this page?`;\n            }\n        }\n\n        if (typeof window !== \"undefined\")\n            window.addEventListener(\"beforeunload\", beforeunload);\n\n        return () => {\n            if (typeof window !== \"undefined\")\n                window.removeEventListener(\"beforeunload\", beforeunload);\n        };\n\n    }, [blocked, collection]);\n\n    const onValuesAreModified = useCallback((modified: boolean) => {\n        setBlocked(modified);\n        setBlockedNavigationMessage(modified\n            ? <> You have unsaved changes in this <b>{collection?.name}</b>.</>\n            : undefined)\n    }, [collection?.name, setBlocked, setBlockedNavigationMessage]);\n\n    if (!props || !collection) {\n        return <div style={{ width: FORM_CONTAINER_WIDTH }}/>;\n    }\n\n    return (\n        <>\n\n            <ErrorBoundary>\n                <EntityView\n                    {...props}\n                    formWidth={props.width}\n                    collection={collection}\n                    onValuesAreModified={onValuesAreModified}\n                />\n            </ErrorBoundary>\n\n        </>\n    );\n}\n","import { useCallback, useEffect, useRef } from \"react\";\nimport { useMediaQuery, useTheme } from \"@mui/material\";\nimport {\n    EntityCollection,\n    EntitySidePanelProps,\n    NavigationContext,\n    SideDialogPanelProps,\n    SideDialogsController,\n    SideEntityController\n} from \"../../types\";\nimport {\n    getNavigationEntriesFromPathInternal,\n    NavigationViewInternal\n} from \"../util/navigation_from_path\";\nimport { useLocation } from \"react-router-dom\";\nimport { EntitySidePanel } from \"../EntitySidePanel\";\nimport { removeInitialAndTrailingSlashes } from \"../util\";\nimport {\n    ADDITIONAL_TAB_WIDTH,\n    CONTAINER_FULL_WIDTH,\n    FORM_CONTAINER_WIDTH\n} from \"./common\";\n\nconst NEW_URL_HASH = \"new\";\n\nexport function getEntityViewWidth(props: EntitySidePanelProps<any>, small: boolean): string {\n    if (small) return CONTAINER_FULL_WIDTH;\n    const mainViewSelected = !props.selectedSubPath;\n    const resolvedWidth: string | undefined = typeof props.width === \"number\" ? `${props.width}px` : props.width;\n    return !mainViewSelected ? `calc(${ADDITIONAL_TAB_WIDTH} + ${resolvedWidth ?? FORM_CONTAINER_WIDTH})` : resolvedWidth ?? FORM_CONTAINER_WIDTH\n}\n\nexport const useBuildSideEntityController = (navigation: NavigationContext,\n                                             sideDialogsController: SideDialogsController): SideEntityController => {\n\n    const location = useLocation();\n    const initialised = useRef<boolean>(false);\n\n    const theme = useTheme();\n    const smallLayout: boolean = useMediaQuery(theme.breakpoints.down(\"sm\"));\n\n    // only on initialisation, create panels from URL\n    useEffect(() => {\n        if (!navigation.loading && !initialised.current) {\n            if (navigation.isUrlCollectionPath(location.pathname)) {\n                const newFlag = location.hash === `#${NEW_URL_HASH}`;\n                const entityOrCollectionPath = navigation.urlPathToDataPath(location.pathname);\n                const panelsFromUrl = buildSidePanelsFromUrl(entityOrCollectionPath, navigation.collections, newFlag);\n                sideDialogsController.replace(panelsFromUrl.map((props) => propsToSidePanel(props, navigation, smallLayout)));\n            }\n            initialised.current = true;\n        }\n    }, [location, navigation, sideDialogsController, smallLayout]);\n\n    const close = useCallback(() => {\n        sideDialogsController.close();\n    }, [sideDialogsController]);\n\n    const open = useCallback((props: EntitySidePanelProps<any>) => {\n\n        if (props.copy && !props.entityId) {\n            throw Error(\"If you want to copy an entity you need to provide an entityId\");\n        }\n        const firstAdditionalView = props.collection ? props.collection.defaultSelectedView : undefined;\n        sideDialogsController.open(propsToSidePanel({ selectedSubPath: firstAdditionalView, ...props }, navigation, smallLayout));\n\n    }, [sideDialogsController, navigation, smallLayout]);\n\n    const replace = useCallback((props: EntitySidePanelProps<any>) => {\n\n        if (props.copy && !props.entityId) {\n            throw Error(\"If you want to copy an entity you need to provide an entityId\");\n        }\n\n        sideDialogsController.replace(propsToSidePanel(props, navigation, smallLayout));\n\n    }, [navigation, sideDialogsController, smallLayout]);\n\n    return {\n        close,\n        open,\n        replace\n    };\n};\n\nfunction buildSidePanelsFromUrl(path: string, collections: EntityCollection[], newFlag: boolean): EntitySidePanelProps<any>[] {\n\n    const navigationViewsForPath: NavigationViewInternal<any>[] = getNavigationEntriesFromPathInternal({\n        path,\n        collections\n    });\n\n    const sidePanels: EntitySidePanelProps<any>[] = [];\n    let lastCollectionPath = \"\";\n    for (let i = 0; i < navigationViewsForPath.length; i++) {\n        const navigationEntry = navigationViewsForPath[i];\n\n        if (navigationEntry.type === \"collection\") {\n            lastCollectionPath = navigationEntry.path;\n        }\n\n        if (i > 0) { // the first collection is handled by the main navigation\n            const previousEntry = navigationViewsForPath[i - 1];\n            if (navigationEntry.type === \"entity\") {\n                sidePanels.push({\n                        path: navigationEntry.path,\n                        entityId: navigationEntry.entityId,\n                        copy: false\n                    }\n                );\n            } else if (navigationEntry.type === \"custom_view\") {\n                if (previousEntry.type === \"entity\") {\n                    const lastSidePanel: EntitySidePanelProps<any> = sidePanels[sidePanels.length - 1];\n                    if (lastSidePanel)\n                        lastSidePanel.selectedSubPath = navigationEntry.view.path;\n                }\n            } else if (navigationEntry.type === \"collection\") {\n                if (previousEntry.type === \"entity\") {\n                    const lastSidePanel: EntitySidePanelProps<any> = sidePanels[sidePanels.length - 1];\n                    if (lastSidePanel)\n                        lastSidePanel.selectedSubPath = navigationEntry.collection.alias ?? navigationEntry.collection.path;\n                }\n            }\n        }\n\n    }\n\n    if (newFlag) {\n        sidePanels.push({\n            path: lastCollectionPath,\n            copy: false\n        });\n    }\n\n    return sidePanels;\n}\n\nconst propsToSidePanel = (props: EntitySidePanelProps<any>, navigation: NavigationContext, smallLayout: boolean): SideDialogPanelProps => {\n\n    const collectionPath = removeInitialAndTrailingSlashes(props.path);\n    const newPath = props.entityId\n        ? navigation.buildUrlCollectionPath(`${collectionPath}/${props.entityId}/${props.selectedSubPath || \"\"}`)\n        : navigation.buildUrlCollectionPath(`${collectionPath}#${NEW_URL_HASH}`);\n\n    return ({\n        key: `${props.path}/${props.entityId}`,\n        component: <EntitySidePanel {...props}/>,\n        urlPath: newPath,\n        parentUrlPath: navigation.buildUrlCollectionPath(collectionPath),\n        width: getEntityViewWidth(props, smallLayout),\n        onClose: props.onClose\n    });\n};\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport { useLocation } from \"react-router-dom\";\n\nimport {\n    AuthController,\n    CMSView,\n    CMSViewsBuilder,\n    CollectionOverrideHandler,\n    DataSource,\n    EntityCollection,\n    EntityCollectionsBuilder,\n    FireCMSPlugin,\n    NavigationContext,\n    TopNavigationEntry,\n    TopNavigationResult,\n    User,\n    UserConfigurationPersistence\n} from \"../../types\";\nimport {\n    getCollectionByPathOrAlias,\n    mergeDeep,\n    removeInitialAndTrailingSlashes,\n    resolveCollectionPathAliases,\n    resolvePermissions\n} from \"../util\";\n\ntype BuildNavigationContextProps<UserType extends User> = {\n    basePath: string,\n    baseCollectionPath: string,\n    authController: AuthController<UserType>;\n    collections?: EntityCollection[] | EntityCollectionsBuilder;\n    views?: CMSView[] | CMSViewsBuilder;\n    collectionOverrideHandler: CollectionOverrideHandler | undefined;\n    userConfigPersistence?: UserConfigurationPersistence;\n    plugins?: FireCMSPlugin[];\n    dataSource: DataSource;\n};\n\nexport function useBuildNavigationContext<UserType extends User>({\n                                                                     basePath,\n                                                                     baseCollectionPath,\n                                                                     authController,\n                                                                     collections: baseCollections,\n                                                                     views: baseViews,\n                                                                     collectionOverrideHandler,\n                                                                     userConfigPersistence,\n                                                                     plugins,\n                                                                     dataSource\n                                                                 }: BuildNavigationContextProps<UserType>): NavigationContext {\n\n    const location = useLocation();\n\n    const [collections, setCollections] = useState<EntityCollection[] | undefined>();\n    const [views, setViews] = useState<CMSView[] | undefined>();\n    const [initialised, setInitialised] = useState<boolean>(false);\n\n    const [topLevelNavigation, setTopLevelNavigation] = useState<TopNavigationResult | undefined>(undefined);\n    const [navigationLoading, setNavigationLoading] = useState<boolean>(true);\n    const [navigationLoadingError, setNavigationLoadingError] = useState<Error | undefined>(undefined);\n\n    const cleanBasePath = removeInitialAndTrailingSlashes(basePath);\n    const cleanBaseCollectionPath = removeInitialAndTrailingSlashes(baseCollectionPath);\n\n    const homeUrl = cleanBasePath ? `/${cleanBasePath}` : \"/\";\n\n    const fullCollectionPath = cleanBasePath ? `/${cleanBasePath}/${cleanBaseCollectionPath}` : `/${cleanBaseCollectionPath}`;\n\n    const buildCMSUrlPath = useCallback((path: string): string => cleanBasePath ? `/${cleanBasePath}/${encodePath(path)}` : `/${encodePath(path)}`,\n        [cleanBasePath]);\n\n    const buildUrlCollectionPath = useCallback((path: string): string => `${removeInitialAndTrailingSlashes(baseCollectionPath)}/${encodePath(path)}`,\n        [baseCollectionPath]);\n\n    const computeTopNavigation = useCallback((collections: EntityCollection[], views: CMSView[]): TopNavigationResult => {\n        // return (collection.editable && resolvePermissions(collection, authController, paths).editCollection) ?? DEFAULT_PERMISSIONS.editCollection;\n        const navigationEntries: TopNavigationEntry[] = [\n            ...(collections ?? []).map(collection => (!collection.hideFromNavigation\n                ? {\n                    url: buildUrlCollectionPath(collection.alias ?? collection.path),\n                    type: \"collection\",\n                    name: collection.name.trim(),\n                    path: collection.alias ?? collection.path,\n                    collection,\n                    description: collection.description?.trim(),\n                    group: collection.group?.trim()\n                }\n                : undefined))\n                .filter(Boolean) as TopNavigationEntry[],\n            ...(views ?? []).map(view =>\n                !view.hideFromNavigation\n                    ? ({\n                        url: buildCMSUrlPath(Array.isArray(view.path) ? view.path[0] : view.path),\n                        name: view.name.trim(),\n                        type: \"view\",\n                        view,\n                        description: view.description?.trim(),\n                        group: view.group?.trim()\n                    })\n                    : undefined)\n                .filter(Boolean) as TopNavigationEntry[]\n        ];\n\n        const groups: string[] = Object.values(navigationEntries)\n            .map(e => e.group)\n            .filter(Boolean)\n            .filter((value, index, array) => array.indexOf(value) === index) as string[];\n        return { navigationEntries, groups };\n    }, [buildCMSUrlPath, buildUrlCollectionPath]);\n\n    const refreshNavigation = useCallback(async () => {\n\n        try {\n            const [resolvedCollections = [], resolvedViews = []] = await Promise.all([\n                    resolveCollections(baseCollections, authController, dataSource, plugins),\n                    resolveCMSViews(baseViews, authController, dataSource)\n                ]\n            );\n\n            setCollections(resolvedCollections);\n            setViews(resolvedViews);\n            setTopLevelNavigation(computeTopNavigation(resolvedCollections ?? [], resolvedViews));\n        } catch (e) {\n            console.error(e);\n            setNavigationLoadingError(e as any);\n        }\n\n        setNavigationLoading(false);\n        setInitialised(true);\n    }, [baseCollections, authController.user, dataSource, plugins, baseViews, computeTopNavigation]);\n\n    useEffect(() => {\n        refreshNavigation();\n    }, [refreshNavigation]);\n\n    const getCollection = useCallback(<EC extends EntityCollection>(\n        pathOrAlias: string,\n        entityId?: string,\n        includeUserOverride = false\n    ): EC | undefined => {\n\n        if (!collections)\n            return undefined;\n\n        const baseCollection = getCollectionByPathOrAlias(removeInitialAndTrailingSlashes(pathOrAlias), collections);\n\n        const userOverride = includeUserOverride ? userConfigPersistence?.getCollectionConfig(pathOrAlias) : undefined;\n\n        const overriddenCollection = baseCollection ? mergeDeep(baseCollection, userOverride) : undefined;\n\n        let result: Partial<EntityCollection> | undefined = overriddenCollection;\n\n        const resolvedProps: Partial<EntityCollection> | undefined = collectionOverrideHandler && collectionOverrideHandler({\n            entityId,\n            path: removeInitialAndTrailingSlashes(pathOrAlias)\n        });\n\n        if (resolvedProps)\n            result = resolvedProps;\n\n        if (overriddenCollection) {\n            const subcollections = overriddenCollection.subcollections;\n            const callbacks = overriddenCollection.callbacks;\n            const permissions = overriddenCollection.permissions;\n            result = {\n                ...result,\n                subcollections: result?.subcollections ?? subcollections,\n                callbacks: result?.callbacks ?? callbacks,\n                permissions: result?.permissions ?? permissions\n            };\n        }\n\n        if (!result) return undefined;\n\n        return { ...overriddenCollection, ...result } as EC;\n\n    }, [\n        basePath,\n        baseCollectionPath,\n        collections,\n        collectionOverrideHandler\n    ]);\n\n    const isUrlCollectionPath = useCallback(\n        (path: string): boolean => removeInitialAndTrailingSlashes(path + \"/\").startsWith(removeInitialAndTrailingSlashes(fullCollectionPath) + \"/\"),\n        [fullCollectionPath]);\n\n    const urlPathToDataPath = useCallback((path: string): string => {\n        if (path.startsWith(fullCollectionPath))\n            return path.replace(fullCollectionPath, \"\");\n        throw Error(\"Expected path starting with \" + fullCollectionPath);\n    }, [fullCollectionPath]);\n\n    const buildUrlEditCollectionPath = useCallback(({\n                                                        path\n                                                    }: {\n            path: string\n        }): string => {\n            return `s/edit/${encodePath(path)}`;\n        },\n        []);\n\n    const resolveAliasesFrom = useCallback((path: string): string => {\n        if (!collections)\n            throw Error(\"Collections have not been initialised yet\");\n        return resolveCollectionPathAliases(path, collections);\n    }, [collections]);\n\n    const state = location.state as any;\n    /**\n     * The location can be overridden if `base_location` is set in the\n     * state field of the current location. This can happen if you open\n     * a side entity, like `products`, from a different one, like `users`\n     */\n    const baseLocation = state && state.base_location ? state.base_location : location;\n\n    return {\n        collections: collections ?? [],\n        views: views ?? [],\n        loading: !initialised || navigationLoading,\n        navigationLoadingError,\n        homeUrl,\n        basePath,\n        baseCollectionPath,\n        initialised,\n        getCollection,\n        isUrlCollectionPath,\n        urlPathToDataPath,\n        buildUrlCollectionPath,\n        buildUrlEditCollectionPath,\n        buildCMSUrlPath,\n        resolveAliasesFrom,\n        topLevelNavigation,\n        baseLocation,\n        refreshNavigation\n    };\n}\n\nexport function getSidePanelKey(path: string, entityId?: string) {\n    if (entityId)\n        return `${removeInitialAndTrailingSlashes(path)}/${removeInitialAndTrailingSlashes(entityId)}`;\n    else\n        return removeInitialAndTrailingSlashes(path);\n}\n\nfunction encodePath(input: string) {\n    return encodeURIComponent(removeInitialAndTrailingSlashes(input))\n        .replaceAll(\"%2F\", \"/\")\n        .replaceAll(\"%23\", \"#\");\n}\n\nfunction filterOutNotAllowedCollections(resolvedCollections: EntityCollection[], authController: AuthController<User>): EntityCollection[] {\n    return resolvedCollections\n        .filter((c) => {\n            if (!c.permissions) return true;\n            const resolvedPermissions = resolvePermissions(c, authController, [c.path], null,)\n            return resolvedPermissions.read !== false;\n        })\n        .map((c) => {\n            if (!c.subcollections) return c;\n            return {\n                ...c,\n                subcollections: filterOutNotAllowedCollections(c.subcollections, authController)\n            }\n        });\n}\n\nasync function resolveCollections(collections: undefined | EntityCollection[] | EntityCollectionsBuilder, authController: AuthController, dataSource: DataSource, plugins?: FireCMSPlugin[]) {\n    let resolvedCollections: EntityCollection[] = [];\n    if (typeof collections === \"function\") {\n        resolvedCollections = await collections({\n            user: authController.user,\n            authController,\n            dataSource\n        });\n    } else if (Array.isArray(collections)) {\n        resolvedCollections = collections;\n    }\n\n    resolvedCollections = filterOutNotAllowedCollections(resolvedCollections, authController);\n\n    if (plugins) {\n        plugins.forEach((plugin: FireCMSPlugin) => {\n            if (plugin.collections?.injectCollections) {\n                resolvedCollections = plugin.collections?.injectCollections(resolvedCollections ?? []);\n            }\n        });\n    }\n    return resolvedCollections;\n}\n\nasync function resolveCMSViews(baseViews: CMSView[] | CMSViewsBuilder | undefined, authController: AuthController, dataSource: DataSource) {\n    let resolvedViews: CMSView[] = [];\n    if (typeof baseViews === \"function\") {\n        resolvedViews = await baseViews({\n            user: authController.user,\n            authController,\n            dataSource\n        });\n    } else if (Array.isArray(baseViews)) {\n        resolvedViews = baseViews;\n    }\n    return resolvedViews;\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { SideDialogPanelProps, SideDialogsController } from \"../../types\";\nimport equal from \"react-fast-compare\"\n\nexport function useBuildSideDialogsController(): SideDialogsController {\n\n    const location = useLocation();\n    const navigate = useNavigate();\n\n    const [sidePanels, setSidePanels] = useState<SideDialogPanelProps[]>([]);\n    const sidePanelsRef = useRef<SideDialogPanelProps[]>(sidePanels);\n\n    const routesStore = useRef<Record<string, SideDialogPanelProps>>({});\n    const routesCount = useRef<number>(0);\n\n    const updateSidePanels = (newPanels: SideDialogPanelProps[]) => {\n        sidePanelsRef.current = newPanels;\n        setSidePanels(newPanels);\n    };\n\n    useEffect(() => {\n        const state = location.state as any;\n        const panelKeys: string[] = state?.panels ?? [];\n        const newPanels = panelKeys\n            .map(key => routesStore.current[key])\n            .filter(p => Boolean(p)) as SideDialogPanelProps[];\n        if (!equal(sidePanelsRef.current.map(p => p.key), newPanels.map(p => p.key)))\n            updateSidePanels(newPanels);\n    }, [location]);\n\n    const close = useCallback(() => {\n\n        if (sidePanels.length === 0)\n            return;\n\n        const lastSidePanel = sidePanels[sidePanels.length - 1];\n        const updatedPanels = [...sidePanels.slice(0, -1)];\n        updateSidePanels(updatedPanels);\n\n        if (routesCount.current > 0) {\n            if (lastSidePanel.urlPath)\n                navigate(-1);\n            routesCount.current--;\n        } else if (lastSidePanel.parentUrlPath) {\n            const baseLocation = (location.state as any)?.base_location ?? location;\n            navigate(\n                lastSidePanel.parentUrlPath,\n                {\n                    replace: true,\n                    state: {\n                        base_location: baseLocation,\n                        panels: updatedPanels.map(p => p.key)\n                    }\n                }\n            );\n        }\n    }, [sidePanels, navigate, location]);\n\n    const open = useCallback((panelProps: SideDialogPanelProps | SideDialogPanelProps[]) => {\n\n        const newPanels: SideDialogPanelProps[] = Array.isArray(panelProps) ? panelProps : [panelProps];\n\n        newPanels.forEach((panel) => {\n            routesStore.current[panel.key] = panel;\n        });\n        routesCount.current = routesCount.current + newPanels.length;\n\n        const baseLocation = (location.state as any)?.base_location ?? location;\n\n        const updatedPanels = [...sidePanels, ...newPanels];\n        updateSidePanels(updatedPanels);\n\n        newPanels.forEach((panel) => {\n            if (panel.urlPath) {\n                navigate(\n                    panel.urlPath,\n                    {\n                        state: {\n                            base_location: baseLocation,\n                            panels: updatedPanels.map(p => p.key)\n                        }\n                    }\n                );\n            }\n        });\n\n    }, [location, navigate, sidePanels]);\n\n    const replace = useCallback((panelProps: SideDialogPanelProps | SideDialogPanelProps[]) => {\n\n        const newPanels: SideDialogPanelProps[] = Array.isArray(panelProps) ? panelProps : [panelProps];\n        newPanels.forEach((panel) => {\n            routesStore.current[panel.key] = panel;\n        });\n\n        const baseLocation = (location.state as any)?.base_location ?? location;\n\n        const updatedPanels = [...sidePanels.slice(0, -newPanels.length), ...newPanels];\n        updateSidePanels(updatedPanels);\n\n        newPanels.forEach((panel) => {\n            if (panel.urlPath) {\n                navigate(\n                    panel.urlPath,\n                    {\n                        replace: true,\n                        state: {\n                            base_location: baseLocation,\n                            panels: updatedPanels.map(p => p.key)\n                        }\n                    }\n                );\n            }\n        });\n\n    }, [location, navigate, sidePanels]);\n\n    return {\n        sidePanels,\n        close,\n        open,\n        replace\n    };\n}\n","import React from \"react\";\n\nimport { AdapterDateFns } from \"@mui/x-date-pickers/AdapterDateFns\";\nimport { LocalizationProvider } from \"@mui/x-date-pickers/LocalizationProvider\";\nimport DateFnsUtils from \"@date-io/date-fns\";\nimport * as locales from \"date-fns/locale\";\n\nimport { FireCMSContext, FireCMSPlugin, FireCMSProps, User } from \"../types\";\nimport { BreadcrumbsProvider } from \"./contexts/BreacrumbsContext\";\nimport { ModeControllerContext } from \"./contexts/ModeController\";\nimport {\n    useBuildSideEntityController\n} from \"./internal/useBuildSideEntityController\";\nimport {\n    useBuildNavigationContext\n} from \"./internal/useBuildNavigationContext\";\nimport {\n    useBuildSideDialogsController\n} from \"./internal/useBuildSideDialogsController\";\nimport {\n    FireCMSContextInstance,\n    useFireCMSContext,\n    useModeController,\n    useSnackbarController\n} from \"../hooks\";\nimport { CenteredView, ErrorView } from \"./components\";\nimport { StorageSourceContext } from \"./contexts/StorageSourceContext\";\nimport {\n    UserConfigurationPersistenceContext\n} from \"./contexts/UserConfigurationPersistenceContext\";\nimport { DataSourceContext } from \"./contexts/DataSourceContext\";\nimport {\n    SideEntityControllerContext\n} from \"./contexts/SideEntityControllerContext\";\nimport { NavigationContextInstance } from \"./contexts/NavigationContext\";\nimport { AuthControllerContext } from \"./contexts/AuthControllerContext\";\nimport {\n    SideDialogsControllerContext\n} from \"./contexts/SideDialogsControllerContext\";\n\nconst DEFAULT_COLLECTION_PATH = \"/c\";\n\n/**\n * If you are using independent components of the CMS\n * you need to wrap them with this main component, so the internal hooks work.\n *\n * @constructor\n * @category Core\n */\n\nexport function FireCMS<UserType extends User>(props: FireCMSProps<UserType>) {\n\n    const modeController = useModeController();\n    const {\n        children,\n        collections,\n        views,\n        entityLinkBuilder,\n        userConfigPersistence,\n        dateTimeFormat,\n        locale,\n        authController,\n        collectionOverrideHandler,\n        storageSource,\n        dataSource,\n        basePath,\n        baseCollectionPath,\n        plugins,\n        onAnalyticsEvent,\n        fields\n    } = props;\n\n    const usedBasePath = basePath ?? \"/\";\n    const usedBasedCollectionPath = baseCollectionPath ?? DEFAULT_COLLECTION_PATH;\n\n    // @ts-ignore\n    const dateUtilsLocale = locale ? locales[locale] : undefined;\n\n    const navigation = useBuildNavigationContext({\n        basePath: usedBasePath,\n        baseCollectionPath: usedBasedCollectionPath,\n        authController,\n        collections,\n        views,\n        collectionOverrideHandler,\n        userConfigPersistence,\n        dataSource,\n        plugins\n    });\n\n    const sideDialogsController = useBuildSideDialogsController();\n    const sideEntityController = useBuildSideEntityController(navigation, sideDialogsController);\n\n    const loading = authController.initialLoading || navigation.loading || (plugins?.some(p => p.loading) ?? false);\n\n    if (navigation.navigationLoadingError) {\n        return (\n            <CenteredView maxWidth={300} fullScreen={true}>\n                <ErrorView\n                    title={\"Error loading navigation\"}\n                    error={navigation.navigationLoadingError}/>\n            </CenteredView>\n        );\n    }\n\n    if (authController.authError) {\n        return (\n            <CenteredView maxWidth={300} fullScreen={true}>\n                <ErrorView\n                    title={\"Error loading auth\"}\n                    error={authController.authError}/>\n            </CenteredView>\n        );\n    }\n\n    const context: Partial<FireCMSContext> = {\n        entityLinkBuilder,\n        dateTimeFormat,\n        locale,\n        plugins,\n        onAnalyticsEvent,\n        fields\n    };\n\n    return (\n        <ModeControllerContext.Provider value={modeController}>\n            <FireCMSContextInstance.Provider value={context}>\n                <UserConfigurationPersistenceContext.Provider\n                    value={userConfigPersistence}>\n                    <StorageSourceContext.Provider\n                        value={storageSource}>\n                        <DataSourceContext.Provider\n                            value={dataSource}>\n                            <AuthControllerContext.Provider\n                                value={authController}>\n                                <SideDialogsControllerContext.Provider\n                                    value={sideDialogsController}>\n                                    <SideEntityControllerContext.Provider\n                                        value={sideEntityController}>\n                                        <NavigationContextInstance.Provider\n                                            value={navigation}>\n                                            <BreadcrumbsProvider>\n                                                <LocalizationProvider\n                                                    dateAdapter={AdapterDateFns}\n                                                    utils={DateFnsUtils}\n                                                    locale={dateUtilsLocale}>\n                                                    <FireCMSInternal\n                                                        loading={loading}>\n                                                        {children}\n                                                    </FireCMSInternal>\n                                                </LocalizationProvider>\n                                            </BreadcrumbsProvider>\n                                        </NavigationContextInstance.Provider>\n                                    </SideEntityControllerContext.Provider>\n                                </SideDialogsControllerContext.Provider>\n                            </AuthControllerContext.Provider>\n                        </DataSourceContext.Provider>\n                    </StorageSourceContext.Provider>\n                </UserConfigurationPersistenceContext.Provider>\n            </FireCMSContextInstance.Provider>\n        </ModeControllerContext.Provider>\n    );\n}\n\nfunction FireCMSInternal({\n                             loading,\n                             children\n                         }: {\n    loading: boolean;\n    children: (props: {\n        context: FireCMSContext;\n        loading: boolean;\n    }) => React.ReactNode;\n}) {\n\n    const context = useFireCMSContext();\n    let childrenResult = children({\n        context,\n        loading\n    });\n\n    const plugins = context.plugins;\n    if (!loading && plugins) {\n        plugins.forEach((plugin: FireCMSPlugin) => {\n            if (plugin.provider) {\n                childrenResult = (\n                    <plugin.provider.Component {...plugin.provider.props}\n                                               context={context}>\n                        {childrenResult}\n                    </plugin.provider.Component>\n                );\n            }\n        });\n    }\n\n    return <>{childrenResult}</>;\n}\n","import { pink, red } from \"@mui/material/colors\";\nimport { createTheme, Theme } from \"@mui/material\";\nimport type {} from \"@mui/lab/themeAugmentation\";\n\ndeclare module \"@mui/material/styles\" {\n    interface TypographyVariants {\n        label: React.CSSProperties;\n    }\n\n    interface TypographyVariantsOptions {\n        label?: React.CSSProperties;\n    }\n}\n\ndeclare module \"@mui/material/Typography\" {\n    interface TypographyPropsVariantOverrides {\n        label: true;\n    }\n}\n\n/**\n * Use this function to build the default FireCMS MUI5 theme,\n * with some overrides.\n * @category Hooks and utilities\n */\nexport const createCMSDefaultTheme = (\n    { mode, primaryColor, secondaryColor, fontFamily, headersFontFamily }: {\n        mode: \"light\" | \"dark\";\n        primaryColor?: string;\n        secondaryColor?: string;\n        fontFamily?: string;\n        headersFontFamily?: string;\n    }): Theme => {\n\n    const radius = 6;\n\n    const { palette } = createTheme();\n    const { augmentColor } = palette;\n    const createColor = (mainColor: string) => augmentColor({ color: { main: mainColor } });\n\n    const original = createTheme({\n        palette: {\n            mode,\n            background: {\n                default: mode === \"dark\" ? \"#202024\" : \"#f8f8fa\",\n                paper: mode === \"dark\" ? \"#121215\" : \"#ffffff\"\n            },\n            primary: {\n                main: primaryColor || \"#0070f4\"\n            },\n            secondary: {\n                main: secondaryColor || pink[\"400\"]\n            },\n            error: {\n                main: red.A400\n            }\n        },\n        shape: {\n            borderRadius: radius\n        },\n        typography: {\n            fontFamily: fontFamily || \"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\n            fontWeightMedium: 500,\n            h6: {\n                fontFamily: fontFamily || \"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\n                fontSize: \"1.15rem\",\n                fontWeight: 500\n            },\n            h5: {\n                fontFamily: fontFamily || \"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\n                fontSize: \"1.55rem\"\n            },\n            h4: {\n                fontFamily: fontFamily || \"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\n                fontSize: \"2rem\",\n                fontWeight: 500\n            },\n            h3: {\n                fontFamily: fontFamily || \"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\n                fontWeight: 600\n            },\n            h2: {\n                fontFamily: headersFontFamily || \"'IBM Plex Mono', 'Space Mono', 'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\n                fontWeight: 600\n            },\n            h1: {\n                fontFamily: headersFontFamily || \"'IBM Plex Mono', 'Space Mono', 'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\n                fontWeight: 600\n            },\n            label: {\n                display: \"block\",\n                color: \"#838383\",\n                fontWeight: 500,\n                fontSize: \"0.875rem\",\n                lineHeight: 1.43\n            }\n        },\n        components: {\n            MuiSkeleton: {\n                styleOverrides: {\n                    root: {\n                        borderRadius: radius\n                    }\n                }\n            },\n            MuiButton: {\n                styleOverrides: {\n                    root: {\n                        borderRadius: radius\n                    }\n                }\n            },\n            MuiLoadingButton: {\n                styleOverrides: {\n                    root: {\n                        borderRadius: radius\n                    }\n                }\n            },\n            MuiTableRow: {\n                styleOverrides: {\n                    root: {\n                        \"&:last-child td\": {\n                            borderBottom: 0\n                        }\n                    }\n                }\n            },\n            MuiTypography: {\n                styleOverrides: {\n                    root: {\n                        \"&.mono\": {\n                            fontFamily: \"'IBM Plex Mono', 'Space Mono', monospace, 'Lucida Console'\"\n                        },\n                        \"&.weight-500\": {\n                            fontWeight: 500\n                        }\n                    }\n                }\n            },\n            MuiInputBase: {\n                styleOverrides: {\n                    root: {\n                        \"&.mono\": {\n                            fontFamily: \"'IBM Plex Mono', 'Space Mono', 'Lucida Console', monospace\"\n                        },\n                        \"& input::-webkit-outer-spin-button, & input::-webkit-inner-spin-button\": {\n                            display: \"none\"\n                        },\n                        \"& input[type=number]\": {\n                            MozAppearance: \"textfield\"\n                        }\n                    }\n                }\n            },\n            MuiDialog: {\n                styleOverrides: {\n                    paper: {\n                        backgroundImage: \"inherit\",\n                    }\n                }\n            },\n            // MuiPaper: {\n            //     styleOverrides: {\n            //         outlined: {\n            //             border: \"none\",\n            //         }\n            //     }\n            // },\n            MuiCardActionArea: {\n                styleOverrides: {\n                    root: {\n                        borderRadius: radius\n                    }\n                }\n            }\n        }\n    });\n\n    return {\n        ...original,\n        // @ts-ignore\n        shadows: original.shadows.map((shadow, index) => {\n            if (index === 3) {\n                return \"0px 0px 0px 0px rgba(0,0,0,0.18), 0px 0px 10px 0px rgba(0,0,0,0.12), 0px 0px 14px 2px rgba(0,0,0,0.10)\"\n            }\n            return shadow;\n        })\n    };\n};\n","import React, { PropsWithChildren } from \"react\";\n\nimport { Route, Routes, useLocation } from \"react-router-dom\";\nimport { CMSView } from \"../types\";\nimport {\n    EntityCollectionView,\n    FireCMSHomePage,\n    NotFoundPage\n} from \"./components\";\nimport {\n    useBreadcrumbsContext,\n    useFireCMSContext,\n    useNavigationContext\n} from \"../hooks\";\nimport { toArray } from \"./util/arrays\";\nimport equal from \"react-fast-compare\"\n\n/**\n * @category Components\n */\nexport type NavigationRoutesProps = {\n    /**\n     * In case you need to override the home page\n     */\n    HomePage?: React.ComponentType;\n\n    customRoutes?: React.ReactNode[]\n\n};\n\n/**\n * This component is in charge of rendering\n * all the related routes (entity collection root views, custom views\n * or the home route) related to a {@link NavigationContext}.\n * This component needs a parent {@link FireCMS}\n *\n * @constructor\n * @category Components\n */\n\nexport const NavigationRoutes = React.memo<NavigationRoutesProps>(\n    function NavigationRoutes({\n                                  HomePage = FireCMSHomePage,\n                                  customRoutes\n                              }: NavigationRoutesProps) {\n\n        const location = useLocation();\n        const navigation = useNavigationContext();\n\n        const context = useFireCMSContext();\n        const plugins = context.plugins ?? [];\n\n        if (!navigation)\n            return <></>;\n\n        const state = location.state as any;\n\n        /**\n         * The location can be overridden if `base_location` is set in the\n         * state field of the current location. This can happen if you open\n         * a side entity, like `products`, from a different one, like `users`\n         */\n        const baseLocation = state && state.base_location ? state.base_location : location;\n\n        const cmsViews: React.ReactNode[] = [];\n        if (navigation.views) {\n            navigation.views.forEach((cmsView) => {\n                if (Array.isArray(cmsView.path))\n                    cmsViews.push(...cmsView.path.map(path => buildCMSViewRoute(path, cmsView)));\n                else\n                    cmsViews.push(buildCMSViewRoute(cmsView.path, cmsView));\n            });\n        }\n\n        // we reorder collections so that nested paths are included first\n        const sortedCollections = [...(navigation.collections ?? [])]\n            .sort((a, b) => b.path.length - a.path.length);\n\n        const collectionRoutes = sortedCollections\n            .map((collection) => {\n                    const urlPath = navigation.buildUrlCollectionPath(collection.alias ?? collection.path);\n                    const allActions:React.ComponentType<any>[] = [];\n                    if (plugins) {\n                        plugins.forEach(plugin => {\n                            if (plugin.collections?.CollectionActions) {\n                                allActions.push(...toArray(plugin.collections?.CollectionActions));\n                            }\n                        });\n                    }\n                    allActions.push(...toArray(collection.Actions));\n                    return <Route path={urlPath + \"/*\"}\n                                  key={`navigation_${collection.alias ?? collection.path}`}\n                                  element={\n                                      <RouteWrapper\n                                          path={urlPath}\n                                          title={collection.name}\n                                          type={\"collection\"}>\n                                          <EntityCollectionView\n                                              key={`collection_view_${collection.alias ?? collection.path}`}\n                                              isSubCollection={false}\n                                              fullPath={collection.alias ?? collection.path}\n                                              {...collection}\n                                              Actions={allActions}/>\n                                      </RouteWrapper>\n                                  }/>;\n                }\n            );\n\n        const homeRoute = (\n            <Route path={\"/\"}\n                   element={\n                       <RouteWrapper\n                           path={navigation.homeUrl}\n                           key={\"navigation_home\"}\n                           title={\"Home\"}\n                           type={\"home\"}>\n                           <HomePage/>\n                       </RouteWrapper>\n                   }/>\n        );\n\n        const notFoundRoute = <Route path={\"*\"}\n                                     element={\n                                         <NotFoundPage/>\n                                     }/>;\n\n        return (\n            <Routes location={baseLocation}>\n\n                {collectionRoutes}\n\n                {cmsViews}\n\n                {homeRoute}\n\n                {notFoundRoute}\n\n                {customRoutes}\n\n            </Routes>\n        );\n    });\n\nconst buildCMSViewRoute = (path: string, cmsView: CMSView) => {\n    return <Route\n        key={\"navigation_view_\" + path}\n        path={path}\n        element={\n            <RouteWrapper\n                path={path}\n                key={`navigation_${path}`}\n                title={cmsView.name}\n                type={\"view\"}>\n                {cmsView.view}\n            </RouteWrapper>}\n    />;\n};\n\ninterface RouteWrapperProps {\n    title: string;\n    path: string;\n    type: \"collection\" | \"view\" | \"home\";\n}\n\n/**\n * This component updates the breadcrumb in the app bar when rendered\n * @param children\n * @param title\n * @param path\n * @param type\n * @constructor\n * @category Components\n */\n\nexport const RouteWrapper = React.memo<PropsWithChildren<RouteWrapperProps>>(\n    function RouteWrapper({\n                              children,\n                              title,\n                              path,\n                              type\n                          }\n                              : PropsWithChildren<RouteWrapperProps>) {\n\n        const breadcrumbsContext = useBreadcrumbsContext();\n\n        React.useEffect(() => {\n            breadcrumbsContext.set({\n                breadcrumbs: [{\n                    title,\n                    url: path\n                }]\n            });\n        }, [path, title]);\n\n        return <>{children}</>;\n    }, equal);\n","import {\n    AdditionalFieldDelegate,\n    ArrayProperty,\n    BooleanProperty,\n    CMSType,\n    DateProperty,\n    EntityCallbacks,\n    EntityCollection,\n    EnumValueConfig,\n    EnumValues,\n    FieldConfig,\n    GeopointProperty,\n    MapProperty,\n    NumberProperty,\n    PropertiesOrBuilders,\n    PropertyBuilder,\n    PropertyOrBuilder,\n    ReferenceProperty,\n    StringProperty,\n    User\n} from \"../types\";\n\n/**\n * Identity function we use to defeat the type system of Typescript and build\n * collection views with all its properties\n * @param collection\n * @category Builder\n */\nexport function buildCollection<M extends Record<string, any> = any,\n    AdditionalKey extends string = string,\n    UserType extends User = User>(\n    collection: EntityCollection<M, AdditionalKey, UserType>\n): EntityCollection<M, AdditionalKey, UserType> {\n    return collection;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and preserve\n * the property keys.\n * @param property\n * @category Builder\n */\nexport function buildProperty<T extends CMSType = CMSType, P extends PropertyOrBuilder<T> = PropertyOrBuilder<T>, M extends Record<string, any> = Record<string, any>>(\n    property: P\n):\n    P extends StringProperty ? StringProperty :\n        P extends NumberProperty ? NumberProperty :\n            P extends BooleanProperty ? BooleanProperty :\n                P extends DateProperty ? DateProperty :\n                    P extends GeopointProperty ? GeopointProperty :\n                        P extends ReferenceProperty ? ReferenceProperty :\n                            P extends ArrayProperty ? ArrayProperty :\n                                P extends MapProperty ? MapProperty :\n                                    P extends PropertyBuilder<T, M> ? PropertyBuilder<T, M> : never {\n    return property as any;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and preserve\n * the properties keys.\n * @param properties\n * @category Builder\n */\nexport function buildProperties<M extends Record<string, any>>(\n    properties: PropertiesOrBuilders<M>\n): PropertiesOrBuilders<M> {\n    return properties;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and preserve\n * the properties keys.\n * @param propertiesOrBuilder\n * @category Builder\n */\nexport function buildPropertiesOrBuilder<M extends Record<string, any>>(\n    propertiesOrBuilder: PropertiesOrBuilders<M>\n): PropertiesOrBuilders<M> {\n    return propertiesOrBuilder;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and preserve\n * the properties keys.\n * @param enumValues\n * @category Builder\n */\nexport function buildEnumValues(\n    enumValues: EnumValues\n): EnumValues {\n    return enumValues;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and preserve\n * the properties keys.\n * @param enumValueConfig\n * @category Builder\n */\nexport function buildEnumValueConfig(\n    enumValueConfig: EnumValueConfig\n): EnumValueConfig {\n    return enumValueConfig;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and preserve\n * the properties keys.\n * @param callbacks\n * @category Builder\n */\nexport function buildEntityCallbacks<M extends Record<string, any> = any>(\n    callbacks: EntityCallbacks<M>\n): EntityCallbacks<M> {\n    return callbacks;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and build\n * additional field delegates views with all its properties\n * @param additionalFieldDelegate\n * @category Builder\n */\nexport function buildAdditionalFieldDelegate<M extends Record<string, any>, AdditionalKey extends string = string, UserType extends User = User>(\n    additionalFieldDelegate: AdditionalFieldDelegate<M, AdditionalKey, UserType>\n): AdditionalFieldDelegate<M, AdditionalKey, UserType> {\n    return additionalFieldDelegate;\n}\n\n/**\n * Identity function we use to defeat the type system of Typescript and build\n * additional field delegates views with all its properties\n * @param fieldConfig\n * @category Builder\n */\nexport function buildFieldConfig<T extends CMSType = CMSType>(\n    fieldConfig: FieldConfig<T>\n): FieldConfig<T> {\n    return fieldConfig;\n}\n","import { useMediaQuery } from \"@mui/material\";\nimport React, { useCallback, useEffect, useState } from \"react\";\n\nimport { ModeController } from \"../hooks/useModeController\";\n\n/**\n * Use this hook to build a color mode controller that determines\n * the theme of the CMS\n */\nexport function useBuildModeController(): ModeController {\n\n    const prefersDarkModeQuery = useMediaQuery(\"(prefers-color-scheme: dark)\");\n    const prefersDarkModeStorage: boolean | null = localStorage.getItem(\"prefers-dark-mode\") != null ? localStorage.getItem(\"prefers-dark-mode\") === \"true\" : null;\n    const prefersDarkMode = prefersDarkModeStorage ?? prefersDarkModeQuery;\n    const [mode, setMode] = useState<\"light\" | \"dark\">(prefersDarkMode ? \"dark\" : \"light\");\n\n    useEffect(() => {\n        setMode(prefersDarkMode ? \"dark\" : \"light\");\n        setDocumentMode(prefersDarkMode ? \"dark\" : \"light\");\n    }, [prefersDarkMode]);\n\n    // color-scheme: dark;\n    const setDarkMode = useCallback(() => {\n        setMode(\"dark\");\n        setDocumentMode(\"dark\");\n    }, [prefersDarkModeQuery]);\n\n    const setLightMode = useCallback(() => {\n        setMode(\"light\");\n        setDocumentMode(\"light\");\n    }, []);\n\n    const setDocumentMode = useCallback((mode: \"light\" | \"dark\") => {\n        document.body.style.setProperty(\"color-scheme\", mode);\n    }, [document]);\n\n    const toggleMode = useCallback(() => {\n\n        if (mode === \"light\") {\n            if (!prefersDarkModeQuery)\n                localStorage.setItem(\"prefers-dark-mode\", \"true\");\n            else\n                localStorage.removeItem(\"prefers-dark-mode\");\n            setDarkMode();\n        } else {\n            if (prefersDarkModeQuery)\n                localStorage.setItem(\"prefers-dark-mode\", \"false\");\n            else\n                localStorage.removeItem(\"prefers-dark-mode\");\n            setLightMode();\n        }\n    }, [mode, prefersDarkModeQuery]);\n\n    return {\n        mode,\n        setMode,\n        toggleMode\n    };\n}\n","import { useCallback, useEffect, useState } from \"react\";\nimport {\n    PartialEntityCollection,\n    UserConfigurationPersistence\n} from \"../types\";\nimport { mergeDeep, stripCollectionPath } from \"./util\";\n\nexport function useBuildLocalConfigurationPersistence(): UserConfigurationPersistence {\n\n    const [configCache, setConfigCache] = useState<Record<string, PartialEntityCollection>>({});\n\n    const getCollectionFromStorage = useCallback((storageKey: string) => {\n        const item = localStorage.getItem(storageKey);\n        return item ? JSON.parse(item) : {};\n    }, []);\n\n    const getCollectionConfig = useCallback(<M extends Record<string, any>>(path: string): PartialEntityCollection<M> => {\n        const storageKey = `collection_config::${stripCollectionPath(path)}`;\n        if (configCache[storageKey]) {\n            return configCache[storageKey] as PartialEntityCollection<M>;\n        }\n        return getCollectionFromStorage(storageKey);\n    }, [configCache, getCollectionFromStorage]);\n\n    const onCollectionModified = useCallback(<M extends Record<string, any>>(path: string, data: PartialEntityCollection<M>) => {\n        const storageKey = `collection_config::${stripCollectionPath(path)}`;\n        localStorage.setItem(storageKey, JSON.stringify(data));\n        setConfigCache((currentCache) => {\n            const cachedConfig = currentCache[storageKey];\n            const newConfig = mergeDeep(cachedConfig ?? getCollectionFromStorage(path), data);\n            return (mergeDeep(currentCache, newConfig));\n        });\n    }, [getCollectionFromStorage]);\n\n    const [recentlyVisitedPaths, _setRecentlyVisitedPaths] = useState<string[]>([]);\n    const [favouritePaths, _setFavouritePaths] = useState<string[]>([]);\n    const [collapsedGroups, _setCollapsedGroups] = useState<string[]>([]);\n\n    useEffect(() => {\n        _setRecentlyVisitedPaths(localStorage.getItem(\"recently_visited_paths\") ? JSON.parse(localStorage.getItem(\"recently_visited_paths\")!) : []);\n        _setFavouritePaths(localStorage.getItem(\"favourite_paths\") ? JSON.parse(localStorage.getItem(\"favourite_paths\")!) : []);\n        _setCollapsedGroups(localStorage.getItem(\"collapsed_groups\") ? JSON.parse(localStorage.getItem(\"collapsed_groups\")!) : []);\n    }, []);\n\n    const setRecentlyVisitedPaths = useCallback((paths: string[]) => {\n        localStorage.setItem(\"recently_visited_paths\", JSON.stringify(paths));\n        _setRecentlyVisitedPaths(paths);\n    }, []);\n\n    const setFavouritePaths = useCallback((paths: string[]) => {\n        localStorage.setItem(\"favourite_paths\", JSON.stringify(paths));\n        _setFavouritePaths(paths);\n    }, []);\n\n    const setCollapsedGroups = useCallback((paths: string[]) => {\n        localStorage.setItem(\"collapsed_groups\", JSON.stringify(paths));\n        _setCollapsedGroups(paths);\n    }, []);\n\n    return {\n        onCollectionModified,\n        getCollectionConfig,\n        recentlyVisitedPaths,\n        setRecentlyVisitedPaths,\n        favouritePaths,\n        setFavouritePaths,\n        collapsedGroups,\n        setCollapsedGroups\n    }\n}\n","import React, { PropsWithChildren } from \"react\";\nimport { SnackbarProvider as NotistackSnackbarProvider } from \"notistack\";\n\nexport const SnackbarProvider: React.FC<PropsWithChildren<{maxSnack?: number, autoHideDuration?: number }>> = ({ children, maxSnack = 3, autoHideDuration = 3500 }) => {\n\n    return (\n        <NotistackSnackbarProvider maxSnack={maxSnack}\n                                   autoHideDuration={autoHideDuration}>\n            {children}\n        </NotistackSnackbarProvider>\n    );\n};\n","import { useCallback, useEffect, useState } from \"react\";\n\nimport {\n    ApplicationVerifier,\n    Auth,\n    ConfirmationResult,\n    createUserWithEmailAndPassword as createUserWithEmailAndPasswordFirebase,\n    FacebookAuthProvider,\n    fetchSignInMethodsForEmail as fetchSignInMethodsForEmailFirebase,\n    getAuth,\n    GithubAuthProvider,\n    GoogleAuthProvider,\n    OAuthProvider,\n    onAuthStateChanged,\n    signInAnonymously,\n    signInWithEmailAndPassword,\n    signInWithPhoneNumber,\n    signInWithPopup,\n    signOut,\n    TwitterAuthProvider,\n    User as FirebaseUser\n} from \"firebase/auth\";\nimport { FirebaseApp } from \"firebase/app\";\nimport { AuthController } from \"../../types\";\nimport {\n    FirebaseAuthController,\n    FirebaseSignInOption,\n    FirebaseSignInProvider\n} from \"../types/auth\";\n\ninterface FirebaseAuthHandlerProps {\n    firebaseApp?: FirebaseApp;\n    signInOptions: Array<FirebaseSignInProvider | FirebaseSignInOption>;\n}\n\n/**\n * Use this hook to build an {@link AuthController} based on Firebase Auth\n * @category Firebase\n */\nexport const useFirebaseAuthController = (\n    {\n        firebaseApp,\n        signInOptions\n    }: FirebaseAuthHandlerProps): FirebaseAuthController => {\n\n    const [loggedUser, setLoggedUser] = useState<FirebaseUser | null | undefined>(undefined); // logged user, anonymous or logged out\n    const [authError, setAuthError] = useState<any>();\n    const [authProviderError, setAuthProviderError] = useState<any>();\n    const [initialLoading, setInitialLoading] = useState(true);\n    const [authLoading, setAuthLoading] = useState(true);\n    const [loginSkipped, setLoginSkipped] = useState<boolean>(false);\n    const [confirmationResult, setConfirmationResult] = useState<undefined | ConfirmationResult>();\n\n    const [extra, setExtra] = useState<any>();\n\n    useEffect(() => {\n        if (!firebaseApp) return;\n        try {\n            const auth = getAuth(firebaseApp);\n            setAuthError(undefined);\n            setLoggedUser(auth.currentUser)\n            return onAuthStateChanged(\n                auth,\n                updateFirebaseUser,\n                error => setAuthProviderError(error)\n            );\n        } catch (e) {\n            setAuthError(e);\n            return () => {\n            };\n        }\n    }, [firebaseApp]);\n\n    const skipLogin = useCallback(() => {\n        setLoginSkipped(true);\n        setLoggedUser(null);\n    }, []);\n\n    const updateFirebaseUser = useCallback(async (firebaseUser: FirebaseUser | null) => {\n        setLoggedUser(firebaseUser);\n        setInitialLoading(false);\n        setAuthLoading(false);\n    }, []);\n\n    const onSignOut = useCallback(() => {\n        const auth = getAuth(firebaseApp);\n        signOut(auth)\n            .then(_ => {\n                setLoggedUser(null);\n                setAuthProviderError(null);\n            });\n        setLoginSkipped(false);\n    }, [firebaseApp]);\n\n    const getProviderOptions = useCallback((providerId: FirebaseSignInProvider): FirebaseSignInOption | undefined => {\n        return signInOptions.find((option) => {\n            if (option === null) throw Error(\"useFirebaseAuthController\");\n            if (typeof option === \"object\" && option.provider === providerId)\n                return option as FirebaseSignInOption;\n            return undefined;\n        }) as FirebaseSignInOption | undefined;\n    }, [signInOptions]);\n\n    const googleLogin = useCallback(() => {\n        const provider = new GoogleAuthProvider();\n        const options = getProviderOptions(\"google.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = getAuth();\n        signInWithPopup(auth, provider).catch(setAuthProviderError);\n    }, [getProviderOptions]);\n\n    const doOauthLogin = useCallback((auth: Auth, provider: OAuthProvider | FacebookAuthProvider | GithubAuthProvider | TwitterAuthProvider) => {\n        setAuthLoading(true);\n        signInWithPopup(auth, provider)\n            .catch(setAuthProviderError).then(() => setAuthLoading(false));\n    }, []);\n\n    const anonymousLogin = useCallback(() => {\n        const auth = getAuth();\n        setAuthLoading(true);\n        signInAnonymously(auth)\n            .catch(setAuthProviderError)\n            .then(() => setAuthLoading(false));\n    }, []);\n\n    const phoneLogin = useCallback((phone: string, applicationVerifier: ApplicationVerifier) => {\n        const auth = getAuth();\n        setAuthLoading(true);\n        return signInWithPhoneNumber(auth, phone, applicationVerifier)\n            .catch(setAuthProviderError)\n            .then((res) => {\n                setAuthLoading(false);\n                setConfirmationResult(res ?? undefined);\n            });\n    }, []);\n\n    const appleLogin = useCallback(() => {\n        const provider = new OAuthProvider(\"apple.com\");\n        const options = getProviderOptions(\"apple.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = getAuth();\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const facebookLogin = useCallback(() => {\n        const provider = new FacebookAuthProvider();\n        const options = getProviderOptions(\"facebook.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = getAuth();\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const githubLogin = useCallback(() => {\n        const provider = new GithubAuthProvider();\n        const options = getProviderOptions(\"github.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = getAuth();\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const microsoftLogin = useCallback(() => {\n        const provider = new OAuthProvider(\"microsoft.com\");\n        const options = getProviderOptions(\"microsoft.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = getAuth();\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const twitterLogin = useCallback(() => {\n        const provider = new TwitterAuthProvider();\n        const options = getProviderOptions(\"twitter.com\");\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = getAuth();\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const emailPasswordLogin = useCallback((email: string, password: string) => {\n        const auth = getAuth();\n        setAuthLoading(true);\n        signInWithEmailAndPassword(auth, email, password)\n            .catch(setAuthProviderError)\n            .then(() => setAuthLoading(false));\n    }, []);\n\n    const createUserWithEmailAndPassword = useCallback((email: string, password: string) => {\n        const auth = getAuth();\n        setAuthLoading(true);\n        createUserWithEmailAndPasswordFirebase(auth, email, password)\n            .catch(setAuthProviderError)\n            .then(() => setAuthLoading(false));\n    }, []);\n\n    const fetchSignInMethodsForEmail = useCallback((email: string): Promise<string[]> => {\n        const auth = getAuth();\n        setAuthLoading(true);\n        return fetchSignInMethodsForEmailFirebase(auth, email)\n            .then((res) => {\n                setAuthLoading(false);\n                return res;\n            });\n    }, []);\n\n    const getAuthToken = useCallback(async (): Promise<string> => {\n        if (!loggedUser)\n            throw Error(\"User is not logged in\");\n        return loggedUser.getIdToken();\n    }, [loggedUser]);\n\n    return {\n        user: loggedUser ?? null,\n        authError,\n        authProviderError,\n        authLoading,\n        initialLoading,\n        getAuthToken,\n        confirmationResult,\n        signOut: onSignOut,\n        loginSkipped,\n        skipLogin,\n        googleLogin,\n        anonymousLogin,\n        appleLogin,\n        facebookLogin,\n        githubLogin,\n        microsoftLogin,\n        twitterLogin,\n        emailPasswordLogin,\n        phoneLogin,\n        fetchSignInMethodsForEmail,\n        createUserWithEmailAndPassword,\n        extra,\n        setExtra\n    };\n};\n","import { Timestamp } from \"firebase/firestore\";\n\nexport function setDateToMidnight(input?: Timestamp): Timestamp | undefined {\n    if (!input) return input;\n    const date = input.toDate();\n    date.setHours(0, 0, 0, 0);\n    return Timestamp.fromDate(date);\n}\n","import {\n    DataSource,\n    DeleteEntityProps,\n    Entity,\n    EntityCollection,\n    EntityReference,\n    EntityValues,\n    FetchCollectionProps,\n    FetchEntityProps,\n    FieldConfig,\n    FilterValues,\n    GeoPoint,\n    ListenCollectionProps,\n    ListenEntityProps,\n    ResolvedEntityCollection,\n    ResolvedProperties,\n    ResolvedProperty,\n    SaveEntityProps,\n    WhereFilterOp\n} from \"../../types\";\nimport {\n    resolveCollection,\n    sanitizeData,\n    updateDateAutoValues\n} from \"../../core\";\nimport {\n    collection as collectionClause,\n    CollectionReference,\n    deleteDoc,\n    doc,\n    DocumentReference,\n    DocumentSnapshot,\n    Firestore,\n    GeoPoint as FirestoreGeoPoint,\n    getCountFromServer,\n    getDoc,\n    getDocs,\n    getFirestore,\n    limit as limitClause,\n    onSnapshot,\n    orderBy as orderByClause,\n    Query,\n    query,\n    QueryConstraint,\n    serverTimestamp,\n    setDoc,\n    startAfter as startAfterClause,\n    Timestamp,\n    where as whereClause\n} from \"firebase/firestore\";\nimport { FirebaseApp } from \"firebase/app\";\nimport { FirestoreTextSearchController } from \"../types/text_search\";\nimport { useCallback } from \"react\";\nimport { setDateToMidnight } from \"../util/dates\";\n\n/**\n * @category Firebase\n */\nexport interface FirestoreDataSourceProps {\n    firebaseApp?: FirebaseApp,\n    textSearchController?: FirestoreTextSearchController,\n    fields?: Record<string, FieldConfig>;\n}\n\n/**\n * Use this hook to build a {@link DataSource} based on Firestore\n * @param firebaseApp\n * @param textSearchController\n * @param collectionRegistry\n * @category Firebase\n */\nexport function useFirestoreDataSource({\n                                           firebaseApp,\n                                           textSearchController,\n                                           fields\n                                       }: FirestoreDataSourceProps): DataSource {\n\n    const createEntityFromCollection = useCallback(<M extends Record<string, any>>(\n        docSnap: DocumentSnapshot,\n        path: string,\n        resolvedCollection: ResolvedEntityCollection<M>\n    ): Entity<M> => {\n\n        const values = firestoreToCMSModel(docSnap.data());\n        const data = docSnap.data()\n            ? resolvedCollection.properties\n                ? sanitizeData(values as EntityValues<M>, resolvedCollection.properties)\n                : docSnap.data()\n            : undefined;\n        return {\n            id: docSnap.id,\n            path: getCMSPathFromFirestorePath(docSnap.ref.path),\n            values: data\n        };\n    }, []);\n\n    const buildQuery = useCallback(<M>(path: string, filter: FilterValues<Extract<keyof M, string>> | undefined, orderBy: string | undefined, order: \"desc\" | \"asc\" | undefined, startAfter: any[] | undefined, limit: number | undefined) => {\n\n        if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n\n        const firestore = getFirestore(firebaseApp);\n        const collectionReference: Query = collectionClause(firestore, path);\n\n        const queryParams: QueryConstraint[] = [];\n        if (filter) {\n            Object.entries(filter)\n                .filter(([_, entry]) => !!entry)\n                .forEach(([key, filterParameter]) => {\n                    const [op, value] = filterParameter as [WhereFilterOp, any];\n                    queryParams.push(whereClause(key, op, cmsToFirestoreModel(value, firestore)));\n                });\n        }\n\n        if (orderBy && order) {\n            queryParams.push(orderByClause(orderBy, order));\n        }\n\n        if (startAfter) {\n            queryParams.push(startAfterClause(startAfter));\n        }\n\n        if (limit) {\n            queryParams.push(limitClause(limit));\n        }\n\n        return query(collectionReference, ...queryParams);\n    }, [firebaseApp]);\n\n    const getAndBuildEntity = useCallback(<M extends Record<string, any>>(path: string,\n                                                                          entityId: string,\n                                                                          collection: EntityCollection<M> | ResolvedEntityCollection<M>): Promise<Entity<M> | undefined> => {\n        if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n\n        const firestore = getFirestore(firebaseApp);\n\n        return getDoc(doc(firestore, path, entityId))\n            .then((docSnapshot) => {\n                if (!docSnapshot.exists()) {\n                    return undefined;\n                }\n                const resolvedCollection = resolveCollection<M>({\n                    collection,\n                    path,\n                    entityId: docSnapshot.id,\n                    values: firestoreToCMSModel(docSnapshot.data()),\n                    fields\n                });\n                return createEntityFromCollection(docSnapshot, path, resolvedCollection);\n            });\n    }, [firebaseApp]);\n\n    const performTextSearch = useCallback(async <M extends Record<string, any>>(path: string,\n                                                                                searchString: string,\n                                                                                collection: EntityCollection<M> | ResolvedEntityCollection<M>): Promise<Entity<M>[]> => {\n        if (!textSearchController)\n            throw Error(\"Trying to make text search without specifying a FirestoreTextSearchController\");\n        const ids = await textSearchController({\n            path,\n            searchString\n        });\n        if (ids === undefined)\n            throw Error(\"The current path is not supported by the specified FirestoreTextSearchController\");\n        const promises: Promise<Entity<M> | undefined>[] = ids\n            .map(async (entityId) => {\n                    try {\n                        return await getAndBuildEntity(path, entityId, collection);\n                    } catch (e) {\n                        console.error(e);\n                        return undefined;\n                    }\n                }\n            );\n        return Promise.all(promises)\n            .then((res) => res.filter((e) => e !== undefined && e.values) as Entity<M>[]);\n    }, [getAndBuildEntity]);\n\n    return {\n\n        /**\n         * Fetch entities in a Firestore path\n         * @param path\n         * @param collection\n         * @param filter\n         * @param limit\n         * @param startAfter\n         * @param searchString\n         * @param orderBy\n         * @param order\n         * @return Function to cancel subscription\n         * @see useCollectionFetch if you need this functionality implemented as a hook\n         * @category Firestore\n         */\n        fetchCollection: useCallback(<M extends Record<string, any>>({\n                                                                         path,\n                                                                         collection,\n                                                                         filter,\n                                                                         limit,\n                                                                         startAfter,\n                                                                         searchString,\n                                                                         orderBy,\n                                                                         order\n                                                                     }: FetchCollectionProps<M>\n        ): Promise<Entity<M>[]> => {\n\n            if (searchString) {\n                return performTextSearch(path, searchString, collection);\n            }\n\n            console.debug(\"Fetching collection\", path, limit, filter, startAfter, orderBy, order);\n            const query = buildQuery(path, filter, orderBy, order, startAfter, limit);\n\n            return getDocs(query)\n                .then((snapshot) =>\n                    snapshot.docs.map((doc) => {\n                        const resolvedCollection = resolveCollection<M>({\n                            collection,\n                            path,\n                            values: firestoreToCMSModel(doc.data()),\n                            fields\n                        });\n                        return createEntityFromCollection(doc, path, resolvedCollection);\n                    }));\n        }, [buildQuery, performTextSearch]),\n\n        /**\n         * Listen to a entities in a given path\n         * @param path\n         * @param collection\n         * @param onError\n         * @param filter\n         * @param limit\n         * @param startAfter\n         * @param searchString\n         * @param orderBy\n         * @param order\n         * @param onUpdate\n         * @return Function to cancel subscription\n         * @see useCollectionFetch if you need this functionality implemented as a hook\n         * @category Firestore\n         */\n        listenCollection: useCallback(<M extends Record<string, any>>(\n            {\n                path,\n                collection,\n                filter,\n                limit,\n                startAfter,\n                searchString,\n                orderBy,\n                order,\n                onUpdate,\n                onError\n            }: ListenCollectionProps<M>\n        ): () => void => {\n\n            console.debug(\"Listening collection\", {\n                path,\n                limit,\n                filter,\n                startAfter,\n                orderBy,\n                order\n            });\n\n            const query = buildQuery(path, filter, orderBy, order, startAfter, limit);\n\n            if (searchString) {\n                performTextSearch<M>(path, searchString, collection)\n                    .then(onUpdate)\n                    .catch((e) => {\n                        if (onError) onError(e);\n                    });\n                // eslint-disable-next-line @typescript-eslint/no-empty-function\n                return () => {\n                };\n            }\n\n            const resolvedCollection = resolveCollection<M>({\n                collection,\n                path,\n                fields\n            });\n\n            return onSnapshot(query,\n                {\n                    next: (snapshot) => {\n                        onUpdate(snapshot.docs.map((doc) => createEntityFromCollection(doc, path, resolvedCollection)));\n                    },\n                    error: onError\n                }\n            );\n        }, [buildQuery, performTextSearch]),\n\n        /**\n         * Retrieve an entity given a path and a collection\n         * @param path\n         * @param entityId\n         * @param collection\n         * @category Firestore\n         */\n        fetchEntity: useCallback(<M extends Record<string, any>>({\n                                                                     path,\n                                                                     entityId,\n                                                                     collection\n                                                                 }: FetchEntityProps<M>\n        ): Promise<Entity<M> | undefined> => getAndBuildEntity(path, entityId, collection), [getAndBuildEntity]),\n\n        /**\n         *\n         * @param path\n         * @param entityId\n         * @param collection\n         * @param onUpdate\n         * @param onError\n         * @return Function to cancel subscription\n         * @category Firestore\n         */\n        listenEntity: useCallback(<M extends Record<string, any>>(\n            {\n                path,\n                entityId,\n                collection,\n                onUpdate,\n                onError\n            }: ListenEntityProps<M>): () => void => {\n            if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n\n            const firestore = getFirestore(firebaseApp);\n\n            return onSnapshot(\n                doc(firestore, path, entityId),\n                {\n                    next: (docSnapshot) => {\n                        const resolvedCollection = resolveCollection<M>({\n                            collection,\n                            path,\n                            entityId: docSnapshot.id,\n                            fields\n                        });\n                        onUpdate(createEntityFromCollection(docSnapshot, path, resolvedCollection));\n                    },\n                    error: onError\n                }\n            );\n        }, [firebaseApp]),\n\n        /**\n         * Save entity to the specified path. Note that Firestore does not allow\n         * undefined values.\n         * @param path\n         * @param entityId\n         * @param values\n         * @param schemaId\n         * @param collection\n         * @param status\n         * @category Firestore\n         */\n        saveEntity: useCallback(<M extends Record<string, any>>(\n            {\n                path,\n                entityId,\n                values,\n                collection,\n                status\n            }: SaveEntityProps<M>): Promise<Entity<M>> => {\n\n            if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n\n            const firestore = getFirestore(firebaseApp);\n\n            const resolvedCollection = resolveCollection<M>({\n                collection,\n                path,\n                entityId,\n                fields\n            });\n\n            const properties: ResolvedProperties<M> = resolvedCollection.properties;\n            const collectionReference: CollectionReference = collectionClause(firestore, path);\n\n            const firestoreValues = cmsToFirestoreModel(values, firestore);\n            const updatedFirestoreValues: EntityValues<M> = updateDateAutoValues(\n                {\n                    inputValues: firestoreValues,\n                    properties,\n                    status,\n                    timestampNowValue: serverTimestamp(),\n                    setDateToMidnight\n                });\n\n            console.debug(\"Saving entity\", path, entityId, updatedFirestoreValues);\n\n            let documentReference: DocumentReference;\n            if (entityId)\n                documentReference = doc(collectionReference, entityId);\n            else\n                documentReference = doc(collectionReference);\n\n            return setDoc(documentReference, updatedFirestoreValues, { merge: true })\n                .then(() => ({\n                    id: documentReference.id,\n                    path,\n                    values: firestoreToCMSModel(updatedFirestoreValues)\n                }));\n        }, [firebaseApp]),\n\n        /**\n         * Delete an entity\n         * @param entity\n         * @param collection\n         * @category Firestore\n         */\n        deleteEntity: useCallback(<M extends Record<string, any>>(\n            {\n                entity\n            }: DeleteEntityProps<M>\n        ): Promise<void> => {\n            if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n\n            const firestore = getFirestore(firebaseApp);\n\n            return deleteDoc(doc(firestore, entity.path, entity.id));\n        }, [firebaseApp]),\n\n        /**\n         * Check if the given property is unique in the given collection\n         * @param path Collection path\n         * @param name of the property\n         * @param value\n         * @param property\n         * @param entityId\n         * @return `true` if there are no other fields besides the given entity\n         * @category Firestore\n         */\n        checkUniqueField: useCallback((\n            path: string,\n            name: string,\n            value: any,\n            property: ResolvedProperty,\n            entityId?: string\n        ): Promise<boolean> => {\n\n            if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n\n            const firestore = getFirestore(firebaseApp);\n\n            console.debug(\"Check unique field entity\", path, name, value, entityId);\n\n            if (property.dataType === \"array\") {\n                console.error(\"checkUniqueField received an array\");\n            }\n\n            if (value === undefined || value === null) {\n                return Promise.resolve(true);\n            }\n            const q = query(collectionClause(firestore, path), whereClause(name, \"==\", value));\n            return getDocs(q)\n                .then((snapshots) =>\n                    snapshots.docs.filter(doc => doc.id !== entityId).length === 0\n                );\n\n        }, [firebaseApp]),\n\n        generateEntityId: useCallback((path: string): string => {\n            if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n            const firestore = getFirestore(firebaseApp);\n            return doc(collectionClause(firestore, path)).id;\n        }, [firebaseApp]),\n\n        countEntities: useCallback(async (path: string): Promise<number> => {\n            if (!firebaseApp) throw Error(\"useFirestoreDataSource Firebase not initialised\");\n            const firestore = getFirestore(firebaseApp);\n            const coll = collectionClause(firestore, path);\n            const snapshot = await getCountFromServer(coll);\n            return snapshot.data().count;\n        }, [firebaseApp])\n\n    };\n\n}\n\n/**\n * Recursive function that converts Firestore data types into CMS or plain\n * JS types.\n * FireCMS uses Javascript dates internally instead of Firestore timestamps.\n * This makes it easier to interact with the rest of the libraries and\n * bindings.\n * Also, Firestore references are replaced with {@link EntityReference}\n * @param data\n * @category Firestore\n */\nexport function firestoreToCMSModel(data: any): any\nexport function firestoreToCMSModel(data: any): any {\n    if (data === null || data === undefined) return null;\n    if (serverTimestamp().isEqual(data)) {\n        return null;\n    }\n    if (data instanceof Timestamp || (typeof data.toDate === \"function\" && data.toDate() instanceof Date)) {\n        return data.toDate();\n    }\n    if (data instanceof Date) {\n        return data;\n    }\n    if (data instanceof GeoPoint) {\n        return new GeoPoint(data.latitude, data.longitude);\n    }\n    if (data instanceof DocumentReference) {\n        return new EntityReference(data.id, getCMSPathFromFirestorePath(data.path));\n    }\n    if (Array.isArray(data)) {\n        return data.map(firestoreToCMSModel);\n    }\n    if (typeof data === \"object\") {\n        const result: Record<string, any> = {};\n        for (const key of Object.keys(data)) {\n            result[key] = firestoreToCMSModel(data[key]);\n        }\n        return result;\n    }\n    return data;\n}\nexport function cmsToFirestoreModel(data: any, firestore: Firestore): any {\n    if (Array.isArray(data)) {\n        return data.map(v => cmsToFirestoreModel(v, firestore));\n    } else if (data instanceof EntityReference) {\n        return doc(firestore, data.path, data.id);\n    } else if (data instanceof GeoPoint) {\n        return new FirestoreGeoPoint(data.latitude, data.longitude);\n    } else if (data instanceof Date) {\n        return Timestamp.fromDate(data);\n    } else if (data && typeof data === \"object\") {\n        return Object.entries(data)\n            .map(([key, v]) => ({ [key]: cmsToFirestoreModel(v, firestore) }))\n            .reduce((a, b) => ({ ...a, ...b }), {});\n    }\n    return data;\n}\n\n/**\n * Remove id from Firestore path\n * @param fsPath\n */\nfunction getCMSPathFromFirestorePath(fsPath: string): string {\n    let to = fsPath.lastIndexOf(\"/\");\n    to = to === -1 ? fsPath.length : to;\n    return fsPath.substring(0, to);\n}\n","import { FirebaseApp } from \"firebase/app\";\nimport {\n    FirebaseStorage,\n    getDownloadURL,\n    getMetadata,\n    getStorage,\n    ref,\n    uploadBytes\n} from \"firebase/storage\";\nimport {\n    DownloadConfig,\n    DownloadMetadata,\n    StorageSource,\n    UploadFileProps\n} from \"../../types\";\nimport { useEffect, useState } from \"react\";\n\n/**\n * @category Firebase\n */\nexport interface FirebaseStorageSourceProps {\n    firebaseApp?: FirebaseApp\n}\n\n/**\n * Use this hook to build an {@link StorageSource} based on Firebase storage\n * @category Firebase\n */\nexport function useFirebaseStorageSource({ firebaseApp }: FirebaseStorageSourceProps): StorageSource {\n\n    const [storage, setStorage] = useState<FirebaseStorage>();\n\n    useEffect(() => {\n        if (!firebaseApp) return;\n        setStorage(getStorage(firebaseApp));\n    }, [firebaseApp]);\n\n    const urlsCache: Record<string, DownloadConfig> = {};\n\n    return {\n        uploadFile({ file, fileName, path, metadata }: UploadFileProps)\n            : Promise<any> {\n            if (!storage) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n            const usedFilename = fileName ?? file.name;\n            console.debug(\"Uploading file\", usedFilename, file, path, metadata);\n            return uploadBytes(ref(storage, `${path}/${usedFilename}`), file, metadata).then(snapshot => ({\n                path: snapshot.ref.fullPath\n            }));\n        },\n\n        async getDownloadURL(storagePathOrUrl: string): Promise<DownloadConfig> {\n            if (!storage) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n            if (urlsCache[storagePathOrUrl])\n                return urlsCache[storagePathOrUrl];\n            const fileRef = ref(storage, storagePathOrUrl);\n            const [url, metadata] = await Promise.all([getDownloadURL(fileRef), getMetadata(fileRef)]);\n            const result:DownloadConfig = {\n                url, metadata: metadata as DownloadMetadata\n            }\n            urlsCache[storagePathOrUrl] = result;\n            return result;\n        }\n    };\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport equal from \"react-fast-compare\";\n\nimport { User as FirebaseUser } from \"firebase/auth\";\n\nimport { AppCheckTokenResult, DataSource, StorageSource } from \"../../types\";\nimport { Authenticator, FirebaseAuthController } from \"../types/auth\";\n\n/**\n * This hook is used internally for validating an authenticator.\n * You may want to use it if you are not using {@link FirebaseCMSApp}, but\n * building your own custom {@link FireCMS} instance.\n * @param authController\n * @param authentication\n * @param getAppCheckToken\n * @param storageSource\n * @param dataSource\n */\nexport function useValidateAuthenticator({\n                                             authController,\n                                             authentication,\n                                             getAppCheckToken,\n                                             appCheckForceRefresh = false,\n                                             storageSource,\n                                             dataSource\n                                         }:\n                                             {\n                                                 authController: FirebaseAuthController,\n                                                 authentication?: boolean | Authenticator<FirebaseUser>,\n                                                 getAppCheckToken?: (forceRefresh: boolean) => Promise<AppCheckTokenResult> | undefined,\n                                                 appCheckForceRefresh?: boolean,\n                                                 dataSource: DataSource;\n                                                 storageSource: StorageSource;\n                                             }): {\n    canAccessMainView: boolean,\n    authLoading: boolean,\n    notAllowedError: any,\n    authVerified: boolean,\n} {\n\n    const authenticationEnabled = Boolean(authentication);\n\n    const [authLoading, setAuthLoading] = useState<boolean>(authenticationEnabled);\n    const [notAllowedError, setNotAllowedError] = useState<any>(false);\n    const [authVerified, setAuthVerified] = useState<boolean>(!authenticationEnabled || Boolean(authController.loginSkipped));\n\n    const canAccessMainView = (authVerified) &&\n        (!authenticationEnabled || Boolean(authController.user) || Boolean(authController.loginSkipped)) &&\n        !notAllowedError;\n\n    useEffect(() => {\n        if (authController.loginSkipped)\n            setAuthVerified(true);\n    }, [authController.loginSkipped]);\n\n    /**\n     * We use this ref to check the authentication only if the user has\n     * changed\n     */\n    const checkedUserRef = useRef<FirebaseUser | undefined>();\n\n    const checkAuthentication = useCallback(async () => {\n\n        if (authController.initialLoading) {\n            return;\n        }\n\n        if (!authController.user && !authController.loginSkipped) {\n            checkedUserRef.current = undefined;\n            setAuthLoading(false);\n            setAuthVerified(false);\n            return;\n        }\n\n        const delegateUser = authController.user;\n\n        if (getAppCheckToken) {\n            try {\n                if (!await getAppCheckToken(appCheckForceRefresh)) {\n                    setNotAllowedError(\"App Check failed.\");\n                    authController.signOut();\n                } else {\n                    console.log(\"App Check success.\");\n                }\n            } catch (e: any) {\n                setNotAllowedError(e.message);\n                authController.signOut();\n            }\n        }\n\n        if (authentication instanceof Function && delegateUser && !equal(checkedUserRef.current, delegateUser)) {\n            setAuthLoading(true);\n            try {\n                const allowed = await authentication({\n                    user: delegateUser,\n                    authController,\n                    dataSource,\n                    storageSource\n                });\n                if (!allowed) {\n                    authController.signOut();\n                    setNotAllowedError(true);\n                }\n            } catch (e) {\n                setNotAllowedError(e);\n                authController.signOut();\n            }\n            setAuthLoading(false);\n            setAuthVerified(true);\n            checkedUserRef.current = delegateUser;\n        } else {\n            setAuthLoading(false);\n        }\n\n        if (!authController.initialLoading && !delegateUser) {\n            setAuthVerified(true);\n        }\n\n    }, [authController, authentication, getAppCheckToken, appCheckForceRefresh, dataSource, storageSource]);\n\n    useEffect(() => {\n        checkAuthentication();\n    }, [checkAuthentication]);\n\n    return {\n        canAccessMainView,\n        authLoading: authenticationEnabled && authLoading,\n        notAllowedError,\n        authVerified\n    }\n}\n","import React, { useCallback, useEffect } from \"react\";\n\nimport { FirebaseApp, initializeApp } from \"firebase/app\";\n\n/**\n * @category Firebase\n */\nexport interface InitialiseFirebaseResult {\n    firebaseConfigLoading: boolean,\n    firebaseApp?: FirebaseApp;\n    configError?: string,\n    firebaseConfigError?: Error\n}\n\nconst hostingError = \"It seems like the provided Firebase config is not correct. If you \\n\" +\n    \"are using the credentials provided automatically by Firebase \\n\" +\n    \"Hosting, make sure you link your Firebase app to Firebase Hosting. \\n\";\n\n/**\n * Function used to initialise Firebase, either by using the provided config,\n * or by fetching it by Firebase Hosting, if not specified.\n *\n * It works as a hook that gives you the loading state and the used\n * configuration.\n *\n * You most likely only need to use this if you are developing a custom app\n * that is not using {@link FirebaseCMSApp}. You can also not use this component\n * and initialise Firebase yourself.\n *\n * @param onFirebaseInit\n * @param firebaseConfig\n * @param name\n * @category Firebase\n */\nexport function useInitialiseFirebase({\n                                          firebaseConfig,\n                                          onFirebaseInit,\n                                          name,\n                                          authDomain\n                                      }: {\n    onFirebaseInit?: ((config: object) => void) | undefined,\n    firebaseConfig: Record<string, unknown> | undefined,\n    name?: string;\n    authDomain?: string;\n}): InitialiseFirebaseResult {\n\n    const [firebaseApp, setFirebaseApp] = React.useState<FirebaseApp | undefined>();\n    const [firebaseConfigLoading, setFirebaseConfigLoading] = React.useState<boolean>(false);\n    const [configError, setConfigError] = React.useState<string>();\n\n    const initFirebase = useCallback((config: Record<string, unknown>) => {\n        try {\n            const initialisedFirebaseApp = initializeApp(config, name ?? \"[DEFAULT]\");\n            setConfigError(undefined);\n            setFirebaseConfigLoading(false);\n            if (onFirebaseInit)\n                onFirebaseInit(config);\n            setFirebaseApp(initialisedFirebaseApp);\n        } catch (e: any) {\n            console.error(\"Error initialising Firebase\", e);\n            setConfigError(hostingError + \"\\n\" + (e.message ?? JSON.stringify(e)));\n        }\n    }, [name]);\n\n    useEffect(() => {\n\n        setFirebaseConfigLoading(true);\n\n        if (firebaseConfig) {\n            initFirebase(firebaseConfig);\n        } else if (process.env.NODE_ENV === \"production\") {\n            fetch(\"/__/firebase/init.json\")\n                .then(async response => {\n                    console.debug(\"Firebase init response\", response.status);\n                    if (response && response.status < 300) {\n                        const config = await response.json();\n                        if (authDomain) config.authDomain = authDomain;\n                        initFirebase(config);\n                    }\n                })\n                .catch(e => {\n                        setFirebaseConfigLoading(false);\n                        setConfigError(\n                            \"Could not load Firebase configuration from Firebase hosting. \" +\n                            \"If the app is not deployed in Firebase hosting, you need to specify the configuration manually\" +\n                            e.toString()\n                        );\n                    }\n                );\n        } else {\n            setFirebaseConfigLoading(false);\n            setConfigError(\n                \"You need to deploy the app to Firebase hosting or specify a Firebase configuration object\"\n            );\n        }\n    }, [firebaseConfig, initFirebase]);\n\n    return {\n        firebaseApp,\n        firebaseConfigLoading,\n        configError\n    };\n}\n","import React, { useCallback, useEffect } from \"react\";\n\nimport {\n    AppCheck as FirebaseAppCheck,\n    getToken,\n    initializeAppCheck,\n    ReCaptchaEnterpriseProvider,\n    ReCaptchaV3Provider\n} from \"firebase/app-check\";\nimport { AppCheck, AppCheckOptions, AppCheckTokenResult } from \"../../types\";\nimport { FirebaseApp } from \"firebase/app\";\n\n/**\n * @category Firebase\n */\nexport interface InitializeAppCheckProps {\n    firebaseApp?: FirebaseApp;\n    options?: AppCheckOptions;\n}\n\nexport interface InitializeAppCheckResult {\n    appCheckLoading: boolean;\n    getAppCheckToken?: (forceRefresh: boolean) => Promise<AppCheckTokenResult> | undefined;\n}\n\n/**\n * Function used to initialise Firebase App Check.\n *\n * It works as a hook that gives you back an object holding the Firebase App.\n *\n * You most likely only need to use this if you are developing a custom app\n * that is not using {@link FirebaseCMSApp}. You can also not use this component\n * and initialise App Check yourself.\n *\n * @param firebaseApp\n * @category Firebase\n */\nexport function useInitializeAppCheck({\n                                          firebaseApp,\n                                          options\n                                      }: InitializeAppCheckProps): InitializeAppCheckResult {\n    if (options?.debugToken) {\n        Object.assign(window, {\n            FIREBASE_APPCHECK_DEBUG_TOKEN: options?.debugToken\n        });\n    }\n\n    const [appCheckLoading, setAppCheckLoading] = React.useState<boolean>(false);\n    const [appCheck, setAppCheck] = React.useState<AppCheck | undefined>();\n\n    const getAppCheckToken = useCallback((forceRefresh: boolean) => {\n        if (!appCheck || !options) return;\n        return getToken(appCheck as FirebaseAppCheck, forceRefresh);\n    }, [appCheck, options]);\n\n    useEffect(() => {\n        if (!options) return;\n        if (!firebaseApp) return;\n\n        setAppCheckLoading(true);\n\n        const {\n            providerKey,\n            useEnterpriseRecaptcha,\n            isTokenAutoRefreshEnabled\n        } = options;\n        const appCheck_ = initializeAppCheck(firebaseApp, {\n            provider: useEnterpriseRecaptcha ? new ReCaptchaEnterpriseProvider(providerKey) : new ReCaptchaV3Provider(providerKey),\n            isTokenAutoRefreshEnabled\n        });\n        setAppCheck(appCheck_ as AppCheck);\n\n        setAppCheckLoading(false);\n    }, [firebaseApp, options]);\n\n    return {\n        appCheckLoading,\n        getAppCheckToken: options ? getAppCheckToken : undefined\n    };\n}\n","export const googleIcon = (mode: \"light\" | \"dark\") => <>\n    <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        width={32}\n        height={32}\n    >\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJb\"\n            x1=\"29.401\"\n            x2=\"29.401\"\n            y1=\"4.064\"\n            y2=\"106.734\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#ff5840\"/>\n            <stop offset=\".007\" stopColor=\"#ff5840\"/>\n            <stop offset=\".989\" stopColor=\"#fa528c\"/>\n            <stop offset=\"1\" stopColor=\"#fa528c\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJb)\"\n            d=\"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z\"\n        />\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJc\"\n            x1=\"12.148\"\n            x2=\"12.148\"\n            y1=\".872\"\n            y2=\"47.812\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#feaa53\"/>\n            <stop offset=\".612\" stopColor=\"#ffcd49\"/>\n            <stop offset=\"1\" stopColor=\"#ffde44\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJc)\"\n            d=\"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z\"\n        />\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJd\"\n            x1=\"29.76\"\n            x2=\"29.76\"\n            y1=\"32.149\"\n            y2=\"-6.939\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#42d778\"/>\n            <stop offset=\".428\" stopColor=\"#3dca76\"/>\n            <stop offset=\"1\" stopColor=\"#34b171\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJd)\"\n            d=\"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z\"\n        />\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJe\"\n            x1=\"46\"\n            x2=\"46\"\n            y1=\"3.638\"\n            y2=\"35.593\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#155cde\"/>\n            <stop offset=\".278\" stopColor=\"#1f7fe5\"/>\n            <stop offset=\".569\" stopColor=\"#279ceb\"/>\n            <stop offset=\".82\" stopColor=\"#2cafef\"/>\n            <stop offset=\"1\" stopColor=\"#2eb5f0\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJe)\"\n            d=\"M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15\n        c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z\"\n        />\n    </svg>\n</>;\n\nexport const appleIcon = (mode: \"light\" | \"dark\") => <svg width={32} height={32}\n                                                          viewBox=\"0 0 56 56\"\n                                                          style={{ transform: \"scale(2.8)\" }}\n                                                          version=\"1.1\"\n                                                          xmlns=\"http://www.w3.org/2000/svg\">\n    <g stroke={mode === \"light\" ? \"#424245\" : \"white\"} strokeWidth=\"0.5\"\n       fillRule=\"evenodd\">\n        <path\n            d=\"M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z\"\n            fill={mode === \"light\" ? \"#424245\" : \"white\"} fillRule=\"nonzero\"/>\n    </g>\n</svg>;\n\nexport const githubIcon = (mode: \"light\" | \"dark\") => <svg\n    fill={mode === \"light\" ? \"#1c1e21\" : \"white\"}\n    role=\"img\"\n    viewBox=\"0 0 24 24\"\n    width={28}\n    height={28}\n    xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n        d=\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"/>\n</svg>;\n\n\nexport const facebookIcon = (mode: \"light\" | \"dark\") => <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width={28} height={28}\n    viewBox=\"0 0 90 90\">\n    <g>\n        <path\n            d=\"M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z\"\n            fill={mode === \"light\" ? \"#39569c\" : \"white\"}/>\n    </g>\n</svg>;\n\nexport const microsoftIcon = (mode: \"light\" | \"dark\") => <svg\n    xmlns=\"http://www.w3.org/2000/svg\" width={28} height={28}\n    viewBox=\"0 0 480 480\">\n    <g>\n        <path\n            d=\"M0.176,224L0.001,67.963l192-26.072V224H0.176z M224.001,37.241L479.937,0v224H224.001V37.241z M479.999,256l-0.062,224   l-255.936-36.008V256H479.999z M192.001,439.918L0.157,413.621L0.147,256h191.854V439.918z\"\n            fill={mode === \"light\" ? \"#00a2ed\" : \"white\"}/>\n    </g>\n</svg>;\n\nexport const twitterIcon = (mode: \"light\" | \"dark\") => <svg\n    xmlns=\"http://www.w3.org/2000/svg\" width={28} height={28}\n    viewBox=\"0 0 24 24\">\n    <path fill={mode === \"light\" ? \"#00acee\" : \"white\"}\n          d=\"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z\"/>\n</svg>;\n\n","import { useEffect } from \"react\";\nimport { getAuth, RecaptchaVerifier } from \"firebase/auth\";\n\ndeclare global {\n    interface Window {\n        recaptchaVerifier: RecaptchaVerifier;\n    }\n}\n\nexport const RECAPTCHA_CONTAINER_ID = \"recaptcha-container\" as const;\n\nexport function useRecaptcha() {\n    useEffect(() => {\n        if (!window || window?.recaptchaVerifier) return;\n\n        const auth = getAuth();\n\n        window.recaptchaVerifier = new RecaptchaVerifier(\n            RECAPTCHA_CONTAINER_ID,\n            {\n                size: \"invisible\"\n            },\n            auth\n        );\n    }, []);\n\n    return null;\n}\n","import React, {\n    ReactNode,\n    useCallback,\n    useEffect,\n    useRef,\n    useState\n} from \"react\";\n\nimport {\n    Box,\n    Button,\n    CircularProgress,\n    Fade,\n    Grid,\n    IconButton,\n    Slide,\n    TextField,\n    Typography\n} from \"@mui/material\";\n\nimport { FirebaseApp, FirebaseError } from \"firebase/app\";\nimport { ErrorView, FireCMSLogo } from \"../../core\";\nimport { useModeController } from \"../../hooks\";\nimport {\n    FirebaseAuthController,\n    FirebaseSignInOption,\n    FirebaseSignInProvider\n} from \"../types/auth\";\nimport {\n    appleIcon,\n    facebookIcon,\n    githubIcon,\n    googleIcon,\n    microsoftIcon,\n    twitterIcon\n} from \"./social_icons\";\nimport EmailIcon from \"@mui/icons-material/Email\";\nimport ArrowBackIcon from \"@mui/icons-material/ArrowBack\";\nimport PersonOutlineIcon from \"@mui/icons-material/PersonOutline\";\nimport { Phone } from \"@mui/icons-material\";\nimport { RECAPTCHA_CONTAINER_ID, useRecaptcha } from \"../hooks/useRecaptcha\";\nimport {\n    getAuth,\n    getMultiFactorResolver,\n    PhoneAuthProvider,\n    PhoneMultiFactorGenerator,\n    RecaptchaVerifier\n} from \"firebase/auth\";\n\n/**\n * @category Firebase\n */\nexport interface FirebaseLoginViewProps {\n\n    /**\n     * Firebase app this login view is accessing\n     */\n    firebaseApp: FirebaseApp;\n\n    /**\n     * Delegate holding the auth state\n     */\n    authController: FirebaseAuthController;\n\n    /**\n     * Path to the logo displayed in the login screen\n     */\n    logo?: string;\n\n    /**\n     * Enable the skip login button\n     */\n    allowSkipLogin?: boolean;\n\n    /**\n     * Each of the sign in options that get a custom button\n     */\n    signInOptions: Array<FirebaseSignInProvider | FirebaseSignInOption>;\n\n    /**\n     * Disable the login buttons\n     */\n    disabled?: boolean;\n\n    /**\n     * Prevent users from creating new users in when the `signInOptions` value\n     * is `password`. This does not apply to the rest of login providers.\n     */\n    disableSignupScreen?: boolean;\n\n    /**\n     * Display this component when no user is found a user tries to log in\n     * when the `signInOptions` value is `password`.\n     */\n    noUserComponent?: ReactNode;\n\n    /**\n     * Display this component bellow the sign-in buttons.\n     * Useful for adding checkboxes for privacy and terms and conditions.\n     * You may want to use it in conjunction with the `disabled` prop.\n     */\n    additionalComponent?: ReactNode;\n\n    notAllowedError?: any;\n\n}\n\n/**\n * Use this component to render a login view, that updates\n * the state of the {@link FirebaseAuthController} based on the result\n * @constructor\n * @category Firebase\n */\nexport function FirebaseLoginView({\n                                      allowSkipLogin,\n                                      logo,\n                                      signInOptions,\n                                      firebaseApp,\n                                      authController,\n                                      noUserComponent,\n                                      disableSignupScreen = false,\n                                      disabled = false,\n                                      additionalComponent,\n                                      notAllowedError\n                                  }: FirebaseLoginViewProps) {\n\n    const modeState = useModeController();\n\n    const [passwordLoginSelected, setPasswordLoginSelected] = useState(false);\n\n    const [phoneLoginSelected, setPhoneLoginSelected] = useState(false);\n\n    const resolvedSignInOptions: FirebaseSignInProvider[] = signInOptions.map((o) => {\n        if (typeof o === \"object\") {\n            return o.provider;\n        } else return o as FirebaseSignInProvider;\n    })\n\n    const sendMFASms = useCallback(() => {\n        const auth = getAuth();\n        const recaptchaVerifier = new RecaptchaVerifier(\"recaptcha\", { size: \"invisible\" }, auth);\n\n        const resolver = getMultiFactorResolver(auth, authController.authProviderError);\n\n        if (resolver.hints[0].factorId === PhoneMultiFactorGenerator.FACTOR_ID) {\n\n            const phoneInfoOptions = {\n                multiFactorHint: resolver.hints[0],\n                session: resolver.session\n            };\n            const phoneAuthProvider = new PhoneAuthProvider(auth);\n            // Send SMS verification code\n            phoneAuthProvider.verifyPhoneNumber(phoneInfoOptions, recaptchaVerifier)\n                .then(function (verificationId) {\n\n                    // Ask user for the SMS verification code. Then:\n                    const verificationCode = String(window.prompt(\"Please enter the verification \" + \"code that was sent to your mobile device.\"));\n                    const cred = PhoneAuthProvider.credential(verificationId, verificationCode);\n                    const multiFactorAssertion = PhoneMultiFactorGenerator.assertion(cred);\n                    // // Complete sign-in.\n                    return resolver.resolveSignIn(multiFactorAssertion);\n\n                })\n\n        } else {\n            // Unsupported second factor.\n            console.warn(\"Unsupported second factor.\");\n        }\n\n    }, [authController.authProviderError]);\n\n    function buildErrorView() {\n        let errorView: any;\n        if (authController.user != null) return errorView; // if the user is logged in via MFA\n        const ignoredCodes = [\"auth/popup-closed-by-user\", \"auth/cancelled-popup-request\"];\n        if (authController.authProviderError) {\n            if (authController.authProviderError.code === \"auth/operation-not-allowed\" ||\n                authController.authProviderError.code === \"auth/configuration-not-found\") {\n                errorView =\n                    <div>\n                        <Box p={1}>\n                            <ErrorView\n                                error={\"You need to enable Firebase auth and the corresponding login provider in your Firebase project\"}/>\n                        </Box>\n                        {firebaseApp &&\n                            <Box p={1}>\n                                <a href={`https://console.firebase.google.com/project/${firebaseApp.options.projectId}/authentication/providers`}\n                                   rel=\"noopener noreferrer\"\n                                   target=\"_blank\">\n                                    <Button variant=\"text\"\n                                            color=\"primary\">\n                                        Open Firebase configuration\n                                    </Button>\n                                </a>\n                            </Box>}\n                    </div>;\n            } else if (!ignoredCodes.includes(authController.authProviderError.code)) {\n                if (authController.authProviderError.code === \"auth/multi-factor-auth-required\") {\n                    sendMFASms();\n                }\n                errorView =\n                    <Box p={1}>\n                        <ErrorView error={authController.authProviderError}/>\n                    </Box>;\n            }\n        }\n        return errorView;\n    }\n\n    let logoComponent;\n    if (logo) {\n        logoComponent = <img src={logo}\n                             style={{\n                                 height: \"100%\",\n                                 width: \"100%\",\n                                 objectFit: \"cover\"\n                             }}\n                             alt={\"Logo\"}/>;\n    } else {\n        logoComponent = <FireCMSLogo/>;\n    }\n\n    let notAllowedMessage: string | undefined;\n    if (notAllowedError) {\n        if (typeof notAllowedError === \"string\") {\n            notAllowedMessage = notAllowedError;\n        } else if (notAllowedError instanceof Error) {\n            notAllowedMessage = notAllowedError.message;\n        } else {\n            notAllowedMessage = \"It looks like you don't have access to the CMS, based on the specified Authenticator configuration\";\n        }\n    }\n\n    return (\n\n        <Fade\n            in={true}\n            timeout={800}\n            mountOnEnter\n            unmountOnExit>\n\n            <Box sx={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                minHeight: \"100vh\",\n                \"@supports (minHeight: 100dvh)\": {\n                    minHeight: \"100dvh\"\n                },\n                minWidth: \"100vw\",\n                p: 2\n            }}>\n                <div id=\"recaptcha\"></div>\n                <Box sx={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: \"center\",\n                    width: \"100%\",\n                    maxWidth: 480\n                }}>\n\n                    <Box m={1} sx={{\n                        padding: 1,\n                        width: 260,\n                        height: 260\n                    }}>\n                        {logoComponent}\n                    </Box>\n\n                    {notAllowedMessage &&\n                        <Box p={2}>\n                            <ErrorView error={notAllowedMessage}/>\n                        </Box>}\n\n                    {buildErrorView()}\n\n                    {(!passwordLoginSelected && !phoneLoginSelected) && <>\n\n                        {buildOauthLoginButtons(authController, resolvedSignInOptions, modeState.mode, disabled)}\n\n                        {resolvedSignInOptions.includes(\"password\") &&\n                            <LoginButton\n                                disabled={disabled}\n                                text={\"Email/password\"}\n                                icon={<EmailIcon fontSize={\"large\"}/>}\n                                onClick={() => setPasswordLoginSelected(true)}/>}\n\n                        {resolvedSignInOptions.includes(\"phone\") &&\n                            <LoginButton\n                                disabled={disabled}\n                                text={\"Phone number\"}\n                                icon={<Phone fontSize={\"large\"}/>}\n                                onClick={() => setPhoneLoginSelected(true)}/>}\n\n                        {resolvedSignInOptions.includes(\"anonymous\") &&\n                            <LoginButton\n                                disabled={disabled}\n                                text={\"Log in anonymously\"}\n                                icon={<PersonOutlineIcon\n                                    fontSize={\"large\"}/>}\n                                onClick={authController.anonymousLogin}/>}\n\n                        {allowSkipLogin &&\n                            <Box m={1}>\n                                <Button\n                                    disabled={disabled}\n                                    onClick={authController.skipLogin}>\n                                    Skip login\n                                </Button>\n                            </Box>\n                        }\n\n                    </>}\n\n                    {passwordLoginSelected && <LoginForm\n                        authController={authController}\n                        onClose={() => setPasswordLoginSelected(false)}\n                        mode={modeState.mode}\n                        noUserComponent={noUserComponent}\n                        disableSignupScreen={disableSignupScreen}\n                    />}\n\n                    {phoneLoginSelected && <PhoneLoginForm\n                        authController={authController}\n                        onClose={() => setPhoneLoginSelected(false)}\n                    />}\n\n                    {!passwordLoginSelected && !phoneLoginSelected && additionalComponent}\n\n                </Box>\n            </Box>\n        </Fade>\n    );\n}\n\nexport function LoginButton({\n                                icon,\n                                onClick,\n                                text,\n                                disabled\n                            }: { icon: React.ReactNode, onClick: () => void, text: string, disabled?: boolean }) {\n    return (\n        <Box m={0.5} width={\"100%\"}>\n            <Button fullWidth\n                    variant=\"outlined\"\n                    disabled={disabled}\n                    onClick={onClick}>\n                <Box sx={{\n                    p: \"1\",\n                    display: \"flex\",\n                    width: \"240px\",\n                    height: \"32px\",\n                    alignItems: \"center\",\n                    justifyItems: \"center\"\n                }}>\n                    <Box sx={{\n                        display: \"flex\",\n                        flexDirection: \"column\",\n                        width: \"32px\",\n                        alignItems: \"center\",\n                        justifyItems: \"center\"\n                    }}>\n                        {icon}\n                    </Box>\n                    <Box sx={{\n                        flexGrow: 1,\n                        pl: 2,\n                        textAlign: \"center\"\n                    }}>{text}</Box>\n                </Box>\n            </Button>\n        </Box>\n    )\n}\n\nfunction PhoneLoginForm({\n                            onClose,\n                            authController\n                        }: {\n    onClose: () => void,\n    authController: FirebaseAuthController,\n}) {\n    useRecaptcha();\n\n    const [phone, setPhone] = useState<string>();\n    const [code, setCode] = useState<string>();\n    const [isInvalidCode, setIsInvalidCode] = useState(false);\n\n    const handleSubmit = async (event: any) => {\n        event.preventDefault();\n\n        if (code && authController.confirmationResult) {\n            setIsInvalidCode(false);\n\n            authController.confirmationResult.confirm(code).catch((e: FirebaseError) => {\n                if (e.code === \"auth/invalid-verification-code\") {\n                    setIsInvalidCode(true)\n                }\n            });\n        } else {\n            if (phone) {\n                authController.phoneLogin(phone, window.recaptchaVerifier);\n            }\n        }\n    }\n\n    return (\n        <form onSubmit={handleSubmit}>\n            {isInvalidCode &&\n                <Box p={2}>\n                    <ErrorView error={\"Invalid confirmation code\"}/>\n                </Box>}\n\n            <div id={RECAPTCHA_CONTAINER_ID}/>\n\n            <Grid container spacing={1}>\n                <Grid item xs={12}>\n                    <IconButton\n                        onClick={onClose}>\n                        <ArrowBackIcon sx={{\n                            width: 20,\n                            height: 20\n                        }}/>\n                    </IconButton>\n                </Grid>\n                <Grid item xs={12} sx={{\n                    p: 1,\n                    display: \"flex\"\n                }}>\n                    <Typography align={\"center\"}\n                                variant={\"subtitle2\"}>{\"Please enter your phone number\"}</Typography>\n                </Grid>\n                <Grid item xs={12}>\n                    <TextField placeholder=\"\" fullWidth\n                               value={phone}\n                               disabled={Boolean(phone && (authController.authLoading || authController.confirmationResult))}\n                               type=\"phone\"\n                               required\n                               onChange={(event) => setPhone(event.target.value)}/>\n                </Grid>\n                {Boolean(phone && authController.confirmationResult) &&\n                    <>\n                        <Grid item xs={12} sx={{\n                            mt: 2,\n                            p: 1,\n                            display: \"flex\"\n                        }}>\n                            <Typography align={\"center\"}\n                                        variant={\"subtitle2\"}>{\"Please enter the confirmation code\"}</Typography>\n                        </Grid>\n                        <Grid item xs={12}>\n                            <TextField placeholder=\"\" fullWidth\n                                       value={code}\n                                       type=\"text\"\n                                       required\n                                       onChange={(event) => setCode(event.target.value)}/>\n                        </Grid>\n                    </>\n                }\n\n                <Grid item xs={12}>\n                    <Box sx={{\n                        display: \"flex\",\n                        justifyContent: \"end\",\n                        alignItems: \"center\",\n                        width: \"100%\"\n                    }}>\n\n                        {authController.authLoading &&\n                            <CircularProgress sx={{ p: 1 }} size={16}\n                                              thickness={8}/>\n                        }\n\n                        <Button type=\"submit\">\n                            {\"Ok\"}\n                        </Button>\n                    </Box>\n                </Grid>\n\n            </Grid>\n        </form>\n    );\n}\n\nfunction LoginForm({\n                       onClose,\n                       authController,\n                       mode,\n                       noUserComponent,\n                       disableSignupScreen\n                   }: {\n    onClose: () => void,\n    authController: FirebaseAuthController,\n    mode: \"light\" | \"dark\",\n    noUserComponent?: ReactNode,\n    disableSignupScreen: boolean\n}) {\n\n    const passwordRef = useRef<HTMLInputElement | null>(null);\n\n    const [email, setEmail] = useState<string>();\n    const [availableProviders, setAvailableProviders] = useState<string[] | undefined>();\n    const [password, setPassword] = useState<string>();\n\n    const shouldShowEmail = availableProviders === undefined;\n    const loginMode = availableProviders && availableProviders.includes(\"password\");\n    const otherProvidersMode = availableProviders && !availableProviders.includes(\"password\") && availableProviders.length > 0;\n    const registrationMode = availableProviders && !availableProviders.includes(\"password\");\n\n    useEffect(() => {\n        if ((loginMode || registrationMode) && passwordRef.current) {\n            passwordRef.current.focus()\n        }\n    }, [loginMode, registrationMode]);\n\n    useEffect(() => {\n        if (!document) return;\n        const escFunction = (event: any) => {\n            if (event.keyCode === 27) {\n                onClose();\n            }\n        };\n        document.addEventListener(\"keydown\", escFunction, false);\n        return () => {\n            document.removeEventListener(\"keydown\", escFunction, false);\n        };\n    }, [onClose]);\n\n    function handleEnterEmail() {\n        if (email) {\n            authController.fetchSignInMethodsForEmail(email).then((availableProviders) => {\n                setAvailableProviders(availableProviders)\n            });\n        }\n    }\n\n    function handleEnterPassword() {\n        if (email && password) {\n            authController.emailPasswordLogin(email, password);\n        }\n    }\n\n    function handleRegistration() {\n        if (email && password) {\n            authController.createUserWithEmailAndPassword(email, password);\n        }\n    }\n\n    const onBackPressed = () => {\n        if (shouldShowEmail) {\n            onClose();\n        } else {\n            setAvailableProviders(undefined);\n        }\n    }\n\n    const handleSubmit = (event: any) => {\n        event.preventDefault();\n        if (shouldShowEmail) {\n            handleEnterEmail();\n        } else if (loginMode) {\n            handleEnterPassword();\n        } else if (registrationMode) {\n            handleRegistration();\n        }\n    }\n\n    const label = registrationMode\n        ? \"No user found with that email. Pick a password to create a new account\"\n        : (loginMode ? \"Please enter your password\" : \"Please enter your email\");\n    const button = registrationMode ? \"Create account\" : (loginMode ? \"Login\" : \"Ok\");\n\n    if (otherProvidersMode) {\n        return (\n            <Grid container spacing={1}>\n                <Grid item xs={12}>\n                    <IconButton\n                        onClick={onBackPressed}>\n                        <ArrowBackIcon sx={{\n                            width: 20,\n                            height: 20\n                        }}/>\n                    </IconButton>\n                </Grid>\n\n                <Grid item xs={12} sx={{ p: 1 }}>\n                    <Typography align={\"center\"} variant={\"subtitle2\"}>\n                        You already have an account\n                    </Typography>\n                    <Typography align={\"center\"} variant={\"body2\"}>\n                        You can use one of these\n                        methods to login with {email}\n                    </Typography>\n                </Grid>\n\n                <Grid item xs={12}>\n                    {availableProviders && buildOauthLoginButtons(authController, availableProviders, mode, false)}\n                </Grid>\n            </Grid>\n        );\n    }\n\n    return (\n        <Slide\n            direction=\"up\"\n            in={true}\n            mountOnEnter\n            unmountOnExit>\n            <form onSubmit={handleSubmit}>\n                <Grid container spacing={1}>\n                    <Grid item xs={12}>\n                        <IconButton\n                            onClick={onBackPressed}>\n                            <ArrowBackIcon sx={{\n                                width: 20,\n                                height: 20\n                            }}/>\n                        </IconButton>\n                    </Grid>\n\n                    <Grid item xs={12} sx={{\n                        p: 1,\n                        display: (registrationMode && disableSignupScreen) ? \"none\" : \"flex\"\n                    }}>\n                        <Typography align={\"center\"}\n                                    variant={\"subtitle2\"}>{label}</Typography>\n                    </Grid>\n\n                    <Grid item xs={12}\n                          sx={{ display: shouldShowEmail ? \"inherit\" : \"none\" }}>\n                        <TextField placeholder=\"Email\" fullWidth autoFocus\n                                   value={email ?? \"\"}\n                                   disabled={authController.authLoading}\n                                   type=\"email\"\n                                   onChange={(event) => setEmail(event.target.value)}/>\n                    </Grid>\n\n                    <Grid item xs={12}>\n                        {registrationMode && noUserComponent}\n                    </Grid>\n\n                    <Grid item xs={12}\n                          sx={{ display: loginMode || (registrationMode && !disableSignupScreen) ? \"inherit\" : \"none\" }}>\n                        <TextField placeholder=\"Password\" fullWidth\n                                   value={password ?? \"\"}\n                                   disabled={authController.authLoading}\n                                   inputRef={passwordRef}\n                                   type=\"password\"\n                                   onChange={(event) => setPassword(event.target.value)}/>\n                    </Grid>\n\n                    <Grid item xs={12}>\n                        <Box sx={{\n                            display: (registrationMode && disableSignupScreen) ? \"none\" : \"flex\",\n                            justifyContent: \"end\",\n                            alignItems: \"center\",\n                            width: \"100%\"\n                        }}>\n\n                            {authController.authLoading &&\n                                <CircularProgress sx={{ p: 1 }} size={16}\n                                                  thickness={8}/>\n                            }\n\n                            <Button type=\"submit\">\n                                {button}\n                            </Button>\n                        </Box>\n                    </Grid>\n                </Grid>\n            </form>\n        </Slide>\n    );\n\n}\n\nfunction buildOauthLoginButtons(authController: FirebaseAuthController, providers: string[], mode: \"light\" | \"dark\", disabled: boolean) {\n    return <>\n        {providers.includes(\"google.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Google\"}\n            icon={googleIcon(mode)}\n            onClick={authController.googleLogin}/>}\n\n        {providers.includes(\"microsoft.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Microsoft\"}\n            icon={microsoftIcon(mode)}\n            onClick={authController.microsoftLogin}/>}\n\n        {providers.includes(\"apple.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Apple\"}\n            icon={appleIcon(mode)}\n            onClick={authController.appleLogin}/>}\n\n        {providers.includes(\"github.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Github\"}\n            icon={githubIcon(mode)}\n            onClick={authController.githubLogin}/>}\n\n        {providers.includes(\"facebook.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Facebook\"}\n            icon={facebookIcon(mode)}\n            onClick={authController.facebookLogin}/>}\n\n        {providers.includes(\"twitter.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Twitter\"}\n            icon={twitterIcon(mode)}\n            onClick={authController.twitterLogin}/>}\n    </>\n}\n","import React, { useMemo } from \"react\";\nimport { GoogleAuthProvider } from \"firebase/auth\";\nimport { CssBaseline, ThemeProvider } from \"@mui/material\";\nimport { BrowserRouter } from \"react-router-dom\";\n\nimport {\n    CenteredView,\n    CircularProgressCenter,\n    createCMSDefaultTheme,\n    FireCMS,\n    ModeControllerProvider,\n    NavigationRoutes,\n    Scaffold,\n    SideDialogs,\n    SnackbarProvider,\n    useBuildLocalConfigurationPersistence,\n    useBuildModeController\n} from \"../core\";\n\nimport { FirebaseCMSAppProps } from \"./FirebaseCMSAppProps\";\nimport { useFirebaseAuthController } from \"./hooks/useFirebaseAuthController\";\nimport { useFirestoreDataSource } from \"./hooks/useFirestoreDataSource\";\nimport { useFirebaseStorageSource } from \"./hooks/useFirebaseStorageSource\";\nimport { useInitialiseFirebase } from \"./hooks/useInitialiseFirebase\";\nimport { useInitializeAppCheck } from \"./hooks/useInitializeAppCheck\";\nimport { FirebaseLoginView } from \"./components/FirebaseLoginView\";\nimport { FirebaseAuthController } from \"./types/auth\";\nimport { useValidateAuthenticator } from \"./hooks/useValidateAuthenticator\";\nimport { useBrowserTitleAndIcon } from \"../hooks\";\n\nconst DEFAULT_SIGN_IN_OPTIONS = [\n    GoogleAuthProvider.PROVIDER_ID\n];\n\n/**\n * This is the default implementation of a FireCMS app using the Firebase services\n * as a backend.\n * You can use this component as a full app, by specifying collections and\n * entity collections.\n *\n * This component is in charge of initialising Firebase, with the given\n * configuration object.\n *\n * If you are building a larger app and need finer control, you can use\n * {@link FireCMS}, {@link Scaffold}, {@link SideDialogs}\n * and {@link NavigationRoutes} instead.\n *\n * @param props\n * @constructor\n * @category Firebase\n */\nexport function FirebaseCMSApp({\n                                   name,\n                                   logo,\n                                   logoDark,\n                                   toolbarExtraWidget,\n                                   authentication,\n                                   collectionOverrideHandler,\n                                   collections,\n                                   views,\n                                   textSearchController,\n                                   allowSkipLogin,\n                                   signInOptions = DEFAULT_SIGN_IN_OPTIONS,\n                                   firebaseConfig,\n                                   onFirebaseInit,\n                                   appCheckOptions,\n                                   primaryColor,\n                                   secondaryColor,\n                                   fontFamily,\n                                   dateTimeFormat,\n                                   locale,\n                                   HomePage,\n                                   basePath,\n                                   baseCollectionPath,\n                                   LoginView,\n                                   onAnalyticsEvent,\n                                   fields,\n                                   plugins,\n                                   autoOpenDrawer,\n                                   snackbarMaxSnack = 3,\n                                   snackbarAutoHideDuration = 5000,\n                               }: FirebaseCMSAppProps) {\n\n    /**\n     * Update the browser title and icon\n     */\n    useBrowserTitleAndIcon(name, logo);\n\n    const {\n        firebaseApp,\n        firebaseConfigLoading,\n        configError\n    } = useInitialiseFirebase({\n        onFirebaseInit,\n        firebaseConfig\n    });\n\n    const {\n        appCheckLoading,\n        getAppCheckToken\n    } = useInitializeAppCheck({\n        firebaseApp,\n        options: appCheckOptions\n    });\n\n    /**\n     * Controller for managing authentication\n     */\n    const authController: FirebaseAuthController = useFirebaseAuthController({\n        firebaseApp,\n        signInOptions\n    });\n\n    /**\n     * Controller for saving some user preferences locally.\n     */\n    const userConfigPersistence = useBuildLocalConfigurationPersistence();\n\n    /**\n     * Controller in charge of fetching and persisting data\n     */\n    const dataSource = useFirestoreDataSource({\n        firebaseApp,\n        textSearchController,\n        fields\n    });\n\n    /**\n     * Controller used for saving and fetching files in storage\n     */\n    const storageSource = useFirebaseStorageSource({\n        firebaseApp\n    });\n\n    /**\n     * Validate authenticator\n     */\n    const {\n        authLoading,\n        canAccessMainView,\n        notAllowedError\n    } = useValidateAuthenticator({\n        authController,\n        authentication,\n        getAppCheckToken,\n        appCheckForceRefresh: (appCheckOptions && appCheckOptions.forceRefresh) ? appCheckOptions.forceRefresh! : false,\n        dataSource,\n        storageSource\n    });\n\n    /**\n     * Controller used to manage the dark or light color mode\n     */\n    const modeController = useBuildModeController();\n\n    /**\n     * It is important to memoize the theme, otherwise the app will re-render\n     * whenever there is a state change in the CMS.\n     */\n    const theme = useMemo(() => createCMSDefaultTheme({\n        mode: modeController.mode,\n        primaryColor,\n        secondaryColor,\n        fontFamily\n    }), [fontFamily, modeController.mode, primaryColor, secondaryColor]);\n\n    if (configError) {\n        return <CenteredView fullScreen={true}>{configError}</CenteredView>;\n    }\n\n    if (firebaseConfigLoading || !firebaseApp || appCheckLoading) {\n        return <>\n            <CssBaseline/>\n            <CircularProgressCenter/>\n        </>;\n    }\n\n    return (\n        <BrowserRouter basename={basePath}>\n            <SnackbarProvider\n                maxSnack={snackbarMaxSnack}\n                autoHideDuration={snackbarAutoHideDuration}>\n                <ModeControllerProvider\n                    value={modeController}>\n                    <FireCMS\n                        collections={collections}\n                        views={views}\n                        authController={authController}\n                        userConfigPersistence={userConfigPersistence}\n                        collectionOverrideHandler={collectionOverrideHandler}\n                        dateTimeFormat={dateTimeFormat}\n                        dataSource={dataSource}\n                        storageSource={storageSource}\n                        entityLinkBuilder={({ entity }) => `https://console.firebase.google.com/project/${firebaseApp.options.projectId}/firestore/data/${entity.path}/${entity.id}`}\n                        locale={locale}\n                        basePath={basePath}\n                        baseCollectionPath={baseCollectionPath}\n                        onAnalyticsEvent={onAnalyticsEvent}\n                        plugins={plugins}\n                        fields={fields}>\n                        {({\n                              context,\n                              loading\n                          }) => {\n\n                            let component;\n                            if (loading || authLoading) {\n                                component = <CircularProgressCenter/>;\n                            } else {\n                                const usedLogo = modeController.mode === \"dark\" && logoDark ? logoDark : logo;\n                                if (!canAccessMainView) {\n                                    const LoginViewUsed = LoginView ?? FirebaseLoginView;\n                                    component = (\n                                        <LoginViewUsed\n                                            logo={usedLogo}\n                                            allowSkipLogin={allowSkipLogin}\n                                            signInOptions={signInOptions ?? DEFAULT_SIGN_IN_OPTIONS}\n                                            firebaseApp={firebaseApp}\n                                            authController={authController}\n                                            notAllowedError={notAllowedError}/>\n                                    );\n                                } else {\n                                    component = (\n                                        <Scaffold\n                                            name={name}\n                                            logo={usedLogo}\n                                            toolbarExtraWidget={toolbarExtraWidget}\n                                            autoOpenDrawer={autoOpenDrawer}>\n                                            <NavigationRoutes\n                                                HomePage={HomePage}/>\n                                            <SideDialogs/>\n                                        </Scaffold>\n                                    );\n                                }\n                            }\n\n                            return (\n                                <ThemeProvider theme={theme}>\n                                    <CssBaseline enableColorScheme/>\n                                    {component}\n                                </ThemeProvider>\n                            );\n                        }}\n                    </FireCMS>\n                </ModeControllerProvider>\n            </SnackbarProvider>\n        </BrowserRouter>\n    );\n}\n","import { SearchIndex } from \"algoliasearch\";\n\n/**\n * Use this controller to return a list of ids from a search index, given a\n * `path` and a `searchString`.\n * Firestore does not support text search directly so we need to rely on an external\n * index, such as Algolia.\n * Note that you will get text search requests for collections that have the\n * `textSearchEnabled` flag set to `true`.\n * @see performAlgoliaTextSearch\n * @category Firebase\n */\nexport type FirestoreTextSearchController = (props: { path: string, searchString: string }) => Promise<readonly string[]> | undefined;\n\n/**\n * Utility function to perform a text search in an algolia index,\n * returning the ids of the entities.\n * @param index\n * @param query\n * @category Firebase\n */\nexport function performAlgoliaTextSearch(index: SearchIndex, query: string): Promise<readonly string[]> {\n\n    console.debug(\"Performing Algolia query\", index, query);\n    return index\n        .search(query)\n        .then(({ hits }: any) => {\n            return hits.map((hit: any) => hit.objectID as string);\n        })\n        .catch((err: any) => {\n            console.error(err);\n            return [];\n        });\n}\n"],"names":["DEFAULT_BREADCRUMBS_CONTROLLER","props","BreadcrumbContext","React","BreadcrumbsProvider","children","breadcrumbs","setBreadcrumbs","useState","set","jsx","DEFAULT_MODE_STATE","mode","ModeControllerContext","ModeControllerProvider","removeInitialAndTrailingSlashes","s","removeInitialSlash","removeTrailingSlash","addInitialSlash","getLastSegment","path","cleanPath","segments","resolveCollectionPathAliases","allCollections","subpaths","aliasedCollection","col","resolvedAliased","segmentCollection","getCollectionByPathOrAlias","restOfThePath","pathOrAlias","collections","subpathCombinations","getCollectionPathsCombinations","result","subpathCombination","navigationEntry","a","b","entry","newPath","entries","length","i","getNavigationEntriesFromPathInternal","currentFullPath","collection","collectionPath","nextSegments","entityId","fullPath","customViews","customView","CONTAINER_FULL_WIDTH","ADDITIONAL_TAB_WIDTH","FORM_CONTAINER_WIDTH","DataSourceContext","useDataSource","useContext","NavigationContextInstance","useNavigationContext","AuthControllerContext","useAuthController","SideDialogsControllerContext","useSideDialogsController","SideEntityControllerContext","useSideEntityController","StorageSourceContext","useStorageSource","useSnackbarController","enqueueSnackbar","closeSnackbar","useSnackbar","useCallback","type","message","UserConfigurationPersistenceContext","useUserConfigurationPersistence","FireCMSContextInstance","createContext","useFireCMSContext","partialContext","authController","sideDialogsController","sideEntityController","navigation","dataSource","storageSource","snackbarController","userConfigPersistence","useCollectionFetch","inputPath","filterValues","sortBy","itemCount","searchString","sortByProperty","currentSort","context","data","setData","dataLoading","setDataLoading","dataLoadingError","setDataLoadingError","noMoreToLoad","setNoMoreToLoad","useEffect","onEntitiesUpdate","entities","entity","e","onError","error","CACHE","useEntityFetch","useCache","setEntity","onEntityUpdate","updatedEntity","saveEntityWithCallbacks","values","previousValues","status","onSaveSuccess","onSaveFailure","onPreSaveHookError","onSaveSuccessHookError","updatedValues","resolvedPath","callbacks","resolvedCollection","resolveCollection","deleteEntityWithCallbacks","onDeleteSuccess","onDeleteFailure","onPreDeleteHookError","onDeleteSuccessHookError","entityDeleteProps","useClearRestoreValue","property","value","setValue","clearedValueRef","useRef","resolveNavigationFrom","resultPromises","v","useResolvedNavigationFrom","res","useModeController","useClipboard","options","onSuccess","disableClipboardAPI","copiedDuration","ref","isCoppied","setIsCoppied","clipboard","setClipbaord","isSupported","handleError","handleSuccess","text","copyToClipboard","err","clearClipboard","copy","action","cut","operation","element","isInput","input","useBreadcrumbsContext","useReferenceDialog","referenceDialogProps","open","usedCollection","ReferenceSelectionInner","close","fireCMSLogo","useBrowserTitleAndIcon","name","logo","link","ErrorTooltip","styled","className","Tooltip","theme","tooltipClasses","ErrorView","title","tooltip","component","body","jsxs","Box","ErrorIcon","Typography","EntityReference","id","GeoPoint","latitude","longitude","PropertyPreview","fireCMSContext","content","inputProperty","propertyKey","size","height","width","resolveProperty","EmptyValue","createElement","stringProperty","UrlComponentPreview","StorageThumbnail","Markdown","StringPropertyPreview","buildWrongValueType","arrayProperty","ArrayPropertyPreview","ArrayOfMapsPreview","ArrayOfReferencesPreview","ArrayPropertyEnumPreview","ArrayOfStorageComponentsPreview","ArrayOfStringsPreview","ArrayOneOfPreview","MapPropertyPreview","DatePreview","ReferencePreview","BooleanPreview","NumberPropertyPreview","dataType","hashString","str","hash","chr","CHIP_COLORS","getColorSchemeForSeed","seed","colorKeys","index","enumToObjectEntries","enumValues","getLabelOrConfigFrom","key","getColorScheme","labelOrConfig","isEnumValueDisabled","buildEnumLabel","EnumValuesChip","enumKey","small","enumValuesConfig","enumValue","label","colorScheme","ColorChip","outlined","useTheme","usedColorScheme","Chip","resolvedProperty","resolvePropertyEnum","ErrorBoundary","Fragment","lines","PREFIX","classes","Root","resolveArrayProperty","ArrayEnumPreview","ofProperty","mapProperty","properties","previewProperties","mapProperties","Table","TableBody","TableRow","TableCell","resolveEnumValues","childSize","reference","mapPropertyKeys","of","Divider","DEFAULT_ONE_OF_TYPE","DEFAULT_ONE_OF_VALUE","typeField","valueField","TINY_THUMBNAIL","SMALL_THUMBNAIL","REGULAR_THUMBNAIL","getThumbnailMeasure","getPreviewSizeFrom","SkeletonPropertyComponent","renderUrlComponent","renderSkeletonImageThumbnail","renderSkeletonText","p","renderGenericArrayCell","renderArrayOfMaps","renderArrayEnumTableCell","renderArrayOfStrings","renderMap","renderReference","tableProperties","Grid","imageSize","Skeleton","renderSkeletonIcon","renderUrlFile","renderSkeletonCaptionText","AsyncPreviewComponent","builder","loading","setLoading","setResult","unmounted","defaultDateFormat","date","appConfig","dateUtilsLocale","locales","dateFormat","formattedDate","format","ImagePreview","url","onHover","setOnHover","useMemo","imageStyle","IconButton","ContentCopyIcon","OpenInNewIcon","previewType","hint","CardMedia","DescriptionOutlinedIcon","Link","StorageThumbnailInternal","areEqual","prevProps","nextProps","URL_CACHE","storeUrl","storagePathOrDownloadUrl","storage","downloadConfig","setDownloadConfig","filetype","getFiletype","CheckBox","CheckBoxOutlineBlank","md","MarkdownIt","source","html","ReferencePreviewInternal","disabled","onClick","allowEntityNavigation","navigationContext","referencesCache","usedEntity","listProperties","getReferencePreviewKeys","childProperty","getValueInPath","KeyboardTabIcon","ReferencePreviewWrap","clickableStyles","lighten","darken","event","pick","obj","args","isObject","item","mergeDeep","target","targetIsObject","output","o","pathSegments","removeInPath","currentObject","parts","last","part","removeFunctions","_","getHashValue","removeUndefined","isEmptyObject","childRes","isReadOnly","isHidden","isPropertyBuilder","propertyOrBuilder","getDefaultValuesFor","getDefaultValueFor","defaultValuesFor","updateDateAutoValues","inputValues","timestampNowValue","setDateToMidnight","traverseValuesProperties","inputValue","resultDate","sanitizeData","getReferenceFrom","updatedValue","traverseValueProperty","mergeCollections","subcollectionsMerged","targetSubcollection","modifiedCollection","sourceSubcollection","mergedCollection","sortProperties","joinCollectionLists","fetchedCollections","baseCollections","resolvedFetchedCollections","c","updatedCollections","navigationCollection","storedCollection","storedCollections","propertiesOrder","propertiesKeys","kebabCaseRegex","toKebabCase","regExpMatchArray","x","snakeCaseRegex","toSnakeCase","randomString","strLength","randomColor","COLLECTION_PATH_SEPARATOR","stripCollectionPath","segmentsToStrippedPath","fullPathToCollectionSegments","paths","serializeRegExp","hydrateRegExp","fragments","isValidRegExp","useDebounce","callback","timeoutMs","pendingUpdate","performUpdate","handler","useDebounceValue","delay","debouncedValue","setDebouncedValue","ArrayContainer","addLabel","buildEntry","onInternalIdAdded","includeAddButton","newDefaultEntry","hasValue","internalIdsMap","getRandomId","animatedIds","internalIdsRef","internalIds","setInternalIds","newInternalIds","hashValue","newInternalId","FieldArray","arrayHelpers","ArrayContainerInternal","insertInEnd","newIds","remove","copyingItem","onDragEnd","sourceIndex","destinationIndex","temp","DragDropContext","Droppable","provided","snapshot","rubric","internalId","ArrayContainerItem","droppableProvided","droppableSnapshot","Draggable","Button","AddIcon","measureRef","bounds","useMeasure","smallContent","ArrayItemOptions","direction","anchorEl","setAnchorEl","openMenu","closeMenu","DragHandleIcon","RemoveIcon","CopyIcon","MoreVert","Menu","MenuItem","ListItemIcon","ListItemText","FieldDescription","disabledTooltip","FormHelperText","InfoIcon","LabelWithIcon","icon","sx","DebouncedTextField","previousEventRef","internalValue","setInternalValue","deferredValue","useDeferredValue","internalOnChange","TextField","SwitchControl","field","form","formControlLabel","FormControlLabel","Switch","checked","SelectFieldBinding","showError","autoFocus","touched","includeDescription","handleClearClick","FormControl","InputLabel","getIconForProperty","MuiSelect","ClearIcon","evt","eventValue","newValue","enumConfig","ArrayEnumSelectBinding","validValue","selected","Checkbox","ArrayOfReferencesFieldBinding","isSubmitting","tableMode","expanded","selectedEntityIds","onMultipleEntitiesSelected","referenceDialogController","onEntryClick","entryValue","ExpandablePanel","resolveFilenameString","file","replacePlaceholders","resolveStoragePathString","ext","useStorageUploadController","entityValues","onChange","multipleFilesSupported","metadata","compression","internalInitialValue","initialValue","setInitialValue","equal","fileNameBuilder","fileName","storagePathBuilder","onFileUploadComplete","uploadedPath","uploadPathOrDownloadUrl","removeDuplicates","fieldValue","onFilesAdded","acceptedFiles","newInternalValue","compressionFormat","resizeAndCompressImage","items","supportedTypes","defaultQuality","resolve","inputQuality","quality","Resizer","StorageUploadProgress","storagePath","simple","setError","mounted","uploading","upload","Paper","StorageItemPreview","onRemove","fieldBackground","fieldBackgroundHover","fieldBackgroundDisabled","StyledBox","StorageUploadFieldBinding","StorageUpload","FileDropComponent","isDraggingOver","onClear","helpText","snackbarContext","getRootProps","getInputProps","isDragActive","isDragAccept","isDragReject","useDropzone","fileRejections","fileRejection","clsx","child","moveItem","fromIndex","toIndex","clearedStoragePathOrDownloadUrl","renderProperty","getStyleValue","styles","isEmpty","TextareaAutosize","onScroll","onResize","maxRows","minRows","style","onFocus","onBlur","sizeRef","other","isControlled","inputRef","handleRef","useForkRef","shadowRef","renders","state","setState","getUpdatedState","computedStyle","ownerWindow","sizeReferenceElement","inputShallow","boxSizing","padding","border","innerHeight","singleRowHeight","outerHeight","outerHeightStyle","overflow","updateState","prevState","newState","syncHeight","syncHeightWithFlushSync","ReactDOM","handleResize","debounce","resizeObserver","containerWindow","useEnhancedEffect","handleChange","DisabledTextField","TextInput","inputType","multiline","endAdornment","placeholder","focused","setFocused","numberValue","StyledTextArea","StyledInput","inner","TextFieldBinding","allowInfinity","isMultiline","valueIsInfinity","updateValue","numValue","SwitchFieldBinding","focus","setFocus","DateTimeFieldBinding","PickerComponent","DateTimePicker","DatePicker","params","MuiTextField","dateValue","ReferenceWidget","forceFilter","onSingleEntitySelected","handleClickOpen","clearValue","seeEntityDetails","buildEntityView","missingEntity","LinkIcon","ReferenceFieldBinding","ReadOnlyFieldBinding","ReferenceFieldBindingInternal","errorInfo","PropertyFieldBinding","PropertyFieldBindingInternal","aIsBuilder","bIsBuilder","shouldPropertyReRender","underlyingValueHasChanged","partOfArray","FieldComponent","Field","FastField","fieldProps","Component","fieldConfig","getFieldConfig","componentProps","FieldInternal","plugins","customFieldProps","getIn","UsedComponent","useWrappedComponent","cmsFieldProps","shouldValidate","otherPropertyKey","plugin","defAProperty","rerenderThisProperty","Wrapper","fieldId","getFieldId","enabled","MapFieldBinding","pickOnlySomeKeys","mapFormView","entryKey","buildPickKeysSelect","keys","handleAddProperty","Select","invisible","initiallyExpanded","onExpandedChange","expandedInternal","setExpandedInternal","Accordion","AccordionSummary","ExpandMoreIcon","AccordionDetails","RepeatFieldBinding","lastAddedId","setLastAddedId","arrayContainer","BlockFieldBinding","BlockEntry","typeInternal","setTypeInternal","formikContext","useFormikContext","updateType","enumValuesConfigs","typeFieldName","valueFieldName","newType","enumValueConfig","mdParser","MdEditor","Plugins","MarkdownFieldBinding","valueRef","deferred","StyledFormControl","yup","mapper","getYupEntitySchema","customFieldValidator","objectSchema","mapPropertyToYup","propertyContext","getYupStringSchema","getYupNumberSchema","getYupBooleanSchema","getYupMapObjectSchema","getYupArraySchema","getYupDateSchema","getYupGeoPointSchema","getYupReferenceSchema","childName","parentProperty","validation","regExp","hasUniqueInArrayModifier","arraySchema","yupProperties","object","arrayUniqueFields","ErrorFocus","containerRef","isValidating","errors","errorElement","scrollableParent","getScrollableParent","top","isScrollable","ele","hasScrollableContent","overflowYStyle","isOverflowHidden","fields","collectionOverride","storedProperties","defaultValues","usedValues","usedPreviousValues","resolvedProperties","propertyValue","cleanedProperties","fromBuilder","resolveProperties","cmsFields","customField","customFieldProperty","CustomIdField","customId","idSetAutomatically","inputProps","InputAdornment","ErrorMessage","EntityForm","EntityFormInternal","inputCollection","onEntitySave","onDiscard","onModified","onValuesChanged","onIdChange","onFormContextChange","hideId","initialResolvedCollection","mustSetCustomId","initialEntityId","closeAfterSaveRef","baseDataSourceValues","setEntityId","entityIdError","setEntityIdError","savingError","setSavingError","initialValues","setInitialValues","internalValues","setInternalValues","doOnValuesChanges","onIdUpdate","underlyingChanges","latestValue","saveValues","formikActions","eventName","uniqueFieldValidator","validationSchema","Formik","pluginActions","formContext","actionProps","alpha","InnerForm","setFieldValue","handleSubmit","dirty","modified","formValue","formFields","cmsFormFieldProps","formRef","Form","CustomDialogActions","ArrayCustomShapedFieldBinding","DEFAULT_FIELD_CONFIGS","ShortTextIcon","SubjectIcon","FormatQuoteIcon","HttpIcon","EmailIcon","ListIcon","ListAltIcon","NumbersIcon","FormatListNumberedIcon","UploadFileIcon","DriveFolderUploadIcon","AddLinkIcon","FlagIcon","ScheduleIcon","BallotOutlinedIcon","RepeatIcon","ViewStreamIcon","oneOf","isReferenceProperty","getIdIcon","color","fontSize","AdjustIcon","getIconForWidget","widget","Icon","Crop75Icon","FunctionsIcon","getBadgeForWidget","getColorForProperty","getPropertyInPath","getResolvedPropertyInPath","getBracketNotation","DEFAULT_PERMISSIONS","resolvePermissions","permission","canEditEntity","canCreateEntity","canDeleteEntity","getIcon","iconKey","mui","getIconForView","collectionOrView","iconsCount","collectionIconKeys","plural","word","amount","plurals","irregular","w","pattern","replace","reg","singular","singulars","targetCollection","limit","allProperties","StyledTableContainer","TableContainer","EntityPreview","getCellAlignment","getPropertyColumnWidth","getSubcollectionColumnId","TableInput","focusedState","doUpdate","TableSelect","multiple","valueType","setOpen","handleOpen","handleClose","renderValue","chip","NumberTableInput","align","propStringValue","regexp","Input","TableSwitch","TableDateField","TableReferenceField","multiselect","hoverTrue","hoverFalse","valueNotSet","buildSingleReferenceField","buildMultipleReferenceField","dropZoneMixin","activeDropMixin","acceptDropMixin","rejectDropMixin","TableStorageUpload","previewSize","previewSizeInput","rootProps","TableStorageItemPreview","EditIcon","getRowHeight","getBackgroundColor","selectedRow","saved","isSelected","TableCellRoot","justifyContent","alignItems","backgroundColor","TableCellInner","scrollable","faded","fullHeight","allowScroll","openPopup","removePadding","onSelect","showExpandIcon","isOverflowing","setIsOverflowing","maxHeight","internalSaved","setInternalSaved","iconRef","doOpenPopup","cellRect","onSelectCallback","newOverflowingValue","setOnHoverTrue","setOnHoverFalse","RemoveCircleIcon","ErrorOutlineIcon","isEqual","isStorageProperty","PropertyTableCell","columnIndex","readonly","onValueChange","selectedCell","select","setPopupCell","useEntityCollectionTableController","internalValueRef","setSaved","onValueUpdated","customPreview","readOnlyProperty","innerComponent","numberProperty","useDraggable","innerRef","y","onMove","relX","relY","listeningRef","onMouseDown","onMouseMove","onMouseUp","onMouseDownInner","update","current","innerCurrent","useWindowSize","setSize","useLayoutEffect","updateSize","ElementResizeListener","rafRef","objectRef","onResizeRef","_onResize","onLoad","position","maxWidth","translucent","Container","PopupFormField","PopupFormFieldInternal","tableKey","onClose","onCellValueChange","popupLocation","setPopupLocation","windowSize","initialPositionSet","getInitialLocation","normalizePosition","draggableBoundingRect","updatePopupLocation","newPosition","adaptResize","saveValue","actions","setFieldTouched","internalForm","draggable","Portal","CircularProgressCenter","CircularProgress","VirtualTableHeader","resizeHandleRef","isResizingIndex","sort","onColumnSort","onFilterUpdate","filter","column","onClickResizeColumn","createFilterField","openFilter","setOpenFilter","handleSettingsClick","filterForProperty","newOpenFilterState","thisColumnIsResizing","hovered","Badge","ArrowUpwardIcon","ArrowDownwardIcon","ArrowDropDownCircleIcon","FilterForm","popupOpen","setPopupOpen","filterInternal","setFilterInternal","submit","reset","filterIsSet","filterField","Popover","VirtualTableHeaderRow","columns","onColumnResize","onColumnResizeEnd","columnRefs","createRef","isResizing","setIsResizing","adjustWidthColumn","end","minWidth","newWidth","getEventNewWidth","left","setCursorDocument","handleOnMouseMove","handleOnMouseUp","removeResizingListeners","attachResizeListeners","filterForThisProperty","VirtualTableRowInner","cursor","VirtualTableRow","rowData","rowIndex","onRowClick","hoverRow","setHovered","VirtualTableCell","VirtualListContext","innerElementType","forwardRef","rest","virtualTableProps","VirtualTable","onResetPagination","onEndReached","columnsProp","filterInput","checkFilterCombination","emptyMessage","onSortByUpdate","cellRenderer","setColumns","tableRef","endReachCallbackThreshold","onColumnResizeInternal","onColumnResizeEndInternal","filterRef","scrollToTop","isDesc","newSort","newSortProperty","newSortBy","resetSort","maxScroll","onEndReachedInternal","scrollOffset","scrollUpdateWasRequested","onFilterUpdateInternal","newFilterValue","buildErrorView","buildEmptyView","AssignmentIcon","empty","MemoizedList","outerRef","itemSize","Row","cellData","List","EntityCollectionRowActions","frozen","selectionEnabled","toggleEntitySelection","onCopyClicked","onEditClicked","onDeleteClicked","largeLayout","useMediaQuery","editEnabled","copyEnabled","deleteEnabled","onCheckboxChange","onDeleteClick","onCopyClick","KeyboardTab","Delete","FileCopy","SearchBar","onTextSearch","expandable","large","searchText","setSearchText","active","setActive","deferredValues","clearText","SearchIcon","InputBase","FilledSelect","FilledMenuItem","CollectionTableToolbar","filterView","FilterListOffIcon","sizeSelect","Hidden","operationLabels","multipleSelectOperations","ReferenceFilterField","isArray","possibleOperations","fieldOperation","setOperation","updateFilter","op","val","prevOpIsArray","newOpIsArray","hasNewValue","doOpenDialog","StringNumberFilterField","OutlinedInput","BooleanFilterField","valueSetToTrue","valueSet","DateTimeFilterField","DEFAULT_STATE","EntityCollectionTableContext","EntityCollectionTable","initialFilter","initialSort","filterCombinations","actionsStart","tableRowActionsBuilder","selectionController","highlightedEntities","onEntityClick","onSizeChanged","textSearchEnabled","inlineEditing","setFilterValues","setSortBy","setSearchString","clearFilter","setItemCount","pageSize","paginationEnabled","disabledFilterChange","selectedEntities","setSelectedCell","popupCell","additionalFields","subcollectionColumns","subcollection","loadNextPage","resetPagination","newSearchString","additionalFieldsMap","aC","escFunction","unselect","cell","onPopupClose","displayedColumnIds","useColumnIds","propertyCellRenderer","additionalCellRenderer","additionalField","Builder","allColumns","columnsResult","childKey","filterable","filterableProperty","hoverOrOpen","additionalTableColumns","idColumn","columnKey","updatedFilterValues","setIn","saveProps","getDefaultColumnKeys","includeSubcollections","propertyKeys","subCollections","columnIds","subCollectionIds","subColId","hideAndExpandKeys","filterValue","setFilterValue","baseProperty","defaultTransitionDuration","SideDialogDrawer","offsetPosition","Modal","Backdrop","Slide","useNavigationUnsavedChangesDialog","when","nextLocation","setNextLocation","navigator","UNSAFE_NavigationContext","navigate","useNavigate","handleCancel","handleOk","blocker","retry","unblock","tx","autoUnblockingTx","UnsavedChangesDialog","Dialog","DialogTitle","DialogContent","DialogContentText","SideDialogContext","blocked","useSideDialogContext","SideDialogs","sidePanels","panels","panel","SideDialogView","drawerCloseRequested","setDrawerCloseRequested","setBlocked","blockedNavigationMessage","setBlockedNavigationMessage","widthRef","navigationWasBlocked","handleNavigationOk","handleNavigationCancel","handleDrawerCloseOk","handleDrawerCloseCancel","onCloseRequest","force","DeleteEntityDialog","entityOrEntitiesToDelete","onEntityDelete","onMultipleEntitiesDelete","entityOrEntities","setUsedEntityOrEntities","multipleEntities","setMultipleEntities","revisedEntityOrEntities","performDelete","results","success","dialogTitle","downloadCSV","additionalData","exportConfig","headers","getExportHeaders","exportableData","getExportableData","headersData","entryToCSVRow","h","csvData","downloadBlob","mergedData","processCSVValues","additional","header","getHeaders","prefix","currentKey","processCSVValue","filename","contentType","blob","pom","INITIAL_DOCUMENTS_LIMIT","ExportButton","dataRef","additionalDataRef","hasLargeAmountOfData","setHasLargeAmountOfData","fetchLargeDataAccepted","setFetchLargeDataAccepted","doDownload","fetchAdditionalFields","updateEntities","pendingDownload","additionalFieldsData","needsToAcceptFetchAllData","onOkClicked","GetAppIcon","Alert","EntityCollectionViewActions","onNewClick","exportable","onMultipleDeleteClick","loadedEntities","addButton","Add","multipleDeleteEnabled","multipleDeleteButton","button","Action","exportButton","useDataOrder","entitiesDisplayedFirst","displayedFirstId","useDebouncedData","deps","deferredData","setDeferredData","dataLength","currentDeps","haveDepsChanged","immediateUpdate","DEFAULT_PAGE_SIZE","useTableController","isFilterCombinationValid","lastDeleteTimestamp","initialSortInternal","rawData","orderedData","isFilterCombinationValidForFirestore","indexes","sortKey","sortDirection","filterKeys","filtersCount","compositeIndex","EntityCollectionView","isSubCollection","collectionProp","userOverride","selectedNavigationEntity","setSelectedNavigationEntity","deleteEntityClicked","setDeleteEntityClicked","setLastDeleteTimestamp","unselectNavigatedEntity","currentSelection","checkInlineEditing","useSelectionController","usedSelectionController","isEntitySelected","setSelectedEntities","tableController","clickedEntity","onSingleDeleteClick","selectedEntity","internalOnEntityDelete","_path","internalOnMultipleEntitiesDelete","onCollectionModifiedForUser","partialCollection","currentStoredConfig","updatedConfig","localCollection","Title","EntitiesCount","createEnabled","count","setCount","pathInput","description","maxSelection","sideDialogContext","setEntitiesDisplayedFirst","onDone","ReferenceDialogActions","toArray","NavigationGroup","group","userConfigurationPersistence","g","NavigationCollectionCard","view","CollectionIcon","favourite","CardActionArea","CardContent","StarIcon","StarBorderIcon","CardActions","ArrowForwardIcon","NavigationChip","FavouritesView","hidden","favouriteCollections","recentCollections","favouritesGroup","Collapse","useRestoreScroll","scrollsMap","location","useLocation","scroll","setScroll","setDirection","handleScroll","container","searchIndex","Index","FireCMSHomePage","additionalChildren","navigationEntries","groups","filteredUrls","setFilteredUrls","filteredNavigationEntries","updateSearchResults","allGroups","additionalSections","sectionProps","section","AdditionalCards","thisGroupCollections","AdditionalCard","BreadcrumbUpdater","breadcrumbsContext","NotFoundPage","ReactLink","DeleteConfirmationDialog","onAccept","onCancel","LoadingButton","FireCMSLogo","CenteredView","fullScreen","fadeTimeout","Fade","InfoLabel","background","Drawer","drawerOpen","closeDrawer","tooltipsOpen","ungroupedNavigationViews","buildGroupHeader","DrawerNavigationItem","grey","listItem","ListItem","NavLink","isActive","DRAWER_WIDTH","Scaffold","drawerUrl","drawerUrlLabel","toolbarExtraWidget","autoOpenDrawer","FireCMSAppBarComponent","FireCMSAppBar","setDrawerOpen","UsedDrawer","FireCMSDrawer","handleDrawerClose","computedDrawerOpen","StyledDrawer","DrawerHeader","drawerProps","logoComponent","menuIconButton","MenuIcon","MuiDrawer","openedMixin","closedMixin","ChevronRightIcon","ChevronLeftIcon","Toolbar","toggleMode","initial","Breadcrumbs","NavigateNextIcon","DarkModeOutlinedIcon","LightModeOutlinedIcon","Avatar","useLargeSideLayout","EntityView","selectedSubPath","onValuesAreModified","formWidth","onUpdate","largeLayoutTabSelected","resolvedFormWidth","setFormContext","setStatus","modifiedValuesRef","modifiedValues","subcollections","subcollectionsCount","customViewsCount","getTabPositionFromPath","subPath","hasAdditionalViews","defaultSelectedView","tabsPosition","setTabsPosition","mainViewVisible","currentEntityId","setCurrentEntityId","setUsedEntity","readOnly","setReadOnly","closeAfterSave","customViewsView","colIndex","subCollectionsViews","getSelectedSubPath","onSideTabClick","buildForm","subcollectionTabs","Tab","customViewTabs","CloseIcon","Tabs","ev","EntitySidePanel","beforeunload","NEW_URL_HASH","getEntityViewWidth","mainViewSelected","resolvedWidth","useBuildSideEntityController","initialised","smallLayout","newFlag","entityOrCollectionPath","panelsFromUrl","buildSidePanelsFromUrl","propsToSidePanel","firstAdditionalView","navigationViewsForPath","lastCollectionPath","previousEntry","lastSidePanel","useBuildNavigationContext","basePath","baseCollectionPath","baseViews","collectionOverrideHandler","setCollections","views","setViews","setInitialised","topLevelNavigation","setTopLevelNavigation","navigationLoading","setNavigationLoading","navigationLoadingError","setNavigationLoadingError","cleanBasePath","cleanBaseCollectionPath","homeUrl","fullCollectionPath","buildCMSUrlPath","encodePath","buildUrlCollectionPath","computeTopNavigation","array","refreshNavigation","resolvedCollections","resolvedViews","resolveCollections","resolveCMSViews","getCollection","includeUserOverride","baseCollection","overriddenCollection","resolvedProps","permissions","isUrlCollectionPath","urlPathToDataPath","buildUrlEditCollectionPath","resolveAliasesFrom","baseLocation","filterOutNotAllowedCollections","useBuildSideDialogsController","setSidePanels","sidePanelsRef","routesStore","routesCount","updateSidePanels","newPanels","updatedPanels","panelProps","DEFAULT_COLLECTION_PATH","FireCMS","modeController","entityLinkBuilder","dateTimeFormat","locale","onAnalyticsEvent","usedBasePath","usedBasedCollectionPath","LocalizationProvider","AdapterDateFns","DateFnsUtils","FireCMSInternal","childrenResult","createCMSDefaultTheme","primaryColor","secondaryColor","fontFamily","headersFontFamily","createTheme","original","pink","red","shadow","NavigationRoutes","HomePage","customRoutes","cmsViews","cmsView","buildCMSViewRoute","collectionRoutes","urlPath","allActions","Route","RouteWrapper","homeRoute","notFoundRoute","Routes","buildCollection","buildProperty","buildProperties","buildPropertiesOrBuilder","propertiesOrBuilder","buildEnumValues","buildEnumValueConfig","buildEntityCallbacks","buildAdditionalFieldDelegate","additionalFieldDelegate","buildFieldConfig","useBuildModeController","prefersDarkModeQuery","prefersDarkMode","setMode","setDocumentMode","setDarkMode","setLightMode","useBuildLocalConfigurationPersistence","configCache","setConfigCache","getCollectionFromStorage","storageKey","getCollectionConfig","onCollectionModified","currentCache","cachedConfig","newConfig","recentlyVisitedPaths","_setRecentlyVisitedPaths","favouritePaths","_setFavouritePaths","collapsedGroups","_setCollapsedGroups","setRecentlyVisitedPaths","setFavouritePaths","setCollapsedGroups","SnackbarProvider","maxSnack","autoHideDuration","NotistackSnackbarProvider","useFirebaseAuthController","firebaseApp","signInOptions","loggedUser","setLoggedUser","authError","setAuthError","authProviderError","setAuthProviderError","initialLoading","setInitialLoading","authLoading","setAuthLoading","loginSkipped","setLoginSkipped","confirmationResult","setConfirmationResult","extra","setExtra","auth","getAuth","onAuthStateChanged","updateFirebaseUser","skipLogin","firebaseUser","onSignOut","signOut","getProviderOptions","providerId","option","googleLogin","provider","GoogleAuthProvider","scope","signInWithPopup","doOauthLogin","anonymousLogin","signInAnonymously","phoneLogin","phone","applicationVerifier","signInWithPhoneNumber","appleLogin","OAuthProvider","facebookLogin","FacebookAuthProvider","githubLogin","GithubAuthProvider","microsoftLogin","twitterLogin","TwitterAuthProvider","emailPasswordLogin","email","password","signInWithEmailAndPassword","createUserWithEmailAndPassword","createUserWithEmailAndPasswordFirebase","fetchSignInMethodsForEmail","fetchSignInMethodsForEmailFirebase","getAuthToken","Timestamp","useFirestoreDataSource","textSearchController","createEntityFromCollection","docSnap","firestoreToCMSModel","getCMSPathFromFirestorePath","buildQuery","orderBy","order","startAfter","firestore","getFirestore","collectionReference","collectionClause","queryParams","filterParameter","whereClause","cmsToFirestoreModel","orderByClause","startAfterClause","limitClause","query","getAndBuildEntity","getDoc","doc","docSnapshot","performTextSearch","ids","promises","getDocs","onSnapshot","firestoreValues","updatedFirestoreValues","serverTimestamp","documentReference","setDoc","deleteDoc","q","snapshots","coll","getCountFromServer","DocumentReference","FirestoreGeoPoint","fsPath","to","useFirebaseStorageSource","setStorage","getStorage","urlsCache","usedFilename","uploadBytes","storagePathOrUrl","fileRef","getDownloadURL","getMetadata","useValidateAuthenticator","authentication","getAppCheckToken","appCheckForceRefresh","authenticationEnabled","notAllowedError","setNotAllowedError","authVerified","setAuthVerified","canAccessMainView","checkedUserRef","checkAuthentication","delegateUser","hostingError","useInitialiseFirebase","firebaseConfig","onFirebaseInit","authDomain","setFirebaseApp","firebaseConfigLoading","setFirebaseConfigLoading","configError","setConfigError","initFirebase","config","initialisedFirebaseApp","initializeApp","response","useInitializeAppCheck","appCheckLoading","setAppCheckLoading","appCheck","setAppCheck","forceRefresh","getToken","providerKey","useEnterpriseRecaptcha","isTokenAutoRefreshEnabled","appCheck_","initializeAppCheck","ReCaptchaEnterpriseProvider","ReCaptchaV3Provider","googleIcon","appleIcon","githubIcon","facebookIcon","microsoftIcon","twitterIcon","RECAPTCHA_CONTAINER_ID","useRecaptcha","RecaptchaVerifier","FirebaseLoginView","allowSkipLogin","noUserComponent","disableSignupScreen","additionalComponent","modeState","passwordLoginSelected","setPasswordLoginSelected","phoneLoginSelected","setPhoneLoginSelected","resolvedSignInOptions","sendMFASms","recaptchaVerifier","resolver","getMultiFactorResolver","PhoneMultiFactorGenerator","phoneInfoOptions","PhoneAuthProvider","verificationId","verificationCode","cred","multiFactorAssertion","errorView","ignoredCodes","notAllowedMessage","buildOauthLoginButtons","LoginButton","Phone","PersonOutlineIcon","LoginForm","PhoneLoginForm","setPhone","code","setCode","isInvalidCode","setIsInvalidCode","ArrowBackIcon","passwordRef","setEmail","availableProviders","setAvailableProviders","setPassword","shouldShowEmail","loginMode","otherProvidersMode","registrationMode","handleEnterEmail","handleEnterPassword","handleRegistration","onBackPressed","providers","DEFAULT_SIGN_IN_OPTIONS","FirebaseCMSApp","logoDark","appCheckOptions","LoginView","snackbarMaxSnack","snackbarAutoHideDuration","CssBaseline","BrowserRouter","usedLogo","LoginViewUsed","ThemeProvider","performAlgoliaTextSearch","hits","hit"],"mappings":"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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAmI0B8a,GAAgB9a,CAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAwBjB8a,GAAgB9a,CAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAmDxB8a,GAAgB9a,CAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAO3B8a,GAAgB9a,CAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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ACA,UAAW,CACP,KAAM,YACN,YAAa,2BACb,SAAU,SACV,KAAMiN,GACN,MAAO,UACP,MAAOjN,EACX,EACA,SAAU,CACN,KAAM,WACN,YAAa,qCACb,SAAU,SACV,KAAMkN,GACN,MAAO,UACP,MAAOlH,EACX,EACA,IAAK,CACD,KAAM,MACN,YAAa,2BACb,SAAU,SACV,KAAMmH,GACN,MAAO,UACP,MAAOnN,EACX,EACA,MAAO,CACH,KAAM,QACN,YAAa,6BACb,SAAU,SACV,KAAMoN,GACN,MAAO,UACP,MAAOpN,EACX,EACA,OAAQ,CACJ,KAAM,cACN,YAAa,mDACb,SAAU,SACV,KAAMqN,GACN,MAAO,UACP,MAAOnX,EACX,EACA,aAAc,CACV,KAAM,eACN,YAAa,yDACb,SAAU,QACV,KAAMoX,GACN,MAAO,UACP,MAAOrW,EACX,EACA,aAAc,CACV,KAAM,eACN,YAAa,sCACb,SAAU,SACV,KAAMsW,GACN,MAAO,UACP,MAAOvN,EACX,EACA,cAAe,CACX,KAAM,gBACN,YAAa,mDACb,SAAU,SACV,KAAMwN,GACN,MAAO,UACP,MAAOtX,EACX,EACA,oBAAqB,CACjB,KAAM,yBACN,YAAa,2DACb,SAAU,QACV,KAAMsX,GACN,MAAO,UACP,MAAOvW,EACX,EACA,YAAa,CACT,KAAM,cACN,YAAa,mCACb,SAAU,SACV,KAAMwW,GACN,MAAO,UACP,MAAOzS,EACX,EACA,kBAAmB,CACf,KAAM,uBACN,YAAa,qCACb,SAAU,QACV,KAAM0S,GACN,MAAO,UACP,MAAO1S,EACX,EACA,UAAW,CACP,KAAM,YACN,YAAa,6CACb,SAAU,YACV,KAAMwG,GACN,MAAO,UACP,MAAOC,EACX,EACA,iBAAkB,CACd,KAAM,sBACN,YAAa,uDACb,SAAU,QACV,KAAMkM,GACN,MAAO,UACP,MAAOtW,EACX,EACA,OAAQ,CACJ,KAAM,SACN,YAAa,gDACb,SAAU,UACV,KAAMuW,GACN,MAAO,UACP,MAAOtN,EACX,EACA,UAAW,CACP,KAAM,YACN,YAAa,2BACb,SAAU,OACV,KAAMuN,GACN,MAAO,UACP,MAA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"}